import{a as n}from"./chunk-EUAKOWGB.js";import{a as I}from"./chunk-3QJCEZQC.js";import{a as _}from"./chunk-EPPWFHNT.js";import{G as E}from"./chunk-ZMFSGBQT.js";import{Cb as f,Db as y,Ib as g,Jb as M,Kb as C,Lb as p,Qc as d,Rc as T,Xd as L,Za as c,_b as q,a as l,b as h,e as a,fa as r,ic as v,jc as k,mb as m,xa as u}from"./chunk-S3YUDFSI.js";function S(i,b){i&1&&p(0,"app-loading")}var O=(()=>{class i{constructor(){this.listType=d(),this.latest=d(!1),this.query=d(),this.queryCmd=d(),this.loadMore=T.required(n),this.jam=r(L),this.notify=r(E)}getEpisodes(s){let e=this.loadMore();e.loading.set(!0);let t=s().then(o=>{this.activeRequest===t&&(this.episodes=[...this.episodes??[],...o.items],e.hasMore.set((o.total??0)>this.episodes.length),e.total.set(o.total),e.loading.set(!1))}).catch(o=>{this.activeRequest===t&&this.loadMore().loading.set(!1),this.notify.error(o)});this.activeRequest=t}searchText(){this.getEpisodes(()=>a(this,null,function*(){return this.jam.episode.search({query:this.query(),skip:this.loadMore().skip(),take:this.loadMore().take(),episodeIncTag:!0,episodeIncState:!0})}))}searchCmd(){this.getEpisodes(()=>a(this,null,function*(){return this.jam.episode.search(h(l({},this.queryCmd()),{skip:this.loadMore().skip(),take:this.loadMore().take(),episodeIncTag:!0,episodeIncState:!0}))}))}list(){this.getEpisodes(()=>a(this,null,function*(){return this.jam.episode.search({list:this.listType(),episodeIncState:!0,episodeIncTag:!0,skip:this.loadMore().skip(),take:this.loadMore().take()})}))}searchLatest(){this.getEpisodes(()=>a(this,null,function*(){return this.jam.episode.search({episodeIncState:!0,episodeIncTag:!0,skip:this.loadMore().skip(),take:this.loadMore().take()})}))}load(){this.latest()?this.searchLatest():this.query()?this.searchText():this.queryCmd()?this.searchCmd():this.listType()?this.list():this.episodes=[]}ngOnChanges(){let s=this.loadMore();s.skip.set(0),s.total.set(0),s.hasMore.set(!1),this.episodes=void 0,this.load()}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=m({type:i,selectors:[["app-episodes-loader"]],viewQuery:function(e,t){e&1&&v(t.loadMore,n,5),e&2&&k()},inputs:{listType:[1,"listType"],latest:[1,"latest"],query:[1,"query"],queryCmd:[1,"queryCmd"]},features:[u],decls:3,vars:3,consts:[[3,"episodes","showPodcast"],[3,"requestLoad"]],template:function(e,t){e&1&&(f(0,S,1,0,"app-loading"),p(1,"app-episode-list",0),M(2,"app-load-more-button",1),q("requestLoad",function(){return t.load()}),C()),e&2&&(y(t.episodes?-1:0),c(),g("episodes",t.episodes)("showPodcast",!0))},dependencies:[I,n,_],encapsulation:2})}}return i})();export{O as a};
