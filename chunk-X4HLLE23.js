import{a as h}from"./chunk-VSMEHVNZ.js";import{b as L}from"./chunk-MQ5GQMNI.js";import{a as _}from"./chunk-PZTZCA44.js";import{G as P}from"./chunk-ZVKVGF76.js";import{$d as D,Aa as p,Hb as k,Ib as f,Nb as g,Ob as C,Pb as T,Qb as c,Vc as n,Wc as v,a as d,ab as m,b as u,dc as q,e as r,ia as l,nb as y,nc as w,oc as M}from"./chunk-H2EXZDP6.js";function R(o,i){o&1&&c(0,"app-loading")}var O=(()=>{let i=class i{constructor(){this.listType=n(),this.query=n(),this.queryCmd=n(),this.loadMore=v.required(h),this.showRating=!1,this.showPlayCount=!1,this.showPlayDate=!1,this.jam=l(D),this.notify=l(P)}getTracks(s){let t=this.loadMore();t.loading.set(!0);let e=s().then(a=>{this.activeRequest===e&&(this.tracks=[...this.tracks??[],...a.items],t.hasMore.set((a.total??0)>this.tracks.length),t.total.set(a.total),t.loading.set(!1))}).catch(a=>{this.activeRequest===e&&this.loadMore().loading.set(!1),this.notify.error(a)});this.activeRequest=e}searchText(){this.getTracks(()=>r(this,null,function*(){return this.jam.track.search({query:this.query(),skip:this.loadMore().skip(),take:this.loadMore().take(),trackIncTag:!0,trackIncState:!0})}))}searchCmd(){this.getTracks(()=>r(this,null,function*(){return this.jam.track.search(u(d({},this.queryCmd()),{skip:this.loadMore().skip(),take:this.loadMore().take(),trackIncTag:!0,trackIncState:!0}))}))}list(){this.getTracks(()=>r(this,null,function*(){return this.jam.track.search({list:this.listType(),trackIncState:!0,trackIncTag:!0,skip:this.loadMore().skip(),take:this.loadMore().take()})}))}load(){this.query()?this.searchText():this.queryCmd()?this.searchCmd():this.listType()?this.list():this.tracks=[]}ngOnChanges(){let s=this.loadMore();s.skip.set(0),s.total.set(0),s.hasMore.set(!1),this.showRating=this.listType()==="highest",this.showPlayCount=this.listType()==="frequent",this.showPlayDate=this.listType()==="recent",this.tracks=void 0,this.load()}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=y({type:i,selectors:[["app-tracks-loader"]],viewQuery:function(t,e){t&1&&w(e.loadMore,h,5),t&2&&M()},inputs:{listType:[1,"listType"],query:[1,"query"],queryCmd:[1,"queryCmd"]},features:[p],decls:3,vars:6,consts:[[3,"showArtist","showPlayCount","showPlayDate","showRating","tracks"],[3,"requestLoad"]],template:function(t,e){t&1&&(k(0,R,1,0,"app-loading"),c(1,"app-track-list",0),C(2,"app-load-more-button",1),q("requestLoad",function(){return e.load()}),T()),t&2&&(f(e.tracks?-1:0),m(),g("showArtist",!0)("showPlayCount",e.showPlayCount)("showPlayDate",e.showPlayDate)("showRating",e.showRating)("tracks",e.tracks))},dependencies:[L,h,_],encapsulation:2});let o=i;return o})();export{O as a};
