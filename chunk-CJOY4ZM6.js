import{c as g}from"./chunk-7O7M2ADH.js";import{d as b}from"./chunk-ZBZLQTZR.js";import{G as h}from"./chunk-3LOKQP2Q.js";import{Gd as m,Nd as o,Wd as f,aa as c,e as l,fa as u,ra as p}from"./chunk-XLNNDSL4.js";function x(s,r,a,e){if(s)return{type:m.album,name:a,groups:s.groups.map(t=>({name:t.name,expanded:r,entries:t.items.map(i=>({id:i.id,link:`/library/albums/id/${i.id}`,extraLink:`/library/artists/id/${i.artistID}`,name:i.name,extra:i.artist,visible:!1,trackCount:i.trackCount,image:e.image.imageUrl({id:i.id,size:200,format:o.webp})}))}))}}function k(s,r,a,e){if(s)return{name:a,type:m.folder,groups:s.groups.map(t=>({name:t.name,expanded:r,entries:t.items.map(i=>({id:i.id,link:`/library/folders/id/${i.id}`,name:i.name,visible:!1,trackCount:i.trackCount,image:e.image.imageUrl({id:i.id,size:200,format:o.webp})}))}))}}function I(s,r,a,e){if(s)return{name:a,type:m.artist,groups:s.groups.map(t=>({name:t.name,expanded:r,entries:t.items.map(i=>({id:i.id,link:`/library/artists/id/${i.id}`,name:i.name,visible:!1,trackCount:i.trackCount,image:e.image.imageUrl({id:i.id,size:200,format:o.webp})}))}))}}function j(s,r,a,e){if(s)return{name:a,type:m.series,groups:s.groups.map(t=>({name:t.name,expanded:r,entries:t.items.map(i=>({id:i.id,link:`/library/series/id/${i.id}`,name:i.name,visible:!1,trackCount:i.trackCount,image:e.image.imageUrl({id:i.id,size:200,format:o.webp})}))}))}}function w(s,r,a,e){if(s)return{name:a,type:m.genre,groups:s.groups.map(t=>({name:t.name,expanded:r,entries:t.items.map(i=>({id:i.id,link:`/library/genres/id/${i.id}`,name:i.name,details:[{name:"Albums",count:i.albumCount},{name:"Artists",count:i.artistCount},{name:"Tracks",count:i.trackCount}].filter(n=>n.count>0).map(n=>`${n.name}: ${n.count}`).join(", "),visible:!1,trackCount:i.trackCount,image:e.image.imageUrl({id:i.id,size:200,format:o.webp})}))}))}}var d=class{constructor(r,a){this.type=r,this.query=a}isQuery(r){return JSON.stringify(r)===JSON.stringify(this.query)}matches(r,a){return r===this.type&&this.isQuery(a)}},T=(()=>{class s{constructor(){this.indexNotify=new p,this.app=u(g),this.jam=u(f),this.notify=u(h),this.indexes=[]}findIndexCache(a,e){return this.indexes.find(t=>t.matches(a,e))}getIndex(a,e){return l(this,null,function*(){switch(a){case m.folder:return k(yield this.jam.folder.index(e),!this.app.smallscreen,"Folders",this.jam);case m.artist:return I(yield this.jam.artist.index(e),!this.app.smallscreen,"Artists",this.jam);case m.series:return j(yield this.jam.series.index(e),!this.app.smallscreen,"Series",this.jam);case m.genre:return w(yield this.jam.genre.index(e),!this.app.smallscreen,"Genres",this.jam);case m.album:{let t=e,i=t.albumTypes?.at(0),n=i?b(i):void 0;return x(yield this.jam.album.index(t),!this.app.smallscreen,n?n.text:"Albums",this.jam)}default:return}})}requestIndex(a,e){let t=this.findIndexCache(a,e);if(t?.index)return t.index;if(t)return;let i=new d(a,e);this.indexes.push(i),this.getIndex(a,e).then(n=>{i.index=n,i.index&&this.indexNotify.emit(i)}).catch(n=>{this.notify.error(n)})}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275prov=c({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{T as a};
