import{a as R}from"./chunk-A3XTFPCP.js";import"./chunk-CERT6F7Z.js";import{a as j}from"./chunk-BAOGHNZ3.js";import{a as z}from"./chunk-7FJFRFGA.js";import"./chunk-24DMSAFT.js";import{b as X}from"./chunk-PZKV7YRJ.js";import{a as B}from"./chunk-EPPWFHNT.js";import{G as F}from"./chunk-ZMFSGBQT.js";import{i as H,k as V}from"./chunk-B4HPT77T.js";import{Bc as w,Cb as d,Db as c,Gb as I,Hb as D,Ib as O,Jb as a,Kb as o,Lb as h,Pb as S,Qb as N,Sc as L,Sd as E,U as b,Vb as u,Xb as A,Xd as G,Za as r,_b as p,ac as l,fa as g,ic as k,j as T,jc as y,ka as m,la as f,mb as v,oc as P,qc as x,rc as $}from"./chunk-S3YUDFSI.js";var q=e=>["/admin/folder",e,"tags"],Q=(e,_)=>_.track.id;function U(e,_){if(e&1){let t=u();a(0,"div",7)(1,"button",8),p("click",function(){m(t);let n=l(2);return f(n.stop())}),h(2,"i",9),a(3,"span"),A(4,0),o()()()}}function J(e,_){if(e&1){let t=u();a(0,"button",8),p("click",function(){m(t);let n=l(4);return f(n.fixAll())}),A(1,3),o()}}function K(e,_){if(e&1){let t=u();a(0,"button",8),p("click",function(){m(t);let n=l(3);return f(n.refresh(n.current.pos,!1))}),h(1,"i",12),S(2),A(3,2),N(),o(),d(4,J,2,0,"button",13)}if(e&2){let t=l(3);r(4),c(t.current.health&&t.current.health.length>0?4:-1)}}function W(e,_){if(e&1){let t=u();a(0,"div",7)(1,"button",10),p("click",function(){m(t);let n=l(2);return f(n.start())}),h(2,"i",11),S(3),A(4,1),N(),o(),d(5,K,5,1),o()}if(e&2){let t=l(2);r(5),c(t.current?5:-1)}}function Y(e,_){if(e&1&&d(0,U,5,0,"div",7)(1,W,6,1,"div",7),e&2){let t=l();c(t.searching?0:1)}}function Z(e,_){e&1&&h(0,"app-loading")}function tt(e,_){e&1&&h(0,"i",15)}function et(e,_){if(e&1){let t=u();a(0,"div",18)(1,"div",19),P(2),o(),a(3,"div",20)(4,"app-track-health",21),p("resolvedEvent",function(){let n=m(t).$implicit,s=l(3);return f(s.trackHealthResolved(n))}),o()()()}if(e&2){let t=_.$implicit;r(2),x(" ",t.track.name," "),r(2),O("trackHealth",t)}}function nt(e,_){if(e&1&&I(0,et,5,2,"div",18,Q),e&2){let t=l(2);D(t.current.health)}}function it(e,_){if(e&1&&(a(0,"div")(1,"div",14)(2,"span"),d(3,tt,1,0,"i",15),o(),a(4,"span"),P(5),o(),a(6,"a",16),h(7,"i",17),P(8),o()(),d(9,nt,2,0),o()),e&2){let t=l();r(3),c(t.searching?3:-1),r(2),$("",t.current.pos+1," / ",t.folders.length),r(),O("routerLink",w(6,q,t.current.folder.id)),r(2),x(" ",t.current.folder.name),r(),c(t.current.health?9:-1)}}var pt=(()=>{class e{static{this.localStorageName="admin.radar"}constructor(){this.searching=!1,this.trackHealthComponents=L(R),this.unsubscribe=new T,this.jam=g(G),this.notify=g(F),this.uiState=g(z),this.userStorage=g(X),this.userStorage.userChange.pipe(b(this.unsubscribe)).subscribe(()=>{this.loadFromStorage()})}trackHealthResolved(t){this.current?.health&&(this.current.health=this.current.health.filter(i=>i!==t))}stop(){this.searching=!1}start(){this.searching||!this.folders||(this.searching=!0,this.request())}request(){if(!this.searching)return;let t=0;this.current&&(t=this.current.pos+1),this.refresh(t,!0)}fixAll(){let t=this.trackHealthComponents();if(!(this.searching||!this.current))for(let i of t)i.fixAll()}refresh(t,i){this.current=void 0,this.searching=!0;let n=this.folders?.[t];if(!n){this.searching=!1;return}let s={folder:n,pos:t};this.current=s,this.userStorage.set(e.localStorageName,{folderID:n.id}),this.jam.track.health({folderIDs:[n.id],healthMedia:!0}).then(C=>{C.length>0?(s.health=C,this.searching=!1):i?this.request():(s.health=[],this.searching=!1)}).catch(C=>{this.current=void 0,this.searching=!1,this.notify.error(C)})}ngOnInit(){let t=this.uiState.get("app-admin-radar",{});this.folders=t.folders,this.current=t.current,!this.folders&&this.loadFolders()}ngOnDestroy(){this.uiState.data["app-admin-radar"]={folders:this.folders,current:this.current},this.current=void 0,this.searching=!1,this.folders=void 0,this.unsubscribe.next(),this.unsubscribe.complete()}loadFromStorage(){let t=this.userStorage.get(e.localStorageName);if(t?.folderID&&this.folders){let i=this.folders.findIndex(n=>n.id===t.folderID);i!==-1&&(this.current={folder:this.folders[i],pos:i},this.refresh(i,!1))}}loadFolders(){this.jam.folder.search({folderTypes:[E.album,E.multialbum]}).then(t=>{this.folders=t.items,this.loadFromStorage()}).catch(t=>{this.notify.error(t)})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=v({type:e,selectors:[["app-admin-radar"]],viewQuery:function(i,n){i&1&&k(n.trackHealthComponents,R,5),i&2&&y()},decls:6,vars:3,consts:()=>{let t;t=$localize`:␟2b67115641c17c9e2d3e94fd920f48fefdfdc25b␟1962047135999875061:Health Radar`;let i;i=$localize`:␟1d0d5c9a36e72bd9643ff1ede69736ae063d652b␟3133539296286953705:Stop`;let n;n=$localize`:␟f732c304c7433e5a83ffcd862c3dce709a0f4982␟3885497195825665706:Next`;let s;s=$localize`:␟c8d1785038d461ec66b5799db21864182b35900a␟1102717806459547726:Refresh`;let C;return C=$localize`:␟71697936bf93aa7b37f938e213eaf990aaa0715c␟6587306545685043964:Fix all fixable`,[i,n,s,C,[1,"radar"],["section",t],[1,"content"],[1,"buttons"],[1,"button-on-control",3,"click"],[1,"icon-stop"],[1,"button-primary",3,"click"],[1,"icon-play"],[1,"icon-reload"],[1,"button-on-control"],[1,"current"],[1,"icon-spin","icon-spinner"],[3,"routerLink"],[1,"icon-folder"],[1,"track"],[1,"meta"],[1,"track-health"],[3,"resolvedEvent","trackHealth"]]},template:function(i,n){i&1&&(a(0,"div",4)(1,"app-view-header-slim",5),d(2,Y,2,1),o(),a(3,"div",6),d(4,Z,1,0,"app-loading"),d(5,it,10,8,"div"),o()()),i&2&&(r(2),c(n.folders?2:-1),r(2),c(n.folders?-1:4),r(),c(n.folders&&n.current?5:-1))},dependencies:[V,H,R,B,j],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{min-width:130px;display:inline-block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]{padding-top:15px;padding-bottom:15px;border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-right:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]{border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{padding-top:15px;padding-bottom:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{padding-left:15px}@media(max-width:768px){[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{padding-left:0}}"]})}}return e})();export{pt as AdminRadarComponent};
