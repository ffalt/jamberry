"use strict";(self.webpackChunkjamberry=self.webpackChunkjamberry||[]).push([[240],{4240:(bt,$,M)=>{M.r($),M.d($,{AdminModule:()=>po});var N=M(6409),d=M(6895),C=M(4719),L=M(1481),et=M(3926),z=M(2486),lt=M(2364),nt=M(1208),t=M(4650);let ot=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin"]],decls:6,vars:0,consts:[[1,"left"],["role","main",1,"middle"]],template:function(e,n){1&e&&(t.TgZ(0,"aside",0),t._UZ(1,"app-admin-sidebar"),t.qZA(),t._UZ(2,"app-splitter"),t.TgZ(3,"main",1),t._UZ(4,"router-outlet"),t.qZA(),t._UZ(5,"app-admin-queue-requests"))},styles:["[_nghost-%COMP%]{width:100%;height:100%;flex:1;display:flex;flex-flow:row nowrap;overflow:hidden;align-items:flex-start;align-content:flex-start}[_nghost-%COMP%]   .left[_ngcontent-%COMP%]{width:15%;height:100%;min-width:140px}[_nghost-%COMP%]   .middle[_ngcontent-%COMP%]{width:85%;flex-grow:1;height:100%}@media (max-width: 1400px){[_nghost-%COMP%]   .left[_ngcontent-%COMP%]{width:20%}[_nghost-%COMP%]   .middle[_ngcontent-%COMP%]{width:80%}}@media (max-width: 768px){[_nghost-%COMP%]{min-height:100%;position:absolute;display:block;flex:none;flex-flow:inherit}[_nghost-%COMP%]   app-splitter[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .left[_ngcontent-%COMP%]{width:100%!important;height:auto}[_nghost-%COMP%]   .middle[_ngcontent-%COMP%]{width:100%;min-height:100%}}"]}),o})();var y=M(5861),P=M(3590),Q=M(8929),F=M(7625);const dt=["overview","tags","health","tracks","tracks-health"];var u=M(9291),_=M(3689),O=M(6491),w=M(2205),A=M(7544),Z=M(8986);function U(o,c){1&o&&t._UZ(0,"i",14)}function K(o,c){if(1&o&&(t.TgZ(0,"i"),t.ALo(1,"stringToggle"),t.qZA()),2&o){const e=t.oxw().$implicit;t.Tol(t.Dn7(1,2,e.expanded,"icon-minus","icon-plus"))}}function G(o,c){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",7),t.NdJ("click",function(){const r=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.selectNode(r))})("keydown.enter",function(){const r=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.selectNode(r))})("keydown.arrowRight",function(){const r=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.toggleNode(r))})("keydown.arrowLeft",function(){const r=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.toggleNode(r))}),t.TgZ(2,"span",8),t.NdJ("clickenter",function(){const r=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.toggleNode(r))}),t.YNc(3,U,1,0,"i",9),t.YNc(4,K,2,6,"i",10),t.qZA(),t.TgZ(5,"span",11),t.NdJ("clickenter",function(){const r=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.toggleNode(r))}),t.TgZ(6,"i"),t.ALo(7,"stringToggle"),t.qZA()(),t.TgZ(8,"span",12),t._uU(9),t.qZA(),t.TgZ(10,"span",13),t._uU(11),t.qZA()(),t.BQk()}if(2&o){const e=c.$implicit,n=t.oxw();t.xp6(1),t.Udp("padding-left",12*e.level,"px"),t.ekj("active",e===n.selected),t.xp6(1),t.MGl("title","Subfolders: ",e.folder.folderCount,""),t.xp6(1),t.Q6J("ngIf",e.isLoading),t.xp6(1),t.Q6J("ngIf",!e.isLoading&&e.hasChildren),t.xp6(1),t.Udp("color",e.color),t.Q6J("title",e.folder.type),t.xp6(1),t.Tol(t.Dn7(7,15,e.expanded,"icon-folder-open","icon-folder")),t.xp6(2),t.Q6J("title",e.folder.name),t.xp6(1),t.Oqu(e.folder.name),t.xp6(2),t.hij("| ",e.folder.type,"")}}function E(o,c){if(o.children)for(const e of o.children)c(e),E(e,c)}let q=(()=>{class o{constructor(e,n,i,r){this.app=e,this.jam=n,this.notify=i,this.folderService=r,this.nodes=[],this.expandIDs=[],this.autoSelect=!1,this.selectionChange=new t.vpe,this.unsubscribe=new Q.xQ}ngOnInit(){this.folderService.foldersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(e=>{const n=this.nodes.find(i=>i.folder.id===e.id);n&&this.jam.folder.id({id:e.id,folderIncTrackCount:!0,folderIncChildFolderCount:!0}).then(i=>{n.folder=i,e.mode===u.dw.fsnRefreshChilds&&n.expanded&&(this.collapseNode(n),n.hasChildren=(i.folderCount||0)>0,n.children=void 0,n.isLoading=!1,n.hasChildren&&(n.expanded=!0,this.checkLoadExpanded(n)))}).catch(i=>{console.error(i)})})}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}selectNode(e){this.selectionChange.emit(e.folder),this.autoSelect&&(this.selected=e)}toggleNode(e){e.expanded?this.collapseNode(e):this.expandNode(e)}refresh(){!this.jam.auth.isLoggedIn()||this.jam.folder.search({level:0,folderIncChildFolderCount:!0,folderIncTrackCount:!0}).then(e=>{this.nodes=e.items.map(n=>({folder:n,hasChildren:(n.folderCount||0)>0,level:0,color:this.typeToColor(n),expanded:this.expandIDs.includes(n.id),isLoading:!1}));for(const n of this.nodes)this.checkLoadExpanded(n)}).catch(e=>{this.notify.error(e)})}typeToColor(e){switch(e.type){case _.Sr.unknown:return"#ff9fAA";case _.Sr.artist:return"#6f806e";case _.Sr.collection:return"#adbced";case _.Sr.album:return"#bdbd9c";case _.Sr.multialbum:return"#bdaaae";case _.Sr.extras:return"#bdbdbd";default:return""}}onFolderUpdate(e){const n=this.nodes.find(i=>i.folder.id===e.id);n&&(n.folder=e)}selectFolderByID(e){const n=this.nodes.find(i=>i.folder.id===e);n?this.selected=n:this.jam.folder.id({id:e,folderIncParents:!0}).then(i=>{if(i.parents){for(const r of i.parents)this.expandIDs.includes(r.id)||this.expandIDs.push(r.id);for(const r of this.nodes)r.expanded=this.expandIDs.includes(r.folder.id),this.checkLoadExpanded(r,e)}}).catch(i=>{this.notify.error(i)})}checkLoadExpanded(e,n){e.expanded&&!e.isLoading&&this.loadChildren(e,i=>{for(const r of i)this.checkLoadExpanded(r,n)}),e.folder.id===n&&(this.selected=e,this.viewport&&this.viewport.scrollToIndex(this.nodes.indexOf(e)))}loadChildren(e,n){e.isLoading||(e.isLoading=!0,this.jam.folder.search({parentIDs:[e.folder.id],folderIncChildFolderCount:!0,folderIncTrackCount:!0}).then(i=>{const r=i.items.sort((v,H)=>v.name.localeCompare(H.name)).map(v=>({folder:v,hasChildren:(v.folderCount||0)>0,level:e.level+1,color:this.typeToColor(v),expanded:this.expandIDs.includes(v.id),isLoading:!1})),p=this.nodes.indexOf(e);p>=0&&(this.nodes=this.nodes.slice(0,p+1).concat(r).concat(this.nodes.slice(p+1))),e.children=r,e.isLoading=!1,n&&n(r)}).catch(i=>{this.notify.error(i)}))}collapseNode(e){if(e.expanded){const n=[];E(e,i=>n.push(i.folder.id)),this.nodes=this.nodes.filter(i=>!n.includes(i.folder.id)),e.expanded=!1,e.children=void 0,this.expandIDs=(this.expandIDs||[]).filter(i=>i!==e.folder.id)}}expandNode(e){if(!e.expanded){if(e.children){const n=this.nodes.indexOf(e);this.nodes=this.nodes.slice(0,n+1).concat(e.children).concat(this.nodes.slice(n+1))}else this.loadChildren(e);this.expandIDs.push(e.folder.id),e.expanded=!0}}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(_.K4),t.Y36(u.c),t.Y36(u.Cr))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder-tree"]],viewQuery:function(e,n){if(1&e&&t.Gf(N.N7,7),2&e){let i;t.iGM(i=t.CRH())&&(n.viewport=i.first)}},inputs:{autoSelect:"autoSelect"},outputs:{selectionChange:"selectionChange"},decls:8,vars:2,consts:[[1,"actions"],[1,"name"],["title","Refresh Folder Tree",1,"button-on-control",3,"click"],["aria-hidden","true",1,"icon-reload"],["appFocusKeyList","",1,"tree"],[1,"list-container","list-group",2,"height","100%",3,"itemSize"],[4,"cdkVirtualFor","cdkVirtualForOf"],["appFocusKeyListItem","",1,"node",3,"click","keydown.enter","keydown.arrowRight","keydown.arrowLeft"],[1,"node-toggle",3,"title","clickenter"],["class","icon-spin icon-spinner",4,"ngIf"],[3,"class",4,"ngIf"],[1,"node-icon",3,"title","clickenter"],[3,"title"],[1,"node-type"],[1,"icon-spin","icon-spinner"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"span",1),t._uU(2,"Folders"),t.qZA(),t.TgZ(3,"button",2),t.NdJ("click",function(){return n.refresh()}),t._UZ(4,"i",3),t.qZA()(),t.TgZ(5,"div",4)(6,"cdk-virtual-scroll-viewport",5),t.YNc(7,G,12,19,"ng-container",6),t.qZA()()),2&e&&(t.xp6(6),t.Q6J("itemSize",22),t.xp6(1),t.Q6J("cdkVirtualForOf",n.nodes))},dependencies:[d.O5,O.X,w.j,A.R,N.xd,N.x0,N.N7,Z.C],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{padding:15px 15px 10px;background-color:var(--background-transparent);color:var(--on-control)}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{padding-right:10px;vertical-align:middle;color:var(--on-control-active);font-size:20px;font-weight:100}[_nghost-%COMP%]   .tree[_ngcontent-%COMP%]{margin-top:10px;flex:1}[_nghost-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{width:100%;height:100%;min-height:100%;overflow-x:hidden}[_nghost-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]     .cdk-virtual-scroll-content-wrapper{width:100%}[_nghost-%COMP%]   .node[_ngcontent-%COMP%]{width:100%;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-decoration:none;vertical-align:middle;height:22px;cursor:pointer;-webkit-user-select:none;user-select:none;font-size:.9em}[_nghost-%COMP%]   .node[_ngcontent-%COMP%]   .node-toggle[_ngcontent-%COMP%]{display:inline-block;min-width:20px}[_nghost-%COMP%]   .node[_ngcontent-%COMP%]   .node-type[_ngcontent-%COMP%]{padding-left:5px;font-size:.7em;text-transform:uppercase}[_nghost-%COMP%]   .node.active[_ngcontent-%COMP%]{color:var(--on-control-hover)}"]}),o})();var it=M(150);function f(o,c){1&o&&(t.TgZ(0,"a"),t._UZ(1,"i",8),t._uU(2," Show Folder Tools"),t.qZA())}function x(o,c){1&o&&(t.TgZ(0,"a"),t._UZ(1,"i",9),t._uU(2," Show Folder Tree"),t.qZA())}const a=function(o){return["/admin/folder",o,"overview"]},s=function(o){return["/admin/folder",o,"tracks"]},l=function(o){return["/admin/folder",o,"sub-folders"]},g=function(o){return["/admin/folder",o,"tags"]},h=function(o){return["/admin/folder",o,"health"]},m=function(o){return["/admin/folder",o,"tracks-health"]};function b(o,c){if(1&o&&(t.TgZ(0,"nav",10)(1,"ul",11)(2,"li",12)(3,"a"),t._uU(4,"Overview"),t.qZA()(),t.TgZ(5,"li",12)(6,"a"),t._uU(7,"Tracks"),t.qZA()(),t.TgZ(8,"li",12)(9,"a"),t._uU(10,"Folders"),t.qZA()(),t.TgZ(11,"li",12)(12,"a"),t._uU(13,"Tags"),t.qZA()(),t.TgZ(14,"li",12)(15,"a"),t._uU(16,"Health"),t.qZA()(),t.TgZ(17,"li",12)(18,"a"),t._uU(19,"Track Health"),t.qZA()()()()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("routerLink",t.VKq(6,a,e.id)),t.xp6(3),t.Q6J("routerLink",t.VKq(8,s,e.id)),t.xp6(3),t.Q6J("routerLink",t.VKq(10,l,e.id)),t.xp6(3),t.Q6J("routerLink",t.VKq(12,g,e.id)),t.xp6(3),t.Q6J("routerLink",t.VKq(14,h,e.id)),t.xp6(3),t.Q6J("routerLink",t.VKq(16,m,e.id))}}let I=(()=>{class o{constructor(e,n,i){this.route=e,this.router=n,this.uiState=i,this.id="",this.rightActive=!1,this.unsubscribe=new Q.xQ,this.mode="overview"}refresh(){this.tree&&this.tree.refresh()}selectionChange(e){this.router.navigate([`/admin/folder/${e.id}/${this.mode}`]).catch(n=>{console.error(n)})}onFolderUpdate(e){this.tree&&this.tree.onFolderUpdate(e)}ngOnInit(){this.router.events.pipe((0,F.R)(this.unsubscribe)).subscribe(e=>{if(e instanceof P.m2&&this.route.firstChild&&this.route.firstChild.snapshot.url[0]){const n=this.route.firstChild.snapshot.url[0].path;dt.includes(n)&&(this.mode=n)}}),this.route&&this.route.params.pipe((0,F.R)(this.unsubscribe)).subscribe(e=>{const n=e.id;this.id=n,this.tree&&n&&setTimeout(()=>{this.tree&&this.tree.selectFolderByID(n)})}),this.tree&&(this.tree.expandIDs=this.uiState.data["app-admin-folders"]||[]),this.refresh()}ngOnDestroy(){this.tree&&(this.uiState.data["app-admin-folders"]=this.tree.expandIDs),this.unsubscribe.next(),this.unsubscribe.complete()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(P.gz),t.Y36(P.F0),t.Y36(u.JU))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder"]],viewQuery:function(e,n){if(1&e&&t.Gf(q,7),2&e){let i;t.iGM(i=t.CRH())&&(n.tree=i.first)}},hostVars:2,hostBindings:function(e,n){2&e&&t.ekj("right-active",n.rightActive)},decls:11,vars:3,consts:[[1,"toggle",3,"click"],[4,"ngIf"],[1,"content"],[1,"left-content"],[3,"selectionChange"],[1,"right-content"],["class","navigation",4,"ngIf"],[1,"router-content"],[1,"icon-right"],[1,"icon-left"],[1,"navigation"],[1,"tabs"],["routerLinkActive","active",3,"routerLink"]],template:function(e,n){1&e&&(t.TgZ(0,"button",0),t.NdJ("click",function(){return n.rightActive=!n.rightActive}),t.YNc(1,f,3,0,"a",1),t.YNc(2,x,3,0,"a",1),t.qZA(),t.TgZ(3,"div",2)(4,"div",3)(5,"app-admin-folder-tree",4),t.NdJ("selectionChange",function(r){return n.selectionChange(r)}),t.qZA()(),t._UZ(6,"app-splitter"),t.TgZ(7,"div",5),t.YNc(8,b,20,18,"nav",6),t.TgZ(9,"div",7),t._UZ(10,"router-outlet"),t.qZA()()()),2&e&&(t.xp6(1),t.Q6J("ngIf",!n.rightActive),t.xp6(1),t.Q6J("ngIf",n.rightActive),t.xp6(6),t.Q6J("ngIf",n.id))},dependencies:[d.O5,it.H,P.lC,P.rH,P.Od,q],styles:["[_nghost-%COMP%]{overflow-y:auto;overflow-x:hidden;height:100%;width:100%;min-height:100%;flex:1 1 auto;position:relative;display:flex;flex-direction:column;overflow:hidden}[_nghost-%COMP%]   .toggle[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]{width:100%;z-index:1;display:flex;flex-flow:row wrap;justify-content:space-between;align-items:center;background-color:var(--background-transparent);color:var(--on-control)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%]{padding-left:0;margin-top:0;margin-bottom:0;list-style:none;border:none;display:flex;flex-flow:row wrap;width:100%}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{position:relative;display:block;margin-bottom:-1px;flex:1;align-self:stretch;border-top-width:4px;border-top-style:solid;border-top-color:transparent;border-bottom-width:4px;border-bottom-style:solid;border-bottom-color:transparent;padding:0}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]:hover{background-color:var(--control-hover);transition:all .4s ease;border-bottom-width:4px;border-bottom-style:solid;border-bottom-color:transparent}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{padding:10px 0;text-align:center;align-items:center;align-content:center;justify-content:center;margin-right:2px;line-height:1.42857143;border-radius:4px 4px 0 0;position:relative;display:flex;cursor:pointer;border:none;font-size:14px;text-transform:uppercase;letter-spacing:.5px;height:100%;color:var(--on-control);-webkit-user-select:none;user-select:none}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:focus, [_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:hover{background-color:unset;border:none;color:var(--on-control-hover)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]{cursor:default;border-bottom-color:var(--primary)!important}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{cursor:default;background-color:unset;color:var(--on-control-hover)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]:focus, [_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]:hover{border-bottom-color:var(--primary)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.disabled[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{color:var(--on-control-ambient-disabled)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.disabled[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:focus, [_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.disabled[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:hover{color:var(--on-control-ambient-disabled);text-decoration:none;cursor:not-allowed;background-color:transparent}@media (max-width: 768px){[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%]{align-items:center;align-content:center;justify-content:center}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{padding:5px;min-width:33%}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{font-size:.8em}}@media (max-width: 400px){[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{padding:0 5px}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{font-size:.7em}}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs.mini[_ngcontent-%COMP%]{padding-left:15px;padding-right:15px}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs.mini[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{flex:0}@media (max-width: 768px){[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs.mini[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{min-width:20px}}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;height:100%;flex:1;display:flex;flex-flow:row nowrap;overflow:hidden;align-items:flex-start;align-content:flex-start;padding:0;min-height:100%}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .left-content[_ngcontent-%COMP%]{height:100%;width:20%;display:block;border-right:1px solid var(--background-border);min-width:240px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]{width:80%;flex-shrink:1;flex-grow:1;height:100%;display:flex;flex-flow:column nowrap;position:relative;overflow:hidden}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]   .router-content[_ngcontent-%COMP%]{width:100%;height:100%;display:block;overflow:hidden}@media (max-width: 522px){[_nghost-%COMP%]{height:100%;width:100%;min-height:100%;overflow:hidden}[_nghost-%COMP%]   .toggle[_ngcontent-%COMP%]{display:block;position:relative;width:100%;height:33px;text-align:center;padding-top:5px;border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;height:calc(100% - 33px);min-height:calc(100% - 33px);overflow:hidden;display:block;flex:none;position:relative}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-splitter[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .left-content[_ngcontent-%COMP%]{display:flex;height:100%;width:100%}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]{display:none;height:100%;width:100%}.right-active[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .left-content[_ngcontent-%COMP%]{display:none}.right-active[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]{display:flex}}"]}),o})(),k=(()=>{class o{constructor(e){this.route=e,this.unsubscribe=new Q.xQ}ngOnInit(){this.route&&this.route.parent&&this.route.parent.params.pipe((0,F.R)(this.unsubscribe)).subscribe(e=>{this.resolve(e),this.refresh()})}idChanged(){}refresh(){}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}resolve(e){this.id=e.id,this.idChanged()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(P.gz))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-base-parent-view-id"]],decls:0,vars:0,template:function(e,n){}}),o})(),T=(()=>{class o{selectionChange(e){this.data&&(this.data.folder=e)}dialogInit(e,n){this.data=n.data,this.tree&&(this.tree.refresh(),this.data?.selectID&&this.tree.selectFolderByID(this.data.selectID))}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-choose-folder"]],viewQuery:function(e,n){if(1&e&&t.Gf(q,7),2&e){let i;t.iGM(i=t.CRH())&&(n.tree=i.first)}},decls:1,vars:1,consts:[[3,"autoSelect","selectionChange"]],template:function(e,n){1&e&&(t.TgZ(0,"app-admin-folder-tree",0),t.NdJ("selectionChange",function(r){return n.selectionChange(r)}),t.qZA()),2&e&&t.Q6J("autoSelect",!0)},dependencies:[q],styles:["[_nghost-%COMP%]{flex:1}"]}),o})();const Y=function(){return{standalone:!0}};function V(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div")(1,"form")(2,"div",1)(3,"label",2),t._uU(4,"Name"),t.qZA(),t.TgZ(5,"input",3),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.edit.name=i)}),t.qZA()()()()}if(2&o){const e=t.oxw();t.xp6(5),t.Q6J("ngModel",e.edit.name)("ngModelOptions",t.DdM(2,Y))}}let B=(()=>{class o{dialogInit(e,n){this.edit=n.data}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-folder"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"user-form-control"],["for","dialog-folder-edit"],["id","dialog-folder-edit","type","text","name","folder-name",3,"ngModel","ngModelOptions","ngModelChange"]],template:function(e,n){1&e&&t.YNc(0,V,6,3,"div",0),2&e&&t.Q6J("ngIf",n.edit)},dependencies:[d.O5,C._Y,C.Fj,C.JJ,C.JL,C.On,C.F],styles:["[_nghost-%COMP%] > div[_ngcontent-%COMP%]{margin-left:20px;margin-right:20px}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{font-size:1.3em;line-height:1.3em}[_nghost-%COMP%]   .user-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block}"]}),o})();var R=M(2747),S=M(7841),D=M(2569),J=M(7480);function at(o,c){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij(" / ",null==e.folder.tag?null:e.folder.tag.albumType,"")}}const ut=function(o){return["/admin/folder",o,"overview"]};function mt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"tr",10),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.KtG(r.selected=!r.selected)}),t.TgZ(1,"td",4)(2,"a",11),t._uU(3),t.qZA()(),t.TgZ(4,"td",5),t._uU(5),t.qZA(),t.TgZ(6,"td",6),t._uU(7),t.qZA(),t.TgZ(8,"td",7),t._uU(9),t.qZA(),t.TgZ(10,"td",8),t._uU(11),t.YNc(12,at,2,1,"ng-container",12),t.qZA()()}if(2&o){const e=c.$implicit;t.ekj("selected",e.selected),t.xp6(2),t.Q6J("routerLink",t.VKq(9,ut,e.folder.id)),t.xp6(1),t.Oqu(e.folder.name),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.artist),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.album),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.year),t.xp6(2),t.hij(" ",e.folder.type," "),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.albumType)}}function ft(o,c){if(1&o&&(t.TgZ(0,"table",2)(1,"tr",3)(2,"td",4),t._uU(3,"Title"),t.qZA(),t.TgZ(4,"td",5),t._uU(5,"Artist"),t.qZA(),t.TgZ(6,"td",6),t._uU(7,"Album"),t.qZA(),t.TgZ(8,"td",7),t._uU(9,"Year"),t.qZA(),t.TgZ(10,"td",8),t._uU(11,"Type"),t.qZA()(),t.YNc(12,mt,13,11,"tr",9),t.qZA()),2&o){const e=t.oxw();t.xp6(12),t.Q6J("ngForOf",e.folderItems)}}class Ct{constructor(c){this.folder=c}}let xt=(()=>{class o{constructor(){this.folders=[],this.folderItems=[]}getSortValue(e,n){switch(e){case"name":return n.name;case"artist":return n.tag?.artist;case"album":return n.tag?.album;case"type":return n.type;default:return}}ngOnChanges(){this.folderItems=(this.folders||[]).map(e=>new Ct(e))}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder-list"]],inputs:{folders:"folders"},features:[t.TTD],decls:2,vars:2,consts:[["name","Folders",3,"list"],["class","folders",4,"ngIf"],[1,"folders"],[1,"folder","heading"],[1,"title"],[1,"artist"],[1,"album"],[1,"year"],[1,"type"],["class","folder",3,"selected","click",4,"ngFor","ngForOf"],[1,"folder",3,"click"],[3,"routerLink"],[4,"ngIf"]],template:function(e,n){1&e&&(t._UZ(0,"app-background-text-list",0),t.YNc(1,ft,13,1,"table",1)),2&e&&(t.Q6J("list",n.folderItems),t.xp6(1),t.Q6J("ngIf",n.folderItems&&n.folderItems.length>0))},dependencies:[d.sg,d.O5,D.$,P.rH],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]{padding:15px;font-size:.8em;width:100%}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{font-size:.9em}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]{border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .folder.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}"]}),o})();function wt(o,c){1&o&&t._UZ(0,"app-loading")}function yt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.moveSubfolders())}),t._UZ(1,"i",12),t.qZA()}}function gt(o,c){if(1&o&&t._UZ(0,"app-admin-folder-list",13),2&o){const e=t.oxw(2);t.Q6J("folders",e.folder.folders)}}function pt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",2)(1,"div",3)(2,"button",4),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.refresh())}),t._UZ(3,"i",5),t.qZA(),t.TgZ(4,"button",6),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.newFolder())}),t._UZ(5,"i",7),t.qZA(),t.YNc(6,yt,2,0,"button",8),t.qZA(),t._UZ(7,"app-background-text-list",9),t.YNc(8,gt,1,1,"app-admin-folder-list",10),t.qZA()}if(2&o){const e=t.oxw();t.xp6(6),t.Q6J("ngIf",null==e.folder||null==e.folder.folders?null:e.folder.folders.length),t.xp6(1),t.Q6J("list",e.folder.folders),t.xp6(1),t.Q6J("ngIf",null==e.folder.folders?null:e.folder.folders.length)}}let st=(()=>{class o extends k{constructor(e,n,i,r,p,v){super(e),this.jam=n,this.notify=i,this.folderService=r,this.dialogsService=p,this.dialogOverlay=v}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(e=>{e.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}refresh(){this.folder=void 0,this.id&&this.jam.folder.id({id:this.id,folderIncFolders:!0,folderIncTag:!0}).then(e=>{this.folder=e}).catch(e=>{this.notify.error(e)})}newFolder(){var e=this;if(!this.folder)return;const n=this.folder,i={folder:n,name:""};var r;this.dialogOverlay.open({childComponent:B,title:"New Folder",data:i,onOkBtn:(r=(0,y.Z)(function*(){try{e.jam.folder.create({id:n.id,name:i.name}).then(p=>{e.folderService.waitForQueueResult("Creating Folder",p,[],[n.id])}).catch(p=>{e.notify.error(p)})}catch(p){return e.notify.error(p),Promise.reject(p)}}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,y.Z)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}moveSubfolders(){var e=this;if(!this.id||!this.folder?.folders)return;const n=this.id,i=this.folder.folders.map(v=>v.id),r=[n].concat(i),p={selectID:n,disableIDs:r};var v;this.dialogOverlay.open({title:"Move Subfolders to",childComponent:T,data:p,panelClass:"overlay-panel-large-buttons",onOkBtn:(v=(0,y.Z)(function*(){try{const H=p.folder;if(!H)return;r.push(H.id),e.jam.folder.move({ids:i,newParentID:H.id}).then(W=>{e.folderService.waitForQueueResult("Moving Folders",W,[],r)}).catch(W=>{e.notify.error(W)})}catch(H){return e.notify.error(H),Promise.reject(H)}}),function(){return v.apply(this,arguments)}),onCancelBtn:function(){var v=(0,y.Z)(function*(){return Promise.resolve()});return function(){return v.apply(this,arguments)}}()})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(P.gz),t.Y36(_.K4),t.Y36(u.c),t.Y36(u.Cr),t.Y36(R.Hr),t.Y36(S.SL))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder-folders"]],features:[t.qOj],decls:2,vars:2,consts:[[4,"ngIf"],["class","folders",4,"ngIf"],[1,"folders"],[1,"actions"],["title","Refresh",1,"button-on-control",3,"click"],[1,"icon-reload"],["title","New Folder\u2026",1,"button-on-control",3,"click"],[1,"icon-plus"],["class","button-on-control","title","Move Subfolders\u2026",3,"click",4,"ngIf"],["name","Folders",3,"list"],[3,"folders",4,"ngIf"],["title","Move Subfolders\u2026",1,"button-on-control",3,"click"],[1,"icon-right-bold"],[3,"folders"]],template:function(e,n){1&e&&(t.YNc(0,wt,1,0,"app-loading",0),t.YNc(1,pt,9,3,"div",1)),2&e&&(t.Q6J("ngIf",!n.folder),t.xp6(1),t.Q6J("ngIf",n.folder&&n.folder.folders))},dependencies:[d.O5,D.$,J.N,xt],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:block;overflow:hidden}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   app-admin-folder-list[_ngcontent-%COMP%]{overflow-y:auto}"]}),o})();var Mt=M(1687),j=M(529),At=M(6229),ct=M(2689);function vt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"image-cropper",6),t.NdJ("imageCropped",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.imageCropped(i))})("imageLoaded",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.imageLoaded())})("cropperReady",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.cropperReady())})("loadImageFailed",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.loadImageFailed())}),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("imageBase64",e.imageBase64)("format","jpeg")("maintainAspectRatio",e.maintainAspectRatio)}}function X(o,c){if(1&o&&(t.TgZ(0,"div",7),t._UZ(1,"img",8),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("src",e.croppedImage,t.LSH)}}let tt=(()=>{class o{constructor(e,n,i,r){this.app=e,this.jam=n,this.folderService=i,this.notify=r,this.imageBase64="",this.mimeType="image/jpeg",this.maintainAspectRatio=!0,this.imageEdited=new t.vpe,this.unsubscribe=new Q.xQ}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}load(){this.data&&this.jam.image.imageBinary({id:this.data.artwork.id}).then(e=>{this.imageBase64=`data:${e.contentType||"image/jpeg"};base64,${(0,ct.q)(e.buffer)}`}).catch(e=>{this.notify.error(e)})}imageCropped(e){e.base64&&(this.croppedImage=e.base64,this.croppedImageFile=(0,nt.Ll)(e.base64))}imageLoaded(){}cropperReady(){}loadImageFailed(){}ngOnChanges(e){this.load()}upload(){if(!this.croppedImageFile||!this.data)return;const e=this.data.folderID,n=new File([this.croppedImageFile],this.data.artwork.name,{type:this.croppedImageFile.type});this.jam.artwork.update({id:this.data.artwork.id},n).pipe((0,F.R)(this.unsubscribe)).subscribe(i=>{i.type===j.dt.Response&&(this.folderService.waitForQueueResult("Updating Folder Artwork",i.body,[e]),this.imageEdited.emit())},i=>{this.notify.error(i)},()=>{this.notify.success("Upload done")})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(_.K4),t.Y36(u.Cr),t.Y36(u.c))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-artwork-edit"]],inputs:{data:"data"},outputs:{imageEdited:"imageEdited"},features:[t.TTD],decls:9,vars:4,consts:[[1,"image-crop"],["type","checkbox",3,"ngModel","checked","ngModelChange"],[3,"imageBase64","format","maintainAspectRatio","imageCropped","imageLoaded","cropperReady","loadImageFailed",4,"ngIf"],["class","image-preview",4,"ngIf"],[1,"buttons"],[1,"button-on-control",3,"click"],[3,"imageBase64","format","maintainAspectRatio","imageCropped","imageLoaded","cropperReady","loadImageFailed"],[1,"image-preview"],["alt","Cropped Image",3,"src"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"label")(2,"input",1),t.NdJ("ngModelChange",function(r){return n.maintainAspectRatio=r}),t.qZA(),t._uU(3," Maintain Aspect Ratio "),t.qZA(),t.YNc(4,vt,1,3,"image-cropper",2),t.qZA(),t.YNc(5,X,2,1,"div",3),t.TgZ(6,"div",4)(7,"button",5),t.NdJ("click",function(){return n.upload()}),t._uU(8,"Use Cropped Artwork"),t.qZA()()),2&e&&(t.xp6(2),t.Q6J("ngModel",n.maintainAspectRatio)("checked",n.maintainAspectRatio),t.xp6(2),t.Q6J("ngIf",n.imageBase64),t.xp6(1),t.Q6J("ngIf",n.croppedImage))},dependencies:[d.O5,C.Wl,C.JJ,C.On,nt.ap],styles:["[_nghost-%COMP%]{width:100%;display:block;text-align:center}[_nghost-%COMP%]   image-cropper[_ngcontent-%COMP%]{width:300px;display:block}[_nghost-%COMP%]   .image-crop[_ngcontent-%COMP%]{display:inline-block;text-align:center;margin-left:10px;margin-right:10px}[_nghost-%COMP%]   .image-preview[_ngcontent-%COMP%]{margin-left:10px;margin-right:10px;display:inline-block}[_nghost-%COMP%]   .image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:300px}"]}),o})();function Dt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"app-admin-artwork-edit",1),t.NdJ("imageEdited",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.onImageEdited())}),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("data",e.data)}}let Nt=(()=>{class o{constructor(){this.loading=!0}dialogInit(e,n){this.data=n.data,this.reference=e}onImageEdited(){this.reference&&this.reference.close()}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-image-edit-overlay-content"]],decls:1,vars:1,consts:[[3,"data","imageEdited",4,"ngIf"],[3,"data","imageEdited"]],template:function(e,n){1&e&&t.YNc(0,Dt,1,1,"app-admin-artwork-edit",0),2&e&&t.Q6J("ngIf",n.data)},dependencies:[d.O5,tt]}),o})();const zt=["inlineEditControl"];function Et(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",2)(1,"input",3,4),t.NdJ("blur",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.onBlur(i))})("keydown.enter",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.apply())})("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.value=i)}),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("required",e.required)("name",e.value)("ngModel",e.value)("type",e.type)("placeholder",e.placeholder)}}function Yt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div")(1,"div",5),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.edit(i.value))})("focus",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.edit(i.value))}),t._uU(2),t._UZ(3,"i",6),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(2),t.hij("",e.value,"\xa0")}}let Zt=(()=>{class o{constructor(){this.placeholder="",this.type="text",this.required=!1,this.disabled=!1,this.endEditRequest=new t.vpe,this.editing=!1,this.editValue="",this.preValue="",this.onChange=Function.prototype,this.onTouched=Function.prototype}get value(){return this.editValue}set value(e){e!==this.editValue&&(this.editValue=e,this.onChange(e))}writeValue(e){this.editValue=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}onBlur(e){this.editing=!1,this.preValue!==this.editValue&&this.endEditRequest.emit()}apply(){this.editing=!1,this.endEditRequest.emit()}edit(e){this.disabled||(this.preValue=e,this.editing=!0,setTimeout(()=>{this.inlineEditControl?.nativeElement&&this.inlineEditControl.nativeElement.focus()}))}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-inline-edit"]],viewQuery:function(e,n){if(1&e&&t.Gf(zt,5),2&e){let i;t.iGM(i=t.CRH())&&(n.inlineEditControl=i.first)}},inputs:{placeholder:"placeholder",type:"type",required:"required",disabled:"disabled"},outputs:{endEditRequest:"endEditRequest"},features:[t._Bn([{provide:C.JU,useExisting:o,multi:!0}])],decls:2,vars:2,consts:[["class","inline-edit-edit",4,"ngIf"],[4,"ngIf"],[1,"inline-edit-edit"],[3,"required","name","ngModel","type","placeholder","blur","keydown.enter","ngModelChange"],["inlineEditControl",""],["title","Click to edit","tabindex","0",1,"inline-edit",3,"click","focus"],[1,"icon-edit"]],template:function(e,n){1&e&&(t.YNc(0,Et,3,5,"div",0),t.YNc(1,Yt,4,1,"div",1)),2&e&&(t.Q6J("ngIf",n.editing),t.xp6(1),t.Q6J("ngIf",!n.editing))},dependencies:[d.O5,C.Fj,C.JJ,C.Q7,C.On],styles:[".inline-edit{cursor:pointer}.inline-edit i{font-size:.7em}.inline-edit-edit{width:100%;display:block}.inline-edit-edit input{width:100%}\n"],encapsulation:2}),o})();var Lt=M(4627);function Bt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",2),t.NdJ("keydown.enter",function(){const r=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.editArtwork(r.artwork))}),t.TgZ(1,"div",3)(2,"img",4),t.NdJ("clickenter",function(){const r=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.editArtwork(r.artwork))}),t.qZA(),t.TgZ(3,"div",5),t._uU(4),t.qZA(),t.TgZ(5,"div",6),t._uU(6),t.qZA(),t.TgZ(7,"div",7),t._uU(8),t.qZA(),t.TgZ(9,"div",8),t._uU(10),t.ALo(11,"filesize"),t.qZA()(),t.TgZ(12,"div",9)(13,"app-inline-edit",10),t.NdJ("ngModelChange",function(i){const p=t.CHM(e).$implicit;return t.KtG(p.name=i)})("endEditRequest",function(){const r=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.editArtworkName(r))}),t.qZA(),t.TgZ(14,"a",11),t.NdJ("clickenter",function(){const r=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.removeArtwork(r))}),t._UZ(15,"i",12),t.qZA()()()}if(2&o){const e=c.$implicit;t.xp6(2),t.Q6J("src",e.thumbnail,t.LSH),t.xp6(2),t.Oqu(e.artwork.types),t.xp6(2),t.Oqu(e.artwork.format),t.xp6(2),t.AsE("",e.artwork.width,"x",e.artwork.height,""),t.xp6(2),t.Oqu(t.lcZ(11,7,e.artwork.size)),t.xp6(3),t.Q6J("ngModel",e.name)}}function Kt(o){const c=o.split(".");return c.pop(),c.join(".")}function Gt(o){const c=o.split(".");return c[c.length-1]}let It=(()=>{class o{constructor(e,n,i,r,p,v){this.app=e,this.jam=n,this.notify=i,this.folderService=r,this.dialogs=p,this.dialogOverlay=v}trackByFn(e,n){return n.artwork.id}ngOnChanges(e){this.displayArtworks()}editArtworkName(e){this.jam.artwork.rename({id:e.artwork.id,newName:e.name}).then(n=>{this.folderService.waitForQueueResult("Renaming Artwork",n,this.folderID?[this.folderID]:[],[])}).catch(n=>{this.notify.error(n)})}editArtwork(e){this.dialogOverlay.open({childComponent:Nt,title:"Edit Image",data:{artwork:e,folderID:this.folderID},panelClass:""})}showArtwork(e){const n=e.types.join(", ");this.dialogOverlay.open({title:n,childComponent:At.$w,data:{name:n,url:this.jam.image.imageUrl({id:e.id})}})}removeArtwork(e){this.dialogs.confirm("Remove Artworks?",`Do you want to delete "${e.artwork.name}"?`,()=>{this.jam.artwork.remove({id:e.artwork.id}).then(n=>{this.nodes&&(this.nodes=this.nodes.filter(i=>i!==e)),this.folderService.waitForQueueResult("Removing Artwork",n,this.folderID?[this.folderID]:[])}).catch(n=>{this.notify.error(n)})})}displayArtworks(){this.nodes=[],this.artworks&&(this.nodes=this.artworks.map(e=>({name:Kt(e.name),type:Gt(e.name),artwork:e,thumbnail:this.jam.image.imageUrl({id:e.id,size:128,format:_.GU.webp})})))}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(_.K4),t.Y36(u.c),t.Y36(u.Cr),t.Y36(R.Hr),t.Y36(S.SL))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-artwork-list"]],inputs:{artworks:"artworks",folderID:"folderID"},features:[t.TTD],decls:2,vars:2,consts:[["appFocusKeyList",""],["class","artwork","appFocusKeyListItem","",3,"keydown.enter",4,"ngFor","ngForOf","ngForTrackBy"],["appFocusKeyListItem","",1,"artwork",3,"keydown.enter"],[1,"artwork-img"],["alt","Artwork",3,"src","clickenter"],[1,"mode"],[1,"format"],[1,"dims"],[1,"size"],[1,"artwork-types"],["type","text",3,"ngModel","ngModelChange","endEditRequest"],["title","Delete Image",1,"delete-button",3,"clickenter"],["aria-hidden","true",1,"icon-trash"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,Bt,16,9,"div",1),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngForOf",n.nodes)("ngForTrackBy",n.trackByFn))},dependencies:[d.sg,O.X,w.j,A.R,C.JJ,C.On,Zt,Lt.c],styles:["[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]{display:inline-block;padding-top:15px;padding-right:15px;font-size:.8em;text-align:center;width:200px}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]{position:relative;overflow:hidden}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .dims[_ngcontent-%COMP%], [_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%], [_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .format[_ngcontent-%COMP%], [_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .mode[_ngcontent-%COMP%]{position:absolute;padding:5px;background-color:var(--background-transparent);color:var(--on-background-active)}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .mode[_ngcontent-%COMP%]{top:0;left:0}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .format[_ngcontent-%COMP%]{bottom:0;left:0}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .dims[_ngcontent-%COMP%]{top:0;right:0}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{bottom:0;right:0}[_nghost-%COMP%]   .artwork-types[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;overflow:hidden}[_nghost-%COMP%]   .artwork-types[_ngcontent-%COMP%]   app-inline-edit[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .artwork-types[_ngcontent-%COMP%]   .delete-button[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}"]}),o})();function jt(o,c){1&o&&t._UZ(0,"app-loading")}function Wt(o,c){1&o&&t._UZ(0,"i",18)}function $t(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"input",19),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw().$implicit;return t.KtG(r.checked=i)}),t.qZA()}if(2&o){const e=t.oxw().$implicit;t.Q6J("ngModel",e.checked)("checked",e.checked)}}function Vt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",11),t.NdJ("keydown.enter",function(){const r=t.CHM(e).$implicit;return t.KtG(r.checked=!r.checked)}),t.TgZ(1,"div",12),t.NdJ("clickenter",function(){const r=t.CHM(e).$implicit;return t.KtG(r.checked=!r.checked)}),t._UZ(2,"img",13),t.qZA(),t.TgZ(3,"div",14)(4,"div",15)(5,"form")(6,"label"),t.YNc(7,Wt,1,0,"i",16),t.YNc(8,$t,1,2,"input",17),t._uU(9),t.qZA()()()()()}if(2&o){const e=c.$implicit;t.xp6(2),t.s9C("alt",e.name),t.Q6J("src",e.thumbnail,t.LSH),t.xp6(5),t.Q6J("ngIf",e.storing),t.xp6(1),t.Q6J("ngIf",!e.storing),t.xp6(1),t.hij(" ",e.name," ")}}function Xt(o,c){if(1&o&&(t.TgZ(0,"div"),t._UZ(1,"app-background-text-list",8),t.TgZ(2,"div",9),t.YNc(3,Vt,10,5,"div",10),t.qZA()()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("list",e.nodes),t.xp6(2),t.Q6J("ngForOf",e.nodes)("ngForTrackBy",e.trackByFn)}}function te(o,c){if(1&o&&t._UZ(0,"app-admin-artwork-list",22),2&o){const e=t.oxw(2);t.Q6J("folderID",e.data.folder.id)("artworks",e.artworks)}}function ee(o,c){if(1&o&&(t.TgZ(0,"div",20)(1,"div",2),t._uU(2,"Current Images"),t.qZA(),t.YNc(3,te,1,2,"app-admin-artwork-list",21),t.qZA()),2&o){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",!e.isArtRefreshing)}}function ne(o,c){1&o&&(t.TgZ(0,"button",25),t._UZ(1,"i",18),t.qZA())}function oe(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.use())}),t._uU(1,"Use Checked Artwork"),t.qZA()}}function ie(o,c){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,ne,2,0,"button",23),t.YNc(2,oe,2,0,"button",24),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.isWorking),t.xp6(1),t.Q6J("ngIf",!e.isWorking)}}let re=(()=>{class o{constructor(e,n,i,r){this.jam=e,this.notify=n,this.folderService=i,this.http=r,this.isWorking=!1,this.isArtRefreshing=!1,this.searchSource={name:"",url:""},this.unsubscribe=new Q.xQ}trackByFn(e,n){return n.image}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}ngOnChanges(e){this.search(),this.data&&this.data.folder&&(this.data.folder.artworks?this.artworks=this.data.folder.artworks:this.refreshArtworks())}refreshArtworks(){!this.data||(this.isArtRefreshing=!0,this.jam.artwork.search({folderIDs:[this.data.folder.id]}).then(e=>{this.isArtRefreshing=!1,this.artworks=e.items}).catch(e=>{this.isArtRefreshing=!1,console.error(e)}))}loadWikiDataID(e){var n=this;return(0,y.Z)(function*(){const i=yield n.jam.metadata.musicbrainzLookup({type:_.ej.artist,mbID:e});if(i?.data?.artist?.relations){const r=i.data.artist.relations.find(p=>"wikidata"===p.type);if(r?.url)return r.url.resource.split("/").pop()}})()}loadWikiCommonImage(e){var n=this;return(0,y.Z)(function*(){const i=yield n.loadWikiDataID(e);if(!i)return;const p=(yield n.jam.metadata.wikidataLookup({wikiDataID:i}))?.data?.entity?.claims;if(!p)return;const v=Object.keys(p);for(const H of v){let W=p[H];W=W.filter(Tt=>"string"==typeof Tt.mainsnak.datavalue.value&&(0,Mt.U_)(Tt.mainsnak.datavalue.value.toLowerCase(),["jpg","jpeg","png"]));const Qt=W[0];if(Qt){const ho=`https://en.wikipedia.org/w/api.php?format=json&action=query&origin=*&titles=File:${Qt.mainsnak.datavalue.value}&prop=imageinfo&iiprop=extmetadata|url&iiextmetadatafilter=LicenseShortName`,Ot=yield n.http.get(ho).toPromise();if(Ot&&Ot.query.pages){const _t=Ot.query.pages[Object.keys(Ot.query.pages)[0]];if(_t&&_t.imageinfo[0])return{name:_.iJ.artist,thumbnail:_t.imageinfo[0].url,image:_t.imageinfo[0].url,licence:_t.imageinfo[0].extmetadata.LicenseShortName.value,checked:!0,storing:!1,types:[_.iJ.artist]}}}}})()}loadWikiCommon(e){this.loadWikiCommonImage(e).then(n=>{this.nodes=[],n&&(n.checked=!0,this.nodes.push(n))}).catch(n=>{this.nodes=[],this.notify.error(n)})}use(){const e=(this.nodes||[]).find(i=>i.checked&&!i.storing),n=this.data?.folder;e&&n?(this.isWorking=!0,e.storing=!0,this.jam.artwork.createByUrl({folderID:n.id,url:e.image,types:e.types}).then(i=>{this.folderService.waitForQueueResult("Creating Artwork",i,[n.id]).pipe((0,F.R)(this.unsubscribe)).subscribe(()=>{e.storing=!1,e.checked=!1}),this.use()}).catch(i=>{e.storing=!1,this.notify.error(i)})):this.isWorking=!1}ngOnInit(){this.folderService.foldersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(e=>{e.id===this.data?.folder.id&&this.refreshArtworks()})}loadReleaseGroupAndRelease(e,n){this.jam.metadata.coverartarchiveLookup({type:_.xB.releaseGroup,mbID:n}).then(i=>{let r=this.coverArtResponseToNodes(i.data);this.jam.metadata.coverartarchiveLookup({type:_.xB.release,mbID:e}).then(p=>{r=r.concat(this.coverArtResponseToNodes(p.data)),this.display(r)}).catch(p=>{this.notify.error(p)})}).catch(i=>{this.notify.error(i)})}loadReleaseGroup(e){this.jam.metadata.coverartarchiveLookup({type:_.xB.releaseGroup,mbID:e}).then(n=>{const i=this.coverArtResponseToNodes(n.data);this.display(i)}).catch(n=>{this.notify.error(n)})}loadRelease(e){e&&this.jam.metadata.coverartarchiveLookup({type:_.xB.release,mbID:e}).then(n=>{const i=this.coverArtResponseToNodes(n.data);this.display(i),0===i.length&&this.data&&this.data.folder&&this.data.folder.tag&&this.data.folder.tag.mbReleaseGroupID&&(this.nodes=void 0,this.loadReleaseGroup(this.data.folder.tag.mbReleaseGroupID))}).catch(n=>{this.notify.error(n)})}coverArtResponseToNodes(e){return e.images?e.images.map(n=>(0===n.types.length&&n.types.push("Other"),{name:(n.types||[]).join("/").toLowerCase(),thumbnail:this.jam.metadata.coverartarchiveImageUrl({url:n.thumbnails.small}),licence:"",image:n.image,types:(n.types||[]).map(i=>i.toLowerCase()),checked:!1,storing:!1,stored:!1})):[]}search(){this.data&&this.data.folder&&this.data.folder.tag&&(this.data.folder.type===_.Sr.artist?this.data.folder.tag.mbArtistID&&(this.searchSource={name:"Wiki Commons",url:"https://commons.wikimedia.org"},this.loadWikiCommon(this.data.folder.tag.mbArtistID)):this.data&&this.data.folder&&this.data.folder.tag&&(this.searchSource={name:"Coverart Archive",url:"https://coverartarchive.org"},this.data.folder.tag.mbReleaseID&&this.data.folder.tag.mbReleaseGroupID?this.loadReleaseGroupAndRelease(this.data.folder.tag.mbReleaseID,this.data.folder.tag.mbReleaseGroupID):this.data.folder.tag.mbReleaseID?this.loadRelease(this.data.folder.tag.mbReleaseID):this.data.folder.tag.mbReleaseGroupID&&this.loadReleaseGroup(this.data.folder.tag.mbReleaseGroupID)))}display(e){this.nodes=e;let n=e.find(i=>1===i.types.length&&i.types[0]===_.iJ.front);n||(n=e.find(i=>i.types.includes(_.iJ.front))),n&&this.nodes.forEach(i=>i.checked=i===n)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(_.K4),t.Y36(u.c),t.Y36(u.Cr),t.Y36(j.eN))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder-artwork-search"]],inputs:{data:"data"},features:[t.TTD],decls:11,vars:6,consts:[[1,"image-selector"],[1,"art-source"],[1,"section"],["rel","noopener","target","_blank",3,"href"],[4,"ngIf"],[1,"artwork"],["class","current",4,"ngIf"],[1,"buttons"],["name","Images",3,"list"],["appFocusKeyList","",1,"images"],["appFocusKeyListItem","",3,"keydown.enter",4,"ngFor","ngForOf","ngForTrackBy"],["appFocusKeyListItem","",3,"keydown.enter"],[1,"image",3,"clickenter"],[3,"alt","src"],[1,"footer"],[1,"footer-content"],["class","icon-spin icon-spinner",4,"ngIf"],["type","checkbox",3,"ngModel","checked","ngModelChange",4,"ngIf"],[1,"icon-spin","icon-spinner"],["type","checkbox",3,"ngModel","checked","ngModelChange"],[1,"current"],[3,"folderID","artworks",4,"ngIf"],[3,"folderID","artworks"],["class","button-on-control",4,"ngIf"],["class","button-on-control",3,"click",4,"ngIf"],[1,"button-on-control"],[1,"button-on-control",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3),t._uU(4),t.qZA()(),t.YNc(5,jt,1,0,"app-loading",4),t.YNc(6,Xt,4,3,"div",4),t.qZA(),t.TgZ(7,"div",5),t.YNc(8,ee,4,1,"div",6),t.qZA()(),t.TgZ(9,"div",7),t.YNc(10,ie,3,2,"div",4),t.qZA()),2&e&&(t.xp6(3),t.Q6J("href",n.searchSource.url,t.LSH),t.xp6(1),t.Oqu(n.searchSource.name),t.xp6(1),t.Q6J("ngIf",!n.nodes),t.xp6(1),t.Q6J("ngIf",n.nodes),t.xp6(2),t.Q6J("ngIf",n.data&&n.artworks),t.xp6(2),t.Q6J("ngIf",n.nodes&&n.nodes.length>0))},dependencies:[d.sg,d.O5,D.$,J.N,O.X,w.j,A.R,C._Y,C.Wl,C.JJ,C.JL,C.On,C.F,It],styles:["[_nghost-%COMP%]   .image-selector[_ngcontent-%COMP%]{display:flex;flex-flow:column wrap;height:calc(100% - 40px)}[_nghost-%COMP%]   .image-buttons[_ngcontent-%COMP%]{height:40px}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]{overflow-y:auto;width:50%;height:100%;padding-left:15px}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]{padding-right:15px;overflow-y:auto;width:50%;height:100%;border-right:1px solid var(--background-border)}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{display:inline-block;padding-top:15px;padding-right:15px;font-size:.8em}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:185px;min-width:185px;min-height:185px;height:auto}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{font-size:.8em}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]{border-bottom:1px solid var(--background-border);padding-bottom:5px}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-active)}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}"]}),o})(),Ft=(()=>{class o{dialogInit(e,n){this.data=n.data}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-folder-artwork-search"]],decls:1,vars:1,consts:[[3,"data"]],template:function(e,n){1&e&&t._UZ(0,"app-admin-folder-artwork-search",0),2&e&&t.Q6J("data",n.data)},dependencies:[re]}),o})();function ae(o,c){1&o&&(t.TgZ(0,"div",1)(1,"div",2),t._UZ(2,"i",3),t.qZA()())}function se(o,c){1&o&&(t.TgZ(0,"div",2),t._uU(1,"No Hints"),t.qZA())}function ce(o,c){if(1&o&&(t.TgZ(0,"div",10),t._uU(1),t.qZA()),2&o){const e=c.$implicit;t.xp6(1),t.Oqu(e)}}function le(o,c){if(1&o&&(t.TgZ(0,"div",2),t._UZ(1,"i",8),t._uU(2),t.YNc(3,ce,2,1,"div",9),t.qZA()),2&o){const e=c.$implicit;t.xp6(2),t.hij(" ",e.hint.name," "),t.xp6(1),t.Q6J("ngForOf",e.details)}}function de(o,c){1&o&&t._UZ(0,"i",3)}function ge(o,c){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.name)}}function pe(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.KtG(r.click())}),t.YNc(1,de,1,0,"i",12),t.YNc(2,ge,2,1,"ng-container",13),t.qZA()}if(2&o){const e=c.$implicit;t.xp6(1),t.Q6J("ngIf",e.running),t.xp6(1),t.Q6J("ngIf",!e.running)}}function he(o,c){if(1&o&&(t.TgZ(0,"div",1),t.YNc(1,se,2,0,"div",4),t.YNc(2,le,4,2,"div",5),t.TgZ(3,"div",6),t.YNc(4,pe,3,2,"button",7),t.qZA()()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",0===e.hints.length),t.xp6(1),t.Q6J("ngForOf",e.hints)("ngForTrackBy",e.trackByFn),t.xp6(2),t.Q6J("ngForOf",e.solutions)}}let _e=(()=>{class o{constructor(e,n,i,r,p,v){this.app=e,this.router=n,this.jam=i,this.notify=r,this.dialogOverlay=p,this.folderService=v,this.solutions=[],this.unsubscribe=new Q.xQ}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}trackByFn(e,n){return n.hint.id}searchImages(e){this.dialogOverlay.open({title:"Search Artwork Images",childComponent:Ft,data:{folder:e},panelClass:"overlay-panel-large-buttons"})}ngOnChanges(){this.display(this.folderHealth)}static describeImageInvalidHint(e,n){if(!e.details||0===e.details.length)return[];const i=[e.details[0].reason];return e.details[0].expected&&i.push(`Expected: ${e.details[0].expected} Actual: ${e.details[0].actual}`),i}static describeAlbumTracksMissingHint(e,n){if(!e.details||0===e.details.length)return[];const i=[];return e.details[0].expected&&i.push(`Expected: ${e.details[0].expected} Actual: ${e.details[0].actual}`),i}describeImageQualityHint(e,n){if(this.addAlbumImageSearchSolution(n),!e.details||0===e.details.length)return[];const i=[e.details[0].reason];return i.push(`Expected: ${e.details[0].expected} Actual: ${e.details[0].actual}`),i}addArtistImageSearchSolution(e){var r,n=this;if(e.tag&&e.tag.mbArtistID){const i={name:"Search",click:(r=(0,y.Z)(function*(){n.searchImages(e)}),function(){return r.apply(this,arguments)})};this.solutions.push(i)}}addAlbumImageSearchSolution(e){var r,n=this;if(e.tag&&(e.tag.mbReleaseID||e.tag.mbReleaseGroupID)){const i={name:"Search",click:(r=(0,y.Z)(function*(){n.searchImages(e)}),function(){return r.apply(this,arguments)})};this.solutions.push(i)}}addRenameSolution(e,n){var p,i=this;if(!this.solutions.find(r=>"Rename"===r.name)){const r={name:"Rename",click:(p=(0,y.Z)(function*(){if(r.running)return;r.running=!0;const v=yield i.jam.folder.rename({id:e.id,name:n});i.folderService.waitForQueueResult("Renaming Folder",v,[e.id]).pipe((0,F.R)(i.unsubscribe)).subscribe(()=>{r.running=!1})}),function(){return p.apply(this,arguments)})};this.solutions.push(r)}}addEditTagSolution(e){var r,n=this;if(!this.solutions.find(i=>"Edit Tags"===i.name)){const i={name:"Edit Tags",click:(r=(0,y.Z)(function*(){n.router.navigate([`/admin/folder/${e.id}/tags`]).catch(p=>{console.error(p)})}),function(){return r.apply(this,arguments)})};this.solutions.push(i)}}describeMBIDMissingHint(e,n){return this.addEditTagSolution(n),[]}describeAlbumTagMissingHint(e,n){return this.addEditTagSolution(n),e.details?[`Expected: ${e.details.map(i=>i.expected).join(",")}`]:[]}describeNameNonConformHint(e,n){const i=e.details&&e.details.length>0?e.details[0].expected:"";return i?(this.addRenameSolution(n,i),[`Current: ${n.name}`,`Suggested Name: ${i}`]):[]}describeArtistImageMissingHint(e,n){return this.addArtistImageSearchSolution(n),[]}describeAlbumImageMissingHint(e,n){return this.addAlbumImageSearchSolution(n),[]}describeHint(e,n){switch(e.id){case _.Mx.albumMBIDExists:return this.describeMBIDMissingHint(e,n);case _.Mx.albumTagsExists:return this.describeAlbumTagMissingHint(e,n);case _.Mx.albumNameConform:case _.Mx.artistNameConform:return this.describeNameNonConformHint(e,n);case _.Mx.albumImageExists:return this.describeAlbumImageMissingHint(e,n);case _.Mx.albumTracksComplete:return o.describeAlbumTracksMissingHint(e,n);case _.Mx.artistImageExists:return this.describeArtistImageMissingHint(e,n);case _.Mx.artistImageValid:case _.Mx.albumImageValid:return o.describeImageInvalidHint(e,n);case _.Mx.albumImageQuality:return this.describeImageQualityHint(e,n)}return[]}display(e){this.hints=[],this.solutions=[],e?.health&&(this.hints=e.health.map(n=>({hint:n,details:this.describeHint(n,e.folder)})))}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(P.F0),t.Y36(_.K4),t.Y36(u.c),t.Y36(S.SL),t.Y36(u.Cr))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-folder-health"]],inputs:{folderHealth:"folderHealth"},features:[t.TTD],decls:2,vars:2,consts:[["class","hints",4,"ngIf"],[1,"hints"],[1,"hint"],[1,"icon-spin","icon-spinner"],["class","hint",4,"ngIf"],["class","hint",4,"ngFor","ngForOf","ngForTrackBy"],[1,"solutions"],["class","button-on-background",3,"click",4,"ngFor","ngForOf"],[1,"icon-warning"],["class","details",4,"ngFor","ngForOf"],[1,"details"],[1,"button-on-background",3,"click"],["class","icon-spin icon-spinner",4,"ngIf"],[4,"ngIf"]],template:function(e,n){1&e&&(t.YNc(0,ae,3,0,"div",0),t.YNc(1,he,5,4,"div",0)),2&e&&(t.Q6J("ngIf",!n.hints),t.xp6(1),t.Q6J("ngIf",n.hints))},dependencies:[d.sg,d.O5],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .icon-warning[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]{padding-left:28px;font-size:.8em;text-transform:uppercase;min-width:30%;display:inline-block}[_nghost-%COMP%]   .hints[_ngcontent-%COMP%]{padding-top:10px}[_nghost-%COMP%]   .hint[_ngcontent-%COMP%]{padding-bottom:10px}"]}),o})();function ue(o,c){if(1&o&&(t.TgZ(0,"option",11),t._uU(1),t.qZA()),2&o){const e=c.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function me(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"select",9),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.filter=i)})("ngModelChange",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.onFilterChange())}),t.YNc(1,ue,2,2,"option",10),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("ngModel",e.filter),t.xp6(1),t.Q6J("ngForOf",e.modes)}}function fe(o,c){1&o&&t._UZ(0,"app-loading")}function Ce(o,c){if(1&o&&(t.ynx(0),t.TgZ(1,"div",20),t._uU(2,"Album"),t.qZA(),t.TgZ(3,"div",21),t._uU(4),t.qZA(),t.TgZ(5,"div",22),t._uU(6),t.qZA(),t.TgZ(7,"div",23),t._uU(8),t.qZA(),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(4),t.Oqu(null==e.folder.tag?null:e.folder.tag.album),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.artist),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.year)}}function xe(o,c){if(1&o&&(t.ynx(0),t.TgZ(1,"div",20),t._uU(2,"Album"),t.qZA(),t.TgZ(3,"div",21),t._uU(4),t.qZA(),t.TgZ(5,"div",22),t._uU(6),t.qZA(),t.TgZ(7,"div",23),t._uU(8),t.qZA(),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(4),t.Oqu(null==e.folder.tag?null:e.folder.tag.album),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.artist),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.year)}}function Me(o,c){if(1&o&&(t.ynx(0),t.TgZ(1,"div",20),t._uU(2,"Artist"),t.qZA(),t.TgZ(3,"div",21),t._uU(4),t.qZA(),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(4),t.Oqu(null==e.folder.tag?null:e.folder.tag.artist)}}function ve(o,c){if(1&o&&(t.ynx(0),t.TgZ(1,"div",20),t._uU(2,"Collection"),t.qZA(),t.TgZ(3,"div",21),t._uU(4),t.qZA(),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(4),t.Oqu(e.folder.name)}}function Oe(o,c){if(1&o&&(t.ynx(0),t.TgZ(1,"div",21),t._uU(2),t.qZA(),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(2),t.Oqu(e.folder.name)}}const be=function(o){return["/admin/folder",o,"overview"]};function we(o,c){if(1&o&&(t.TgZ(0,"div",12)(1,"div",13)(2,"a",14),t.ynx(3,15),t.YNc(4,Ce,9,3,"ng-container",16),t.YNc(5,xe,9,3,"ng-container",16),t.YNc(6,Me,5,1,"ng-container",16),t.YNc(7,ve,5,1,"ng-container",16),t.YNc(8,Oe,3,1,"ng-container",17),t.BQk(),t.qZA()(),t.TgZ(9,"div",18),t._UZ(10,"app-folder-health",19),t.qZA()()),2&o){const e=c.$implicit;t.xp6(2),t.Q6J("routerLink",t.VKq(7,be,e.folder.id)),t.xp6(1),t.Q6J("ngSwitch",e.folder.type),t.xp6(1),t.Q6J("ngSwitchCase","multialbum"),t.xp6(1),t.Q6J("ngSwitchCase","album"),t.xp6(1),t.Q6J("ngSwitchCase","artist"),t.xp6(1),t.Q6J("ngSwitchCase","collection"),t.xp6(3),t.Q6J("folderHealth",e)}}let ye=(()=>{class o extends k{constructor(e,n,i,r,p){super(e),this.app=n,this.jam=i,this.notify=r,this.folderService=p,this.modes=[]}onFilterChange(){this.reDisplay()}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(e=>{if(e.id===this.id)this.refresh();else if(this.all){const n=this.all.find(i=>i.folder.id===e.id);n&&this.jam.folder.health({ids:[e.id],folderIncTag:!0}).then(i=>{if(this.all){const r=i.find(p=>p.folder.id===n.folder.id);r?this.all[this.all.indexOf(n)]=r:this.all=this.all.filter(p=>p.folder.id!==n.folder.id)}this.reDisplay()}).catch(i=>{this.notify.error(i)})}})}ngOnDestroy(){super.ngOnDestroy()}refresh(){this.hints=void 0,this.jam.folder.health({childOfID:this.id,folderIncTag:!0}).then(e=>{this.display(e)}).catch(e=>{this.notify.error(e)})}reDisplay(){this.hints=this.filter&&this.all?this.all.filter(e=>e.health&&e.health.find(n=>n.name===this.filter)):this.all}display(e){this.all=e,this.modes=[];for(const n of e)if(n.health)for(const i of n.health)this.modes.includes(i.name)||this.modes.push(i.name);this.reDisplay()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(P.gz),t.Y36(u.zi),t.Y36(_.K4),t.Y36(u.c),t.Y36(u.Cr))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder-health"]],features:[t.qOj],decls:9,vars:4,consts:[[1,"health"],[1,"actions"],["title","Refresh List",1,"button-on-control",3,"click"],[1,"icon-reload"],["placeholder","Type of Hints",3,"ngModel","ngModelChange",4,"ngIf"],[1,"health-content"],[4,"ngIf"],["name","Folder Health Issues",3,"list"],["class","folder",4,"ngFor","ngForOf"],["placeholder","Type of Hints",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"folder"],[1,"meta"],[3,"routerLink"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"folder-health"],[3,"folderHealth"],[1,"type"],[1,"name"],[1,"artist"],[1,"year"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t.NdJ("click",function(){return n.refresh()}),t._UZ(3,"i",3),t.qZA(),t.YNc(4,me,2,2,"select",4),t.qZA(),t.TgZ(5,"div",5),t.YNc(6,fe,1,0,"app-loading",6),t._UZ(7,"app-background-text-list",7),t.YNc(8,we,11,9,"div",8),t.qZA()()),2&e&&(t.xp6(4),t.Q6J("ngIf",n.modes.length>0),t.xp6(2),t.Q6J("ngIf",!n.hints),t.xp6(1),t.Q6J("list",n.hints),t.xp6(1),t.Q6J("ngForOf",n.hints))},dependencies:[d.sg,d.O5,d.RF,d.n9,d.ED,D.$,J.N,C.YN,C.Kr,C.EJ,C.JJ,C.On,P.rH,_e],styles:["[_nghost-%COMP%]{height:100%;width:100%}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .health-content[_ngcontent-%COMP%]{padding:15px;overflow-y:auto;overflow-x:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]{border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:var(--background-border);padding:15px;display:flex;flex-flow:row wrap;flex-flow:row nowrap}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{width:30%;padding-right:15px;margin-left:15px;display:flex;flex-flow:column wrap;position:relative}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;text-overflow:ellipsis;overflow:hidden}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%]{text-transform:uppercase}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .year[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .state[_ngcontent-%COMP%]{letter-spacing:1px;font-size:.8em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:24px;font-weight:100;color:var(--on-background-active)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-active)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:14px;line-height:1.2em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:5px;margin-right:5px;height:27px;font-weight:500;padding:1px 15px 0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transform:scale(1.3);transform-origin:center}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;border:1px solid transparent;padding:4px 9px 7px;border-radius:50%;display:none;position:absolute;right:1px;bottom:0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:var(--control-hover);color:var(--on-background-hover)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]:hover   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]:hover   app-fav-icon[_ngcontent-%COMP%]{display:inline}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .folder-health[_ngcontent-%COMP%]{display:flex;width:70%}@media (max-width: 400px){[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]{padding-left:0;padding-right:0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-size:.8em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:16px}}"]}),o})();var Ae=M(7111);function Pe(o,c){if(1&o&&(t.TgZ(0,"div")(1,"div"),t._uU(2),t.ALo(3,"stringToggle"),t.qZA(),t._UZ(4,"app-loading"),t.qZA()),2&o){const e=t.oxw();t.xp6(2),t.Oqu(t.Dn7(3,1,e.isUploading,"Uploading","Creating Artwork"))}}function ke(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",2),t.NdJ("drop",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.onDropFile(i))})("dragover",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.onDragOverFile(i))}),t.TgZ(1,"form")(2,"input",3),t.NdJ("change",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.selectFile(i))}),t.qZA()()()}}let Te=(()=>{class o{constructor(e,n,i){this.jam=e,this.notify=n,this.folderService=i,this.isIdle=!0,this.isUploading=!1,this.unsubscribe=new Q.xQ}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}dialogInit(e,n){this.reference=e,this.folder=n.data?.folder}waitForCreationEnd(e){if(!this.folder)return;const n=this.folder.id;this.folderService.waitForQueueResult("Creating Artwork",e,[]).pipe((0,F.R)(this.unsubscribe)).subscribe(i=>{this.isIdle=!0,this.folderService.notifyFolderChange(n,u.dw.fsnRefresh),e.error||(this.notify.success("Upload done"),this.reference&&this.reference.close())})}onDropFile(e){e.preventDefault(),this.uploadFile(e.dataTransfer?.files)}onDragOverFile(e){e.stopPropagation(),e.preventDefault()}selectFile(e){this.uploadFile(e.target.files)}uploadFile(e){if(!e||0===e.length||!this.folder)return;const n=e[0];this.isIdle=!1,this.isUploading=!0,this.jam.artwork.createByUpload({folderID:this.folder.id,types:[]},n).pipe((0,F.R)(this.unsubscribe)).subscribe(i=>{if(i.type!==j.dt.UploadProgress&&i instanceof j.Zn){const r=i.body;r&&this.waitForCreationEnd(r)}},i=>{this.isUploading=!1,this.isIdle=!0,this.notify.error(i)},()=>{this.isUploading=!1})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(_.K4),t.Y36(u.c),t.Y36(u.Cr))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-upload-image"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","drop-zone",3,"drop","dragover",4,"ngIf"],[1,"drop-zone",3,"drop","dragover"],["type","file","placeholder","Upload image","accept",".png,.jpeg,.jpg",3,"change"]],template:function(e,n){1&e&&(t.YNc(0,Pe,5,5,"div",0),t.YNc(1,ke,3,0,"div",1)),2&e&&(t.Q6J("ngIf",!n.isIdle),t.xp6(1),t.Q6J("ngIf",n.isIdle))},dependencies:[d.O5,J.N,C._Y,C.JL,C.F,Z.C],styles:["[_nghost-%COMP%]   .drop-zone[_ngcontent-%COMP%]{margin:10px 20px;border-width:2px;border-style:dotted;border-color:var(--secondary);height:80%}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}"]}),o})();var Ze=M(9743);function Ie(o,c){1&o&&t._UZ(0,"app-loading")}function Fe(o,c){if(1&o&&t._UZ(0,"app-info-note",21),2&o){const e=t.oxw(2);t.Q6J("info",e.folder.info)}}function Ue(o,c){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=t.oxw(2);t.xp6(1),t.hij(" / ",null==e.folder.tag?null:e.folder.tag.albumType,"")}}function Se(o,c){if(1&o&&(t.TgZ(0,"div")(1,"div",13),t._uU(2,"Artist"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(4),t.Oqu(null==e.folder.tag?null:e.folder.tag.artist)}}function Re(o,c){if(1&o&&(t.TgZ(0,"div")(1,"div",13),t._uU(2,"Album"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(4),t.Oqu(null==e.folder.tag?null:e.folder.tag.album)}}function He(o,c){if(1&o&&(t.TgZ(0,"div")(1,"div",13),t._uU(2,"Year"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(4),t.hij(" ",null==e.folder.tag?null:e.folder.tag.year,"")}}function qe(o,c){if(1&o&&(t.TgZ(0,"div")(1,"div",13),t._uU(2,"Genres"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(4),t.hij(" ",null==e.folder.tag?null:e.folder.tag.genres,"")}}function Je(o,c){if(1&o&&(t.TgZ(0,"div")(1,"div",13),t._uU(2,"MB Release Id"),t.qZA(),t.TgZ(3,"div")(4,"a",22),t._uU(5),t.qZA()()()),2&o){const e=t.oxw(2);t.xp6(4),t.MGl("href","https://musicbrainz.org/release/",null==e.folder.tag?null:e.folder.tag.mbReleaseID,"",t.LSH),t.xp6(1),t.Oqu(null==e.folder.tag?null:e.folder.tag.mbReleaseID)}}function Qe(o,c){if(1&o&&(t.TgZ(0,"div")(1,"div",13),t._uU(2,"MB Artist Id"),t.qZA(),t.TgZ(3,"div")(4,"a",22),t._uU(5),t.qZA()()()),2&o){const e=t.oxw(2);t.xp6(4),t.MGl("href","https://musicbrainz.org/artist/",null==e.folder.tag?null:e.folder.tag.mbArtistID,"",t.LSH),t.xp6(1),t.Oqu(null==e.folder.tag?null:e.folder.tag.mbArtistID)}}const De=function(o){return["/admin/folder",o]};function Ne(o,c){if(1&o&&(t.TgZ(0,"div")(1,"div",13),t._uU(2,"Parent Folder Id"),t.qZA(),t.TgZ(3,"div")(4,"a",23),t._uU(5),t.qZA()()()),2&o){const e=t.oxw(2);t.xp6(4),t.Q6J("routerLink",t.VKq(2,De,e.folder.parentID)),t.xp6(1),t.Oqu(e.folder.parentID)}}function ze(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",24),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.searchImages())}),t._UZ(1,"i",25),t._uU(2," Search Artwork "),t.qZA()}}function Ee(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.searchImages())}),t._UZ(1,"i",25),t._uU(2," Search Art"),t.qZA()}}function Ye(o,c){if(1&o&&(t.TgZ(0,"div",27),t._UZ(1,"app-admin-artwork-list",28),t.qZA()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("folderID",e.folder.id)("artworks",e.folder.artworks)}}function Le(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",2)(1,"div",3)(2,"button",4),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.refresh())}),t._UZ(3,"i",5),t.qZA(),t.TgZ(4,"button",6),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.moveFolder())}),t._UZ(5,"i",7),t.qZA(),t.TgZ(6,"button",8),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.removeFolder())}),t._UZ(7,"i",9),t.qZA()(),t.TgZ(8,"div",10),t.YNc(9,Fe,1,1,"app-info-note",11),t.TgZ(10,"div",12)(11,"div")(12,"div")(13,"div",13),t._uU(14,"Name"),t.qZA(),t.TgZ(15,"div")(16,"app-inline-edit",14),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.name=i)})("endEditRequest",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.editFolderName())}),t.qZA()()(),t.TgZ(17,"div")(18,"div",13),t._uU(19,"Type"),t.qZA(),t.TgZ(20,"div"),t._uU(21),t.YNc(22,Ue,2,1,"ng-container",0),t.qZA()(),t.TgZ(23,"div")(24,"div",13),t._uU(25,"Track Count"),t.qZA(),t.TgZ(26,"div"),t._uU(27),t.qZA()(),t.TgZ(28,"div")(29,"div",13),t._uU(30,"Folder Count"),t.qZA(),t.TgZ(31,"div"),t._uU(32),t.qZA()(),t.YNc(33,Se,5,1,"div",0),t.YNc(34,Re,5,1,"div",0),t.qZA(),t.TgZ(35,"div"),t.YNc(36,He,5,1,"div",0),t.YNc(37,qe,5,1,"div",0),t.YNc(38,Je,6,2,"div",0),t.YNc(39,Qe,6,2,"div",0),t.YNc(40,Ne,6,4,"div",0),t.qZA()(),t.TgZ(41,"div",15)(42,"div",3)(43,"button",16),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.uploadImage())}),t._UZ(44,"i",17),t._uU(45," Upload Artwork"),t.qZA(),t.YNc(46,ze,3,0,"button",18),t.YNc(47,Ee,3,0,"button",19),t.qZA(),t.YNc(48,Ye,2,2,"div",20),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(9),t.Q6J("ngIf",null==e.folder.info?null:e.folder.info.description),t.xp6(7),t.Q6J("ngModel",e.name),t.xp6(5),t.hij("",e.folder.type," "),t.xp6(1),t.Q6J("ngIf",e.isAlbum),t.xp6(5),t.Oqu(e.folder.trackCount),t.xp6(5),t.Oqu(e.folder.folderCount),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.artist),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.album),t.xp6(2),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.year),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag||null==e.folder.tag.genres?null:e.folder.tag.genres.length),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.mbReleaseID),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.mbArtistID),t.xp6(1),t.Q6J("ngIf",e.folder.parentID),t.xp6(6),t.Q6J("ngIf",e.isAlbum&&e.folder.tag&&(e.folder.tag.mbReleaseID||e.folder.tag.mbReleaseGroupID)),t.xp6(1),t.Q6J("ngIf",e.isArtist&&e.folder.tag&&e.folder.tag.mbArtistID),t.xp6(1),t.Q6J("ngIf",e.folder.artworks&&e.folder.artworks.length>0)}}let Be=(()=>{class o extends k{constructor(e,n,i,r,p,v,H,W){super(e),this.app=n,this.jam=i,this.notify=r,this.dialogsService=p,this.dialogOverlay=v,this.folderService=H,this.router=W,this.name="",this.isAlbum=!1,this.isArtist=!1}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(e=>{e.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}editFolderName(){if(!this.folder)return;const e=(this.name||"").trim();if(0===e.length||e===this.folder.name)return void(this.name=this.folder.name);const n=this.folder.id;this.jam.folder.rename({id:n,name:e}).then(i=>{this.folderService.waitForQueueResult("Renaming Folder",i,[n])}).catch(i=>{this.notify.error(i)})}refresh(){this.id&&this.jam.folder.id({id:this.id,folderIncTag:!0,folderIncParents:!0,folderIncArtworks:!0,folderIncChildFolderCount:!0,folderIncTrackCount:!0}).then(e=>{this.display(e)}).catch(e=>{404===e.code?this.router.navigate(["/admin/folder/"]).catch(n=>{console.error(n)}):this.notify.error(e)})}uploadImage(){this.dialogOverlay.open({title:"Upload Folder Images",childComponent:Te,data:{folder:this.folder},panelClass:"overlay-panel-large-buttons"})}searchImages(){this.dialogOverlay.open({title:"Search Artwork Images",childComponent:Ft,data:{folder:this.folder},panelClass:"overlay-panel-large-buttons"})}removeFolder(){const e=this.folder;!e||this.dialogsService.confirm("Remove Folder?",`Sure to remove Folder "${e.name}"?`,()=>{this.jam.folder.remove({id:e.id}).then(n=>{e.parentID&&this.router.navigate([`/admin/folder/${e.parentID}/overview`]).catch(i=>{console.error(i)}),this.folderService.waitForQueueResult("Removing Folder",n,[e.id],e.parentID?[e.parentID]:[])}).catch(n=>{this.notify.error(n)})})}moveFolder(){var e=this;const n=this.folder;if(!n)return;const i={selectID:n.id,disableIDs:[n.id]};var r;this.dialogOverlay.open({title:"Move Folder to",childComponent:T,data:i,panelClass:"overlay-panel-large-buttons",onOkBtn:(r=(0,y.Z)(function*(){const p=i.folder;if(p)try{e.jam.folder.move({ids:[n.id],newParentID:p.id}).then(v=>{e.folderService.waitForQueueResult("Moving Folder",v,[n.id],(n.parentID?[n.parentID]:[]).concat([p.id]))}).catch(v=>{e.notify.error(v)})}catch(v){return e.notify.error(v),Promise.reject(v)}}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,y.Z)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}display(e){this.name="",this.isAlbum=!1,this.isArtist=!1,this.folder=e,e&&(this.name=e.name,this.isAlbum=Ae.Dz.includes(e.type),this.isArtist=e.type===_.Sr.artist)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(P.gz),t.Y36(u.zi),t.Y36(_.K4),t.Y36(u.c),t.Y36(R.Hr),t.Y36(S.SL),t.Y36(u.Cr),t.Y36(P.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder"]],features:[t.qOj],decls:2,vars:2,consts:[[4,"ngIf"],["class","folder",4,"ngIf"],[1,"folder"],[1,"actions"],["title","Refresh",1,"button-on-control",3,"click"],[1,"icon-reload"],["title","Move Folder\u2026",1,"button-on-control",3,"click"],[1,"icon-right-bold"],["title","Remove Folder\u2026",1,"button-on-control",3,"click"],[1,"icon-trash"],[1,"content"],[3,"info",4,"ngIf"],[1,"properties"],[1,"label"],["type","text",3,"ngModel","ngModelChange","endEditRequest"],[1,"artworks"],[1,"button-on-control",3,"click"],[1,"icon-upload-cloud"],["class","button-on-control","title","Album Images",3,"click",4,"ngIf"],["class","button-on-control","title","Artist Images",3,"click",4,"ngIf"],["class","artworks-content",4,"ngIf"],[3,"info"],["target","_blank","rel","noopener",3,"href"],[3,"routerLink"],["title","Album Images",1,"button-on-control",3,"click"],[1,"icon-picture"],["title","Artist Images",1,"button-on-control",3,"click"],[1,"artworks-content"],[3,"folderID","artworks"]],template:function(e,n){1&e&&(t.YNc(0,Ie,1,0,"app-loading",0),t.YNc(1,Le,49,16,"div",1)),2&e&&(t.Q6J("ngIf",!n.folder),t.xp6(1),t.Q6J("ngIf",n.folder))},dependencies:[d.O5,Ze.a,J.N,C.JJ,C.On,P.rH,It,Zt],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow:hidden;display:block}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{overflow-y:auto;display:flex;flex-direction:column}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%]{width:100%;display:flex;flex-wrap:wrap;flex-direction:row;padding:15px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:0 0 50%}@media (max-width: 522px){[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:0 0 100%}}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding-top:5px;padding-bottom:5px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{color:var(--on-background-active)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-active)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--on-background);font-size:.7em;text-transform:uppercase;padding-bottom:2px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .artworks[_ngcontent-%COMP%]{border-top:1px solid var(--background-border)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .artworks[_ngcontent-%COMP%]   .artworks-content[_ngcontent-%COMP%]{padding:0 15px 15px}"]}),o})();function Ke(o,c){1&o&&(t.TgZ(0,"div",2)(1,"div",3),t._UZ(2,"i",4),t.qZA()())}function Ge(o,c){1&o&&(t.TgZ(0,"div",3),t._uU(1,"No Hints"),t.qZA())}function je(o,c){if(1&o&&(t.TgZ(0,"div",3),t._UZ(1,"i",9),t._uU(2),t.TgZ(3,"div",10),t._uU(4),t.qZA()()),2&o){const e=c.$implicit;t.xp6(2),t.hij(" ",e.hint.name," "),t.xp6(2),t.Oqu(e.description)}}function We(o,c){1&o&&t._UZ(0,"i",4)}function $e(o,c){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.name)}}function Ve(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.KtG(r.click())}),t.YNc(1,We,1,0,"i",12),t.YNc(2,$e,2,1,"ng-container",0),t.qZA()}if(2&o){const e=c.$implicit;t.xp6(1),t.Q6J("ngIf",e.running),t.xp6(1),t.Q6J("ngIf",!e.running)}}function Xe(o,c){if(1&o&&(t.TgZ(0,"div",2),t.YNc(1,Ge,2,0,"div",5),t.YNc(2,je,5,2,"div",6),t.TgZ(3,"div",7),t.YNc(4,Ve,3,2,"button",8),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",0===e.hints.length),t.xp6(1),t.Q6J("ngForOf",e.hints)("ngForTrackBy",e.trackByFn),t.xp6(2),t.Q6J("ngForOf",e.solutions)}}function tn(o,c){if(1&o&&(t.ynx(0),t.YNc(1,Ke,3,0,"div",1),t.YNc(2,Xe,5,4,"div",1),t.BQk()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!(e.trackHealth.health&&e.hints)),t.xp6(1),t.Q6J("ngIf",e.trackHealth.health&&e.hints)}}let Pt=(()=>{class o{constructor(e,n,i,r,p){this.app=e,this.jam=n,this.notify=i,this.folderService=r,this.router=p,this.solutions=[],this.resolvedEvent=new t.vpe,this.unsubscribe=new Q.xQ}trackByFn(e,n){return n.hint.id}ngOnChanges(e){this.display(this.trackHealth)}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}ngOnInit(){this.folderService.tracksChange.pipe((0,F.R)(this.unsubscribe)).subscribe(e=>{const n=this.trackHealth;n&&n.track.id===e.id&&(n.health=[],this.jam.track.health({ids:[n.track.id],healthMedia:!0}).then(i=>{const r=i.find(p=>p.track.id===n.track.id);r&&r.health?(n.track=r.track,n.health=r.health):n.health=[],0===n.health.length&&this.resolvedEvent.emit(),this.display(n)}).catch(i=>{this.notify.error(i)}))})}fixAll(){for(const e of this.solutions)e.fixable&&!e.running&&e.click&&e.click()}display(e){this.hints=[],this.solutions=[],e?.health&&(this.hints=e.health.map(n=>({hint:n,description:this.describeHint(n,e.track)})))}describeTagHint(e,n){let i="";return e.id===_.U.tagValuesExists?i=(e.details||[]).map(r=>r.reason.toUpperCase()).join(", "):e.id===_.U.id3v2Garbage?i=(e.details||[]).map(r=>r.reason).join(", "):e.id===_.U.id3v2Valid&&(i=(e.details||[]).map(r=>r.expected&&r.actual?`${r.reason}  (${r.actual} instead of ${r.expected})`:r.reason).join(", ")),this.solutions.find(r=>"Edit Tag"===r.name)||this.solutions.push({name:"Edit Tag",click:()=>{this.router.navigate([`/admin/folder/${n.parentID}/tags`]).catch(p=>{console.error(p)})}}),i}describeMp3GarbageHint(e,n){let i="";if(e.details&&e.details.length>0&&(i=`${e.details[0].reason} (${e.details[0].actual} bytes)`),!this.solutions.find(r=>"Fix MP3"===r.name)){const r={name:"Fix MP3",fixable:!0,click:()=>{r.running||(r.running=!0,this.jam.track.fix({id:n.id,fixID:e.id}).then(p=>{this.folderService.waitForQueueResult("Fixing Track MP3",p,[],[],[n.id])}).catch(p=>{this.notify.error(p)}))}};this.solutions.push(r)}return i}describeMp3ErrorHint(e,n){const i=`Stream Errors: ${(e.details||[]).length}`;if(!this.solutions.find(r=>"Fix Stream"===r.name)){const r={name:"Fix Stream",fixable:!0,click:()=>{r.running||(r.running=!0,this.jam.track.fix({id:n.id,fixID:e.id}).then(p=>{this.folderService.waitForQueueResult("Fixing Track Stream",p,[],[],[n.id])}).catch(p=>{this.notify.error(p)}))}};this.solutions.push(r)}return i}describeID3v1Hint(e,n){if(!this.solutions.find(i=>"Remove ID3v1"===i.name)){const i={name:"Remove ID3v1",fixable:!0,click:()=>{i.running||(i.running=!0,this.jam.track.fix({id:n.id,fixID:e.id}).then(r=>{this.folderService.waitForQueueResult("Remove ID3v1",r,[],[],[n.id])}).catch(r=>{this.notify.error(r)}))}};this.solutions.push(i)}return""}describeMP3HeaderHint(e,n){let i="";if(e.id===_.U.mp3HeaderValid&&(i=(e.details||[]).map(r=>r.expected&&r.actual?`${r.reason}  (${r.actual} instead of ${r.expected})`:r.reason).join(", ")),!this.solutions.find(r=>"Fix Header"===r.name)){const r={name:"Fix Header",fixable:!0,click:()=>{r.running||(r.running=!0,this.jam.track.fix({id:n.id,fixID:e.id}).then(p=>{this.folderService.waitForQueueResult("Fixing Track Header",p,[],[],[n.id])}).catch(p=>{this.notify.error(p)}))}};this.solutions.push(r)}return i}describeHint(e,n){switch(e.id){case _.U.tagValuesExists:case _.U.id3v2Garbage:case _.U.id3v2Exists:case _.U.id3v2Valid:return this.describeTagHint(e,n);case _.U.mp3Garbage:return this.describeMp3GarbageHint(e,n);case _.U.mp3MediaValid:return this.describeMp3ErrorHint(e,n);case _.U.id3v2NoId3v1:return this.describeID3v1Hint(e,n);case _.U.mp3HeaderExists:case _.U.mp3HeaderValid:return this.describeMP3HeaderHint(e,n)}return""}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(_.K4),t.Y36(u.c),t.Y36(u.Cr),t.Y36(P.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-track-health"]],inputs:{trackHealth:"trackHealth"},outputs:{resolvedEvent:"resolvedEvent"},features:[t.TTD],decls:1,vars:1,consts:[[4,"ngIf"],["class","hints",4,"ngIf"],[1,"hints"],[1,"hint"],[1,"icon-spin","icon-spinner"],["class","hint",4,"ngIf"],["class","hint",4,"ngFor","ngForOf","ngForTrackBy"],[1,"solutions"],["class","button-on-background",3,"click",4,"ngFor","ngForOf"],[1,"icon-warning"],[1,"details"],[1,"button-on-background",3,"click"],["class","icon-spin icon-spinner",4,"ngIf"]],template:function(e,n){1&e&&t.YNc(0,tn,3,2,"ng-container",0),2&e&&t.Q6J("ngIf",n.trackHealth)},dependencies:[d.sg,d.O5],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .icon-warning[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]{padding-left:28px;font-size:.8em;display:block;padding-top:5px}[_nghost-%COMP%]   .hint[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .solutions[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .solutions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}[_nghost-%COMP%]   .detail[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1.25px;font-size:11px;min-width:80px;margin-right:10px;display:inline-block}"]}),o})();function en(o,c){1&o&&t._UZ(0,"app-loading")}function nn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",9)(1,"div",10),t._uU(2),t.qZA(),t.TgZ(3,"div",11)(4,"app-track-health",12),t.NdJ("resolvedEvent",function(){const r=t.CHM(e).$implicit,p=t.oxw();return t.KtG(p.trackHealthResolved(r))}),t.qZA()()()}if(2&o){const e=c.$implicit;t.xp6(2),t.hij(" ",e.track.name," "),t.xp6(2),t.Q6J("trackHealth",e)}}let on=(()=>{class o extends k{constructor(e,n,i,r,p){super(e),this.app=n,this.jam=i,this.notify=r,this.folderService=p,this.modes=[],this.mediaCheck=!1}onFilterChange(){this.reDisplay()}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(e=>{e.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}checkChange(){this.refresh()}trackHealthResolved(e){this.all&&(this.all=this.all.filter(n=>n!==e),this.reDisplay())}refresh(){this.hints=void 0,this.id&&this.jam.track.health({folderIDs:[this.id],healthMedia:this.mediaCheck}).then(e=>{this.display(e)}).catch(e=>{this.notify.error(e)})}reDisplay(){this.hints=this.filter&&this.all?this.all.filter(e=>e.health&&e.health.find(n=>n.name===this.filter)):this.all}display(e){this.all=e,this.modes=[];for(const n of e)if(n.health)for(const i of n.health)this.modes.includes(i.name)||this.modes.push(i.name);this.reDisplay()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(P.gz),t.Y36(u.zi),t.Y36(_.K4),t.Y36(u.c),t.Y36(u.Cr))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-tracks-health"]],features:[t.qOj],decls:11,vars:5,consts:[[1,"health"],[1,"actions"],["title","Refresh List",1,"button-on-control",3,"click"],[1,"icon-reload"],["type","checkbox",3,"ngModel","checked","ngModelChange","change"],[1,"content"],[4,"ngIf"],["name","Track Health Issues",3,"list"],["class","track",4,"ngFor","ngForOf"],[1,"track"],[1,"meta"],[1,"track-health"],[3,"trackHealth","resolvedEvent"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t.NdJ("click",function(){return n.refresh()}),t._UZ(3,"i",3),t.qZA(),t.TgZ(4,"label")(5,"input",4),t.NdJ("ngModelChange",function(r){return n.mediaCheck=r})("change",function(){return n.checkChange()}),t.qZA(),t._uU(6," Check Media "),t.qZA()(),t.TgZ(7,"div",5),t.YNc(8,en,1,0,"app-loading",6),t._UZ(9,"app-background-text-list",7),t.YNc(10,nn,5,2,"div",8),t.qZA()()),2&e&&(t.xp6(5),t.Q6J("ngModel",n.mediaCheck)("checked",n.mediaCheck),t.xp6(3),t.Q6J("ngIf",!n.hints),t.xp6(1),t.Q6J("list",n.hints),t.xp6(1),t.Q6J("ngForOf",n.hints))},dependencies:[d.sg,d.O5,D.$,J.N,C.Wl,C.JJ,C.On,Pt],styles:["[_nghost-%COMP%]{height:100%;width:100%}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:15px;overflow-y:auto;overflow-x:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]{flex-flow:row nowrap}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{width:30%;overflow:hidden;padding-right:15px;text-overflow:ellipsis}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{width:70%}"]}),o})();var rn=M(6906);function an(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"tr",13),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.KtG(r.selected=!r.selected)}),t.TgZ(1,"td",4),t._uU(2),t.qZA(),t.TgZ(3,"td",5),t._uU(4),t.qZA(),t.TgZ(5,"td",6),t._uU(6),t.qZA(),t.TgZ(7,"td",7),t._uU(8),t.qZA(),t.TgZ(9,"td",8),t._uU(10),t.qZA(),t.TgZ(11,"td",9),t._uU(12),t.qZA(),t.TgZ(13,"td",10),t._uU(14),t.qZA(),t.TgZ(15,"td",11),t._uU(16),t.ALo(17,"duration"),t.qZA()()}if(2&o){const e=c.$implicit;t.ekj("selected",e.selected),t.xp6(2),t.Oqu(null==e.track.tag?null:e.track.tag.trackNr),t.xp6(2),t.Oqu(null==e.track.tag?null:e.track.tag.title),t.xp6(2),t.Oqu(null==e.track.tag?null:e.track.tag.artist),t.xp6(2),t.Oqu(null==e.track.tag?null:e.track.tag.album),t.xp6(2),t.Oqu(null==e.track.media?null:e.track.media.format),t.xp6(2),t.Oqu(null==e.track.media?null:e.track.media.bitRate),t.xp6(2),t.Oqu(null==e.track.media?null:e.track.media.sampleRate),t.xp6(2),t.Oqu(t.lcZ(17,10,e.track.duration))}}function sn(o,c){if(1&o&&(t.TgZ(0,"table",2)(1,"tr",3)(2,"td",4),t._uU(3,"Track Nr."),t.qZA(),t.TgZ(4,"td",5),t._uU(5,"Title"),t.qZA(),t.TgZ(6,"td",6),t._uU(7,"Artist"),t.qZA(),t.TgZ(8,"td",7),t._uU(9,"Album"),t.qZA(),t.TgZ(10,"td",8),t._uU(11,"Format"),t.qZA(),t.TgZ(12,"td",9),t._uU(13,"BitRate"),t.qZA(),t.TgZ(14,"td",10),t._uU(15,"SampleRate"),t.qZA(),t.TgZ(16,"td",11),t._uU(17,"Duration"),t.qZA()(),t.YNc(18,an,18,12,"tr",12),t.qZA()),2&o){const e=t.oxw();t.xp6(18),t.Q6J("ngForOf",e.trackItems)}}let Ut=(()=>{class o{constructor(e){this.router=e,this.tracks=[]}getSortValue(e,n){switch(e){case"number":return n.track.tag?.trackNr;case"name":return n.track.name;case"artist":return n.track.tag?.artist;case"album":return n.track.tag?.album;case"duration":return n.track.duration;default:return}}ngOnChanges(e){this.trackItems=(this.tracks||[]).map(n=>({track:n}))}toTrackFolder(e){this.router.navigate([`/admin/folder/${e.parentID}/overview`]).catch(n=>{console.error(n)})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(P.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-track-list"]],inputs:{tracks:"tracks"},features:[t.TTD],decls:2,vars:2,consts:[["name","Tracks",3,"list"],["class","tracks",4,"ngIf"],[1,"tracks"],[1,"track","heading"],[1,"number"],[1,"title"],[1,"artist"],[1,"album"],[1,"format"],[1,"bitrate"],[1,"samplerate"],[1,"duration"],["class","track",3,"selected","click",4,"ngFor","ngForOf"],[1,"track",3,"click"]],template:function(e,n){1&e&&(t._UZ(0,"app-background-text-list",0),t.YNc(1,sn,19,1,"table",1)),2&e&&(t.Q6J("list",n.tracks),t.xp6(1),t.Q6J("ngIf",n.tracks&&n.tracks.length>0))},dependencies:[d.sg,d.O5,D.$,rn.u],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]{padding:15px;font-size:.8em;width:100%}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{font-size:.9em}[_nghost-%COMP%]   .track[_ngcontent-%COMP%]{border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .track[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .track[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .track.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}"]}),o})();function cn(o,c){1&o&&t._UZ(0,"app-loading")}function ln(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",3)(1,"div",4)(2,"button",5),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.refresh())}),t._UZ(3,"i",6),t.qZA(),t.TgZ(4,"button",7),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.moveTracks())}),t._UZ(5,"i",8),t.qZA(),t.TgZ(6,"button",9),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.deleteTracks())}),t._UZ(7,"i",10),t.qZA()(),t._UZ(8,"app-admin-track-list",11),t.qZA()}if(2&o){const e=t.oxw();t.xp6(8),t.Q6J("tracks",e.folder.tracks)}}let dn=(()=>{class o extends k{constructor(e,n,i,r,p,v){super(e),this.jam=n,this.notify=i,this.folderService=r,this.dialogsService=p,this.dialogOverlay=v}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(e=>{e.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}deleteTracks(){const e=this.getTrackIDs();0!==e.length&&this.dialogsService.confirm("Remove Tracks?",`Sure to remove ${e.length} Track${e.length>1?"s":""}?`,()=>{for(const n of e)this.jam.track.remove({id:n}).then(i=>{this.folderService.waitForQueueResult("Removing Track",i,[],[],[n])}).catch(i=>{this.notify.error(i)})})}getTrackIDs(){if(!this.tracks?.trackItems||!this.folder?.tracks)return[];const e=this.tracks.trackItems.filter(n=>n.selected).map(n=>n.track.id);return e.length>0?e:this.folder.tracks.map(n=>n.id)}moveTracks(){var e=this;const n=this.getTrackIDs();if(0===n.length)return;const i={selectID:this.id};var r;this.dialogOverlay.open({title:"Move Tracks to",childComponent:T,data:i,panelClass:"overlay-panel-large-buttons",onOkBtn:(r=(0,y.Z)(function*(){const p=i.folder;if(p)return e.jam.track.move({ids:n,folderID:p.id}).then(v=>{e.folderService.waitForQueueResult("Moving Tracks",v,[],[p.id].concat(e.folder?.parentID?[e.folder.parentID]:[]),n)}).catch(v=>{e.notify.error(v)}),Promise.resolve()}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,y.Z)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}refresh(){this.folder=void 0,this.id&&this.jam.folder.id({id:this.id,folderIncTracks:!0,trackIncTag:!0,trackIncMedia:!0}).then(e=>{this.folder=e}).catch(e=>{this.notify.error(e)})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(P.gz),t.Y36(_.K4),t.Y36(u.c),t.Y36(u.Cr),t.Y36(R.Hr),t.Y36(S.SL))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder-tracks"]],viewQuery:function(e,n){if(1&e&&t.Gf(Ut,5),2&e){let i;t.iGM(i=t.CRH())&&(n.tracks=i.first)}},features:[t.qOj],decls:3,vars:3,consts:[[4,"ngIf"],["name","Tracks",3,"list"],["class","tracks",4,"ngIf"],[1,"tracks"],[1,"actions"],["title","Refresh",1,"button-on-control",3,"click"],[1,"icon-reload"],["title","Move Tracks\u2026",1,"button-on-control",3,"click"],[1,"icon-right-bold"],["title","Delete Tracks\u2026",1,"button-on-control",3,"click"],[1,"icon-trash"],[1,"content",3,"tracks"]],template:function(e,n){1&e&&(t.YNc(0,cn,1,0,"app-loading",0),t._UZ(1,"app-background-text-list",1),t.YNc(2,ln,9,1,"div",2)),2&e&&(t.Q6J("ngIf",!n.folder),t.xp6(1),t.Q6J("list",null==n.folder?null:n.folder.tracks),t.xp6(1),t.Q6J("ngIf",n.folder&&n.folder.tracks&&n.folder.tracks.length>0))},dependencies:[d.O5,D.$,J.N,Ut],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:block;overflow:hidden}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   app-admin-track-list[_ngcontent-%COMP%]{overflow-y:auto}"]}),o})();var ht=M(5197);function gn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(3);return t.KtG(i.refresh(i.current.pos,!1))}),t._UZ(1,"i",10),t._uU(2," Refresh"),t.qZA()}}function pn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(3);return t.KtG(i.fixAll())}),t._uU(1,"Fix all fixable"),t.qZA()}}function hn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",5)(1,"button",6),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.start())}),t._UZ(2,"i",7),t._uU(3," Next"),t.qZA(),t.YNc(4,gn,3,0,"button",8),t.YNc(5,pn,2,0,"button",8),t.qZA()}if(2&o){const e=t.oxw(2);t.xp6(4),t.Q6J("ngIf",e.current),t.xp6(1),t.Q6J("ngIf",e.current&&e.current.health&&e.current.health.length>0)}}function _n(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",5)(1,"button",9),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.stop())}),t._UZ(2,"i",11),t._uU(3," Stop"),t.qZA()()}}function un(o,c){if(1&o&&(t.ynx(0),t.YNc(1,hn,6,2,"div",4),t.YNc(2,_n,4,0,"div",4),t.BQk()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.searching),t.xp6(1),t.Q6J("ngIf",e.searching)}}function mn(o,c){1&o&&t._UZ(0,"app-loading")}function fn(o,c){1&o&&t._UZ(0,"i",16)}function Cn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",18)(1,"div",19),t._uU(2),t.qZA(),t.TgZ(3,"div",20)(4,"app-track-health",21),t.NdJ("resolvedEvent",function(){const r=t.CHM(e).$implicit,p=t.oxw(3);return t.KtG(p.trackHealthResolved(r))}),t.qZA()()()}if(2&o){const e=c.$implicit;t.xp6(2),t.hij(" ",e.track.name," "),t.xp6(2),t.Q6J("trackHealth",e)}}function xn(o,c){if(1&o&&(t.ynx(0),t.YNc(1,Cn,5,2,"div",17),t.BQk()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.current.health)("ngForTrackBy",e.trackByFn)}}const Mn=function(o){return["/admin/folder",o,"tags"]};function vn(o,c){if(1&o&&(t.TgZ(0,"div")(1,"div",12)(2,"span"),t.YNc(3,fn,1,0,"i",13),t.qZA(),t.TgZ(4,"span"),t._uU(5),t.qZA(),t.TgZ(6,"a",14),t._UZ(7,"i",15),t._uU(8),t.qZA()(),t.YNc(9,xn,2,2,"ng-container",2),t.qZA()),2&o){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",e.searching),t.xp6(2),t.AsE("",e.current.pos+1," / ",e.folders.length,""),t.xp6(1),t.Q6J("routerLink",t.VKq(6,Mn,e.current.folder.id)),t.xp6(2),t.hij(" ",e.current.folder.name,""),t.xp6(1),t.Q6J("ngIf",e.current.health)}}let On=(()=>{class o{constructor(e,n,i,r,p,v){this.app=e,this.jam=n,this.notify=i,this.uiState=r,this.folderService=p,this.userStorage=v,this.searching=!1,this.unsubscribe=new Q.xQ,v.userChange.pipe((0,F.R)(this.unsubscribe)).subscribe(H=>{this.loadFromStorage()})}trackHealthResolved(e){this.current&&this.current.health&&(this.current.health=this.current.health.filter(n=>n!==e))}trackByFn(e,n){return n.track.id}stop(){this.searching=!1}start(){this.searching||!this.folders||(this.searching=!0,this.request())}request(){if(!this.searching)return;let e=0;this.current&&(e=this.current.pos+1),this.refresh(e,!0)}fixAll(){this.searching||!this.current||!this.trackHealthComponents||this.trackHealthComponents.forEach(e=>{e.fixAll()})}refresh(e,n){this.current=void 0,this.searching=!0;const i=this.folders&&this.folders[e];if(!i)return void(this.searching=!1);const r={folder:i,pos:e};this.current=r,this.userStorage.set(o.localStorageName,{folderID:i.id}),this.jam.track.health({folderIDs:[i.id],healthMedia:!0}).then(p=>{p.length>0?(r.health=p,this.searching=!1):n?this.request():(r.health=[],this.searching=!1)}).catch(p=>{this.current=void 0,this.searching=!1,this.notify.error(p)})}ngOnInit(){const e=this.uiState.data["app-admin-radar"];e&&(this.folders=e.folders,this.current=e.current,this.folders)||this.loadFolders()}ngOnDestroy(){this.uiState.data["app-admin-radar"]={folders:this.folders,current:this.current},this.current=void 0,this.searching=!1,this.folders=void 0,this.unsubscribe.next(),this.unsubscribe.complete()}loadFromStorage(){const e=this.userStorage.get(o.localStorageName);if(e?.folderID&&this.folders){const n=this.folders.findIndex(i=>i.id===e.folderID);n>=0&&(this.current={folder:this.folders[n],pos:n},this.refresh(n,!1))}}loadFolders(){this.jam.folder.search({folderTypes:[_.Sr.album,_.Sr.multialbum]}).then(e=>{this.folders=e.items,this.loadFromStorage()}).catch(e=>{this.notify.error(e)})}}return o.localStorageName="admin.radar",o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(_.K4),t.Y36(u.c),t.Y36(u.JU),t.Y36(u.Cr),t.Y36(u.TZ))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-radar"]],viewQuery:function(e,n){if(1&e&&t.Gf(Pt,5),2&e){let i;t.iGM(i=t.CRH())&&(n.trackHealthComponents=i)}},decls:6,vars:3,consts:[[1,"radar"],["section","Health Radar"],[4,"ngIf"],[1,"content"],["class","buttons",4,"ngIf"],[1,"buttons"],[1,"button-primary",3,"click"],[1,"icon-play"],["class","button-on-control",3,"click",4,"ngIf"],[1,"button-on-control",3,"click"],[1,"icon-reload"],[1,"icon-stop"],[1,"current"],["class","icon-spin icon-spinner",4,"ngIf"],[3,"routerLink"],[1,"icon-folder"],[1,"icon-spin","icon-spinner"],["class","track",4,"ngFor","ngForOf","ngForTrackBy"],[1,"track"],[1,"meta"],[1,"track-health"],[3,"trackHealth","resolvedEvent"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"app-view-header-slim",1),t.YNc(2,un,3,2,"ng-container",2),t.qZA(),t.TgZ(3,"div",3),t.YNc(4,mn,1,0,"app-loading",2),t.YNc(5,vn,10,8,"div",2),t.qZA()()),2&e&&(t.xp6(2),t.Q6J("ngIf",n.folders),t.xp6(2),t.Q6J("ngIf",!n.folders),t.xp6(1),t.Q6J("ngIf",n.folders&&n.current))},dependencies:[d.sg,d.O5,ht.p,J.N,P.rH,Pt],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{min-width:130px;display:inline-block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]{padding-top:15px;padding-bottom:15px;border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-right:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]{border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{padding-top:15px;padding-bottom:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{padding-left:15px}@media (max-width: 768px){[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{padding-left:0}}"]}),o})();const St=function(){return{standalone:!0}};function bn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"form")(1,"div",1)(2,"label",2),t._uU(3,"Root name"),t.qZA(),t.TgZ(4,"input",3),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.edit.name=i)}),t.qZA()(),t.TgZ(5,"div",1)(6,"label",4),t._uU(7,"Path"),t.qZA(),t.TgZ(8,"input",5),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.edit.path=i)}),t.qZA()(),t.TgZ(9,"div",1)(10,"label",6),t._uU(11,"Scan Strategy"),t.qZA(),t.TgZ(12,"fieldset",7)(13,"label",8)(14,"input",9),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.edit.strategy=i)}),t.qZA(),t._uU(15," Auto"),t.qZA(),t.TgZ(16,"label",8)(17,"input",9),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.edit.strategy=i)}),t.qZA(),t._uU(18," Artist/Album"),t.qZA(),t.TgZ(19,"label",8)(20,"input",9),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.edit.strategy=i)}),t.qZA(),t._uU(21," Compilations"),t.qZA(),t.TgZ(22,"label",8)(23,"input",9),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.edit.strategy=i)}),t.qZA(),t._uU(24," Audiobook"),t.qZA()()()()}if(2&o){const e=t.oxw();t.xp6(4),t.Q6J("ngModel",e.edit.name)("ngModelOptions",t.DdM(12,St)),t.xp6(4),t.Q6J("ngModel",e.edit.path)("ngModelOptions",t.DdM(13,St)),t.xp6(6),t.Q6J("ngModel",e.edit.strategy)("value",e.RootScanStrategy.auto),t.xp6(3),t.Q6J("ngModel",e.edit.strategy)("value",e.RootScanStrategy.artistalbum),t.xp6(3),t.Q6J("ngModel",e.edit.strategy)("value",e.RootScanStrategy.compilation),t.xp6(3),t.Q6J("ngModel",e.edit.strategy)("value",e.RootScanStrategy.audiobook)}}let Rt=(()=>{class o{constructor(){this.RootScanStrategy=_.hy}dialogInit(e,n){this.edit=n.data}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-root"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"root-form-control"],["for","root-name"],["id","root-name","type","text",3,"ngModel","ngModelOptions","ngModelChange"],["for","root-path"],["id","root-path","type","text",3,"ngModel","ngModelOptions","ngModelChange"],["for","strategy"],["id","strategy"],[1,"select"],["type","radio","name","strategy",3,"ngModel","value","ngModelChange"]],template:function(e,n){1&e&&t.YNc(0,bn,25,14,"form",0),2&e&&t.Q6J("ngIf",n.edit)},dependencies:[d.O5,C._Y,C.Fj,C._,C.JJ,C.JL,C.On,C.F],styles:["[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%;line-height:1.3em;padding:5px;min-width:300px}[_nghost-%COMP%]   input[type=radio][_ngcontent-%COMP%]{margin-right:5px}[_nghost-%COMP%]   .root-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block}[_nghost-%COMP%]   .select[_ngcontent-%COMP%]{margin-right:15px;display:block;font-size:.8em;line-height:1.5em}"]}),o})();var wn=M(9178);function yn(o,c){1&o&&(t.TgZ(0,"span"),t._uU(1,"Not scanned"),t.qZA())}function An(o,c){if(1&o&&(t.TgZ(0,"span",22),t._uU(1,"Error:"),t._UZ(2,"br"),t._uU(3),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(3),t.Oqu(e.status.error)}}function Pn(o,c){1&o&&(t.ynx(0),t._uU(1,"Working\u2026"),t.BQk())}function kn(o,c){if(1&o&&(t.ynx(0),t._uU(1,"Last Change:"),t._UZ(2,"br"),t._uU(3),t.ALo(4,"date"),t.BQk()),2&o){const e=t.oxw(2).$implicit;t.xp6(3),t.Oqu(t.xi3(4,1,e.status.lastScan,"medium"))}}function Tn(o,c){if(1&o&&(t.TgZ(0,"span"),t.YNc(1,Pn,2,0,"ng-container",11),t.YNc(2,kn,5,4,"ng-container",11),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",e.status.scanning),t.xp6(1),t.Q6J("ngIf",!e.status.scanning)}}function Zn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"tr",10),t.NdJ("dblclick",function(){const r=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.editRoot(r))})("keydown.enter",function(){const r=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.editRoot(r))}),t.TgZ(1,"td",4),t._uU(2),t.qZA(),t.TgZ(3,"td",5),t._uU(4),t.qZA(),t.TgZ(5,"td",6),t._uU(6),t.qZA(),t.TgZ(7,"td",7),t.YNc(8,yn,2,0,"span",11),t.YNc(9,An,4,1,"span",12),t.YNc(10,Tn,3,2,"span",11),t.qZA(),t.TgZ(11,"td",8)(12,"div",13)(13,"button",14),t.NdJ("click",function(){const r=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.refreshRoot(r))}),t._UZ(14,"i",15),t.qZA(),t.TgZ(15,"button",16),t.NdJ("click",function(){const r=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.refreshRootMeta(r))}),t._UZ(16,"i",17),t.qZA(),t.TgZ(17,"button",18),t.NdJ("click",function(){const r=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.editRoot(r))}),t._UZ(18,"i",19),t.qZA(),t.TgZ(19,"button",20),t.NdJ("click",function(){const r=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.deleteRoot(r))}),t._UZ(20,"i",21),t.qZA()()()()}if(2&o){const e=c.$implicit;t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.path),t.xp6(2),t.Oqu(e.strategy),t.xp6(2),t.Q6J("ngIf",!e.status),t.xp6(1),t.Q6J("ngIf",e.status&&e.status.error),t.xp6(1),t.Q6J("ngIf",e.status&&!e.status.error)}}function In(o,c){if(1&o&&(t.TgZ(0,"table",2)(1,"tr",3)(2,"td",4),t._uU(3,"Name"),t.qZA(),t.TgZ(4,"td",5),t._uU(5,"Path"),t.qZA(),t.TgZ(6,"td",6),t._uU(7,"Strategy"),t.qZA(),t.TgZ(8,"td",7),t._uU(9,"Status"),t.qZA(),t.TgZ(10,"td",8),t._uU(11,"Actions"),t.qZA()(),t.YNc(12,Zn,21,6,"tr",9),t.qZA()),2&o){const e=t.oxw();t.xp6(12),t.Q6J("ngForOf",e.roots)}}let Fn=(()=>{class o{constructor(e,n,i,r,p,v,H){this.router=e,this.route=n,this.app=i,this.notify=r,this.dialogs=p,this.rootService=v,this.dialogOverlay=H,this.roots=[]}refreshRoot(e){this.rootService.rescanRoot(e)}refreshRootMeta(e){this.rootService.refreshRootMeta(e)}editRoot(e){var n=this;const i={root:e,name:e.name,path:e.path,strategy:e.strategy};var r;this.dialogOverlay.open({title:"Edit Root",childComponent:Rt,data:i,onOkBtn:(r=(0,y.Z)(function*(){try{yield n.rootService.applyDialogRoot(i)}catch(p){return n.notify.error(p),Promise.reject(p)}}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,y.Z)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}deleteRoot(e){this.dialogs.confirm("Delete Root","Do you want to the delete the root folder?",()=>{this.rootService.removeRoot(e)})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(P.F0),t.Y36(P.gz),t.Y36(u.zi),t.Y36(u.c),t.Y36(R.Hr),t.Y36(u.Nb),t.Y36(S.SL))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-root-list"]],inputs:{roots:"roots"},decls:2,vars:2,consts:[["name","Roots",3,"list"],["class","roots","appFocusKeyList","",4,"ngIf"],["appFocusKeyList","",1,"roots"],[1,"root","heading"],[1,"title"],[1,"path"],[1,"strategy"],[1,"status"],[1,"actions"],["class","root","appFocusKeyListItem","",3,"dblclick","keydown.enter",4,"ngFor","ngForOf"],["appFocusKeyListItem","",1,"root",3,"dblclick","keydown.enter"],[4,"ngIf"],["class","error",4,"ngIf"],[1,"action-buttons"],["title","Rescan Root","appClickStop","",3,"click"],["aria-hidden","true",1,"icon-rescan"],["title","Refresh Root Meta","appClickStop","",3,"click"],["aria-hidden","true",1,"icon-broom"],["title","Edit Root","appClickStop","",3,"click"],["aria-hidden","true",1,"icon-edit"],["title","Delete Root","appClickStop","",3,"click"],["aria-hidden","true",1,"icon-remove"],[1,"error"]],template:function(e,n){1&e&&(t._UZ(0,"app-background-text-list",0),t.YNc(1,In,13,1,"table",1)),2&e&&(t.Q6J("list",n.roots),t.xp6(1),t.Q6J("ngIf",n.roots&&n.roots.length>0))},dependencies:[d.sg,d.O5,D.$,wn.D,w.j,A.R,d.uU],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .roots[_ngcontent-%COMP%]{padding:15px;font-size:.9em;width:100%}[_nghost-%COMP%]   .root[_ngcontent-%COMP%]{height:60px;border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .root[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .root[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .root.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}[_nghost-%COMP%]   .error[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{height:40px;font-size:.9em}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{width:100px}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px;flex:50%;margin:0;display:inline-block;color:var(--on-control);border:1px solid transparent}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--on-control-active);border:1px solid var(--control-active)}"]}),o})(),Un=(()=>{class o{constructor(e,n,i,r,p,v,H){this.router=e,this.route=n,this.app=i,this.notify=r,this.dialogs=p,this.rootService=v,this.dialogOverlay=H,this.unsubscribe=new Q.xQ}static getSortValue(e,n){switch(e){case"name":return n.name;case"path":return n.path;default:return}}ngOnInit(){this.rootService.rootsChange.pipe((0,F.R)(this.unsubscribe)).subscribe(e=>{this.roots=(e||[]).sort((n,i)=>n.name.localeCompare(i.name))},e=>{this.notify.error(e)}),this.rootService.refreshRoots()}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}refresh(){this.rootService.refreshRoots()}newRoot(){var e=this;const n={name:"",path:"",strategy:_.hy.auto};var i;this.dialogOverlay.open({title:"New Root",childComponent:Rt,data:n,onOkBtn:(i=(0,y.Z)(function*(){try{yield e.rootService.applyDialogRoot(n)}catch(r){return e.notify.error(r),Promise.reject(r)}}),function(){return i.apply(this,arguments)}),onCancelBtn:function(){var i=(0,y.Z)(function*(){return Promise.resolve()});return function(){return i.apply(this,arguments)}}()})}refreshRoots(){this.rootService.rescanRoots()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(P.F0),t.Y36(P.gz),t.Y36(u.zi),t.Y36(u.c),t.Y36(R.Hr),t.Y36(u.Nb),t.Y36(S.SL))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-root"]],decls:11,vars:1,consts:[[1,"roots"],["section","Roots"],[1,"actions"],["title","Refresh",1,"button-on-control",3,"click"],[1,"icon-reload"],["title","New Root\u2026",1,"button-on-control",3,"click"],[1,"icon-plus"],["title","Rescan all Roots",1,"button-on-control",3,"click"],[1,"icon-rescan"],[1,"content"],[3,"roots"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"app-view-header-slim",1)(2,"div",2)(3,"button",3),t.NdJ("click",function(){return n.refresh()}),t._UZ(4,"i",4),t.qZA(),t.TgZ(5,"button",5),t.NdJ("click",function(){return n.newRoot()}),t._UZ(6,"i",6),t.qZA(),t.TgZ(7,"button",7),t.NdJ("click",function(){return n.refreshRoots()}),t._UZ(8,"i",8),t.qZA()()(),t.TgZ(9,"div",9),t._UZ(10,"app-admin-root-list",10),t.qZA()()),2&e&&(t.xp6(10),t.Q6J("roots",n.roots))},dependencies:[ht.p,Fn],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .roots[_ngcontent-%COMP%]{height:100%;overflow-y:auto;overflow-x:hidden}[_nghost-%COMP%]   .roots[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}"]}),o})();function Sn(o,c){1&o&&t._UZ(0,"app-loading")}function Rn(o,c){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"div")(2,"div",6),t._uU(3,"Server"),t.qZA(),t.TgZ(4,"div",7)(5,"label")(6,"input",8),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.settings.library.scanAtStart=i)})("ngModelChange",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.onChange())}),t.qZA(),t._uU(7," Scan all Roots on Server Start "),t.qZA()()(),t.TgZ(8,"div")(9,"div",6),t._uU(10,"External Services"),t.qZA(),t.TgZ(11,"div",7)(12,"label")(13,"input",9),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.settings.externalServices.enabled=i)})("ngModelChange",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.onChange())}),t.qZA(),t._uU(14," Allow Request to External Services "),t.qZA()()(),t.TgZ(15,"div")(16,"div",6),t._uU(17,"Chat"),t.qZA(),t.TgZ(18,"div",7)(19,"label",10),t._uU(20,"Maximum Number of Messages"),t.qZA(),t.TgZ(21,"input",11),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.settings.chat.maxMessages=i)})("ngModelChange",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.onChange())}),t.qZA()(),t.TgZ(22,"div",7)(23,"div",12)(24,"label",13),t._uU(25,"Maximum Age of Message"),t.qZA(),t.TgZ(26,"input",14),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.settings.chat.maxAge.value=i)})("ngModelChange",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.onChange())}),t.qZA()(),t.TgZ(27,"select",15),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.settings.chat.maxAge.unit=i)})("ngModelChange",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.onChange())}),t.TgZ(28,"option",16),t._uU(29,"year"),t.qZA(),t.TgZ(30,"option",16),t._uU(31,"years"),t.qZA(),t.TgZ(32,"option",16),t._uU(33,"month"),t.qZA(),t.TgZ(34,"option",16),t._uU(35,"months"),t.qZA(),t.TgZ(36,"option",16),t._uU(37,"day"),t.qZA(),t.TgZ(38,"option",16),t._uU(39,"days"),t.qZA(),t.TgZ(40,"option",16),t._uU(41,"minute"),t.qZA(),t.TgZ(42,"option",16),t._uU(43,"minutes"),t.qZA(),t.TgZ(44,"option",16),t._uU(45,"second"),t.qZA(),t.TgZ(46,"option",16),t._uU(47,"seconds"),t.qZA()()()(),t.TgZ(48,"div")(49,"div",6),t._uU(50,"Artist Index"),t.qZA(),t.TgZ(51,"div",7)(52,"label",17),t._uU(53,"Ignored Articles in Artist Names"),t.qZA(),t.TgZ(54,"textarea",18),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.ignoreArticles=i)})("ngModelChange",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.onChange())}),t.qZA()()(),t.BQk()}if(2&o){const e=t.oxw();t.xp6(6),t.Q6J("ngModel",e.settings.library.scanAtStart),t.xp6(7),t.Q6J("ngModel",e.settings.externalServices.enabled),t.xp6(8),t.Q6J("ngModel",e.settings.chat.maxMessages),t.xp6(5),t.Q6J("ngModel",e.settings.chat.maxAge.value),t.xp6(1),t.Q6J("ngModel",e.settings.chat.maxAge.unit),t.xp6(1),t.Q6J("value","year"),t.xp6(2),t.Q6J("value","years"),t.xp6(2),t.Q6J("value","month"),t.xp6(2),t.Q6J("value","months"),t.xp6(2),t.Q6J("value","day"),t.xp6(2),t.Q6J("value","days"),t.xp6(2),t.Q6J("value","minute"),t.xp6(2),t.Q6J("value","minutes"),t.xp6(2),t.Q6J("value","second"),t.xp6(2),t.Q6J("value","seconds"),t.xp6(8),t.Q6J("ngModel",e.ignoreArticles)}}let Hn=(()=>{class o{constructor(e,n,i){this.app=e,this.jam=n,this.notify=i,this.ignoreArticles=""}ngOnInit(){this.refresh()}onChange(){}refresh(){this.jam.admin.settings().then(e=>{this.display(e)}).catch(e=>{this.notify.error(e)})}save(){const e=this.settings;!e||(e.index.ignoreArticles=this.ignoreArticles.split("\n").map(n=>n.trim()).filter(n=>n.length>0),this.settings=void 0,this.jam.admin.settingsUpdate(e).then(()=>{this.notify.success("Settings updated"),this.settings=e}).catch(n=>{this.notify.error(n),this.settings=e}))}display(e){this.settings=e,this.ignoreArticles=e.index.ignoreArticles.join("\n")}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(_.K4),t.Y36(u.c))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-settings"]],decls:8,vars:2,consts:[[1,"settings"],["section","Admin Settings"],["title","Save",1,"button-on-control",3,"click"],[1,"icon-floppy"],[1,"content"],[4,"ngIf"],[1,"section-title"],[1,"section-entry"],["type","checkbox","title","Scan all Roots on Server Start",3,"ngModel","ngModelChange"],["type","checkbox","title","Allow Request to External Services",3,"ngModel","ngModelChange"],["for","max_messages"],["id","max_messages","type","number",3,"ngModel","ngModelChange"],[1,"chat-max-age"],["for","max_age"],["id","max_age","type","number",3,"ngModel","ngModelChange"],["placeholder","Unit of Age",3,"ngModel","ngModelChange"],[3,"value"],["for","ignore_articles"],["id","ignore_articles","rows","10","cols","20",3,"ngModel","ngModelChange"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"app-view-header-slim",1)(2,"button",2),t.NdJ("click",function(){return n.save()}),t._UZ(3,"i",3),t._uU(4," Save Settings"),t.qZA()(),t.TgZ(5,"div",4),t.YNc(6,Sn,1,0,"app-loading",5),t.YNc(7,Rn,55,16,"ng-container",5),t.qZA()()),2&e&&(t.xp6(6),t.Q6J("ngIf",!n.settings),t.xp6(1),t.Q6J("ngIf",n.settings))},dependencies:[d.O5,ht.p,J.N,C.YN,C.Kr,C.Fj,C.wV,C.Wl,C.EJ,C.JJ,C.On],styles:["[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:hidden;height:100%}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:15px 15px 0}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .chat-max-age[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .section-entry[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:12px;padding-bottom:3px}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-top:-1px;display:inline-block;vertical-align:middle}"]}),o})(),Ht=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-start"]],decls:4,vars:0,consts:[[1,"start"],["section","Administration"],[1,"content"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"app-view-header-slim",1),t.TgZ(2,"div",2),t._UZ(3,"app-admin-section-cards"),t.qZA()())},styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .start[_ngcontent-%COMP%]{height:100%;overflow-y:auto;overflow-x:hidden}"]}),o})();const rt=function(){return{standalone:!0}};function qn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div")(1,"form")(2,"div",1)(3,"label",2),t._uU(4,"Name"),t.qZA(),t.TgZ(5,"input",3),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.edit.edit.name=i)}),t.qZA()(),t.TgZ(6,"div",1)(7,"label",4),t._uU(8,"Email"),t.qZA(),t.TgZ(9,"input",5),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.edit.edit.email=i)}),t.qZA()(),t.TgZ(10,"div",6),t._uU(11,"Roles"),t.qZA(),t.TgZ(12,"div",7)(13,"label")(14,"input",8),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.edit.edit.roleAdmin=i)}),t.qZA(),t._uU(15," Administrator "),t.qZA(),t._UZ(16,"br"),t.TgZ(17,"label")(18,"input",9),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.edit.edit.rolePodcast=i)}),t.qZA(),t._uU(19," Manage Podcasts "),t.qZA(),t._UZ(20,"br"),t.TgZ(21,"label")(22,"input",9),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.edit.edit.roleStream=i)}),t.qZA(),t._uU(23," Can Stream/Download "),t.qZA(),t._UZ(24,"br"),t.TgZ(25,"label")(26,"input",10),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.edit.edit.roleUpload=i)}),t.qZA(),t._uU(27," Can Upload "),t.qZA()(),t._UZ(28,"hr"),t.TgZ(29,"div",1),t._UZ(30,"input",11,12),t.TgZ(32,"label",13),t._uU(33,"Your Admin Password"),t.qZA(),t.TgZ(34,"input",14),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.edit.edit.password=i)}),t.qZA()()()()}if(2&o){const e=t.oxw();t.xp6(5),t.Q6J("ngModel",e.edit.edit.name)("ngModelOptions",t.DdM(14,rt)),t.xp6(4),t.Q6J("ngModel",e.edit.edit.email)("ngModelOptions",t.DdM(15,rt)),t.xp6(5),t.Q6J("ngModel",e.edit.edit.roleAdmin)("ngModelOptions",t.DdM(16,rt)),t.xp6(4),t.Q6J("ngModel",e.edit.edit.rolePodcast)("ngModelOptions",t.DdM(17,rt)),t.xp6(4),t.Q6J("ngModel",e.edit.edit.roleStream)("ngModelOptions",t.DdM(18,rt)),t.xp6(4),t.Q6J("ngModel",e.edit.edit.roleUpload)("ngModelOptions",t.DdM(19,rt)),t.xp6(8),t.Q6J("ngModel",e.edit.edit.password)("ngModelOptions",t.DdM(20,rt))}}let qt=(()=>{class o{dialogInit(e,n){this.edit=n.data}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-user"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"user-form-control"],["for","user-name"],["id","user-name","type","text","name","username",3,"ngModel","ngModelOptions","ngModelChange"],["for","user-mail"],["id","user-mail","type","email","name","mail",3,"ngModel","ngModelOptions","ngModelChange"],[1,"user-form-section"],[1,"user-form-roles"],["type","checkbox","title","Allow User to administrate",3,"ngModel","ngModelOptions","ngModelChange"],["type","checkbox","title","Allow User to manage podcasts",3,"ngModel","ngModelOptions","ngModelChange"],["type","checkbox","title","Allow User to upload files",3,"ngModel","ngModelOptions","ngModelChange"],["type","text","name","user","autocomplete","username",1,"dummy"],["name",""],["for","admin-pass",1,"label-pass"],["id","admin-pass","name","pass","type","password","autocomplete","password",3,"ngModel","ngModelOptions","ngModelChange"]],template:function(e,n){1&e&&t.YNc(0,qn,35,21,"div",0),2&e&&t.Q6J("ngIf",n.edit)},dependencies:[d.O5,C._Y,C.Fj,C.Wl,C.JJ,C.JL,C.On,C.F],styles:["[_nghost-%COMP%] > div[_ngcontent-%COMP%]{margin-left:15px;margin-right:15px}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%], [_nghost-%COMP%]   input[type=email][_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{line-height:1.3em;padding:5px}[_nghost-%COMP%]   .label-pass[_ngcontent-%COMP%]{padding-right:15px;font-size:.8em}[_nghost-%COMP%]   .dummy[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .user-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block}[_nghost-%COMP%]   .user-form-roles[_ngcontent-%COMP%]{margin-bottom:10px}[_nghost-%COMP%]   .user-form-roles[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{line-height:1.5em}"]}),o})();var Jn=M(9100);let Qn=(()=>{class o{constructor(e,n){this.jam=e,this.notify=n,this.hasChanged=!1,this.unsubscribe=new Q.xQ}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}dialogInit(e,n){this.user=n.data,this.setImageSource()}dialogResult(){return this.hasChanged}setImageSource(){this.userAvatar=this.user?`${this.jam.image.imageUrl({id:this.user.id,size:60,format:_.GU.webp})}?${(0,Jn.O)()}`:void 0}onDropFile(e){e.preventDefault(),this.uploadFile(e.dataTransfer?.files)}onDragOverFile(e){e.stopPropagation(),e.preventDefault()}selectFile(e){this.uploadFile(e.target.files)}uploadFile(e){e&&0!==e.length&&this.user&&this.jam.user.uploadUserImage({id:this.user.id},e[0]).pipe((0,F.R)(this.unsubscribe)).subscribe(i=>{i.type===j.dt.UploadProgress||i instanceof j.Zn&&(this.setImageSource(),this.hasChanged=!0)},i=>{this.setImageSource(),this.notify.error(i)},()=>{this.notify.success("Upload done")})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(_.K4),t.Y36(u.c))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-avatar"]],decls:6,vars:1,consts:[[1,"drop-zone",3,"drop","dragover"],[1,"root-form-control"],["alt","User Avatar",3,"src"],["type","file","placeholder","Upload image","accept",".png,.jpeg,.jpg",3,"change"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.NdJ("drop",function(r){return n.onDropFile(r)})("dragover",function(r){return n.onDragOverFile(r)}),t.TgZ(1,"form")(2,"div",1),t._UZ(3,"img",2),t.qZA()(),t.TgZ(4,"form")(5,"input",3),t.NdJ("change",function(r){return n.selectFile(r)}),t.qZA()()()),2&e&&(t.xp6(3),t.Q6J("src",n.userAvatar,t.LSH))},dependencies:[C._Y,C.JL,C.F],styles:["[_nghost-%COMP%]   .drop-zone[_ngcontent-%COMP%]{margin:10px 20px;border-width:2px;border-style:dotted;border-color:var(--secondary)}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .root-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block;text-align:center}"]}),o})();const Jt=function(){return{standalone:!0}};function Dn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",1)(1,"form"),t._UZ(2,"input",2),t.TgZ(3,"label",3),t._uU(4,"Your Admin Password"),t.qZA(),t.TgZ(5,"input",4),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.data.password=i)}),t.qZA()(),t.TgZ(6,"form"),t._UZ(7,"input",5),t.TgZ(8,"label",6),t._uU(9,"New Password for User "),t.TgZ(10,"span"),t._uU(11),t.qZA()(),t.TgZ(12,"input",7),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.data.newPassword=i)}),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(5),t.Q6J("ngModel",e.data.password)("ngModelOptions",t.DdM(5,Jt)),t.xp6(6),t.Oqu(e.data.user.name),t.xp6(1),t.Q6J("ngModel",e.data.newPassword)("ngModelOptions",t.DdM(6,Jt))}}let Nn=(()=>{class o{dialogInit(e,n){this.data=n.data}dialogResult(){return!0}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-user-pass"]],decls:1,vars:1,consts:[["class","user-form-control",4,"ngIf"],[1,"user-form-control"],["type","text","name","user","autocomplete","username",1,"dummy"],["for","admin-pass"],["id","admin-pass","name","pass","type","password","autocomplete","current-password",3,"ngModel","ngModelOptions","ngModelChange"],["type","text","name","new_name",1,"dummy"],["for","new-pass"],["id","new-pass","name","new_password","autocomplete","off","type","password","autocomplete","new-password",3,"ngModel","ngModelOptions","ngModelChange"]],template:function(e,n){1&e&&t.YNc(0,Dn,13,7,"div",0),2&e&&t.Q6J("ngIf",n.data)},dependencies:[d.O5,C._Y,C.Fj,C.JJ,C.JL,C.On,C.F],styles:["[_nghost-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:10px}[_nghost-%COMP%]   label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .dummy[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{line-height:1.3em;padding:5px;width:100%;margin-bottom:15px}"]}),o})();var zn=M(7254);function En(o,c){1&o&&t._UZ(0,"i",22)}function Yn(o,c){1&o&&(t.TgZ(0,"span",23),t._uU(1,"Is Admin"),t.qZA())}function Ln(o,c){1&o&&t._UZ(0,"i",22)}function Bn(o,c){1&o&&(t.TgZ(0,"span",23),t._uU(1,"Can manage podcast"),t.qZA())}function Kn(o,c){1&o&&t._UZ(0,"i",22)}function Gn(o,c){1&o&&(t.TgZ(0,"span",23),t._uU(1,"Can upload"),t.qZA())}function jn(o,c){1&o&&t._UZ(0,"i",22)}function Wn(o,c){1&o&&(t.TgZ(0,"span",23),t._uU(1,"Can stream"),t.qZA())}function $n(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"tr",9),t.NdJ("dblclick",function(){const r=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.editUser(r))})("keydown.enter",function(){const r=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.editUser(r))}),t.TgZ(1,"td",3),t._UZ(2,"app-coverart-image",10),t.qZA(),t.TgZ(3,"td",4),t._uU(4),t.qZA(),t.TgZ(5,"td",5),t._uU(6),t.qZA(),t.TgZ(7,"td",6),t.YNc(8,En,1,0,"i",11),t.YNc(9,Yn,2,0,"span",12),t.qZA(),t.TgZ(10,"td",6),t.YNc(11,Ln,1,0,"i",11),t.YNc(12,Bn,2,0,"span",12),t.qZA(),t.TgZ(13,"td",6),t.YNc(14,Kn,1,0,"i",11),t.YNc(15,Gn,2,0,"span",12),t.qZA(),t.TgZ(16,"td",6),t.YNc(17,jn,1,0,"i",11),t.YNc(18,Wn,2,0,"span",12),t.qZA(),t.TgZ(19,"td",7)(20,"div",13)(21,"button",14),t.NdJ("click",function(){const r=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.editUserAvatar(r))}),t._UZ(22,"i",15),t.qZA(),t.TgZ(23,"button",16),t.NdJ("click",function(){const r=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.setUserPassword(r))}),t._UZ(24,"i",17),t.qZA(),t.TgZ(25,"button",18),t.NdJ("click",function(){const r=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.editUser(r))}),t._UZ(26,"i",19),t.qZA(),t.TgZ(27,"button",20),t.NdJ("click",function(){const r=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.deleteUser(r))}),t._UZ(28,"i",21),t.qZA()()()()}if(2&o){const e=c.$implicit;t.xp6(2),t.Q6J("coverArtObj",e)("alt",e.name)("size",28)("round",!0),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.email),t.xp6(2),t.Q6J("ngIf",e.roles.admin),t.xp6(1),t.Q6J("ngIf",e.roles.admin),t.xp6(2),t.Q6J("ngIf",e.roles.podcast),t.xp6(1),t.Q6J("ngIf",e.roles.admin),t.xp6(2),t.Q6J("ngIf",e.roles.upload),t.xp6(1),t.Q6J("ngIf",e.roles.admin),t.xp6(2),t.Q6J("ngIf",e.roles.stream),t.xp6(1),t.Q6J("ngIf",e.roles.stream)}}function Vn(o,c){if(1&o&&(t.TgZ(0,"table",1)(1,"tr",2)(2,"td",3),t._uU(3,"Avatar"),t.qZA(),t.TgZ(4,"td",4),t._uU(5,"Name"),t.qZA(),t.TgZ(6,"td",5),t._uU(7,"Email"),t.qZA(),t.TgZ(8,"td",6),t._uU(9,"Administrator"),t.qZA(),t.TgZ(10,"td",6),t._uU(11,"Manage Podcasts"),t.qZA(),t.TgZ(12,"td",6),t._uU(13,"Can Upload"),t.qZA(),t.TgZ(14,"td",6),t._uU(15,"Can Stream"),t.qZA(),t.TgZ(16,"td",7),t._uU(17,"Actions"),t.qZA()(),t.YNc(18,$n,29,14,"tr",8),t.qZA()),2&o){const e=t.oxw();t.xp6(18),t.Q6J("ngForOf",e.users)}}let Xn=(()=>{class o{constructor(e,n,i,r,p,v,H){this.router=e,this.route=n,this.app=i,this.notify=r,this.dialogs=p,this.userService=v,this.dialogOverlay=H,this.users=[],this.unsubscribe=new Q.xQ}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}editUser(e){var n=this;const i={user:e,edit:{password:"",name:e.name,email:e.email||"",roleAdmin:e.roles.admin,rolePodcast:e.roles.podcast,roleStream:e.roles.stream,roleUpload:e.roles.upload}};var r;this.dialogOverlay.open({childComponent:qt,title:"Edit User",data:i,onOkBtn:(r=(0,y.Z)(function*(){try{yield n.userService.applyDialogUser(i),n.notify.success("User edited")}catch(p){return n.notify.error(p),Promise.reject(p)}}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,y.Z)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}editUserAvatar(e){this.dialogOverlay.open({childComponent:Qn,title:"Edit User Avatar",data:e}).afterClosed().pipe((0,F.R)(this.unsubscribe)).subscribe(()=>{this.userService.refreshUser(e.id)})}setUserPassword(e){var n=this;const i={user:e,password:"",newPassword:""};var r;this.dialogOverlay.open({childComponent:Nn,title:"Set User Password",data:i,onOkBtn:(r=(0,y.Z)(function*(){try{yield n.userService.setPassword(e.id,i.password,i.newPassword),n.notify.success("Password changed")}catch(p){return n.notify.error(p),Promise.reject(p)}}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,y.Z)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}deleteUser(e){this.dialogs.confirm("Delete User","Do you want to the delete the user?",()=>{this.userService.removeUser(e).then(()=>{this.notify.success("User deleted")}).catch(n=>{this.notify.error(n)})})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(P.F0),t.Y36(P.gz),t.Y36(u.zi),t.Y36(u.c),t.Y36(R.Hr),t.Y36(u.NZ),t.Y36(S.SL))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-user-list"]],inputs:{users:"users"},decls:1,vars:1,consts:[["class","users","appFocusKeyList","",4,"ngIf"],["appFocusKeyList","",1,"users"],[1,"user","heading"],[1,"avatar"],[1,"title"],[1,"email"],[1,"role"],[1,"actions"],["class","user","appFocusKeyListItem","",3,"dblclick","keydown.enter",4,"ngFor","ngForOf"],["appFocusKeyListItem","",1,"user",3,"dblclick","keydown.enter"],[3,"coverArtObj","alt","size","round"],["class","icon-checkmark","aria-hidden","true",4,"ngIf"],["class","visually-hidden",4,"ngIf"],[1,"action-buttons"],["title","Change Avatar",3,"click"],["aria-hidden","true",1,"icon-picture"],["title","Set Password",3,"click"],["aria-hidden","true",1,"icon-key"],["title","Edit User",3,"click"],["aria-hidden","true",1,"icon-edit"],["title","Delete User",3,"click"],["aria-hidden","true",1,"icon-remove"],["aria-hidden","true",1,"icon-checkmark"],[1,"visually-hidden"]],template:function(e,n){1&e&&t.YNc(0,Vn,19,1,"table",0),2&e&&t.Q6J("ngIf",n.users&&n.users.length>0)},dependencies:[d.sg,d.O5,zn.A,w.j,A.R],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]{padding:15px;font-size:.9em;width:100%}[_nghost-%COMP%]   .user[_ngcontent-%COMP%]{height:60px;border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .user[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .user[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .user.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{font-size:.9em;height:40px}[_nghost-%COMP%]   .icon-checkmark[_ngcontent-%COMP%]{color:var(--primary)}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{width:100px}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px;flex:50%;margin:0;display:inline-block;color:var(--on-control);border:1px solid transparent}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--on-control-active);border:1px solid var(--control-active)}"]}),o})();const kt=[{path:"",component:ot,children:[{path:"",pathMatch:"full",component:Ht,data:{name:"Admin"}},{path:"settings",component:Hn,data:{name:"Admin Settings"}},{path:"root",component:Un,data:{name:"Roots",icon:"icon-root"}},{path:"user",component:(()=>{class o{constructor(e,n,i,r,p,v){this.app=e,this.dialogs=n,this.jam=i,this.notify=r,this.userService=p,this.dialogOverlay=v,this.unsubscribe=new Q.xQ}getSortValue(e,n){switch(e){case"name":return n.name;case"email":return n.email;case"roleAdmin":return n.roles.admin?1:0;case"rolePodcast":return n.roles.podcast?1:0;case"roleUpload":return n.roles.upload?1:0;case"roleStream":return n.roles.stream?1:0;default:return}}ngOnInit(){this.userService.usersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(e=>{this.users=(e||[]).sort((n,i)=>n.name.localeCompare(i.name))},e=>{this.notify.error(e)}),this.userService.refreshUsers()}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}refresh(){this.userService.refreshUsers()}newUser(){var e=this;const n={edit:{password:"",name:"",email:"",roleAdmin:!1,rolePodcast:!1,roleStream:!0,roleUpload:!1}};var i;this.dialogOverlay.open({title:"New User",childComponent:qt,data:n,onOkBtn:(i=(0,y.Z)(function*(){try{yield e.userService.applyDialogUser(n),e.notify.success("User created")}catch(r){return e.notify.error(r),Promise.reject(r)}}),function(){return i.apply(this,arguments)}),onCancelBtn:function(){var i=(0,y.Z)(function*(){return Promise.resolve()});return function(){return i.apply(this,arguments)}}()})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(R.Hr),t.Y36(_.K4),t.Y36(u.c),t.Y36(u.NZ),t.Y36(S.SL))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-users"]],decls:9,vars:1,consts:[[1,"users"],["section","Users"],[1,"actions"],["title","Refresh",1,"button-on-control",3,"click"],[1,"icon-reload"],["title","New User\u2026",1,"button-on-control",3,"click"],[1,"icon-plus"],[1,"content"],[3,"users"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"app-view-header-slim",1)(2,"div",2)(3,"button",3),t.NdJ("click",function(){return n.refresh()}),t._UZ(4,"i",4),t.qZA(),t.TgZ(5,"button",5),t.NdJ("click",function(){return n.newUser()}),t._UZ(6,"i",6),t.qZA()()(),t.TgZ(7,"div",7),t._UZ(8,"app-admin-user-list",8),t.qZA()()),2&e&&(t.xp6(8),t.Q6J("users",n.users))},dependencies:[ht.p,Xn],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]{height:100%;overflow-y:auto;overflow-x:hidden}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:0 15px 15px}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1.25px;font-size:13.2px;margin-bottom:10px;color:var(--on-control-ambient)}@media (max-width: 522px){[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding-left:10px;padding-right:10px}}"]}),o})(),data:{name:"Users",icon:"icon-user"}},{path:"folder",redirectTo:"folder/"},{path:"folder/:id",component:I,data:{id:"folder",name:"Folders",icon:"icon-folder",link:"folder"},children:[{path:"overview",component:Be},{path:"health",component:ye},{path:"sub-folders",component:st},{path:"tracks",component:dn},{path:"tracks-health",component:on},{path:"tags",loadChildren:(o=(0,y.Z)(function*(){return Promise.all([M.e(592),M.e(140)]).then(M.bind(M,5140)).then(c=>c.TagEditorModule)}),function(){return o.apply(this,arguments)})}]},{path:"radar",component:On,data:{name:"Health Radar",icon:"icon-health"}}]}],to=P.Bz.forChild(kt);var o;function eo(o,c){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=t.oxw(2);t.xp6(1),t.hij("(",e.folderService.current.count,")")}}function no(o,c){if(1&o&&(t.TgZ(0,"div",7)(1,"span",3),t._uU(2,"Other requests in queue:"),t.qZA(),t._uU(3),t.qZA()),2&o){const e=t.oxw(2);t.xp6(3),t.hij(" ",e.folderService.queue.length," ")}}function oo(o,c){if(1&o&&(t.TgZ(0,"div",1)(1,"div",2)(2,"span",3),t._uU(3,"Current:"),t.qZA(),t._UZ(4,"i",4),t._uU(5),t.YNc(6,eo,2,1,"ng-container",5),t.qZA(),t.YNc(7,no,4,1,"div",6),t.qZA()),2&o){const e=t.oxw();t.xp6(5),t.hij(" ",e.folderService.current.title," "),t.xp6(1),t.Q6J("ngIf",e.folderService.current.count>1),t.xp6(1),t.Q6J("ngIf",e.folderService.queue.length>0)}}let io=(()=>{class o{constructor(e){this.folderService=e}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.Cr))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-queue-requests"]],decls:1,vars:1,consts:[["class","queue-overlay",4,"ngIf"],[1,"queue-overlay"],[1,"current"],[1,"label"],[1,"icon-spin","icon-spinner"],[4,"ngIf"],["class","other",4,"ngIf"],[1,"other"]],template:function(e,n){1&e&&t.YNc(0,oo,8,3,"div",0),2&e&&t.Q6J("ngIf",n.folderService.current)},dependencies:[d.O5],styles:["[_nghost-%COMP%]   .queue-overlay[_ngcontent-%COMP%]{position:fixed;right:16px;bottom:16px;padding:15px;background-color:var(--control);color:var(--on-control);border:1px solid var(--control-border);z-index:1000}[_nghost-%COMP%]   .queue-overlay[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{text-transform:uppercase;font-size:.8em;letter-spacing:1px;color:var(--on-control-ambient)}[_nghost-%COMP%]   .queue-overlay[_ngcontent-%COMP%]   .other[_ngcontent-%COMP%]{border-top:1px solid var(--background-border)}"]}),o})();var ro=M(327);let ao=(()=>{class o{constructor(){this.sections=[];const n=(kt[0].children||[]).filter(i=>i.path&&i.path.length>0&&i.data?.name).map(i=>({link:`/admin/${i.data&&i.data.link?i.data.link:i.path}`,name:i.data?i.data.name:"",icon:i.data&&i.data.icon?i.data.icon:"icon-admin"}));this.sections=[{name:"Administration",entries:n}]}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-sidebar"]],decls:1,vars:1,consts:[[3,"sections"]],template:function(e,n){1&e&&t._UZ(0,"app-sidebar",0),2&e&&t.Q6J("sections",n.sections)},dependencies:[ro.k],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}"]}),o})();var so=M(9766);const co=function(o){return["/admin",o]};function lo(o,c){if(1&o&&(t.TgZ(0,"div",1)(1,"div",2),t._UZ(2,"app-iconart-image",3),t.qZA(),t.TgZ(3,"div",4)(4,"a",5),t._uU(5),t.qZA()()()),2&o){const e=c.$implicit;t.Q6J("routerLink",t.VKq(3,co,e.id)),t.xp6(2),t.Q6J("icon",e.icon),t.xp6(3),t.Oqu(e.text)}}let go=(()=>{class o{constructor(){this.sections=[],this.sections=(kt[0].children||[]).filter(n=>n.path&&n.path.length>0&&n.data?.name).map(n=>({id:n.data&&n.data.link?n.data.link:n.path,text:n.data?n.data.name:"",icon:n.data&&n.data.icon?n.data.icon:"icon-admin"}))}trackByFn(e,n){return n.id}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-section-cards"]],decls:1,vars:2,consts:[["class","section-card no-hover",3,"routerLink",4,"ngFor","ngForOf","ngForTrackBy"],[1,"section-card","no-hover",3,"routerLink"],[1,"image"],[3,"icon"],[1,"footer"],[1,"footer-content"]],template:function(e,n){1&e&&t.YNc(0,lo,6,5,"div",0),2&e&&t.Q6J("ngForOf",n.sections)("ngForTrackBy",n.trackByFn)},dependencies:[d.sg,so.B,P.rH],styles:['[_nghost-%COMP%]{display:flex;flex-flow:row wrap}@media (max-width: 768px){[_nghost-%COMP%]{justify-content:space-around}}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{margin:15px;width:calc(25% - 30px);position:relative;overflow:hidden;display:flex;cursor:pointer}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:before{content:"";display:block;margin-top:100%}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{position:absolute;top:1px;padding:5px;transform:translateY(-31px);transition:transform .3s}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]{right:1px;border-bottom-left-radius:3px;cursor:pointer;-webkit-user-select:none;user-select:none}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{left:1px;font-size:.8em;border-bottom-right-radius:3px}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{padding:5px;position:absolute;bottom:1px;left:1px;right:1px;overflow:hidden;height:auto}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:hover   .fav[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:hover   .date[_ngcontent-%COMP%]{transform:translateY(0)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:hover   .footer[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]{background-color:var(--background-transparent);color:var(--on-background-active)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-active)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer-subline[_ngcontent-%COMP%]{display:block;font-size:.8em}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]{height:40px;padding-top:10px;white-space:nowrap}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:5px;margin-right:5px}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{float:right;margin-right:5px}@media (max-width: 1600px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{width:calc(25% - 30px)}}@media (max-width: 1200px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{width:calc(33.3333333333% - 30px)}}@media (max-width: 522px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{width:calc(50% - 30px)}}@media (max-width: 400px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{font-size:.8em}}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{min-height:135px;min-width:135px;display:flex;align-items:center;justify-content:center}']}),o})(),po=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[d.ez,lt.m,C.u5,L.t6,nt.QG,z.vI,N.Cl,et.In,to]}),o})();t.B6R(ot,function(){return[it.H,P.lC,io,ao]},[]),t.B6R(Ht,function(){return[ht.p,go]},[])},1687:(bt,$,M)=>{function d(u,_){if(void 0===u&&void 0===_)throw new Error("Trying to compare two undefined values");if(void 0===u||void 0===_)return 0;const O=String(u),w=String(_),A=function N(u,_){const O=[];let A,w=0;for(let Z=0;Z<=_.length;Z++)for(let U=0;U<=u.length;U++)A=Z&&U?u.charAt(U-1)===_.charAt(Z-1)?w:Math.min(O[U],O[U-1],w)+1:Z+U,w=O[U],O[U]=A;return O.pop()||0}(O,w);return O.length>w.length?1-A/O.length:1-A/w.length}function L(u,_){const O={};return function C(u,_){const w=_||2,A=`-${u.toLowerCase().replace(/[^\w, ]+/,"")}-`,Z=[];for(let U=0;U<A.length-w+1;U+=1)Z.push(A.slice(U,U+w));return Z}(u,_||2).forEach(A=>{A in O?O[A]+=1:O[A]=1}),O}function z(u){if("string"!=typeof u)throw new Error("Must use a string as argument to FuzzySet functions");return u.toLowerCase()}M.d($,{VI:()=>ot,Cb:()=>F,C6:()=>dt,U_:()=>y,kQ:()=>P,RQ:()=>nt,f_:()=>t});class lt{constructor(_,O,w,A){this.version="0.0.1",this.exactSet={},this.matchDict={},this.items={},this.arr=_||[],this.useLevenshtein=O||!0,this.gramSizeLower=w||2,this.gramSizeUpper=A||3;for(let Z=this.gramSizeLower;Z<this.gramSizeUpper+1;Z+=1)this.items[Z]=[];this.arr.forEach(Z=>{this.add(Z)})}get(_,O){const w=this.getVal(_);return!w&&O?O:w}add(_){if(!(z(_)in this.exactSet))for(let w=this.gramSizeLower;w<this.gramSizeUpper+1;w+=1)this.addVal(_,w)}length(){let _=0;for(const O in this.exactSet)Object.prototype.hasOwnProperty.call(this.exactSet,O)&&(_+=1);return _}isEmpty(){for(const _ in this.exactSet)if(Object.prototype.hasOwnProperty.call(this.exactSet,_))return!1;return!0}values(){const _=[];for(const O in this.exactSet)Object.prototype.hasOwnProperty.call(this.exactSet,O)&&_.push(this.exactSet[O]);return _}getVal(_){const O=z(_),w=this.exactSet[O];if(w)return[[1,w]];for(let A=this.gramSizeUpper;A>=this.gramSizeLower;A-=1){const Z=this.getValGram(_,A);if(Z)return Z}}getValGram(_,O){const w=z(_),A={},Z=L(w,O),U=this.items[O];let G,K=0;for(const a in Z)if(Object.prototype.hasOwnProperty.call(Z,a)){const s=Z[a];if(K+=Math.pow(s,2),a in this.matchDict)for(const l of this.matchDict[a]){const g=l[0];G=l[1],g in A?A[g]+=s*G:A[g]=s*G}}if(function et(u){for(const _ in u)if(Object.prototype.hasOwnProperty.call(u,_))return!1;return!0}(A))return;const E=Math.sqrt(K);let it,q=[];Object.keys(A).forEach(a=>{it=A[a];const s=parseInt(a,10);q.push([it/(E*U[s][0]),U[s][1]])});const f=(a,s)=>a[0]<s[0]?1:a[0]>s[0]?-1:0;if(q.sort(f),this.useLevenshtein){const a=[],s=Math.min(50,q.length);for(let l=0;l<s;l+=1)a.push([d(q[l][1],w),q[l][1]]);q=a,q.sort(f)}const x=[];for(const a of q)a[0]===q[0][0]&&x.push([a[0],this.exactSet[a[1]]]);return x}addVal(_,O){const w=z(_),A=this.items[O]||[],Z=A.length;A.push(0);const U=L(w,O);let K=0;for(const E in U)if(Object.prototype.hasOwnProperty.call(U,E)){const q=U[E];K+=Math.pow(q,2),E in this.matchDict?this.matchDict[E].push([Z,q]):this.matchDict[E]=[[Z,q]]}const G=Math.sqrt(K);A[Z]=[G,w],this.items[O]=A,this.exactSet[w]=_}}function nt(u){return u.split(/[.,\\/ -]/).map(_=>_.trim()).filter(_=>_.length>0)}function t(u){return u.replace(/\.[^/.]+$/,"")}function ot(u){return u.substring(u.lastIndexOf(".")+1,u.length)||u}function y(u,_){return _.includes(ot(u))}function P(u,_){return u.toString().replace(/:/g," - ").replace(/[?/!\\]/g,_)}function F(u){if(!u)return 0;const O=t(u).split(/[ \-_.:;?!~,`"&|()<>{}[\]\r\n/\\]+/).map(Number).filter(w=>!isNaN(w));return O.length>0?O[0]:0}function dt(u,_){const O=new lt;O.add(u);const w=O.get(_);return w?w[0][0]:0}},2689:(bt,$,M)=>{function N(d){let C="";const L=new Uint8Array(d),et=L.byteLength;for(let z=0;z<et;z++)C+=String.fromCharCode(L[z]);return window.btoa(C)}M.d($,{q:()=>N})},1208:(bt,$,M)=>{M.d($,{Ll:()=>it,QG:()=>q,ap:()=>E});var N=M(5861),d=M(4650),C=M(1481),L=M(6895);const et=["wrapper"],z=["sourceImage"];function lt(f,x){if(1&f){const a=d.EpF();d.TgZ(0,"img",4,5),d.NdJ("load",function(){d.CHM(a);const l=d.oxw();return d.KtG(l.imageLoadedInView())})("mousedown",function(l){d.CHM(a);const g=d.oxw();return d.KtG(g.startMove(l,g.moveTypes.Drag))})("touchstart",function(l){d.CHM(a);const g=d.oxw();return d.KtG(g.startMove(l,g.moveTypes.Drag))}),d.qZA()}if(2&f){const a=d.oxw();d.Udp("visibility",a.imageVisible?"visible":"hidden")("transform",a.safeTransformStyle),d.ekj("ngx-ic-draggable",!a.disabled&&a.allowMoveImage),d.Q6J("src",a.safeImgDataUrl,d.LSH)}}function nt(f,x){if(1&f){const a=d.EpF();d.ynx(0),d.TgZ(1,"span",9),d.NdJ("mousedown",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"topleft"))})("touchstart",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"topleft"))}),d._UZ(2,"span",10),d.qZA(),d.TgZ(3,"span",11),d._UZ(4,"span",10),d.qZA(),d.TgZ(5,"span",12),d.NdJ("mousedown",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"topright"))})("touchstart",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"topright"))}),d._UZ(6,"span",10),d.qZA(),d.TgZ(7,"span",13),d._UZ(8,"span",10),d.qZA(),d.TgZ(9,"span",14),d.NdJ("mousedown",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"bottomright"))})("touchstart",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"bottomright"))}),d._UZ(10,"span",10),d.qZA(),d.TgZ(11,"span",15),d._UZ(12,"span",10),d.qZA(),d.TgZ(13,"span",16),d.NdJ("mousedown",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"bottomleft"))})("touchstart",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"bottomleft"))}),d._UZ(14,"span",10),d.qZA(),d.TgZ(15,"span",17),d._UZ(16,"span",10),d.qZA(),d.TgZ(17,"span",18),d.NdJ("mousedown",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"top"))})("touchstart",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"top"))}),d.qZA(),d.TgZ(18,"span",19),d.NdJ("mousedown",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"right"))})("touchstart",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"right"))}),d.qZA(),d.TgZ(19,"span",20),d.NdJ("mousedown",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"bottom"))})("touchstart",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"bottom"))}),d.qZA(),d.TgZ(20,"span",21),d.NdJ("mousedown",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"left"))})("touchstart",function(l){d.CHM(a);const g=d.oxw(2);return d.KtG(g.startMove(l,g.moveTypes.Resize,"left"))}),d.qZA(),d.BQk()}}function t(f,x){if(1&f){const a=d.EpF();d.TgZ(0,"div",6),d.NdJ("keydown",function(l){d.CHM(a);const g=d.oxw();return d.KtG(g.keyboardAccess(l))}),d.TgZ(1,"div",7),d.NdJ("mousedown",function(l){d.CHM(a);const g=d.oxw();return d.KtG(g.startMove(l,g.moveTypes.Move))})("touchstart",function(l){d.CHM(a);const g=d.oxw();return d.KtG(g.startMove(l,g.moveTypes.Move))}),d.qZA(),d.YNc(2,nt,21,0,"ng-container",8),d.qZA()}if(2&f){const a=d.oxw();d.Udp("top",a.cropper.y1,"px")("left",a.cropper.x1,"px")("width",a.cropper.x2-a.cropper.x1,"px")("height",a.cropper.y2-a.cropper.y1,"px")("margin-left","center"===a.alignImage?a.marginLeft:null)("visibility",a.imageVisible?"visible":"hidden"),d.ekj("ngx-ic-round",a.roundCropper),d.xp6(2),d.Q6J("ngIf",!a.hideResizeSquares)}}class ot{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(x){Object.keys(x).filter(a=>a in this).forEach(a=>this[a]=x[a]),this.validateOptions()}setOptionsFromChanges(x){Object.keys(x).filter(a=>a in this).forEach(a=>this[a]=x[a].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}var y=(()=>{return(f=y||(y={})).Drag="drag",f.Move="move",f.Resize="resize",f.Pinch="pinch",y;var f})();function u(f,x){return f/100*x}let _=(()=>{class f{crop(a,s,l,g){const h=this.getImagePosition(a,s,l,g),m=h.x2-h.x1,b=h.y2-h.y1,I=document.createElement("canvas");I.width=m,I.height=b;const k=I.getContext("2d");if(!k)return null;null!=g.backgroundColor&&(k.fillStyle=g.backgroundColor,k.fillRect(0,0,m,b));const T=(g.transform.scale||1)*(g.transform.flipH?-1:1),Y=(g.transform.scale||1)*(g.transform.flipV?-1:1),{translateH:V,translateV:B}=this.getCanvasTranslate(a,s,g),R=s.transformed;k.setTransform(T,0,0,Y,R.size.width/2+V,R.size.height/2+B),k.translate(-h.x1/T,-h.y1/Y),k.rotate((g.transform.rotate||0)*Math.PI/180),k.drawImage(R.image,-R.size.width/2,-R.size.height/2);const S={width:m,height:b,imagePosition:h,cropperPosition:{...l}};g.containWithinAspectRatio&&(S.offsetImagePosition=this.getOffsetImagePosition(a,s,l,g));const D=this.getResizeRatio(m,b,g);return 1!==D&&(S.width=Math.round(m*D),S.height=g.maintainAspectRatio?Math.round(S.width/g.aspectRatio):Math.round(b*D),function dt(f,x,a){const s=f.width,l=f.height,g=s/(x=Math.round(x)),h=l/(a=Math.round(a)),m=Math.ceil(g/2),b=Math.ceil(h/2),I=f.getContext("2d");if(I){const k=I.getImageData(0,0,s,l),T=I.createImageData(x,a),Y=k.data,V=T.data;for(let B=0;B<a;B++)for(let R=0;R<x;R++){const S=4*(R+B*x),D=B*h;let J=0,at=0,ut=0,mt=0,ft=0,Ct=0,xt=0;const wt=Math.floor(R*g),yt=Math.floor(B*h);let gt=Math.ceil((R+1)*g),pt=Math.ceil((B+1)*h);gt=Math.min(gt,s),pt=Math.min(pt,l);for(let st=yt;st<pt;st++){const Mt=Math.abs(D-st)/b,j=R*g,At=Mt*Mt;for(let ct=wt;ct<gt;ct++){const vt=Math.abs(j-ct)/m,X=Math.sqrt(At+vt*vt);if(X>=1)continue;J=2*X*X*X-3*X*X+1;const tt=4*(ct+st*s);xt+=J*Y[tt+3],ut+=J,Y[tt+3]<255&&(J=J*Y[tt+3]/250),mt+=J*Y[tt],ft+=J*Y[tt+1],Ct+=J*Y[tt+2],at+=J}}V[S]=mt/at,V[S+1]=ft/at,V[S+2]=Ct/at,V[S+3]=xt/ut}f.width=x,f.height=a,I.putImageData(T,0,0)}}(I,S.width,S.height)),S.base64=I.toDataURL("image/"+g.format,this.getQuality(g)),S}getCanvasTranslate(a,s,l){if("px"===l.transform.translateUnit){const g=this.getRatio(a,s);return{translateH:(l.transform.translateH||0)*g,translateV:(l.transform.translateV||0)*g}}return{translateH:l.transform.translateH?u(l.transform.translateH,s.transformed.size.width):0,translateV:l.transform.translateV?u(l.transform.translateV,s.transformed.size.height):0}}getRatio(a,s){return s.transformed.size.width/a.nativeElement.offsetWidth}getImagePosition(a,s,l,g){const h=this.getRatio(a,s),m={x1:Math.round(l.x1*h),y1:Math.round(l.y1*h),x2:Math.round(l.x2*h),y2:Math.round(l.y2*h)};return g.containWithinAspectRatio||(m.x1=Math.max(m.x1,0),m.y1=Math.max(m.y1,0),m.x2=Math.min(m.x2,s.transformed.size.width),m.y2=Math.min(m.y2,s.transformed.size.height)),m}getOffsetImagePosition(a,s,l,g){const b=s.transformed.size.width/a.nativeElement.offsetWidth;let I,k;(g.canvasRotation+s.exifTransform.rotate)%2?(I=(s.transformed.size.width-s.original.size.height)/2,k=(s.transformed.size.height-s.original.size.width)/2):(I=(s.transformed.size.width-s.original.size.width)/2,k=(s.transformed.size.height-s.original.size.height)/2);const T={x1:Math.round(l.x1*b)-I,y1:Math.round(l.y1*b)-k,x2:Math.round(l.x2*b)-I,y2:Math.round(l.y2*b)-k};return g.containWithinAspectRatio||(T.x1=Math.max(T.x1,0),T.y1=Math.max(T.y1,0),T.x2=Math.min(T.x2,s.transformed.size.width),T.y2=Math.min(T.y2,s.transformed.size.height)),T}getResizeRatio(a,s,l){const g=l.resizeToWidth/a,h=l.resizeToHeight/s,m=new Array;l.resizeToWidth>0&&m.push(g),l.resizeToHeight>0&&m.push(h);const b=0===m.length?1:Math.min(...m);return b>1&&!l.onlyScaleDown?b:Math.min(b,1)}getQuality(a){return Math.min(1,Math.max(0,a.imageQuality/100))}}return f.\u0275fac=function(a){return new(a||f)},f.\u0275prov=d.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})(),O=(()=>{class f{resetCropperPosition(a,s,l){if(!a?.nativeElement)return;const g=a.nativeElement;if(l.cropperStaticHeight&&l.cropperStaticWidth)s.x1=0,s.x2=g.offsetWidth>l.cropperStaticWidth?l.cropperStaticWidth:g.offsetWidth,s.y1=0,s.y2=g.offsetHeight>l.cropperStaticHeight?l.cropperStaticHeight:g.offsetHeight;else{const h=Math.min(l.cropperScaledMaxWidth,g.offsetWidth),m=Math.min(l.cropperScaledMaxHeight,g.offsetHeight);if(l.maintainAspectRatio)if(g.offsetWidth/l.aspectRatio<g.offsetHeight){s.x1=0,s.x2=h;const b=h/l.aspectRatio;s.y1=(g.offsetHeight-b)/2,s.y2=s.y1+b}else{s.y1=0,s.y2=m;const b=m*l.aspectRatio;s.x1=(g.offsetWidth-b)/2,s.x2=s.x1+b}else s.x1=0,s.x2=h,s.y1=0,s.y2=m}}move(a,s,l){const g=this.getClientX(a)-s.clientX,h=this.getClientY(a)-s.clientY;l.x1=s.x1+g,l.y1=s.y1+h,l.x2=s.x2+g,l.y2=s.y2+h}resize(a,s,l,g,h){const m=this.getClientX(a)-s.clientX,b=this.getClientY(a)-s.clientY;switch(s.position){case"left":l.x1=Math.min(Math.max(s.x1+m,l.x2-h.cropperScaledMaxWidth),l.x2-h.cropperScaledMinWidth);break;case"topleft":l.x1=Math.min(Math.max(s.x1+m,l.x2-h.cropperScaledMaxWidth),l.x2-h.cropperScaledMinWidth),l.y1=Math.min(Math.max(s.y1+b,l.y2-h.cropperScaledMaxHeight),l.y2-h.cropperScaledMinHeight);break;case"top":l.y1=Math.min(Math.max(s.y1+b,l.y2-h.cropperScaledMaxHeight),l.y2-h.cropperScaledMinHeight);break;case"topright":l.x2=Math.max(Math.min(s.x2+m,l.x1+h.cropperScaledMaxWidth),l.x1+h.cropperScaledMinWidth),l.y1=Math.min(Math.max(s.y1+b,l.y2-h.cropperScaledMaxHeight),l.y2-h.cropperScaledMinHeight);break;case"right":l.x2=Math.max(Math.min(s.x2+m,l.x1+h.cropperScaledMaxWidth),l.x1+h.cropperScaledMinWidth);break;case"bottomright":l.x2=Math.max(Math.min(s.x2+m,l.x1+h.cropperScaledMaxWidth),l.x1+h.cropperScaledMinWidth),l.y2=Math.max(Math.min(s.y2+b,l.y1+h.cropperScaledMaxHeight),l.y1+h.cropperScaledMinHeight);break;case"bottom":l.y2=Math.max(Math.min(s.y2+b,l.y1+h.cropperScaledMaxHeight),l.y1+h.cropperScaledMinHeight);break;case"bottomleft":l.x1=Math.min(Math.max(s.x1+m,l.x2-h.cropperScaledMaxWidth),l.x2-h.cropperScaledMinWidth),l.y2=Math.max(Math.min(s.y2+b,l.y1+h.cropperScaledMaxHeight),l.y1+h.cropperScaledMinHeight);break;case"center":const I=a.scale,k=Math.min(Math.max(h.cropperScaledMinWidth,Math.abs(s.x2-s.x1)*I),h.cropperScaledMaxWidth),T=Math.min(Math.max(h.cropperScaledMinHeight,Math.abs(s.y2-s.y1)*I),h.cropperScaledMaxHeight);l.x1=s.clientX-k/2,l.x2=s.clientX+k/2,l.y1=s.clientY-T/2,l.y2=s.clientY+T/2,l.x1<0?(l.x2-=l.x1,l.x1=0):l.x2>g.width&&(l.x1-=l.x2-g.width,l.x2=g.width),l.y1<0?(l.y2-=l.y1,l.y1=0):l.y2>g.height&&(l.y1-=l.y2-g.height,l.y2=g.height)}h.maintainAspectRatio&&this.checkAspectRatio(s.position,l,g,h)}checkAspectRatio(a,s,l,g){let h=0,m=0;switch(a){case"top":s.x2=s.x1+(s.y2-s.y1)*g.aspectRatio,h=Math.max(s.x2-l.width,0),m=Math.max(0-s.y1,0),(h>0||m>0)&&(s.x2-=m*g.aspectRatio>h?m*g.aspectRatio:h,s.y1+=m*g.aspectRatio>h?m:h/g.aspectRatio);break;case"bottom":s.x2=s.x1+(s.y2-s.y1)*g.aspectRatio,h=Math.max(s.x2-l.width,0),m=Math.max(s.y2-l.height,0),(h>0||m>0)&&(s.x2-=m*g.aspectRatio>h?m*g.aspectRatio:h,s.y2-=m*g.aspectRatio>h?m:h/g.aspectRatio);break;case"topleft":s.y1=s.y2-(s.x2-s.x1)/g.aspectRatio,h=Math.max(0-s.x1,0),m=Math.max(0-s.y1,0),(h>0||m>0)&&(s.x1+=m*g.aspectRatio>h?m*g.aspectRatio:h,s.y1+=m*g.aspectRatio>h?m:h/g.aspectRatio);break;case"topright":s.y1=s.y2-(s.x2-s.x1)/g.aspectRatio,h=Math.max(s.x2-l.width,0),m=Math.max(0-s.y1,0),(h>0||m>0)&&(s.x2-=m*g.aspectRatio>h?m*g.aspectRatio:h,s.y1+=m*g.aspectRatio>h?m:h/g.aspectRatio);break;case"right":case"bottomright":s.y2=s.y1+(s.x2-s.x1)/g.aspectRatio,h=Math.max(s.x2-l.width,0),m=Math.max(s.y2-l.height,0),(h>0||m>0)&&(s.x2-=m*g.aspectRatio>h?m*g.aspectRatio:h,s.y2-=m*g.aspectRatio>h?m:h/g.aspectRatio);break;case"left":case"bottomleft":s.y2=s.y1+(s.x2-s.x1)/g.aspectRatio,h=Math.max(0-s.x1,0),m=Math.max(s.y2-l.height,0),(h>0||m>0)&&(s.x1+=m*g.aspectRatio>h?m*g.aspectRatio:h,s.y2-=m*g.aspectRatio>h?m:h/g.aspectRatio);break;case"center":s.x2=s.x1+(s.y2-s.y1)*g.aspectRatio,s.y2=s.y1+(s.x2-s.x1)/g.aspectRatio;const b=Math.max(0-s.x1,0),I=Math.max(s.x2-l.width,0),k=Math.max(s.y2-l.height,0),T=Math.max(0-s.y1,0);(b>0||I>0||k>0||T>0)&&(s.x1+=k*g.aspectRatio>b?k*g.aspectRatio:b,s.x2-=T*g.aspectRatio>I?T*g.aspectRatio:I,s.y1+=T*g.aspectRatio>I?T:I/g.aspectRatio,s.y2-=k*g.aspectRatio>b?k:b/g.aspectRatio)}}getClientX(a){return a.touches?.[0].clientX||a.clientX||0}getClientY(a){return a.touches?.[0].clientY||a.clientY||0}}return f.\u0275fac=function(a){return new(a||f)},f.\u0275prov=d.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})();let G=(()=>{class f{constructor(){this.autoRotateSupported=function A(){return new Promise(f=>{const x=new Image;x.onload=()=>{f(1===x.width&&2===x.height)},x.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(a,s){return new Promise((l,g)=>{const h=new FileReader;h.onload=m=>{this.loadImage(m.target.result,a.type,s).then(l).catch(g)},h.readAsDataURL(a)})}loadImage(a,s,l){return this.isValidImageType(s)?this.loadBase64Image(a,l):Promise.reject(new Error("Invalid image type"))}isValidImageType(a){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(a)}loadImageFromURL(a,s){return new Promise((l,g)=>{const h=new Image;h.onerror=()=>g,h.onload=()=>{const m=document.createElement("canvas"),b=m.getContext("2d");m.width=h.width,m.height=h.height,b?.drawImage(h,0,0),this.loadBase64Image(m.toDataURL(),s).then(l)},h.crossOrigin="anonymous",h.src=a})}loadBase64Image(a,s){return new Promise((l,g)=>{const h=new Image;h.onload=()=>l({originalImage:h,originalBase64:a}),h.onerror=g,h.src=a}).then(l=>this.transformImageBase64(l,s))}transformImageBase64(a,s){var l=this;return(0,N.Z)(function*(){const g=yield l.autoRotateSupported,h=yield function Z(f){switch("string"==typeof f&&(f=function U(f){const x=new DataView(function K(f){f=f.replace(/^data\:([^\;]+)\;base64,/gim,"");const x=atob(f),a=x.length,s=new Uint8Array(a);for(let l=0;l<a;l++)s[l]=x.charCodeAt(l);return s.buffer}(f));if(65496!==x.getUint16(0,!1))return-2;const a=x.byteLength;let s=2;for(;s<a;){if(x.getUint16(s+2,!1)<=8)return-1;const l=x.getUint16(s,!1);if(s+=2,65505==l){if(1165519206!==x.getUint32(s+=2,!1))return-1;const g=18761==x.getUint16(s+=6,!1);s+=x.getUint32(s+4,g);const h=x.getUint16(s,g);s+=2;for(let m=0;m<h;m++)if(274==x.getUint16(s+12*m,g))return x.getUint16(s+12*m+8,g)}else{if(65280!=(65280&l))break;s+=x.getUint16(s,!1)}}return-1}(f)),f){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(g?-1:a.originalBase64);return a.originalImage&&a.originalImage.complete?l.transformLoadedImage({original:{base64:a.originalBase64,image:a.originalImage,size:{width:a.originalImage.naturalWidth,height:a.originalImage.naturalHeight}},exifTransform:h},s):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(a,s){var l=this;return(0,N.Z)(function*(){const g=s.canvasRotation+a.exifTransform.rotate,h={width:a.original.image.naturalWidth,height:a.original.image.naturalHeight};if(0===g&&!a.exifTransform.flip&&!s.containWithinAspectRatio)return{original:{base64:a.original.base64,image:a.original.image,size:{...h}},transformed:{base64:a.original.base64,image:a.original.image,size:{...h}},exifTransform:a.exifTransform};const m=l.getTransformedSize(h,a.exifTransform,s),b=document.createElement("canvas");b.width=m.width,b.height=m.height;const I=b.getContext("2d");I?.setTransform(a.exifTransform.flip?-1:1,0,0,1,b.width/2,b.height/2),I?.rotate(Math.PI*(g/2)),I?.drawImage(a.original.image,-h.width/2,-h.height/2);const k=b.toDataURL(),T=yield l.loadImageFromBase64(k);return{original:{base64:a.original.base64,image:a.original.image,size:{...h}},transformed:{base64:k,image:T,size:{width:T.width,height:T.height}},exifTransform:a.exifTransform}})()}loadImageFromBase64(a){return new Promise((s,l)=>{const g=new Image;g.onload=()=>s(g),g.onerror=l,g.src=a})}getTransformedSize(a,s,l){const g=l.canvasRotation+s.rotate;if(l.containWithinAspectRatio){if(g%2){const m=a.height/l.aspectRatio;return{width:Math.max(a.height,a.width*l.aspectRatio),height:Math.max(a.width,m)}}{const m=a.width/l.aspectRatio;return{width:Math.max(a.width,a.height*l.aspectRatio),height:Math.max(a.height,m)}}}return g%2?{height:a.width,width:a.height}:{width:a.width,height:a.height}}}return f.\u0275fac=function(a){return new(a||f)},f.\u0275prov=d.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})(),E=(()=>{class f{constructor(a,s,l,g,h){this.cropService=a,this.cropperPositionService=s,this.loadImageService=l,this.sanitizer=g,this.cd=h,this.Hammer=window?.Hammer||null,this.settings=new ot,this.setImageMaxSizeRetries=0,this.resizedWhileHidden=!1,this.marginLeft="0px",this.maxSize={width:0,height:0},this.moveTypes=y,this.imageVisible=!1,this.format=this.settings.format,this.transform={},this.maintainAspectRatio=this.settings.maintainAspectRatio,this.aspectRatio=this.settings.aspectRatio,this.resetCropOnAspectRatioChange=this.settings.resetCropOnAspectRatioChange,this.resizeToWidth=this.settings.resizeToWidth,this.resizeToHeight=this.settings.resizeToHeight,this.cropperMinWidth=this.settings.cropperMinWidth,this.cropperMinHeight=this.settings.cropperMinHeight,this.cropperMaxHeight=this.settings.cropperMaxHeight,this.cropperMaxWidth=this.settings.cropperMaxWidth,this.cropperStaticWidth=this.settings.cropperStaticWidth,this.cropperStaticHeight=this.settings.cropperStaticHeight,this.canvasRotation=this.settings.canvasRotation,this.initialStepSize=this.settings.initialStepSize,this.roundCropper=this.settings.roundCropper,this.onlyScaleDown=this.settings.onlyScaleDown,this.imageQuality=this.settings.imageQuality,this.autoCrop=this.settings.autoCrop,this.backgroundColor=this.settings.backgroundColor,this.containWithinAspectRatio=this.settings.containWithinAspectRatio,this.hideResizeSquares=this.settings.hideResizeSquares,this.allowMoveImage=!1,this.cropper={x1:-100,y1:-100,x2:1e4,y2:1e4},this.alignImage=this.settings.alignImage,this.disabled=!1,this.hidden=!1,this.imageCropped=new d.vpe,this.startCropImage=new d.vpe,this.imageLoaded=new d.vpe,this.cropperReady=new d.vpe,this.loadImageFailed=new d.vpe,this.transformChange=new d.vpe,this.reset()}ngOnChanges(a){this.onChangesUpdateSettings(a),this.onChangesInputImage(a),this.loadedImage?.original.image.complete&&(a.containWithinAspectRatio||a.canvasRotation)&&this.loadImageService.transformLoadedImage(this.loadedImage,this.settings).then(s=>this.setLoadedImage(s)).catch(s=>this.loadImageError(s)),(a.cropper||a.maintainAspectRatio||a.aspectRatio)&&(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),!this.maintainAspectRatio||!this.resetCropOnAspectRatioChange&&this.aspectRatioIsCorrect()||!a.maintainAspectRatio&&!a.aspectRatio?a.cropper&&(this.checkCropperPosition(!1),this.doAutoCrop()):this.resetCropperPosition(),this.cd.markForCheck()),a.transform&&(this.transform=this.transform||{},this.setCssTransform(),this.doAutoCrop(),this.cd.markForCheck()),a.hidden&&this.resizedWhileHidden&&!this.hidden&&setTimeout(()=>{this.onResize(),this.resizedWhileHidden=!1})}onChangesUpdateSettings(a){this.settings.setOptionsFromChanges(a),this.settings.cropperStaticHeight&&this.settings.cropperStaticWidth&&this.settings.setOptions({hideResizeSquares:!0,cropperMinWidth:this.settings.cropperStaticWidth,cropperMinHeight:this.settings.cropperStaticHeight,cropperMaxHeight:this.settings.cropperStaticHeight,cropperMaxWidth:this.settings.cropperStaticWidth,maintainAspectRatio:!1})}onChangesInputImage(a){(a.imageChangedEvent||a.imageURL||a.imageBase64||a.imageFile)&&this.reset(),a.imageChangedEvent&&this.isValidImageChangedEvent()&&this.loadImageFile(this.imageChangedEvent.target.files[0]),a.imageURL&&this.imageURL&&this.loadImageFromURL(this.imageURL),a.imageBase64&&this.imageBase64&&this.loadBase64Image(this.imageBase64),a.imageFile&&this.imageFile&&this.loadImageFile(this.imageFile)}isValidImageChangedEvent(){return this.imageChangedEvent?.target?.files?.length>0}setCssTransform(){const a=this.transform?.translateUnit||"%";this.safeTransformStyle=this.sanitizer.bypassSecurityTrustStyle(`translate(${this.transform.translateH||0}${a}, ${this.transform.translateV||0}${a}) scaleX(`+(this.transform.scale||1)*(this.transform.flipH?-1:1)+") scaleY("+(this.transform.scale||1)*(this.transform.flipV?-1:1)+") rotate("+(this.transform.rotate||0)+"deg)")}ngOnInit(){this.settings.stepSize=this.initialStepSize,this.activatePinchGesture()}reset(){this.imageVisible=!1,this.loadedImage=void 0,this.safeImgDataUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",this.moveStart={active:!1,type:null,position:null,x1:0,y1:0,x2:0,y2:0,clientX:0,clientY:0},this.maxSize={width:0,height:0},this.cropper.x1=-100,this.cropper.y1=-100,this.cropper.x2=1e4,this.cropper.y2=1e4}loadImageFile(a){this.loadImageService.loadImageFile(a,this.settings).then(s=>this.setLoadedImage(s)).catch(s=>this.loadImageError(s))}loadBase64Image(a){this.loadImageService.loadBase64Image(a,this.settings).then(s=>this.setLoadedImage(s)).catch(s=>this.loadImageError(s))}loadImageFromURL(a){this.loadImageService.loadImageFromURL(a,this.settings).then(s=>this.setLoadedImage(s)).catch(s=>this.loadImageError(s))}setLoadedImage(a){this.loadedImage=a,this.safeImgDataUrl=this.sanitizer.bypassSecurityTrustResourceUrl(a.transformed.base64),this.cd.markForCheck()}loadImageError(a){console.error(a),this.loadImageFailed.emit()}imageLoadedInView(){null!=this.loadedImage&&(this.imageLoaded.emit(this.loadedImage),this.setImageMaxSizeRetries=0,setTimeout(()=>this.checkImageMaxSizeRecursively()))}checkImageMaxSizeRecursively(){this.setImageMaxSizeRetries>40?this.loadImageFailed.emit():this.sourceImageLoaded()?(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),this.resetCropperPosition(),this.cropperReady.emit({...this.maxSize}),this.cd.markForCheck()):(this.setImageMaxSizeRetries++,setTimeout(()=>this.checkImageMaxSizeRecursively(),50))}sourceImageLoaded(){return this.sourceImage?.nativeElement?.offsetWidth>0}onResize(){!this.loadedImage||(this.hidden?this.resizedWhileHidden=!0:(this.resizeCropperPosition(),this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize()))}activatePinchGesture(){if(this.Hammer){const a=new this.Hammer(this.wrapper.nativeElement);a.get("pinch").set({enable:!0}),a.on("pinchmove",this.onPinch.bind(this)),a.on("pinchend",this.pinchStop.bind(this)),a.on("pinchstart",this.startPinch.bind(this))}else(0,d.X6Q)()&&console.warn("[NgxImageCropper] Could not find HammerJS - Pinch Gesture won't work")}resizeCropperPosition(){const a=this.sourceImage.nativeElement;(this.maxSize.width!==a.offsetWidth||this.maxSize.height!==a.offsetHeight)&&(this.cropper.x1=this.cropper.x1*a.offsetWidth/this.maxSize.width,this.cropper.x2=this.cropper.x2*a.offsetWidth/this.maxSize.width,this.cropper.y1=this.cropper.y1*a.offsetHeight/this.maxSize.height,this.cropper.y2=this.cropper.y2*a.offsetHeight/this.maxSize.height)}resetCropperPosition(){this.cropperPositionService.resetCropperPosition(this.sourceImage,this.cropper,this.settings),this.doAutoCrop(),this.imageVisible=!0}keyboardAccess(a){this.changeKeyboardStepSize(a),this.keyboardMoveCropper(a)}changeKeyboardStepSize(a){const s=+a.key;s>=1&&s<=9&&(this.settings.stepSize=s)}keyboardMoveCropper(a){if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(a.key))return;const l=a.shiftKey?y.Resize:y.Move,g=a.altKey?function Q(f){switch(f){case"ArrowUp":return"bottom";case"ArrowRight":return"left";case"ArrowDown":return"top";default:return"right"}}(a.key):function P(f){switch(f){case"ArrowUp":return"top";case"ArrowRight":return"right";case"ArrowDown":return"bottom";default:return"left"}}(a.key),h=function F(f,x){switch(f){case"ArrowUp":return{clientX:0,clientY:-1*x};case"ArrowRight":return{clientX:x,clientY:0};case"ArrowDown":return{clientX:0,clientY:x};default:return{clientX:-1*x,clientY:0}}}(a.key,this.settings.stepSize);a.preventDefault(),a.stopPropagation(),this.startMove({clientX:0,clientY:0},l,g),this.moveImg(h),this.moveStop()}startMove(a,s,l=null){this.disabled||this.moveStart?.active&&this.moveStart?.type===y.Pinch||s===y.Drag&&!this.allowMoveImage||(a.preventDefault&&a.preventDefault(),this.moveStart={active:!0,type:s,position:l,transform:{...this.transform},clientX:this.cropperPositionService.getClientX(a),clientY:this.cropperPositionService.getClientY(a),...this.cropper})}startPinch(a){!this.safeImgDataUrl||(a.preventDefault&&a.preventDefault(),this.moveStart={active:!0,type:y.Pinch,position:"center",clientX:this.cropper.x1+(this.cropper.x2-this.cropper.x1)/2,clientY:this.cropper.y1+(this.cropper.y2-this.cropper.y1)/2,...this.cropper})}moveImg(a){if(this.moveStart.active){if(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),this.moveStart.type===y.Move)this.cropperPositionService.move(a,this.moveStart,this.cropper),this.checkCropperPosition(!0);else if(this.moveStart.type===y.Resize)!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.cropperPositionService.resize(a,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1);else if(this.moveStart.type===y.Drag){const s=this.cropperPositionService.getClientX(a)-this.moveStart.clientX,l=this.cropperPositionService.getClientY(a)-this.moveStart.clientY;this.transform={...this.transform,translateH:(this.moveStart.transform?.translateH||0)+s,translateV:(this.moveStart.transform?.translateV||0)+l},this.setCssTransform()}this.cd.detectChanges()}}onPinch(a){this.moveStart.active&&(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),this.moveStart.type===y.Pinch&&(this.cropperPositionService.resize(a,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1)),this.cd.detectChanges())}setMaxSize(){if(this.sourceImage){const a=this.sourceImage.nativeElement;this.maxSize.width=a.offsetWidth,this.maxSize.height=a.offsetHeight,this.marginLeft=this.sanitizer.bypassSecurityTrustStyle("calc(50% - "+this.maxSize.width/2+"px)")}}setCropperScaledMinSize(){this.loadedImage?.transformed?.image?(this.setCropperScaledMinWidth(),this.setCropperScaledMinHeight()):(this.settings.cropperScaledMinWidth=20,this.settings.cropperScaledMinHeight=20)}setCropperScaledMinWidth(){this.settings.cropperScaledMinWidth=this.cropperMinWidth>0?Math.max(20,this.cropperMinWidth/this.loadedImage.transformed.image.width*this.maxSize.width):20}setCropperScaledMinHeight(){this.settings.cropperScaledMinHeight=this.maintainAspectRatio?Math.max(20,this.settings.cropperScaledMinWidth/this.aspectRatio):this.cropperMinHeight>0?Math.max(20,this.cropperMinHeight/this.loadedImage.transformed.image.height*this.maxSize.height):20}setCropperScaledMaxSize(){if(this.loadedImage?.transformed?.image){const a=this.loadedImage.transformed.size.width/this.maxSize.width;this.settings.cropperScaledMaxWidth=this.cropperMaxWidth>20?this.cropperMaxWidth/a:this.maxSize.width,this.settings.cropperScaledMaxHeight=this.cropperMaxHeight>20?this.cropperMaxHeight/a:this.maxSize.height,this.maintainAspectRatio&&(this.settings.cropperScaledMaxWidth>this.settings.cropperScaledMaxHeight*this.aspectRatio?this.settings.cropperScaledMaxWidth=this.settings.cropperScaledMaxHeight*this.aspectRatio:this.settings.cropperScaledMaxWidth<this.settings.cropperScaledMaxHeight*this.aspectRatio&&(this.settings.cropperScaledMaxHeight=this.settings.cropperScaledMaxWidth/this.aspectRatio))}else this.settings.cropperScaledMaxWidth=this.maxSize.width,this.settings.cropperScaledMaxHeight=this.maxSize.height}checkCropperPosition(a=!1){this.cropper.x1<0&&(this.cropper.x2-=a?this.cropper.x1:0,this.cropper.x1=0),this.cropper.y1<0&&(this.cropper.y2-=a?this.cropper.y1:0,this.cropper.y1=0),this.cropper.x2>this.maxSize.width&&(this.cropper.x1-=a?this.cropper.x2-this.maxSize.width:0,this.cropper.x2=this.maxSize.width),this.cropper.y2>this.maxSize.height&&(this.cropper.y1-=a?this.cropper.y2-this.maxSize.height:0,this.cropper.y2=this.maxSize.height)}moveStop(){this.moveStart.active&&(this.moveStart.active=!1,this.moveStart?.type===y.Drag?this.transformChange.emit(this.transform):this.doAutoCrop())}pinchStop(){this.moveStart.active&&(this.moveStart.active=!1,this.doAutoCrop())}doAutoCrop(){this.autoCrop&&this.crop()}crop(){if(null!=this.loadedImage?.transformed?.image){this.startCropImage.emit();const a=this.cropService.crop(this.sourceImage,this.loadedImage,this.cropper,this.settings);return null!=a&&this.imageCropped.emit(a),a}return null}aspectRatioIsCorrect(){return(this.cropper.x2-this.cropper.x1)/(this.cropper.y2-this.cropper.y1)===this.aspectRatio}}return f.\u0275fac=function(a){return new(a||f)(d.Y36(_),d.Y36(O),d.Y36(G),d.Y36(C.H7),d.Y36(d.sBO))},f.\u0275cmp=d.Xpm({type:f,selectors:[["image-cropper"]],viewQuery:function(a,s){if(1&a&&(d.Gf(et,7),d.Gf(z,5)),2&a){let l;d.iGM(l=d.CRH())&&(s.wrapper=l.first),d.iGM(l=d.CRH())&&(s.sourceImage=l.first)}},hostVars:6,hostBindings:function(a,s){1&a&&d.NdJ("resize",function(){return s.onResize()},!1,d.Jf7)("mousemove",function(g){return s.moveImg(g)},!1,d.evT)("touchmove",function(g){return s.moveImg(g)},!1,d.evT)("mouseup",function(){return s.moveStop()},!1,d.evT)("touchend",function(){return s.moveStop()},!1,d.evT),2&a&&(d.Udp("text-align",s.alignImage),d.ekj("disabled",s.disabled)("ngx-ix-hidden",s.hidden))},inputs:{imageChangedEvent:"imageChangedEvent",imageURL:"imageURL",imageBase64:"imageBase64",imageFile:"imageFile",format:"format",transform:"transform",maintainAspectRatio:"maintainAspectRatio",aspectRatio:"aspectRatio",resetCropOnAspectRatioChange:"resetCropOnAspectRatioChange",resizeToWidth:"resizeToWidth",resizeToHeight:"resizeToHeight",cropperMinWidth:"cropperMinWidth",cropperMinHeight:"cropperMinHeight",cropperMaxHeight:"cropperMaxHeight",cropperMaxWidth:"cropperMaxWidth",cropperStaticWidth:"cropperStaticWidth",cropperStaticHeight:"cropperStaticHeight",canvasRotation:"canvasRotation",initialStepSize:"initialStepSize",roundCropper:"roundCropper",onlyScaleDown:"onlyScaleDown",imageQuality:"imageQuality",autoCrop:"autoCrop",backgroundColor:"backgroundColor",containWithinAspectRatio:"containWithinAspectRatio",hideResizeSquares:"hideResizeSquares",allowMoveImage:"allowMoveImage",cropper:"cropper",alignImage:"alignImage",disabled:"disabled",hidden:"hidden"},outputs:{imageCropped:"imageCropped",startCropImage:"startCropImage",imageLoaded:"imageLoaded",cropperReady:"cropperReady",loadImageFailed:"loadImageFailed",transformChange:"transformChange"},features:[d.TTD],decls:5,vars:10,consts:[["wrapper",""],["class","ngx-ic-source-image",3,"src","visibility","transform","ngx-ic-draggable","load","mousedown","touchstart",4,"ngIf"],[1,"ngx-ic-overlay"],["class","ngx-ic-cropper","tabindex","0",3,"ngx-ic-round","top","left","width","height","margin-left","visibility","keydown",4,"ngIf"],[1,"ngx-ic-source-image",3,"src","load","mousedown","touchstart"],["sourceImage",""],["tabindex","0",1,"ngx-ic-cropper",3,"keydown"],[1,"ngx-ic-move",3,"mousedown","touchstart"],[4,"ngIf"],[1,"ngx-ic-resize","ngx-ic-topleft",3,"mousedown","touchstart"],[1,"ngx-ic-square"],[1,"ngx-ic-resize","ngx-ic-top"],[1,"ngx-ic-resize","ngx-ic-topright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-right"],[1,"ngx-ic-resize","ngx-ic-bottomright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-bottom"],[1,"ngx-ic-resize","ngx-ic-bottomleft",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-left"],[1,"ngx-ic-resize-bar","ngx-ic-top",3,"mousedown","touchstart"],[1,"ngx-ic-resize-bar","ngx-ic-right",3,"mousedown","touchstart"],[1,"ngx-ic-resize-bar","ngx-ic-bottom",3,"mousedown","touchstart"],[1,"ngx-ic-resize-bar","ngx-ic-left",3,"mousedown","touchstart"]],template:function(a,s){1&a&&(d.TgZ(0,"div",null,0),d.YNc(2,lt,2,7,"img",1),d._UZ(3,"div",2),d.YNc(4,t,3,15,"div",3),d.qZA()),2&a&&(d.Udp("background",s.imageVisible&&s.backgroundColor),d.xp6(2),d.Q6J("ngIf",s.safeImgDataUrl),d.xp6(1),d.Udp("width",s.maxSize.width,"px")("height",s.maxSize.height,"px")("margin-left","center"===s.alignImage?s.marginLeft:null),d.xp6(1),d.Q6J("ngIf",s.imageVisible))},dependencies:[L.O5],styles:['[_nghost-%COMP%]{display:flex;position:relative;width:100%;max-width:100%;max-height:100%;overflow:hidden;padding:5px;text-align:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{width:100%;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image[_ngcontent-%COMP%]{max-width:100%;max-height:100%;transform-origin:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image.ngx-ic-draggable[_ngcontent-%COMP%]{user-drag:none;-webkit-user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;cursor:grab}[_nghost-%COMP%]   .ngx-ic-overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;touch-action:none;outline:var(--cropper-overlay-color, white) solid 100vw;top:0;left:0}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{position:absolute;display:flex;color:#53535c;background:transparent;outline:rgba(255,255,255,.3) solid 100vw;outline:var(--cropper-outline-color, rgba(255, 255, 255, .3)) solid 100vw;touch-action:none}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{outline-width:100vh}}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:after{position:absolute;content:"";inset:0;pointer-events:none;border:dashed 1px;opacity:.75;color:inherit;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{width:100%;cursor:move;border:1px solid rgba(255,255,255,.5)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-move[_ngcontent-%COMP%]{border-color:#1e90ff;border-width:2px}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]{position:absolute;display:inline-block;line-height:6px;padding:8px;opacity:.85;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{display:inline-block;background:#53535C;width:6px;height:6px;border:1px solid rgba(255,255,255,.5);box-sizing:content-box}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topleft[_ngcontent-%COMP%]{top:-12px;left:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-top[_ngcontent-%COMP%]{top:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topright[_ngcontent-%COMP%]{top:-12px;right:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-right[_ngcontent-%COMP%]{top:calc(50% - 12px);right:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomright[_ngcontent-%COMP%]{bottom:-12px;right:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomleft[_ngcontent-%COMP%]{bottom:-12px;left:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-left[_ngcontent-%COMP%]{top:calc(50% - 12px);left:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%]{position:absolute;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-top[_ngcontent-%COMP%]{top:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-right[_ngcontent-%COMP%]{top:11px;right:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-left[_ngcontent-%COMP%]{top:11px;left:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]{outline-color:transparent}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{border-radius:100%;box-shadow:0 0 0 100vw #ffffff4d;box-shadow:0 0 0 100vw var(--cropper-outline-color, rgba(255, 255, 255, .3))}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{box-shadow:0 0 0 100vh #ffffff4d;box-shadow:0 0 0 100vh var(--cropper-outline-color, rgba(255, 255, 255, .3))}}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{border-radius:100%}.disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{display:none}.ngx-ix-hidden[_nghost-%COMP%]{display:none}'],changeDetection:0}),f})(),q=(()=>{class f{}return f.\u0275fac=function(a){return new(a||f)},f.\u0275mod=d.oAB({type:f}),f.\u0275inj=d.cJS({imports:[[L.ez]]}),f})();function it(f){const x=f.split(","),a=x[0].replace("data:","").replace(";base64",""),s=atob(x[1]),l=new ArrayBuffer(s.length),g=new Uint8Array(l);for(let h=0;h<s.length;h+=1)g[h]=s.charCodeAt(h);return new Blob([l],{type:a})}}}]);