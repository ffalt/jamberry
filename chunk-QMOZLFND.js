import{b as D}from"./chunk-JNPRJ3MQ.js";import{G as w}from"./chunk-ZVKVGF76.js";import{h as N}from"./chunk-T6GM3CFW.js";import{$d as $,Aa as H,Hb as m,Ib as h,Lb as g,Mb as x,Nd as l,Rb as c,Sb as d,Tb as p,Uc as F,Vc as I,Y as E,_b as S,ab as u,ac as P,ec as O,fc as f,ia as _,k as v,na as k,nb as M,oa as T,tc as C,uc as y,vc as b}from"./chunk-H2EXZDP6.js";var A=(n,a)=>a.hint.id,R=(n,a)=>a.name;function j(n,a){if(n&1&&(c(0,"div",2),p(1,"i",5),C(2),c(3,"div",6),C(4),d()()),n&2){let s=a.$implicit;u(2),b(" ",s.hint.name," "),u(2),y(s.description)}}function V(n,a){n&1&&(c(0,"div",2),P(1,0),d())}function L(n,a){n&1&&p(0,"i",8)}function G(n,a){if(n&1&&C(0),n&2){let s=f().$implicit;b(" ",s.name," ")}}function K(n,a){if(n&1){let s=S();c(0,"button",7),O("click",function(){let e=k(s).$implicit;return T(e.click())}),m(1,L,1,0,"i",8)(2,G,1,1),d()}if(n&2){let s=a.$implicit;u(),h(s.running?1:2)}}function Q(n,a){if(n&1&&(g(0,j,5,2,"div",2,A,!1,V,2,0,"div",2),c(3,"div",3),g(4,K,3,1,"button",4,R),d()),n&2){let s=f(3);x(s.hints),u(4),x(s.solutions)}}function z(n,a){n&1&&(c(0,"div",2),p(1,"i",8),d())}function B(n,a){n&1&&(c(0,"div",1),m(1,Q,6,1)(2,z,2,0,"div",2),d()),n&2&&(u(),h(a.health?1:2))}function U(n,a){if(n&1&&m(0,B,3,1,"div",1),n&2){let s,i=f();h((s=i.trackHealth())?0:-1,s)}}var et=(()=>{let a=class a{constructor(){this.trackHealth=I(),this.resolvedEvent=F(),this.solutions=[],this.unsubscribe=new v,this.jam=_($),this.notify=_(w),this.folderService=_(D),this.router=_(N)}ngOnChanges(){this.display(this.trackHealth())}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}ngOnInit(){this.folderService.tracksChange.pipe(E(this.unsubscribe)).subscribe(i=>{let e=this.trackHealth();e&&e.track.id===i.id&&(e.health=[],this.jam.track.health({ids:[e.track.id],healthMedia:!0}).then(o=>{let t=o.find(r=>r.track.id===e.track.id);t?.health?(e.track=t.track,e.health=t.health):e.health=[],e.health.length===0&&this.resolvedEvent.emit(),this.display(e)}).catch(o=>{this.notify.error(o)}))})}fixAll(){for(let i of this.solutions)i.fixable&&!i.running&&i.click()}display(i){this.hints=[],this.solutions=[],i?.health&&(this.hints=i.health.map(e=>{let o=this.describeHint(e,i.track);return{hint:e,description:o}}))}describeTagHint(i,e){let o="";switch(i.id){case l.tagValuesExists:{o=(i.details??[]).map(t=>t.reason.toUpperCase()).join(", ");break}case l.id3v2Garbage:{o=(i.details??[]).map(t=>t.reason).join(", ");break}case l.id3v2Valid:{o=(i.details??[]).map(t=>t.expected&&t.actual?`${t.reason}  (${t.actual} instead of ${t.expected})`:t.reason).join(", ");break}}if(!this.solutions.some(t=>t.name==="Edit Tag")){let t={name:"Edit Tag",click:()=>{this.router.navigate([`/admin/folder/${e.parentID}/tags`]).catch(r=>{console.error(r)})}};this.solutions.push(t)}return o}describeMp3GarbageHint(i,e){let o="";if(i.details&&i.details.length>0&&(o=`${i.details[0].reason} (${i.details[0].actual} bytes)`),!this.solutions.some(t=>t.name==="Fix MP3")){let t={name:"Fix MP3",fixable:!0,click:()=>{t.running||(t.running=!0,this.jam.track.fix({id:e.id,fixID:i.id}).then(r=>{this.folderService.waitForQueueResult("Fixing Track MP3",r,[],[],[e.id])}).catch(r=>{this.notify.error(r)}))}};this.solutions.push(t)}return o}describeMp3ErrorHint(i,e){let o=`Stream Errors: ${(i.details??[]).length}`;if(!this.solutions.some(t=>t.name==="Fix Stream")){let t={name:"Fix Stream",fixable:!0,click:()=>{t.running||(t.running=!0,this.jam.track.fix({id:e.id,fixID:i.id}).then(r=>{this.folderService.waitForQueueResult("Fixing Track Stream",r,[],[],[e.id])}).catch(r=>{this.notify.error(r)}))}};this.solutions.push(t)}return o}describeID3v1Hint(i,e){if(!this.solutions.some(o=>o.name==="Remove ID3v1")){let o={name:"Remove ID3v1",fixable:!0,click:()=>{o.running||(o.running=!0,this.jam.track.fix({id:e.id,fixID:i.id}).then(t=>{this.folderService.waitForQueueResult("Remove ID3v1",t,[],[],[e.id])}).catch(t=>{this.notify.error(t)}))}};this.solutions.push(o)}return""}describeMP3HeaderHint(i,e){let o="";if(i.id===l.mp3HeaderValid&&(o=(i.details??[]).map(t=>t.expected&&t.actual?`${t.reason}  (${t.actual} instead of ${t.expected})`:t.reason).join(", ")),!this.solutions.some(t=>t.name==="Fix Header")){let t={name:"Fix Header",fixable:!0,click:()=>{t.running||(t.running=!0,this.jam.track.fix({id:e.id,fixID:i.id}).then(r=>{this.folderService.waitForQueueResult("Fixing Track Header",r,[],[],[e.id])}).catch(r=>{this.notify.error(r)}))}};this.solutions.push(t)}return o}describeHint(i,e){switch(i.id){case l.tagValuesExists:case l.id3v2Garbage:case l.id3v2Exists:case l.id3v2Valid:return this.describeTagHint(i,e);case l.mp3Garbage:return this.describeMp3GarbageHint(i,e);case l.mp3MediaValid:return this.describeMp3ErrorHint(i,e);case l.id3v2NoId3v1:return this.describeID3v1Hint(i,e);case l.mp3HeaderExists:case l.mp3HeaderValid:return this.describeMP3HeaderHint(i,e);default:break}return""}};a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=M({type:a,selectors:[["app-track-health"]],inputs:{trackHealth:[1,"trackHealth"]},outputs:{resolvedEvent:"resolvedEvent"},features:[H],decls:1,vars:1,consts:()=>{let i;return i=$localize`:␟baa5a59fd701bf37b30140cf2080f8987db6c2e9␟4786331182153457864:No Hints`,[i,[1,"hints"],[1,"hint"],[1,"solutions"],[1,"button-on-background"],[1,"icon-warning"],[1,"details"],[1,"button-on-background",3,"click"],[1,"icon-spin","icon-spinner"]]},template:function(e,o){e&1&&m(0,U,1,1),e&2&&h(o.hints?0:-1)},styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .icon-warning[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]{padding-left:28px;font-size:.8em;display:block;padding-top:5px}[_nghost-%COMP%]   .hint[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .solutions[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .solutions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}[_nghost-%COMP%]   .detail[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1.25px;font-size:11px;min-width:80px;margin-right:10px;display:inline-block}"]});let n=a;return n})();export{et as a};
