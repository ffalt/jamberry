import{b as d}from"./chunk-5LL2XCUH.js";import{a as p}from"./chunk-24DMSAFT.js";import{a as l}from"./chunk-COAHUF74.js";import{G as u}from"./chunk-SR2DRA4F.js";import{U as r,Wd as m,aa as c,e as n,fa as i,j as a,ra as f}from"./chunk-MRX5UB2X.js";var F=(()=>{class s{constructor(){this.rootsChange=new f,this.rootChange=new l,this.unsubscribe=new a,this.jam=i(m),this.notify=i(u),this.folderService=i(d),this.rootPoll=new p((t,o)=>{this.jam.root.status({id:t.id}).then(e=>{if(!(this.rootsChange.observed||this.rootChange.observed(t.id))){o(!1);return}e.scanning?o(!0):(t.status=e,o(!1))}).catch(e=>{console.error("error while polling root scan status",e)})}),this.roots=[]}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}applyDialogRoot(t){return n(this,null,function*(){if(t.root){let o=t.root.id,e=yield this.jam.root.update({id:o,name:t.name,path:t.path,strategy:t.strategy});this.folderService.waitForQueueResult("Updating Root",e,[]).pipe(r(this.unsubscribe)).subscribe(()=>{this.notify.success("Root updated"),this.refreshRoot(o)})}else{let o=yield this.jam.root.create({name:t.name,path:t.path,strategy:t.strategy});this.folderService.waitForQueueResult("Creating Root",o,[]).pipe(r(this.unsubscribe)).subscribe(()=>{this.notify.success("Root created"),this.refreshRoots()})}})}rescanRoot(t){this.jam.root.refresh({id:t.id}).then(()=>{this.refreshRoot(t.id)}).catch(o=>{this.notify.error(o)})}refreshRootMeta(t){this.jam.root.refreshMeta({id:t.id}).then(()=>{this.refreshRoot(t.id)}).catch(o=>{this.notify.error(o)})}rescanRoots(){this.jam.root.refresh({}).then(()=>{this.refreshRoots()}).catch(t=>{this.notify.error(t)})}removeRoot(t){this.jam.root.remove({id:t.id}).then(o=>{this.folderService.waitForQueueResult("Removing Root",o,[]).pipe(r(this.unsubscribe)).subscribe(()=>{this.roots=this.roots.filter(e=>e.id!==t.id),this.rootChange.emit(t.id),this.notify.success("Root removed"),this.refreshRoots()})}).catch(o=>{this.notify.error(o)})}refreshRoot(t){this.jam.root.id({id:t}).then(o=>{let e=this.roots.findIndex(h=>h.id===t);e===-1?this.roots.push(o):this.roots[e]=o,this.rootChange.emit(t,o),this.rootsChange.emit(this.roots),o.status.scanning&&this.rootPoll.poll(o)}).catch(o=>{this.notify.error(o)})}refreshRoots(){this.jam.root.search({}).then(t=>{this.roots=t.items;for(let o of this.roots)o.status.scanning&&this.rootPoll.poll(o);this.rootsChange.emit(this.roots)}).catch(t=>{this.notify.error(t)})}static{this.\u0275fac=function(o){return new(o||s)}}static{this.\u0275prov=c({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{F as a};
