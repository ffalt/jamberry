import{a as pe,b as Ne,c as ue}from"./chunk-J6P7OT7K.js";import"./chunk-HMP63COV.js";import{a as Pe}from"./chunk-PJLKC3XD.js";import"./chunk-KD232HJS.js";import{a as Ie}from"./chunk-GVMVJAFS.js";import{a as me,b as V}from"./chunk-JNPRJ3MQ.js";import"./chunk-UKXRRTDE.js";import{a as Me}from"./chunk-XGGDZPWO.js";import"./chunk-6WAGYCOA.js";import"./chunk-UPKF4LSO.js";import{a as ge}from"./chunk-N2K5OS3Y.js";import"./chunk-24DMSAFT.js";import{d as re,g as le,o as de}from"./chunk-Y5Z5ITNC.js";import"./chunk-K7RVMPTP.js";import"./chunk-BNP52TDG.js";import"./chunk-F6BYEP4R.js";import"./chunk-VP6KNDS4.js";import{g as fe}from"./chunk-D2CLWX7O.js";import{k as ce}from"./chunk-AQDYGNZB.js";import"./chunk-FQC6PRY2.js";import{a as h}from"./chunk-PZTZCA44.js";import"./chunk-4HNSRH53.js";import{E as Ce,G as L}from"./chunk-ZVKVGF76.js";import{h as se,i as Ee,k as Oe}from"./chunk-T6GM3CFW.js";import{$d as v,Ac as ne,Ba as K,Cc as $,Dd as _e,Gc as ie,Hb as E,Ib as O,Nb as A,Ob as _,Pb as o,Qb as M,Ub as P,Vb as u,Wd as ae,Y as S,Ya as x,_b as R,ab as d,ac as s,dc as p,e as F,fc as a,ia as I,k as H,na as f,nb as T,oa as g,rb as Z,tc as m,uc as N,vc as D,wd as oe,yc as ee,zc as te}from"./chunk-H2EXZDP6.js";function Se(i,l){if(i&1){let e=R();_(0,"div",3),p("drop",function(n){f(e);let r=a();return g(r.onDropFile(n))})("dragover",function(n){f(e);let r=a();return g(r.onDragOverFile(n))}),_(1,"form")(2,"input",4),p("change",function(n){f(e);let r=a();return g(r.selectFile(n))}),o()()()}}function De(i,l){i&1&&(P(0),s(1,0),u())}function Te(i,l){i&1&&(P(0),s(1,1),u())}function ve(i,l){if(i&1&&(_(0,"div")(1,"div"),E(2,De,2,0,"ng-container")(3,Te,2,0,"ng-container"),o(),M(4,"app-loading"),o()),i&2){let e=a();d(2),O(e.isUploading?2:3)}}var Ae=(()=>{let l=class l{constructor(){this.isIdle=!0,this.isUploading=!1,this.unsubscribe=new H,this.jam=I(v),this.notify=I(L),this.folderService=I(V)}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}dialogInit(t,n){this.reference=t,this.folder=n.data?.folder}waitForCreationEnd(t){if(!this.folder)return;let n=this.folder.id;this.folderService.waitForQueueResult("Creating Artwork",t,[]).pipe(S(this.unsubscribe)).subscribe(()=>{this.isIdle=!0,this.folderService.notifyFolderChange(n,me.fsnRefresh),t.error||(this.notify.success("Upload done"),this.reference&&this.reference.close())})}onDropFile(t){t.preventDefault(),this.uploadFile(t.dataTransfer?.files)}onDragOverFile(t){t.stopPropagation(),t.preventDefault()}selectFile(t){let n=t.target;this.uploadFile(n.files??void 0)}uploadFile(t){if(!t||t.length===0||!this.folder)return;let n=t[0];this.isIdle=!1,this.isUploading=!0,this.jam.artwork.createByUpload({folderID:this.folder.id,types:[]},n).pipe(S(this.unsubscribe)).subscribe({next:r=>{if(r instanceof _e){let C=r.body;C&&this.waitForCreationEnd(C)}},error:r=>{this.isUploading=!1,this.isIdle=!0,this.notify.error(r)},complete:()=>{this.isUploading=!1}})}};l.\u0275fac=function(n){return new(n||l)},l.\u0275cmp=T({type:l,selectors:[["app-dialog-upload-image"]],decls:2,vars:1,consts:()=>{let t;t=$localize`:␟d833321cc90a0b0a52714c6d5ec97fbe6c7cfa5c␟2501989539336327542:Upload image`;let n;n=$localize`:␟f54acc637f2d1ea81cf76322b0c3f381b868baa1␟7636862518745301168:Uploading`;let r;return r=$localize`:␟71969bbb4eedcf48235202c3146043ad48adc542␟1227384069952544114:Creating Artwork`,[n,r,[1,"drop-zone"],[1,"drop-zone",3,"drop","dragover"],["type","file","placeholder",t,"accept",".png,.jpeg,.jpg",3,"change"]]},template:function(n,r){n&1&&E(0,Se,3,0,"div",2)(1,ve,5,1,"div"),n&2&&O(r.isIdle?0:1)},dependencies:[h],styles:["[_nghost-%COMP%]   .drop-zone[_ngcontent-%COMP%]{margin:10px 20px;border-width:2px;border-style:dotted;border-color:var(--secondary);height:80%}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}"]});let i=l;return i})();var Le=i=>["/admin/folder",i];function he(i,l){if(i&1&&M(0,"app-info-note",23),i&2){let e=a(2);A("info",e.folder.info)}}function Ve(i,l){if(i&1&&m(0),i&2){let e=a(2);D(" / ",e.folder.tag==null?null:e.folder.tag.albumType," ")}}function be(i,l){if(i&1&&(_(0,"div")(1,"div",25),s(2,5),o(),_(3,"div"),m(4),o()()),i&2){let e=a(2);d(4),N(e.folder.tag==null?null:e.folder.tag.artist)}}function Fe(i,l){if(i&1&&(_(0,"div")(1,"div",25),s(2,6),o(),_(3,"div"),m(4),o()()),i&2){let e=a(2);d(4),N(e.folder.tag==null?null:e.folder.tag.album)}}function xe(i,l){if(i&1&&(_(0,"div")(1,"div",25),s(2,7),o(),_(3,"div"),m(4),o()()),i&2){let e=a(2);d(4),D(" ",e.folder.tag==null?null:e.folder.tag.year)}}function $e(i,l){if(i&1&&(_(0,"div")(1,"div",25),s(2,8),o(),_(3,"div"),m(4),o()()),i&2){let e=a(2);d(4),D(" ",e.folder.tag==null?null:e.folder.tag.genres)}}function Ge(i,l){if(i&1&&(_(0,"div")(1,"div",25),s(2,9),o(),_(3,"div")(4,"a",33),m(5),o()()()),i&2){let e=a(2);d(4),A("href",$("https://musicbrainz.org/release/",e.folder.tag==null?null:e.folder.tag.mbReleaseID),x),d(),N(e.folder.tag==null?null:e.folder.tag.mbReleaseID)}}function we(i,l){if(i&1&&(_(0,"div")(1,"div",25),s(2,10),o(),_(3,"div")(4,"a",33),m(5),o()()()),i&2){let e=a(2);d(4),A("href",$("https://musicbrainz.org/artist/",e.folder.tag==null?null:e.folder.tag.mbArtistID),x),d(),N(e.folder.tag==null?null:e.folder.tag.mbArtistID)}}function ye(i,l){if(i&1&&(_(0,"div")(1,"div",25),s(2,11),o(),_(3,"div")(4,"a",34),m(5),o()()()),i&2){let e=a(2);d(4),A("routerLink",ie(2,Le,e.folder.parentID)),d(),N(e.folder.parentID)}}function We(i,l){if(i&1){let e=R();_(0,"button",35),p("click",function(){f(e);let n=a(2);return g(n.searchImages())}),M(1,"i",36),P(2),s(3,12),u(),o()}}function ke(i,l){if(i&1){let e=R();_(0,"button",37),p("click",function(){f(e);let n=a(2);return g(n.searchImages())}),M(1,"i",36),P(2),s(3,13),u(),o()}}function Be(i,l){if(i&1&&(_(0,"div",32),M(1,"app-admin-artwork-list",38),o()),i&2){let e=a(2);d(),A("folderID",e.folder.id)("artworks",e.folder.artworks)}}function Xe(i,l){if(i&1){let e=R();_(0,"div",14)(1,"div",15)(2,"button",16),p("click",function(){f(e);let n=a();return g(n.refresh())}),M(3,"i",17),o(),_(4,"button",18),p("click",function(){f(e);let n=a();return g(n.moveFolder())}),M(5,"i",19),o(),_(6,"button",20),p("click",function(){f(e);let n=a();return g(n.removeFolder())}),M(7,"i",21),o()(),_(8,"div",22),E(9,he,1,1,"app-info-note",23),_(10,"div",24)(11,"div")(12,"div")(13,"div",25),s(14,0),o(),_(15,"div")(16,"app-inline-edit",26),ne("ngModelChange",function(n){f(e);let r=a();return te(r.name,n)||(r.name=n),g(n)}),p("endEditRequest",function(){f(e);let n=a();return g(n.editFolderName())}),o()()(),_(17,"div")(18,"div",25),s(19,1),o(),_(20,"div"),m(21),E(22,Ve,1,1),o()(),_(23,"div")(24,"div",25),s(25,2),o(),_(26,"div"),m(27),o()(),_(28,"div")(29,"div",25),s(30,3),o(),_(31,"div"),m(32),o()(),E(33,be,5,1,"div"),E(34,Fe,5,1,"div"),o(),_(35,"div"),E(36,xe,5,1,"div"),E(37,$e,5,1,"div"),E(38,Ge,6,3,"div"),E(39,we,6,3,"div"),E(40,ye,6,4,"div"),o()(),_(41,"div",27)(42,"div",15)(43,"button",28),p("click",function(){f(e);let n=a();return g(n.uploadImage())}),M(44,"i",29),P(45),s(46,4),u(),o(),E(47,We,4,0,"button",30),E(48,ke,4,0,"button",31),o(),E(49,Be,2,2,"div",32),o()()()}if(i&2){let e=a();d(9),O(e.folder.info!=null&&e.folder.info.description?9:-1),d(7),ee("ngModel",e.name),d(5),D("",e.folder.type," "),d(),O(e.isAlbum?22:-1),d(5),N(e.folder.trackCount),d(5),N(e.folder.folderCount),d(),O(e.folder.tag!=null&&e.folder.tag.artist?33:-1),d(),O(e.folder.tag!=null&&e.folder.tag.album?34:-1),d(2),O(e.folder.tag!=null&&e.folder.tag.year?36:-1),d(),O(!(e.folder.tag==null||e.folder.tag.genres==null)&&e.folder.tag.genres.length?37:-1),d(),O(e.folder.tag!=null&&e.folder.tag.mbReleaseID?38:-1),d(),O(e.folder.tag!=null&&e.folder.tag.mbArtistID?39:-1),d(),O(e.folder.parentID?40:-1),d(7),O(e.isAlbum&&e.folder.tag&&(e.folder.tag.mbReleaseID||e.folder.tag.mbReleaseGroupID)?47:-1),d(),O(e.isArtist&&e.folder.tag&&e.folder.tag.mbArtistID?48:-1),d(),O(e.folder.artworks&&e.folder.artworks.length>0?49:-1)}}function Ue(i,l){i&1&&M(0,"app-loading")}var ut=(()=>{let l=class l extends Ie{constructor(){super(...arguments),this.name="",this.isAlbum=!1,this.isArtist=!1,this.jam=I(v),this.notify=I(L),this.dialogsService=I(ge),this.dialogOverlay=I(ce),this.folderService=I(V),this.router=I(se)}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe(S(this.unsubscribe)).subscribe(t=>{t.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}editFolderName(){if(!this.folder)return;let t=(this.name||"").trim();if(t.length===0||t===this.folder.name){this.name=this.folder.name;return}let n=this.folder.id;this.jam.folder.rename({id:n,name:t}).then(r=>{this.folderService.waitForQueueResult("Renaming Folder",r,[n])}).catch(r=>{this.notify.error(r)})}refresh(){this.id&&this.jam.folder.id({id:this.id,folderIncTag:!0,folderIncParents:!0,folderIncArtworks:!0,folderIncChildFolderCount:!0,folderIncTrackCount:!0}).then(t=>{this.display(t)}).catch(t=>{Ce(t)&&t.code===404?this.router.navigate(["/admin/folder/"]).catch(n=>{console.error(n)}):this.notify.error(t)})}uploadImage(){this.dialogOverlay.open({childComponent:Ae,title:"Upload Folder Images",data:{folder:this.folder},panelClass:"overlay-panel-large-buttons"})}searchImages(){this.dialogOverlay.open({childComponent:ue,title:"Search Artwork Images",data:{folder:this.folder,artworks:[]},panelClass:"overlay-panel-large-buttons"})}removeFolder(){let t=this.folder;t&&this.dialogsService.confirm("Remove Folder?",`Sure to remove Folder "${t.name}"?`,()=>{this.jam.folder.remove({id:t.id}).then(n=>{t.parentID&&this.router.navigate([`/admin/folder/${t.parentID}/overview`]).catch(r=>{console.error(r)}),this.folderService.waitForQueueResult("Removing Folder",n,[t.id],t.parentID?[t.parentID]:[])}).catch(n=>{this.notify.error(n)})})}moveFolder(){let t=this.folder;if(!t)return;let n={selectID:t.id,disableIDs:[t.id]};this.dialogOverlay.open({childComponent:Pe,title:"Move Folder to",data:n,panelClass:"overlay-panel-large-buttons",onOkBtn:()=>F(this,null,function*(){let r=n.folder;if(r)try{this.jam.folder.move({ids:[t.id],newParentID:r.id}).then(C=>{this.folderService.waitForQueueResult("Moving Folder",C,[t.id],[...t.parentID?[t.parentID]:[],r.id])}).catch(C=>{this.notify.error(C)})}catch(C){return this.notify.error(C),Promise.reject(C)}}),onCancelBtn:()=>F(this,null,function*(){return Promise.resolve()})})}display(t){this.name="",this.isAlbum=!1,this.isArtist=!1,this.folder=t,t&&(this.name=t.name,this.isAlbum=fe.includes(t.type),this.isArtist=t.type===ae.artist)}};l.\u0275fac=(()=>{let t;return function(r){return(t||(t=K(l)))(r||l)}})(),l.\u0275cmp=T({type:l,selectors:[["app-admin-folder"]],features:[Z],decls:2,vars:1,consts:()=>{let t;t=$localize`:␟c8d1785038d461ec66b5799db21864182b35900a␟1102717806459547726:Refresh`;let n;n=$localize`:␟ee0ffaa4b2ef70f3847c0dc2126aff7ed0034519␟4836856351090546342:Move Folder…`;let r;r=$localize`:␟605381a1ba67135149effc1e2382241d379fcc9a␟5344042372404898499:Remove Folder…`;let C;C=$localize`:␟cb1068a2a1e809104667e887d276b18b2fb9d8fa␟7832824131624341508:Album Images`;let b;b=$localize`:␟12a54d1bad2243f676c829e885461ff819d55f4f␟2477517217585375703:Artist Images`;let G;G=$localize`:␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`;let w;w=$localize`:␟f61c6867295f3b53d23557021f2f4e0aa1d0b8fc␟8650499415827640724:Type`;let y;y=$localize`:␟261caf3111a423a99f27e839571512f371bd0212␟167155511337505993:Track Count`;let W;W=$localize`:␟36b472d60e30275eec0f90dc492c06c990621178␟506719405556868592:Folder Count`;let k;k=$localize`:␟faecc81b39c34e94a8f009af7d8c233d3a3dceaa␟8890037837123071423:Upload Artwork`;let B;B=$localize`:␟378660a509ecaa4d2dd3b4b0b8975760cfe3576d␟2492300395471245755:Artist`;let X;X=$localize`:␟842a4fcf548e0c52ebab1cb5362f47ab2ca83e12␟1393837337557373364:Album`;let U;U=$localize`:␟f6e04edea3bb3a59d5904725bfbc2c440e793001␟1464072562214937907:Year`;let z;z=$localize`:␟33c750c68c3e29d7fee57a180f508d8d202bdd04␟1790640569414740156:Genres`;let j;j=$localize`:␟e25c6080fad93286376b6a4103ff2889588879b5␟6137832517756203418:MB Release Id`;let Q;Q=$localize`:␟5b6e5696b55d1dbdcc67e6bb408952c49221060e␟7022245527426162907:MB Artist Id`;let q;q=$localize`:␟e17ab51fb5646579e7073ed25f240117d5f5169e␟4232003024146825817:Parent Folder Id`;let J;J=$localize`:␟045d07de1f817f18c61b2660126d1edcac7b5bd0␟2134391710559060062:Search Artwork`;let Y;return Y=$localize`:␟85804de0cdf6b27537be7f0d11158dbe7b1dc5c2␟7505878720705236779:Search Art`,[G,w,y,W,k,B,X,U,z,j,Q,q,J,Y,[1,"folder"],[1,"actions"],["title",t,1,"button-on-control",3,"click"],[1,"icon-reload"],["title",n,1,"button-on-control",3,"click"],[1,"icon-right-bold"],["title",r,1,"button-on-control",3,"click"],[1,"icon-trash"],[1,"content"],[3,"info"],[1,"properties"],[1,"label"],["type","text",3,"ngModelChange","endEditRequest","ngModel"],[1,"artworks"],[1,"button-on-control",3,"click"],[1,"icon-upload-cloud"],["title",C,1,"button-on-control"],["title",b,1,"button-on-control"],[1,"artworks-content"],["target","_blank","rel","noopener",3,"href"],[3,"routerLink"],["title",C,1,"button-on-control",3,"click"],[1,"icon-picture"],["title",b,1,"button-on-control",3,"click"],[3,"folderID","artworks"]]},template:function(n,r){n&1&&E(0,Xe,50,16,"div",14)(1,Ue,1,0,"app-loading"),n&2&&O(r.folder?0:1)},dependencies:[oe,Oe,Ee,de,re,le,Ne,pe,h,Me],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow:hidden;display:block}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{overflow-y:auto;display:flex;flex-direction:column}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%]{width:100%;display:flex;flex-wrap:wrap;flex-direction:row;padding:15px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:0 0 50%}@media (max-width: 522px){[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:0 0 100%}}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding-top:5px;padding-bottom:5px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{color:var(--on-background-highlight)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-highlight)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--on-background);font-size:.7em;text-transform:uppercase;padding-bottom:2px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .artworks[_ngcontent-%COMP%]{border-top:1px solid var(--background-border)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .artworks[_ngcontent-%COMP%]   .artworks-content[_ngcontent-%COMP%]{padding:0 15px 15px}"]});let i=l;return i})();export{ut as AdminFolderOverviewComponent};
