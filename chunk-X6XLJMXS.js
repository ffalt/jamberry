import{a as r}from"./chunk-TOONS3AW.js";import{a as Q}from"./chunk-CHYN2OU2.js";import{a as O}from"./chunk-ITVL4IJL.js";import{G as w}from"./chunk-3LOKQP2Q.js";import{$b as j,Db as l,Eb as d,Jb as f,Kb as b,Lb as y,Mb as u,Pc as s,Qc as _,_a as c,bc as M,e as a,fa as h,jc as v,kc as C,nb as m,ya as g}from"./chunk-XLNNDSL4.js";function N(i,p){i&1&&u(0,"app-loading")}function L(i,p){if(i&1&&u(0,"app-obj-groups-view",0),i&2){let e=M();f("objs",e.objs)("showParent",e.showParent())("typeName",p.typeName)("grouping",e.grouping())}}var R=(()=>{class i{constructor(){this.grouping=s(!1),this.showParent=s(!1),this.loader=s(),this.listQuery=s(),this.searchQuery=s(),this.loadAll=s(!1),this.changeTrigger=s(),this.notify=h(w),this.loadMore=_.required(r)}getObjs(e){let t=this.loadMore();t.loading.set(!0);let o=e().then(n=>{this.activeRequest===o&&(this.objs=[...this.objs??[],...n.items],t.hasMore.set((n.list.total??0)>this.objs.length),t.total.set(n.list.total),t.loading.set(!1))}).catch(n=>{this.activeRequest===o&&t.loading.set(!1),this.notify.error(n)});this.activeRequest=o}load(){let e=this.loader();if(!e){this.objs=[];return}let t=this.searchQuery();if(t){this.getObjs(()=>a(this,null,function*(){return e.search(t,this.loadMore().skip(),this.loadMore().take())}));return}let o=this.listQuery();if(o){this.getObjs(()=>a(this,null,function*(){return e.list(o,this.loadMore().skip(),this.loadMore().take())}));return}if(this.loadAll()){this.getObjs(()=>a(this,null,function*(){return e.all(this.loadMore().skip(),this.loadMore().take())}));return}this.objs=[]}ngOnChanges(){let e=this.loadMore();e.skip.set(0),e.total.set(0),e.hasMore.set(!1),this.objs=void 0,this.load()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=m({type:i,selectors:[["app-obj-loader"]],viewQuery:function(t,o){t&1&&v(o.loadMore,r,5),t&2&&C()},inputs:{grouping:[1,"grouping"],showParent:[1,"showParent"],loader:[1,"loader"],listQuery:[1,"listQuery"],searchQuery:[1,"searchQuery"],loadAll:[1,"loadAll"],changeTrigger:[1,"changeTrigger"]},features:[g],decls:3,vars:2,consts:[[3,"objs","showParent","typeName","grouping"],[3,"requestLoad"]],template:function(t,o){if(t&1&&(l(0,N,1,0,"app-loading"),l(1,L,1,4,"app-obj-groups-view",0),b(2,"app-load-more-button",1),j("requestLoad",function(){return o.load()}),y()),t&2){let n;d(o.objs?-1:0),c(),d((n=o.loader())?1:-1,n)}},dependencies:[Q,r,O],encapsulation:2})}}return i})();export{R as a};
