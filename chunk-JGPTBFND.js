import{c as V}from"./chunk-4RUMNACR.js";import{a as q}from"./chunk-WJJBETCU.js";import{c as y,d as T,e as G,f as R,g as A,h as $,o as U}from"./chunk-XTLMNK2P.js";import{F as W,G as F}from"./chunk-ZMFSGBQT.js";import{f as z,h as X}from"./chunk-B4HPT77T.js";import{Cb as O,Db as P,Jb as i,Kb as l,Lb as p,Pb as c,Qb as d,Vb as I,Wd as B,Xb as C,Za as s,_b as E,ac as m,fa as _,ka as v,la as L,mb as w,oc as f,pc as x,qc as b,tc as M,uc as h,vc as u}from"./chunk-S3YUDFSI.js";function j(r,D){if(r&1){let t=I();i(0,"label"),c(1),C(2,3),d(),i(3,"input",11),u("ngModelChange",function(e){v(t);let a=m();return h(a.credentials.server,e)||(a.credentials.server=e),L(e)}),l()()}if(r&2){let t=m();s(3),M("ngModel",t.credentials.server)}}function k(r,D){if(r&1&&(i(0,"div",10),f(1),l()),r&2){let t=m();s(),x(t.error)}}var re=(()=>{class r{constructor(){this.app=_(V),this.credentials={server:"",username:"",password:""},this.showServer=!1,this.route=_(z),this.router=_(X),this.auth=_(B),this.notify=_(F),this.init()}init(){let t=this.getFixed();this.credentials.server=t.server??"",this.credentials.username=t.user??"",this.credentials.password=t.pass??"",this.showServer=this.credentials.server==="",this.auth.clear().catch(n=>{console.error(n)})}getFixed(){return document.jamberry_config?.fixed??{}}ngOnInit(){this.returnUrl=decodeURIComponent(this.returnUrlFromRoute()??"/library")}returnUrlFromRoute(){return this.route.snapshot.queryParams.returnUrl}login(t){t.preventDefault();let n=this.validateCredentials();if(n){this.error=n,this.notify.error(n);return}this.error=void 0,this.auth.login(this.credentials.server,this.credentials.username,this.credentials.password).then(()=>{this.router.navigateByUrl(this.returnUrl??"/library").catch(e=>{console.error(e)})}).catch(e=>{this.notify.error(e),this.error=W(e)})}validateCredentials(){if(this.showServer){let e=this.credentials.server.trim();if(!e)return"Server URL is required";if(e.length>2048)return"Server URL is too long";if(!this.isValidServerUrl(e))return"Invalid server URL. Must start with http:// or https://"}let t=this.credentials.username.trim();if(!t)return"Username is required";if(t.length<1)return"Username must be at least 1 character";if(t.length>255)return"Username is too long (max 255 characters)";let n=this.credentials.password;if(!n)return"Password is required";if(n.length<1)return"Password must be at least 1 character";if(n.length>1e3)return"Password is too long (max 1000 characters)"}isValidServerUrl(t){try{let n=new URL(t);return n.protocol!=="http:"&&n.protocol!=="https:"?!1:!!n.hostname}catch(n){return!1}}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=w({type:r,selectors:[["app-login"]],decls:21,vars:5,consts:()=>{let t;t=$localize`:␟08c74dc9762957593b91f6eb5d65efdfc975bf48␟5248717555542428023:Username`;let n;n=$localize`:␟c32ef07f8803a223a83ed17024b38e8d82292407␟1431416938026210429:Password`;let e;e=$localize`:␟6765b4c916060f6bc42d9bb69e80377dbcb5e4e9␟2454050363478003966:Login`;let a;a=$localize`:␟e08a77594f3d89311cdf6da5090044270909c194␟2392488717875840729:User`;let o;o=$localize`:␟c32ef07f8803a223a83ed17024b38e8d82292407␟1431416938026210429:Password`;let N;N=$localize`:␟905882c0fe09eee755ee6730ecf10e3b85cb6d9c␟2188854519574316630:Server`;let S;return S=$localize`:␟905882c0fe09eee755ee6730ecf10e3b85cb6d9c␟2188854519574316630:Server`,[e,a,o,S,[1,"view-login"],[1,"container-login",3,"submit"],[1,"login-card"],["autocomplete","username","name","user","placeholder",t,"type","text",3,"ngModelChange","ngModel"],["autocomplete","password","name","pass","placeholder",n,"type","password",3,"ngModelChange","ngModel"],["name","login","type","submit","value","login",1,"login-submit"],[1,"error"],["type","text","name","server","placeholder",N,3,"ngModelChange","ngModel"]]},template:function(n,e){n&1&&(i(0,"div",4)(1,"div",5),E("submit",function(o){return e.login(o)}),i(2,"div",6)(3,"h1"),p(4,"app-logo-icon"),f(5),c(6),C(7,0),d(),l(),p(8,"br"),i(9,"form"),O(10,j,4,1,"label"),i(11,"label"),c(12),C(13,1),d(),i(14,"input",7),u("ngModelChange",function(o){return h(e.credentials.username,o)||(e.credentials.username=o),o}),l()(),i(15,"label"),c(16),C(17,2),d(),i(18,"input",8),u("ngModelChange",function(o){return h(e.credentials.password,o)||(e.credentials.password=o),o}),l()(),p(19,"input",9),l()(),O(20,k,2,1,"div",10),l()()),n&2&&(s(5),b("\xA0",e.app.name," "),s(5),P(e.showServer?10:-1),s(4),M("ngModel",e.credentials.username),s(4),M("ngModel",e.credentials.password),s(2),P(e.error?20:-1))},dependencies:[U,$,y,T,G,A,R,q],styles:["[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]{position:fixed;height:100%;width:100%;overflow-y:auto}[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .container-login[_ngcontent-%COMP%]{max-width:400px;width:80%;z-index:15;margin-left:auto;margin-right:auto;margin-top:100px}[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{text-align:center;color:var(--accent)}[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]{overflow:hidden;padding:30px;min-width:274px;max-width:400px;margin:0 auto 10px;border-radius:2px;border-style:solid;border-width:1px}[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-weight:100;text-align:center;font-size:2.3em}[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   app-logo-icon[_ngcontent-%COMP%]{height:42px;width:42px;vertical-align:baseline}[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]   input[type=submit][_ngcontent-%COMP%]{width:100%;display:block;margin-bottom:10px;position:relative}[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], [_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%]{height:44px;font-size:16px;width:100%;margin-top:4px;margin-bottom:10px;padding:0 8px;box-sizing:border-box}[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]   .login-submit[_ngcontent-%COMP%]{text-align:center;font-size:14px;font-weight:700;height:36px;padding:0 8px;border:0;cursor:pointer;background-color:var(--primary);color:var(--on-primary)}[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]   .login-submit[_ngcontent-%COMP%]:hover{border:0}[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]   .login-help[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:12px}[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]   .login-help[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;font-weight:400;text-align:center;display:inline-block;opacity:.6;transition:opacity ease .5s}[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]   .login-help[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{opacity:1}@media(max-width:522px){[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]{margin-top:-20px}[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .container-login[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .container-login[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]{min-width:inherit}[_nghost-%COMP%]   .view-login[_ngcontent-%COMP%]   .container-login[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0;font-size:1.5em}}"]})}}return r})();export{re as LoginComponent};
