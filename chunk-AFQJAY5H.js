import{c as x}from"./chunk-XP5ERWDG.js";import{d as g}from"./chunk-D2CLWX7O.js";import{G as b}from"./chunk-ZVKVGF76.js";import{$d as h,Ld as n,Sd as o,da as c,e as p,ia as u,ub as f}from"./chunk-H2EXZDP6.js";function k(a,t,r,s){if(a)return{type:n.album,name:r,groups:a.groups.map(e=>({name:e.name,expanded:t,entries:e.items.map(i=>({id:i.id,link:`/library/albums/id/${i.id}`,extraLink:`/library/artists/id/${i.artistID}`,name:i.name,extra:i.artist,visible:!1,trackCount:i.trackCount,image:s.image.imageUrl({id:i.id,size:200,format:o.webp})}))}))}}function I(a,t,r,s){if(a)return{name:r,type:n.folder,groups:a.groups.map(e=>({name:e.name,expanded:t,entries:e.items.map(i=>({id:i.id,link:`/library/folders/id/${i.id}`,name:i.name,visible:!1,trackCount:i.trackCount,image:s.image.imageUrl({id:i.id,size:200,format:o.webp})}))}))}}function w(a,t,r,s){if(a)return{name:r,type:n.artist,groups:a.groups.map(e=>({name:e.name,expanded:t,entries:e.items.map(i=>({id:i.id,link:`/library/artists/id/${i.id}`,name:i.name,visible:!1,trackCount:i.trackCount,image:s.image.imageUrl({id:i.id,size:200,format:o.webp})}))}))}}function j(a,t,r,s){if(a)return{name:r,type:n.series,groups:a.groups.map(e=>({name:e.name,expanded:t,entries:e.items.map(i=>({id:i.id,link:`/library/series/id/${i.id}`,name:i.name,visible:!1,trackCount:i.trackCount,image:s.image.imageUrl({id:i.id,size:200,format:o.webp})}))}))}}function C(a,t,r,s){if(a)return{name:r,type:n.genre,groups:a.groups.map(e=>({name:e.name,expanded:t,entries:e.items.map(i=>({id:i.id,link:`/library/genres/id/${i.id}`,name:i.name,visible:!1,trackCount:i.trackCount,image:s.image.imageUrl({id:i.id,size:200,format:o.webp})}))}))}}var l=class{constructor(t,r){this.type=t,this.query=r}isQuery(t){return JSON.stringify(t)===JSON.stringify(this.query)}matches(t,r){return t===this.type&&this.isQuery(r)}},U=(()=>{let t=class t{constructor(){this.indexNotify=new f,this.app=u(x),this.jam=u(h),this.notify=u(b),this.indexes=[]}findIndexCache(s,e){return this.indexes.find(i=>i.matches(s,e))}getIndex(s,e){return p(this,null,function*(){switch(s){case n.folder:return I(yield this.jam.folder.index(e),!this.app.smallscreen,"Folders",this.jam);case n.artist:return w(yield this.jam.artist.index(e),!this.app.smallscreen,"Artists",this.jam);case n.series:return j(yield this.jam.series.index(e),!this.app.smallscreen,"Series",this.jam);case n.genre:return C(yield this.jam.genre.index(e),!this.app.smallscreen,"Genres",this.jam);case n.album:{let i=e,m=i.albumTypes?.at(0),d=m?g(m):void 0;return k(yield this.jam.album.index(i),!this.app.smallscreen,d?d.text:"Albums",this.jam)}default:return}})}requestIndex(s,e){let i=this.findIndexCache(s,e);if(i?.index)return i.index;if(i)return;let m=new l(s,e);this.indexes.push(m),this.getIndex(s,e).then(d=>{m.index=d,m.index&&this.indexNotify.emit(m)}).catch(d=>{this.notify.error(d)})}};t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=c({token:t,factory:t.\u0275fac,providedIn:"root"});let a=t;return a})();export{U as a};
