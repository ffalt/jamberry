<app-loading *ngIf="!track"></app-loading>
<context-menu #trackMenu>
	<ng-template contextMenuItem let-track>
		<app-context-entry-fav [base]="track" baseType="track"></app-context-entry-fav>
	</ng-template>
	<ng-template contextMenuItem let-track>
		<app-context-entry-rate [base]="track" baseType="track"></app-context-entry-rate>
	</ng-template>
	<ng-template contextMenuItem (execute)="player.addTrackToQueue($event.item)"><i class="icon-list-add"></i> Add To Queue</ng-template>
	<ng-template contextMenuItem (execute)="actions.download($event.item)"><i class="icon-download-cloud"></i> Download</ng-template>
</context-menu>

<div class="track" *ngIf="track" [contextMenu]="trackMenu" [contextMenuSubject]="track">
	<div class="header">
		<div class="info">
			<div class="img">
				<app-coverart-image [coverArtObj]="track" [size]="150" [fill]="true" [alt]="track.tag?.title" [allowEnlarge]="true"></app-coverart-image>
			</div>
			<div class="meta">
				<div class="type">Track</div>
				<div class="name">{{track.tag?.title}}</div>
				<div class="actions">
					<button class="button-primary" (click)="player.startTrack(track)"><i class="icon-play"></i> Play</button>
				</div>
			</div>
			<div class="listeners">
				<ng-container *ngIf="track.tag">
					<div class="label">Artist</div>
					<div class="count"><a (click)="navig.toArtistID(track.artistID,track.tag.artist)">{{track.tag.artist}}</a></div>
					<div class="label">Album</div>
					<div class="count"><a (click)="navig.toAlbumID(track.albumID,track.tag.album)">{{track.tag.album}}</a></div>
				</ng-container>
				<div class="label">Played</div>
				<div class="count">{{track.state.played || 0}}</div>

				<a class="more" [contextMenu]="trackMenu" [contextMenuSubject]="track" [contextMenuTriggerLeft]="true">â€¦</a>
			</div>
		</div>
		<app-tabs class="navigation" [tabs]="tabs" [current]="currentTab" (tabChange)="setTab($event)"></app-tabs>
	</div>
	<div class="content">
		<div class="tab-content">
			<div class="tab-pane" *ngIf="track && currentTab.id==='overview'">
				<div>
					<div class="section-title">Waveform</div>
					<div class="svg" *ngIf="svg">
						<svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid" height="100px" width="100%" [attr.viewBox]="svg.viewbox" style="fill-rule:evenodd;clip-rule:evenodd;">
							<path stroke="#1ed760" fill="#1ed760" [attr.d]="svg.path"></path>
						</svg>
					</div>
				</div>
				<div>
					<div class="section-title">Lyrics</div>
					<app-lyrics [trackID]="track.id"></app-lyrics>
				</div>
				<div>
					<div class="section-title">Meta</div>
					<div class="key-value-row">
						<div>Track Nr.</div>
						<div>{{track.tag?.trackNr}}</div>
					</div>
					<div class="key-value-row">
						<div>Title</div>
						<div>{{track.tag?.title}}</div>
					</div>
					<div class="key-value-row">
						<div>Artist</div>
						<div><a (click)="navig.toArtistID(track.artistID, track.tag.artist)">{{track.tag?.artist}}</a></div>
					</div>
					<div class="key-value-row">
						<div>Album</div>
						<div><a (click)="navig.toAlbumID(track.albumID, track.tag.album)">{{track.tag?.album}}</a></div>
					</div>
					<div class="key-value-row">
						<div>Genre</div>
						<div>{{track.tag?.genre}}</div>
					</div>
					<div class="key-value-row" *ngIf="track.tag.musicbrainz && track.tag.musicbrainz.trackID">
						<div>MusicBrainz Track ID:</div>
						<div><a [href]="'https://musicbrainz.org/track/'+track.tag.musicbrainz.trackID" target="_blank" rel="noopener">{{track.tag.musicbrainz.trackID}}</a></div>
					</div>
					<div class="key-value-row" *ngIf="track.tag.musicbrainz && track.tag.musicbrainz.releaseID">
						<div>MusicBrainz Album ID:</div>
						<div><a [href]="'https://musicbrainz.org/release/'+track.tag.musicbrainz.releaseID" target="_blank" rel="noopener">{{track.tag.musicbrainz.releaseID}}</a></div>
					</div>
					<div class="key-value-row" *ngIf="track.tag.musicbrainz && track.tag.musicbrainz.releaseID">
						<div>MusicBrainz Release Group ID:</div>
						<div><a [href]="'https://musicbrainz.org/release-group/'+track.tag.musicbrainz.releaseGroupID" target="_blank" rel="noopener">{{track.tag.musicbrainz.releaseGroupID}}</a></div>
					</div>
					<div class="key-value-row" *ngIf="track.tag.musicbrainz && track.tag.musicbrainz.artistID">
						<div>MusicBrainz Artist ID:</div>
						<div><a [href]="'https://musicbrainz.org/artist/'+track.tag.musicbrainz.artistID" target="_blank" rel="noopener">{{track.tag.musicbrainz.artistID}}</a></div>
					</div>
				</div>
				<div>
					<div class="section-title">Media</div>
					<div class="key-value-row">
						<div>Filename</div>
						<div>{{track.name}}</div>
					</div>
					<div class="key-value-row">
						<div>Size</div>
						<div>{{track.media?.size | filesize}}</div>
					</div>
					<div class="key-value-row">
						<div>File created</div>
						<div>{{track.created | date:'long'}}</div>
					</div>
					<div class="key-value-row">
						<div>Duration</div>
						<div>{{track.duration | duration}}</div>
					</div>
					<div class="key-value-row" *ngIf="track.media.bitRate">
						<div>BitRate</div>
						<div>{{track.media.bitRate}}</div>
					</div>
					<div class="key-value-row">
						<div>SampleRate</div>
						<div>{{track.media?.sampleRate}}</div>
					</div>
					<div class="key-value-row">
						<div>Format</div>
						<div>{{track.media?.format}}</div>
					</div>
					<div class="key-value-row">
						<div>Channels</div>
						<div>{{track.media?.channels}}</div>
					</div>
				</div>
				<div>
					<div class="section-title">User State</div>
					<div class="key-value-row">
						<div>Faved</div>
						<div>{{track.state?.faved | date:'long'}}</div>
					</div>
					<div class="key-value-row">
						<div>Rated</div>
						<div>{{track.state?.rated}}</div>
					</div>
					<div class="key-value-row">
						<div>Last Played</div>
						<div>{{track.state?.lastplayed | date:'long'}}</div>
					</div>
					<div class="key-value-row">
						<div>Played</div>
						<div>{{track.state?.played}}</div>
					</div>
				</div>
			</div>
			<div class="tab-pane" *ngIf="track && currentTab.id==='similar'">
				<app-tracks [showArtist]="true" [tracks]="similar"></app-tracks>
			</div>
			<app-load-more-button [loading]="!similar" [hidden]="currentTab.id!=='similar'" (requestLoad)="loadSimilar()"></app-load-more-button>
			<app-loading *ngIf="!similar && currentTab.id==='similar'"></app-loading>
		</div>
	</div>
</div>
