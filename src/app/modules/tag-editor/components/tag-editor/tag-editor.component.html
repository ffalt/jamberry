<app-loading *ngIf="!folder"></app-loading>

<context-menu #actionMenu>
	<ng-template contextMenuItem (execute)="editor.setAudiobookFrames(this.tracks)"><i class="icon-edit"></i> Set Audiobook Frames</ng-template>
	<ng-template contextMenuItem (execute)="editor.setAudioSeriesFrames(this.tracks)"><i class="icon-edit"></i> Set Audio Series Frames</ng-template>
	<ng-template contextMenuItem (execute)="editor.setSoundtrackFrames(this.tracks)"><i class="icon-edit"></i> Set Soundtrack Frames</ng-template>
	<ng-template contextMenuItem (execute)="editor.setBootlegFrames(this.tracks)"><i class="icon-edit"></i> Set Bootleg Frames</ng-template>
	<ng-template contextMenuItem (execute)="editor.setVariousArtistFrames(this.tracks)"><i class="icon-edit"></i> Set Various Artists Compilation Frames</ng-template>
	<ng-template contextMenuItem (execute)="editor.findMissingLyrics(this.tracks)"><i class="icon-edit"></i> Search & Fill Missing Lyrics Frames</ng-template>
</context-menu>
<ng-container *ngIf="folder">
	<div *ngIf="canLoadRecursive" class="load-recursive">
		This folder does not contain any tracks with tags.<br/>Do you want to load all tracks from subfolders?<br/>
		<button class="button-on-control" title="Load all Tracks" (click)="loadRecursive()"><i class="icon-reload"></i> Load recursive</button>
	</div>
	<div *ngIf="tracks && tracks.length>0 && editor.edits" class="actions">
		<button class="button-on-control" title="Refresh" (click)="refresh()"><i class="icon-reload"></i></button>
		<button class="button-on-control" title="Match with MusicBrainz" (click)="brainz()">
			<app-mb-icon [size]="12"></app-mb-icon>
		</button>
		<button class="button-on-control" title="Choose Columns" (click)="chooseColumns()"><i class="icon-list-add"></i></button>
		<button *ngIf="!isSaving" class="button-on-control" title="Save" (click)="save()"><i class="icon-floppy"></i></button>
		<button *ngIf="isSaving" class="button-on-control" title="Save"><i class="icon-spin icon-spnner"></i></button>
		<button class="button-on-control" title="More" (click)="onContextMenu($event)">â€¦</button>
	</div>
	<app-admin-tag-editor-column-tool [editor]="editor" [activeCol]="activeCol" (requestClose)="activeCol=undefined"></app-admin-tag-editor-column-tool>
	<app-loading *ngIf="!tracks"></app-loading>
	<div *ngIf="tracks && tracks.length>0 && editor.edits" class="editor">
		<table>
			<thead>
			<tr class="header-row">
				<th></th>
				<th *ngFor="let column of editor.columns; trackBy: trackByColumnFn" class="header-row-title" (click)="activeCol = column">
					<div>
						<span [title]="column.def.id">{{column.def.name}}</span>
					</div>
				</th>
			</tr>
			</thead>
			<colgroup>
				<col [style.min-width.px]="60">
				<col *ngFor="let column of editor.columns; trackBy: trackByColumnFn" [style.min-width.px]="column.def.width || 60">
			</colgroup>
			<tbody>
			<tr *ngFor="let edit of editor.edits; trackBy: trackByEditFn">
				<td class="col-state">
					<div class="cell-editor">
						<ng-container *ngIf="edit.changed">
							<i *ngIf="!edit.saving" class="icon-floppy" (click)="saveEdit(edit)"></i>
							<i *ngIf="edit.saving" class="icon-spin icon-spinner"></i>
						</ng-container>
					</div>
				</td>
				<td *ngFor="let cell of edit.cells; trackBy: trackByCellFn">
					<app-cell-editor class="cell-editor" [class.changed]="cell.changed" [cell]="cell" (navigKeyDownRequest)="onCellEditorNavigationKeyDown($event)"></app-cell-editor>
				</td>
			</tr>
			</tbody>
		</table>
	</div>
</ng-container>
