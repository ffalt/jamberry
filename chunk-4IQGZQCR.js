import{a as X}from"./chunk-U7OXVLBO.js";import{a as q}from"./chunk-COAHUF74.js";import{k as J}from"./chunk-EYYLYRFR.js";import{G as y}from"./chunk-SR2DRA4F.js";import{$b as L,Db as E,Eb as F,Ec as B,Fb as M,Gd as r,Hb as T,Hc as V,Ib as w,Jb as k,Kb as D,Lb as S,Nb as C,Ob as _,Oc as U,Pb as x,Pc as z,Qb as j,Rb as A,Uc as H,Wb as g,Wd as u,Yb as N,_a as h,aa as d,ac as $,bc as c,e as s,fa as o,ka as p,la as m,nb as l,oc as f,pc as b,ra as O,rc as G,ya as R}from"./chunk-MRX5UB2X.js";function W(i,I){if(i&1){let t=g();C(0,"i",2),$("click",function(){let a=p(t).$index,n=c();return m(n.mark(a))}),_()}if(i&2){let t=I.$implicit;f(t)}}var K=(()=>{class i{constructor(){this.rating=H(0),this.hasRated=U(),this.maxScore=5,this.range=[],this.marked=-1,this.allowHalf=!1}ngOnInit(){this.updateUI()}updateUI(){this.range=[];for(let t=0;t<this.maxScore;t++)this.range.push(this.markerClass(t))}mark(t){let e=t;this.marked===t?e=t-(this.allowHalf?.5:1):this.allowHalf&&this.marked===t-.5&&(e=t-1),this.marked=e,this.rating.set(this.marked+1),this.updateUI(),this.hasRated.emit(this.rating()??0)}markerClass(t){return t<=this.marked?"icon-star-full":t<this.marked+1?"icon-star-half":"icon-star-empty"}ngOnChanges(){this.marked=(this.rating()??0)-1,this.updateUI()}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=l({type:i,selectors:[["app-rate"]],inputs:{rating:[1,"rating"]},outputs:{rating:"ratingChange",hasRated:"hasRated"},features:[R],decls:3,vars:0,consts:[[1,"star-rating"],[3,"class"],[3,"click"]],template:function(e,a){e&1&&(C(0,"span",0),T(1,W,1,2,"i",1,M),_()),e&2&&(h(),w(a.range))},styles:["[_nghost-%COMP%]   .star-rating[_ngcontent-%COMP%]{cursor:pointer;padding:0 3px}[_nghost-%COMP%]   .star-rating[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.3em;color:orange;margin-left:2px;margin-right:2px}"]})}}return i})();function Y(i,I){if(i&1){let t=g();D(0,"app-rate",1),L("hasRated",function(a){p(t);let n=c();return m(n.onRated(a))}),S(),j(1),N(2,0),A(),b(3)}if(i&2){let t=c();k("rating",t.data.rating),h(3),G(" ",t.data.rating,`
`)}}var Q=(()=>{class i{dialogInit(t,e){this.data=e.data}onRated(t){this.data&&(this.data.rating=t)}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=l({type:i,selectors:[["app-dialog-rate"]],decls:1,vars:1,consts:()=>{let t;return t=$localize`:␟758496ccd0c37659b18828f3234eac3915c1a32f␟5087122090521808199:Rating:`,[t,[3,"hasRated","rating"]]},template:function(e,a){e&1&&E(0,Y,4,2),e&2&&F(a.data?0:-1)},dependencies:[K],styles:["[_nghost-%COMP%]   .star-rating[_ngcontent-%COMP%]{cursor:pointer;padding:0 3px}[_nghost-%COMP%]   .star-rating[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.3em;color:orange}"]})}}return i})();var dt=(()=>{class i{constructor(){this.jam=o(u),this.notify=o(y),this.dialogOverlay=o(J)}rateTrack(t){this.rate(r.track,t)}rateAlbum(t){this.rate(r.album,t)}rateArtist(t){this.rate(r.artist,t)}rateSeries(t){this.rate(r.series,t)}rateFolder(t){this.rate(r.folder,t)}rateEpisode(t){this.rate(r.episode,t)}ratePodcast(t){this.rate(r.podcast,t)}rate(t,e){let a={rating:e.state?.rated??0,id:e.id};this.dialogOverlay.open({childComponent:Q,data:a,onOkBtn:()=>s(this,null,function*(){try{let n=a.rating;if(n===void 0)return;yield this.jam.state.rate({id:e.id,rating:n});let P=e.state??{};P.rated=n,e.state=P,this.notify.success(`Rated ${t}`)}catch(n){return this.notify.error(n),Promise.reject(n)}})})}toggleFav(t,e){return s(this,null,function*(){e.state=e.state??{};let a=!!e.state.faved;try{yield this.jam.state.fav({id:e.id,remove:a}),e.state.faved=a?void 0:Date.now(),this.notify.success(`Favorite ${t} ${a?"removed":"added"}`)}catch(n){this.notify.error(n)}})}toggleFolderFav(t){return s(this,null,function*(){return this.toggleFav(r.folder,t)})}toggleMediaBaseFav(t){return s(this,null,function*(){return this.toggleFav(t.objType,t)})}toggleAlbumFav(t){return s(this,null,function*(){return this.toggleFav(r.album,t)})}toggleGenreFav(t){return s(this,null,function*(){return this.toggleFav(r.genre,t)})}toggleArtistFav(t){return s(this,null,function*(){return this.toggleFav(r.artist,t)})}toggleSeriesFav(t){return s(this,null,function*(){return this.toggleFav(r.series,t)})}togglePlaylistFav(t){return s(this,null,function*(){return this.toggleFav(r.playlist,t)})}togglePodcastFav(t){return s(this,null,function*(){return this.toggleFav(r.podcast,t)})}download(t){t&&(globalThis.location.href=this.jam.download.downloadUrl({id:t.id}))}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275prov=d({token:i,factory:i.\u0275fac})}}return i})();var vt=(()=>{class i{constructor(){this.playlistsChange=new O,this.playlistChange=new q,this.jam=o(u),this.notify=o(y),this.playlists=[]}remove(t){return s(this,null,function*(){yield this.jam.playlist.remove({id:t.id}),this.playlists=this.playlists.filter(e=>e.id!==t.id),this.playlistsChange.emit(this.playlists),this.playlistChange.emit(t.id,void 0)})}savePlaylist(t,e){this.jam.playlist.update({id:t.id,name:t.name,isPublic:t.isPublic,mediaIDs:e}).then(()=>{this.notify.success("Playlist updated"),this.refreshPlaylist(t.id)}).catch(a=>{this.notify.error(a)})}getPlaylistEntriesIDs(t){return s(this,null,function*(){let e=[];return t?.entriesIDs?e=t.entriesIDs:t?.entries?e=t.entries.map(a=>a.id):t&&(e=(yield this.jam.playlist.id({id:t.id,playlistIncEntriesIDs:!0})).entriesIDs),e})}addToPlaylist(t,e){this.getPlaylistEntriesIDs(t).then(a=>{this.savePlaylist(t,[...a,...e])}).catch(a=>{this.notify.error(a)})}removeFromPlaylist(t,e){let a=(t.entries??[]).map(n=>n.id).filter(n=>e.includes(n));this.savePlaylist(t,a)}refreshPlaylist(t){this.jam.playlist.id({id:t,playlistIncEntries:!0,playlistIncState:!0,trackIncTag:!0,trackIncState:!0,episodeIncTag:!0,episodeIncState:!0}).then(e=>{let a=this.playlists.findIndex(n=>n.id===t);a===-1?this.playlists.push(e):this.playlists[a]=e,this.playlistsChange.emit(this.playlists),this.playlistChange.emit(t,e)}).catch(e=>{this.notify.error(e)})}getTracks(t){return s(this,null,function*(){return(yield this.jam.playlist.id({id:t,playlistIncEntries:!0})).entries??[]})}getLists(){return s(this,null,function*(){let t=yield this.jam.playlist.search({playlistIncState:!0});return this.playlists=t.items,this.playlistsChange.emit(this.playlists),t.items})}refreshLists(){this.getLists().catch(t=>{this.notify.error(t)})}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275prov=d({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Rt=(()=>{class i{constructor(){this.faved=z()}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=l({type:i,selectors:[["app-fav-icon"]],inputs:{faved:[1,"faved"]},decls:2,vars:6,template:function(e,a){e&1&&(x(0,"i"),B(1,"stringToggle")),e&2&&f(V(1,2,a.faved(),"icon-heart-full","icon-heart-empty"))},dependencies:[X],encapsulation:2})}}return i})();export{Rt as a,K as b,dt as c,vt as d};
