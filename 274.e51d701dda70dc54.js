"use strict";(self.webpackChunkjamberry=self.webpackChunkjamberry||[]).push([[274],{6555:(Ot,V,M)=>{M.d(V,{ap:()=>R,QG:()=>ot,Ll:()=>rt});var g=M(3668),b=M(4762),x=M(6019),W=M(5427);const tt=["wrapper"],N=["sourceImage"];function lt(C,f){if(1&C){const a=g.EpF();g.TgZ(0,"img",4,5),g.NdJ("load",function(){return g.CHM(a),g.oxw().imageLoadedInView()}),g.qZA()}if(2&C){const a=g.oxw();g.Udp("visibility",a.imageVisible?"visible":"hidden")("transform",a.safeTransformStyle),g.Q6J("src",a.safeImgDataUrl,g.LSH)}}function et(C,f){if(1&C){const a=g.EpF();g.ynx(0),g.TgZ(1,"span",9),g.NdJ("mousedown",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"topleft")})("touchstart",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"topleft")}),g._UZ(2,"span",10),g.qZA(),g.TgZ(3,"span",11),g._UZ(4,"span",10),g.qZA(),g.TgZ(5,"span",12),g.NdJ("mousedown",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"topright")})("touchstart",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"topright")}),g._UZ(6,"span",10),g.qZA(),g.TgZ(7,"span",13),g._UZ(8,"span",10),g.qZA(),g.TgZ(9,"span",14),g.NdJ("mousedown",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"bottomright")})("touchstart",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"bottomright")}),g._UZ(10,"span",10),g.qZA(),g.TgZ(11,"span",15),g._UZ(12,"span",10),g.qZA(),g.TgZ(13,"span",16),g.NdJ("mousedown",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"bottomleft")})("touchstart",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"bottomleft")}),g._UZ(14,"span",10),g.qZA(),g.TgZ(15,"span",17),g._UZ(16,"span",10),g.qZA(),g.TgZ(17,"span",18),g.NdJ("mousedown",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"top")})("touchstart",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"top")}),g.qZA(),g.TgZ(18,"span",19),g.NdJ("mousedown",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"right")})("touchstart",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"right")}),g.qZA(),g.TgZ(19,"span",20),g.NdJ("mousedown",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"bottom")})("touchstart",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"bottom")}),g.qZA(),g.TgZ(20,"span",21),g.NdJ("mousedown",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"left")})("touchstart",function(l){g.CHM(a);const d=g.oxw(2);return d.startMove(l,d.moveTypes.Resize,"left")}),g.qZA(),g.BQk()}}function t(C,f){if(1&C){const a=g.EpF();g.TgZ(0,"div",6),g.NdJ("keydown",function(l){return g.CHM(a),g.oxw().keyboardAccess(l)}),g.TgZ(1,"div",7),g.NdJ("mousedown",function(l){g.CHM(a);const d=g.oxw();return d.startMove(l,d.moveTypes.Move)})("touchstart",function(l){g.CHM(a);const d=g.oxw();return d.startMove(l,d.moveTypes.Move)}),g.qZA(),g.YNc(2,et,21,0,"ng-container",8),g.qZA()}if(2&C){const a=g.oxw();g.Udp("top",a.cropper.y1,"px")("left",a.cropper.x1,"px")("width",a.cropper.x2-a.cropper.x1,"px")("height",a.cropper.y2-a.cropper.y1,"px")("margin-left","center"===a.alignImage?a.marginLeft:null)("visibility",a.imageVisible?"visible":"hidden"),g.ekj("ngx-ic-round",a.roundCropper),g.xp6(2),g.Q6J("ngIf",!a.hideResizeSquares)}}class nt{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=void 0,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(f){Object.keys(f).filter(a=>a in this).forEach(a=>this[a]=f[a]),this.validateOptions()}setOptionsFromChanges(f){Object.keys(f).filter(a=>a in this).forEach(a=>this[a]=f[a].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}const y={Move:"move",Resize:"resize",Pinch:"pinch"};let q=(()=>{class C{crop(a,s,l,d){const p=this.getImagePosition(a,s,l,d),m=p.x2-p.x1,v=p.y2-p.y1,P=document.createElement("canvas");P.width=m,P.height=v;const T=P.getContext("2d");if(!T)return;null!=d.backgroundColor&&(T.fillStyle=d.backgroundColor,T.fillRect(0,0,m,v));const F=(d.transform.scale||1)*(d.transform.flipH?-1:1),z=(d.transform.scale||1)*(d.transform.flipV?-1:1),Y=s.transformed;T.setTransform(F,0,0,z,Y.size.width/2,Y.size.height/2),T.translate(-p.x1/F,-p.y1/z),T.rotate((d.transform.rotate||0)*Math.PI/180),T.drawImage(Y.image,-Y.size.width/2,-Y.size.height/2);const S={width:m,height:v,imagePosition:p,cropperPosition:Object.assign({},l)};d.containWithinAspectRatio&&(S.offsetImagePosition=this.getOffsetImagePosition(a,s,l,d));const H=this.getResizeRatio(m,v,d);return 1!==H&&(S.width=Math.round(m*H),S.height=d.maintainAspectRatio?Math.round(S.width/d.aspectRatio):Math.round(v*H),function(C,f,a){const s=C.width,l=C.height,d=s/(f=Math.round(f)),p=l/(a=Math.round(a)),m=Math.ceil(d/2),v=Math.ceil(p/2),P=C.getContext("2d");if(P){const T=P.getImageData(0,0,s,l),F=P.createImageData(f,a),z=T.data,Y=F.data;for(let S=0;S<a;S++)for(let H=0;H<f;H++){const D=4*(H+S*f),B=S*p;let L=0,at=0,ut=0,mt=0,ft=0,Ct=0,xt=0;const bt=Math.floor(H*d),At=Math.floor(S*p);let gt=Math.ceil((H+1)*d),pt=Math.ceil((S+1)*p);gt=Math.min(gt,s),pt=Math.min(pt,l);for(let st=At;st<pt;st++){const j=Math.abs(B-st)/v,wt=H*d,yt=j*j;for(let ct=bt;ct<gt;ct++){const Mt=Math.abs(wt-ct)/m,X=Math.sqrt(yt+Mt*Mt);if(X>=1)continue;L=2*X*X*X-3*X*X+1;const K=4*(ct+st*s);xt+=L*z[K+3],ut+=L,z[K+3]<255&&(L=L*z[K+3]/250),mt+=L*z[K],ft+=L*z[K+1],Ct+=L*z[K+2],at+=L}}Y[D]=mt/at,Y[D+1]=ft/at,Y[D+2]=Ct/at,Y[D+3]=xt/ut}C.width=f,C.height=a,P.putImageData(F,0,0)}}(P,S.width,S.height)),S.base64=P.toDataURL("image/"+d.format,this.getQuality(d)),S}getImagePosition(a,s,l,d){const m=s.transformed.size.width/a.nativeElement.offsetWidth,v={x1:Math.round(l.x1*m),y1:Math.round(l.y1*m),x2:Math.round(l.x2*m),y2:Math.round(l.y2*m)};return d.containWithinAspectRatio||(v.x1=Math.max(v.x1,0),v.y1=Math.max(v.y1,0),v.x2=Math.min(v.x2,s.transformed.size.width),v.y2=Math.min(v.y2,s.transformed.size.height)),v}getOffsetImagePosition(a,s,l,d){const v=s.transformed.size.width/a.nativeElement.offsetWidth;let P,T;(d.canvasRotation+s.exifTransform.rotate)%2?(P=(s.transformed.size.width-s.original.size.height)/2,T=(s.transformed.size.height-s.original.size.width)/2):(P=(s.transformed.size.width-s.original.size.width)/2,T=(s.transformed.size.height-s.original.size.height)/2);const F={x1:Math.round(l.x1*v)-P,y1:Math.round(l.y1*v)-T,x2:Math.round(l.x2*v)-P,y2:Math.round(l.y2*v)-T};return d.containWithinAspectRatio||(F.x1=Math.max(F.x1,0),F.y1=Math.max(F.y1,0),F.x2=Math.min(F.x2,s.transformed.size.width),F.y2=Math.min(F.y2,s.transformed.size.height)),F}getResizeRatio(a,s,l){const d=l.resizeToWidth/a,p=l.resizeToHeight/s,m=new Array;l.resizeToWidth>0&&m.push(d),l.resizeToHeight>0&&m.push(p);const v=0===m.length?1:Math.min(...m);return v>1&&!l.onlyScaleDown?v:Math.min(v,1)}getQuality(a){return Math.min(1,Math.max(0,a.imageQuality/100))}}return C.\u0275fac=function(a){return new(a||C)},C.\u0275prov=(0,g.Yz7)({factory:function(){return new C},token:C,providedIn:"root"}),C})(),dt=(()=>{class C{resetCropperPosition(a,s,l){if(!(null==a?void 0:a.nativeElement))return;const d=a.nativeElement;if(l.cropperStaticHeight&&l.cropperStaticWidth)s.x1=0,s.x2=d.offsetWidth>l.cropperStaticWidth?l.cropperStaticWidth:d.offsetWidth,s.y1=0,s.y2=d.offsetHeight>l.cropperStaticHeight?l.cropperStaticHeight:d.offsetHeight;else{const p=Math.min(l.cropperScaledMaxWidth,d.offsetWidth),m=Math.min(l.cropperScaledMaxHeight,d.offsetHeight);if(l.maintainAspectRatio)if(d.offsetWidth/l.aspectRatio<d.offsetHeight){s.x1=0,s.x2=p;const v=p/l.aspectRatio;s.y1=(d.offsetHeight-v)/2,s.y2=s.y1+v}else{s.y1=0,s.y2=m;const v=m*l.aspectRatio;s.x1=(d.offsetWidth-v)/2,s.x2=s.x1+v}else s.x1=0,s.x2=p,s.y1=0,s.y2=m}}move(a,s,l){const d=this.getClientX(a)-s.clientX,p=this.getClientY(a)-s.clientY;l.x1=s.x1+d,l.y1=s.y1+p,l.x2=s.x2+d,l.y2=s.y2+p}resize(a,s,l,d,p){const m=this.getClientX(a)-s.clientX,v=this.getClientY(a)-s.clientY;switch(s.position){case"left":l.x1=Math.min(Math.max(s.x1+m,l.x2-p.cropperScaledMaxWidth),l.x2-p.cropperScaledMinWidth);break;case"topleft":l.x1=Math.min(Math.max(s.x1+m,l.x2-p.cropperScaledMaxWidth),l.x2-p.cropperScaledMinWidth),l.y1=Math.min(Math.max(s.y1+v,l.y2-p.cropperScaledMaxHeight),l.y2-p.cropperScaledMinHeight);break;case"top":l.y1=Math.min(Math.max(s.y1+v,l.y2-p.cropperScaledMaxHeight),l.y2-p.cropperScaledMinHeight);break;case"topright":l.x2=Math.max(Math.min(s.x2+m,l.x1+p.cropperScaledMaxWidth),l.x1+p.cropperScaledMinWidth),l.y1=Math.min(Math.max(s.y1+v,l.y2-p.cropperScaledMaxHeight),l.y2-p.cropperScaledMinHeight);break;case"right":l.x2=Math.max(Math.min(s.x2+m,l.x1+p.cropperScaledMaxWidth),l.x1+p.cropperScaledMinWidth);break;case"bottomright":l.x2=Math.max(Math.min(s.x2+m,l.x1+p.cropperScaledMaxWidth),l.x1+p.cropperScaledMinWidth),l.y2=Math.max(Math.min(s.y2+v,l.y1+p.cropperScaledMaxHeight),l.y1+p.cropperScaledMinHeight);break;case"bottom":l.y2=Math.max(Math.min(s.y2+v,l.y1+p.cropperScaledMaxHeight),l.y1+p.cropperScaledMinHeight);break;case"bottomleft":l.x1=Math.min(Math.max(s.x1+m,l.x2-p.cropperScaledMaxWidth),l.x2-p.cropperScaledMinWidth),l.y2=Math.max(Math.min(s.y2+v,l.y1+p.cropperScaledMaxHeight),l.y1+p.cropperScaledMinHeight);break;case"center":const P=a.scale,T=Math.min(Math.max(p.cropperScaledMinWidth,Math.abs(s.x2-s.x1)*P),p.cropperScaledMaxWidth),F=Math.min(Math.max(p.cropperScaledMinHeight,Math.abs(s.y2-s.y1)*P),p.cropperScaledMaxHeight);l.x1=s.clientX-T/2,l.x2=s.clientX+T/2,l.y1=s.clientY-F/2,l.y2=s.clientY+F/2,l.x1<0?(l.x2-=l.x1,l.x1=0):l.x2>d.width&&(l.x1-=l.x2-d.width,l.x2=d.width),l.y1<0?(l.y2-=l.y1,l.y1=0):l.y2>d.height&&(l.y1-=l.y2-d.height,l.y2=d.height)}p.maintainAspectRatio&&this.checkAspectRatio(s.position,l,d,p)}checkAspectRatio(a,s,l,d){let p=0,m=0;switch(a){case"top":s.x2=s.x1+(s.y2-s.y1)*d.aspectRatio,p=Math.max(s.x2-l.width,0),m=Math.max(0-s.y1,0),(p>0||m>0)&&(s.x2-=m*d.aspectRatio>p?m*d.aspectRatio:p,s.y1+=m*d.aspectRatio>p?m:p/d.aspectRatio);break;case"bottom":s.x2=s.x1+(s.y2-s.y1)*d.aspectRatio,p=Math.max(s.x2-l.width,0),m=Math.max(s.y2-l.height,0),(p>0||m>0)&&(s.x2-=m*d.aspectRatio>p?m*d.aspectRatio:p,s.y2-=m*d.aspectRatio>p?m:p/d.aspectRatio);break;case"topleft":s.y1=s.y2-(s.x2-s.x1)/d.aspectRatio,p=Math.max(0-s.x1,0),m=Math.max(0-s.y1,0),(p>0||m>0)&&(s.x1+=m*d.aspectRatio>p?m*d.aspectRatio:p,s.y1+=m*d.aspectRatio>p?m:p/d.aspectRatio);break;case"topright":s.y1=s.y2-(s.x2-s.x1)/d.aspectRatio,p=Math.max(s.x2-l.width,0),m=Math.max(0-s.y1,0),(p>0||m>0)&&(s.x2-=m*d.aspectRatio>p?m*d.aspectRatio:p,s.y1+=m*d.aspectRatio>p?m:p/d.aspectRatio);break;case"right":case"bottomright":s.y2=s.y1+(s.x2-s.x1)/d.aspectRatio,p=Math.max(s.x2-l.width,0),m=Math.max(s.y2-l.height,0),(p>0||m>0)&&(s.x2-=m*d.aspectRatio>p?m*d.aspectRatio:p,s.y2-=m*d.aspectRatio>p?m:p/d.aspectRatio);break;case"left":case"bottomleft":s.y2=s.y1+(s.x2-s.x1)/d.aspectRatio,p=Math.max(0-s.x1,0),m=Math.max(s.y2-l.height,0),(p>0||m>0)&&(s.x1+=m*d.aspectRatio>p?m*d.aspectRatio:p,s.y2-=m*d.aspectRatio>p?m:p/d.aspectRatio);break;case"center":s.x2=s.x1+(s.y2-s.y1)*d.aspectRatio,s.y2=s.y1+(s.x2-s.x1)/d.aspectRatio;const v=Math.max(0-s.x1,0),P=Math.max(s.x2-l.width,0),T=Math.max(s.y2-l.height,0),F=Math.max(0-s.y1,0);(v>0||P>0||T>0||F>0)&&(s.x1+=T*d.aspectRatio>v?T*d.aspectRatio:v,s.x2-=F*d.aspectRatio>P?F*d.aspectRatio:P,s.y1+=F*d.aspectRatio>P?F:P/d.aspectRatio,s.y2-=T*d.aspectRatio>v?T:v/d.aspectRatio)}}getClientX(a){var s;return(null===(s=a.touches)||void 0===s?void 0:s[0].clientX)||a.clientX||0}getClientY(a){var s;return(null===(s=a.touches)||void 0===s?void 0:s[0].clientY)||a.clientY||0}}return C.\u0275fac=function(a){return new(a||C)},C.\u0275prov=(0,g.Yz7)({factory:function(){return new C},token:C,providedIn:"root"}),C})();let U=(()=>{class C{constructor(){this.autoRotateSupported=new Promise(C=>{const f=new Image;f.onload=()=>{C(1===f.width&&2===f.height)},f.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}loadImageFile(a,s){return new Promise((l,d)=>{const p=new FileReader;p.onload=m=>{this.loadImage(m.target.result,a.type,s).then(l).catch(d)},p.readAsDataURL(a)})}loadImage(a,s,l){return this.isValidImageType(s)?this.loadBase64Image(a,l):Promise.reject(new Error("Invalid image type"))}isValidImageType(a){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp)/.test(a)}loadImageFromURL(a,s){return new Promise((l,d)=>{const p=new Image;p.onerror=()=>d,p.onload=()=>{const m=document.createElement("canvas"),v=m.getContext("2d");m.width=p.width,m.height=p.height,v.drawImage(p,0,0),this.loadBase64Image(m.toDataURL(),s).then(l)},p.crossOrigin="anonymous",p.src=a})}loadBase64Image(a,s){return new Promise((l,d)=>{const p=new Image;p.onload=()=>l({originalImage:p,originalBase64:a}),p.onerror=d,p.src=a}).then(l=>this.transformImageBase64(l,s))}transformImageBase64(a,s){return(0,b.mG)(this,void 0,void 0,function*(){const l=yield this.autoRotateSupported,d=yield function(C){switch("string"==typeof C&&(C=function(C){const f=new DataView(function(C){C=C.replace(/^data\:([^\;]+)\;base64,/gim,"");const f=atob(C),a=f.length,s=new Uint8Array(a);for(let l=0;l<a;l++)s[l]=f.charCodeAt(l);return s.buffer}(C));if(65496!==f.getUint16(0,!1))return-2;const a=f.byteLength;let s=2;for(;s<a;){if(f.getUint16(s+2,!1)<=8)return-1;const l=f.getUint16(s,!1);if(s+=2,65505==l){if(1165519206!==f.getUint32(s+=2,!1))return-1;const d=18761==f.getUint16(s+=6,!1);s+=f.getUint32(s+4,d);const p=f.getUint16(s,d);s+=2;for(let m=0;m<p;m++)if(274==f.getUint16(s+12*m,d))return f.getUint16(s+12*m+8,d)}else{if(65280!=(65280&l))break;s+=f.getUint16(s,!1)}}return-1}(C)),C){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(l?-1:a.originalBase64);return a.originalImage&&a.originalImage.complete?this.transformLoadedImage({original:{base64:a.originalBase64,image:a.originalImage,size:{width:a.originalImage.naturalWidth,height:a.originalImage.naturalHeight}},exifTransform:d},s):Promise.reject(new Error("No image loaded"))})}transformLoadedImage(a,s){return(0,b.mG)(this,void 0,void 0,function*(){const l=s.canvasRotation+a.exifTransform.rotate,d={width:a.original.image.naturalWidth,height:a.original.image.naturalHeight};if(0===l&&!a.exifTransform.flip&&!s.containWithinAspectRatio)return{original:{base64:a.original.base64,image:a.original.image,size:Object.assign({},d)},transformed:{base64:a.original.base64,image:a.original.image,size:Object.assign({},d)},exifTransform:a.exifTransform};const p=this.getTransformedSize(d,a.exifTransform,s),m=document.createElement("canvas");m.width=p.width,m.height=p.height;const v=m.getContext("2d");v.setTransform(a.exifTransform.flip?-1:1,0,0,1,m.width/2,m.height/2),v.rotate(Math.PI*(l/2)),v.drawImage(a.original.image,-d.width/2,-d.height/2);const P=m.toDataURL(),T=yield this.loadImageFromBase64(P);return{original:{base64:a.original.base64,image:a.original.image,size:Object.assign({},d)},transformed:{base64:P,image:T,size:{width:T.width,height:T.height}},exifTransform:a.exifTransform}})}loadImageFromBase64(a){return new Promise((s,l)=>{const d=new Image;d.onload=()=>s(d),d.onerror=l,d.src=a})}getTransformedSize(a,s,l){const d=l.canvasRotation+s.rotate;if(l.containWithinAspectRatio){if(d%2){const m=a.height/l.aspectRatio;return{width:Math.max(a.height,a.width*l.aspectRatio),height:Math.max(a.width,m)}}{const m=a.width/l.aspectRatio;return{width:Math.max(a.width,a.height*l.aspectRatio),height:Math.max(a.height,m)}}}return d%2?{height:a.width,width:a.height}:{width:a.width,height:a.height}}}return C.\u0275fac=function(a){return new(a||C)},C.\u0275prov=(0,g.Yz7)({factory:function(){return new C},token:C,providedIn:"root"}),C})(),R=(()=>{class C{constructor(a,s,l,d,p){this.cropService=a,this.cropperPositionService=s,this.loadImageService=l,this.sanitizer=d,this.cd=p,this.Hammer=(null==window?void 0:window.Hammer)||null,this.settings=new nt,this.setImageMaxSizeRetries=0,this.marginLeft="0px",this.moveTypes=y,this.imageVisible=!1,this.format=this.settings.format,this.transform={},this.maintainAspectRatio=this.settings.maintainAspectRatio,this.aspectRatio=this.settings.aspectRatio,this.resizeToWidth=this.settings.resizeToWidth,this.resizeToHeight=this.settings.resizeToHeight,this.cropperMinWidth=this.settings.cropperMinWidth,this.cropperMinHeight=this.settings.cropperMinHeight,this.cropperMaxHeight=this.settings.cropperMaxHeight,this.cropperMaxWidth=this.settings.cropperMaxWidth,this.cropperStaticWidth=this.settings.cropperStaticWidth,this.cropperStaticHeight=this.settings.cropperStaticHeight,this.canvasRotation=this.settings.canvasRotation,this.initialStepSize=this.settings.initialStepSize,this.roundCropper=this.settings.roundCropper,this.onlyScaleDown=this.settings.onlyScaleDown,this.imageQuality=this.settings.imageQuality,this.autoCrop=this.settings.autoCrop,this.backgroundColor=this.settings.backgroundColor,this.containWithinAspectRatio=this.settings.containWithinAspectRatio,this.hideResizeSquares=this.settings.hideResizeSquares,this.cropper={x1:-100,y1:-100,x2:1e4,y2:1e4},this.alignImage=this.settings.alignImage,this.disabled=!1,this.imageCropped=new g.vpe,this.startCropImage=new g.vpe,this.imageLoaded=new g.vpe,this.cropperReady=new g.vpe,this.loadImageFailed=new g.vpe,this.reset()}ngOnChanges(a){var s;this.onChangesUpdateSettings(a),this.onChangesInputImage(a),(null===(s=this.loadedImage)||void 0===s?void 0:s.original.image.complete)&&(a.containWithinAspectRatio||a.canvasRotation)&&this.loadImageService.transformLoadedImage(this.loadedImage,this.settings).then(l=>this.setLoadedImage(l)).catch(l=>this.loadImageError(l)),(a.cropper||a.maintainAspectRatio||a.aspectRatio)&&(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),this.maintainAspectRatio&&(a.maintainAspectRatio||a.aspectRatio)?this.resetCropperPosition():a.cropper&&(this.checkCropperPosition(!1),this.doAutoCrop()),this.cd.markForCheck()),a.transform&&(this.transform=this.transform||{},this.setCssTransform(),this.doAutoCrop())}onChangesUpdateSettings(a){this.settings.setOptionsFromChanges(a),this.settings.cropperStaticHeight&&this.settings.cropperStaticWidth&&this.settings.setOptions({hideResizeSquares:!0,cropperMinWidth:this.settings.cropperStaticWidth,cropperMinHeight:this.settings.cropperStaticHeight,cropperMaxHeight:this.settings.cropperStaticHeight,cropperMaxWidth:this.settings.cropperStaticWidth,maintainAspectRatio:!1})}onChangesInputImage(a){(a.imageChangedEvent||a.imageURL||a.imageBase64||a.imageFile)&&this.reset(),a.imageChangedEvent&&this.isValidImageChangedEvent()&&this.loadImageFile(this.imageChangedEvent.target.files[0]),a.imageURL&&this.imageURL&&this.loadImageFromURL(this.imageURL),a.imageBase64&&this.imageBase64&&this.loadBase64Image(this.imageBase64),a.imageFile&&this.imageFile&&this.loadImageFile(this.imageFile)}isValidImageChangedEvent(){var a,s,l;return(null===(l=null===(s=null===(a=this.imageChangedEvent)||void 0===a?void 0:a.target)||void 0===s?void 0:s.files)||void 0===l?void 0:l.length)>0}setCssTransform(){this.safeTransformStyle=this.sanitizer.bypassSecurityTrustStyle("scaleX("+(this.transform.scale||1)*(this.transform.flipH?-1:1)+")scaleY("+(this.transform.scale||1)*(this.transform.flipV?-1:1)+")rotate("+(this.transform.rotate||0)+"deg)")}ngOnInit(){this.settings.stepSize=this.initialStepSize,this.activatePinchGesture()}reset(){this.imageVisible=!1,this.loadedImage=null,this.safeImgDataUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",this.moveStart={active:!1,type:null,position:null,x1:0,y1:0,x2:0,y2:0,clientX:0,clientY:0},this.maxSize={width:0,height:0},this.cropper.x1=-100,this.cropper.y1=-100,this.cropper.x2=1e4,this.cropper.y2=1e4}loadImageFile(a){this.loadImageService.loadImageFile(a,this.settings).then(s=>this.setLoadedImage(s)).catch(s=>this.loadImageError(s))}loadBase64Image(a){this.loadImageService.loadBase64Image(a,this.settings).then(s=>this.setLoadedImage(s)).catch(s=>this.loadImageError(s))}loadImageFromURL(a){this.loadImageService.loadImageFromURL(a,this.settings).then(s=>this.setLoadedImage(s)).catch(s=>this.loadImageError(s))}setLoadedImage(a){this.loadedImage=a,this.safeImgDataUrl=this.sanitizer.bypassSecurityTrustResourceUrl(a.transformed.base64),this.cd.markForCheck()}loadImageError(a){console.error(a),this.loadImageFailed.emit()}imageLoadedInView(){null!=this.loadedImage&&(this.imageLoaded.emit(this.loadedImage),this.setImageMaxSizeRetries=0,setTimeout(()=>this.checkImageMaxSizeRecursively()))}checkImageMaxSizeRecursively(){this.setImageMaxSizeRetries>40?this.loadImageFailed.emit():this.sourceImageLoaded()?(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),this.resetCropperPosition(),this.cropperReady.emit(Object.assign({},this.maxSize)),this.cd.markForCheck()):(this.setImageMaxSizeRetries++,setTimeout(()=>this.checkImageMaxSizeRecursively(),50))}sourceImageLoaded(){var a,s;return(null===(s=null===(a=this.sourceImage)||void 0===a?void 0:a.nativeElement)||void 0===s?void 0:s.offsetWidth)>0}onResize(){!this.loadedImage||(this.resizeCropperPosition(),this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize())}activatePinchGesture(){if(this.Hammer){const a=new this.Hammer(this.wrapper.nativeElement);a.get("pinch").set({enable:!0}),a.on("pinchmove",this.onPinch.bind(this)),a.on("pinchend",this.pinchStop.bind(this)),a.on("pinchstart",this.startPinch.bind(this))}else(0,g.X6Q)()&&console.warn("[NgxImageCropper] Could not find HammerJS - Pinch Gesture won't work")}resizeCropperPosition(){const a=this.sourceImage.nativeElement;(this.maxSize.width!==a.offsetWidth||this.maxSize.height!==a.offsetHeight)&&(this.cropper.x1=this.cropper.x1*a.offsetWidth/this.maxSize.width,this.cropper.x2=this.cropper.x2*a.offsetWidth/this.maxSize.width,this.cropper.y1=this.cropper.y1*a.offsetHeight/this.maxSize.height,this.cropper.y2=this.cropper.y2*a.offsetHeight/this.maxSize.height)}resetCropperPosition(){this.cropperPositionService.resetCropperPosition(this.sourceImage,this.cropper,this.settings),this.doAutoCrop(),this.imageVisible=!0}keyboardAccess(a){this.changeKeyboardStepSize(a),this.keyboardMoveCropper(a)}changeKeyboardStepSize(a){const s=+a.key;s>=1&&s<=9&&(this.settings.stepSize=s)}keyboardMoveCropper(a){if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(a.key))return;const l=a.shiftKey?y.Resize:y.Move,d=a.altKey?function(C){switch(C){case"ArrowUp":return"bottom";case"ArrowRight":return"left";case"ArrowDown":return"top";default:return"right"}}(a.key):function(C){switch(C){case"ArrowUp":return"top";case"ArrowRight":return"right";case"ArrowDown":return"bottom";default:return"left"}}(a.key),p=function(C,f){switch(C){case"ArrowUp":return{clientX:0,clientY:-1*f};case"ArrowRight":return{clientX:f,clientY:0};case"ArrowDown":return{clientX:0,clientY:f};default:return{clientX:-1*f,clientY:0}}}(a.key,this.settings.stepSize);a.preventDefault(),a.stopPropagation(),this.startMove({clientX:0,clientY:0},l,d),this.moveImg(p),this.moveStop()}startMove(a,s,l=null){var d,p;(null===(d=this.moveStart)||void 0===d?void 0:d.active)&&(null===(p=this.moveStart)||void 0===p?void 0:p.type)===y.Pinch||(a.preventDefault&&a.preventDefault(),this.moveStart=Object.assign({active:!0,type:s,position:l,clientX:this.cropperPositionService.getClientX(a),clientY:this.cropperPositionService.getClientY(a)},this.cropper))}startPinch(a){!this.safeImgDataUrl||(a.preventDefault&&a.preventDefault(),this.moveStart=Object.assign({active:!0,type:y.Pinch,position:"center",clientX:this.cropper.x1+(this.cropper.x2-this.cropper.x1)/2,clientY:this.cropper.y1+(this.cropper.y2-this.cropper.y1)/2},this.cropper))}moveImg(a){this.moveStart.active&&(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),this.moveStart.type===y.Move?(this.cropperPositionService.move(a,this.moveStart,this.cropper),this.checkCropperPosition(!0)):this.moveStart.type===y.Resize&&(!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.cropperPositionService.resize(a,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1)),this.cd.detectChanges())}onPinch(a){this.moveStart.active&&(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),this.moveStart.type===y.Pinch&&(this.cropperPositionService.resize(a,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1)),this.cd.detectChanges())}setMaxSize(){if(this.sourceImage){const a=this.sourceImage.nativeElement;this.maxSize.width=a.offsetWidth,this.maxSize.height=a.offsetHeight,this.marginLeft=this.sanitizer.bypassSecurityTrustStyle("calc(50% - "+this.maxSize.width/2+"px)")}}setCropperScaledMinSize(){var a,s;(null===(s=null===(a=this.loadedImage)||void 0===a?void 0:a.transformed)||void 0===s?void 0:s.image)?(this.setCropperScaledMinWidth(),this.setCropperScaledMinHeight()):(this.settings.cropperScaledMinWidth=20,this.settings.cropperScaledMinHeight=20)}setCropperScaledMinWidth(){this.settings.cropperScaledMinWidth=this.cropperMinWidth>0?Math.max(20,this.cropperMinWidth/this.loadedImage.transformed.image.width*this.maxSize.width):20}setCropperScaledMinHeight(){this.settings.cropperScaledMinHeight=this.maintainAspectRatio?Math.max(20,this.settings.cropperScaledMinWidth/this.aspectRatio):this.cropperMinHeight>0?Math.max(20,this.cropperMinHeight/this.loadedImage.transformed.image.height*this.maxSize.height):20}setCropperScaledMaxSize(){var a,s;if(null===(s=null===(a=this.loadedImage)||void 0===a?void 0:a.transformed)||void 0===s?void 0:s.image){const l=this.loadedImage.transformed.size.width/this.maxSize.width;this.settings.cropperScaledMaxWidth=this.cropperMaxWidth>20?this.cropperMaxWidth/l:this.maxSize.width,this.settings.cropperScaledMaxHeight=this.cropperMaxHeight>20?this.cropperMaxHeight/l:this.maxSize.height,this.maintainAspectRatio&&(this.settings.cropperScaledMaxWidth>this.settings.cropperScaledMaxHeight*this.aspectRatio?this.settings.cropperScaledMaxWidth=this.settings.cropperScaledMaxHeight*this.aspectRatio:this.settings.cropperScaledMaxWidth<this.settings.cropperScaledMaxHeight*this.aspectRatio&&(this.settings.cropperScaledMaxHeight=this.settings.cropperScaledMaxWidth/this.aspectRatio))}else this.settings.cropperScaledMaxWidth=this.maxSize.width,this.settings.cropperScaledMaxHeight=this.maxSize.height}checkCropperPosition(a=!1){this.cropper.x1<0&&(this.cropper.x2-=a?this.cropper.x1:0,this.cropper.x1=0),this.cropper.y1<0&&(this.cropper.y2-=a?this.cropper.y1:0,this.cropper.y1=0),this.cropper.x2>this.maxSize.width&&(this.cropper.x1-=a?this.cropper.x2-this.maxSize.width:0,this.cropper.x2=this.maxSize.width),this.cropper.y2>this.maxSize.height&&(this.cropper.y1-=a?this.cropper.y2-this.maxSize.height:0,this.cropper.y2=this.maxSize.height)}moveStop(){this.moveStart.active&&(this.moveStart.active=!1,this.doAutoCrop())}pinchStop(){this.moveStart.active&&(this.moveStart.active=!1,this.doAutoCrop())}doAutoCrop(){this.autoCrop&&this.crop()}crop(){var a,s;if(null!=(null===(s=null===(a=this.loadedImage)||void 0===a?void 0:a.transformed)||void 0===s?void 0:s.image)){this.startCropImage.emit();const l=this.cropService.crop(this.sourceImage,this.loadedImage,this.cropper,this.settings);return null!=l&&this.imageCropped.emit(l),l}return null}}return C.\u0275fac=function(a){return new(a||C)(g.Y36(q),g.Y36(dt),g.Y36(U),g.Y36(W.H7),g.Y36(g.sBO))},C.\u0275cmp=g.Xpm({type:C,selectors:[["image-cropper"]],viewQuery:function(a,s){if(1&a&&(g.Gf(tt,7),g.Gf(N,5)),2&a){let l;g.iGM(l=g.CRH())&&(s.wrapper=l.first),g.iGM(l=g.CRH())&&(s.sourceImage=l.first)}},hostVars:4,hostBindings:function(a,s){1&a&&g.NdJ("resize",function(){return s.onResize()},!1,g.Jf7)("mousemove",function(d){return s.moveImg(d)},!1,g.evT)("touchmove",function(d){return s.moveImg(d)},!1,g.evT)("mouseup",function(){return s.moveStop()},!1,g.evT)("touchend",function(){return s.moveStop()},!1,g.evT),2&a&&(g.Udp("text-align",s.alignImage),g.ekj("disabled",s.disabled))},inputs:{format:"format",transform:"transform",maintainAspectRatio:"maintainAspectRatio",aspectRatio:"aspectRatio",resizeToWidth:"resizeToWidth",resizeToHeight:"resizeToHeight",cropperMinWidth:"cropperMinWidth",cropperMinHeight:"cropperMinHeight",cropperMaxHeight:"cropperMaxHeight",cropperMaxWidth:"cropperMaxWidth",cropperStaticWidth:"cropperStaticWidth",cropperStaticHeight:"cropperStaticHeight",canvasRotation:"canvasRotation",initialStepSize:"initialStepSize",roundCropper:"roundCropper",onlyScaleDown:"onlyScaleDown",imageQuality:"imageQuality",autoCrop:"autoCrop",backgroundColor:"backgroundColor",containWithinAspectRatio:"containWithinAspectRatio",hideResizeSquares:"hideResizeSquares",cropper:"cropper",alignImage:"alignImage",disabled:"disabled",imageChangedEvent:"imageChangedEvent",imageURL:"imageURL",imageBase64:"imageBase64",imageFile:"imageFile"},outputs:{imageCropped:"imageCropped",startCropImage:"startCropImage",imageLoaded:"imageLoaded",cropperReady:"cropperReady",loadImageFailed:"loadImageFailed"},features:[g.TTD],decls:5,vars:10,consts:[["wrapper",""],["class","ngx-ic-source-image",3,"src","visibility","transform","load",4,"ngIf"],[1,"ngx-ic-overlay"],["class","ngx-ic-cropper","tabindex","0",3,"ngx-ic-round","top","left","width","height","margin-left","visibility","keydown",4,"ngIf"],[1,"ngx-ic-source-image",3,"src","load"],["sourceImage",""],["tabindex","0",1,"ngx-ic-cropper",3,"keydown"],[1,"ngx-ic-move",3,"mousedown","touchstart"],[4,"ngIf"],[1,"ngx-ic-resize","ngx-ic-topleft",3,"mousedown","touchstart"],[1,"ngx-ic-square"],[1,"ngx-ic-resize","ngx-ic-top"],[1,"ngx-ic-resize","ngx-ic-topright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-right"],[1,"ngx-ic-resize","ngx-ic-bottomright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-bottom"],[1,"ngx-ic-resize","ngx-ic-bottomleft",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-left"],[1,"ngx-ic-resize-bar","ngx-ic-top",3,"mousedown","touchstart"],[1,"ngx-ic-resize-bar","ngx-ic-right",3,"mousedown","touchstart"],[1,"ngx-ic-resize-bar","ngx-ic-bottom",3,"mousedown","touchstart"],[1,"ngx-ic-resize-bar","ngx-ic-left",3,"mousedown","touchstart"]],template:function(a,s){1&a&&(g.TgZ(0,"div",null,0),g.YNc(2,lt,2,5,"img",1),g._UZ(3,"div",2),g.YNc(4,t,3,15,"div",3),g.qZA()),2&a&&(g.Udp("background",s.imageVisible&&s.backgroundColor),g.xp6(2),g.Q6J("ngIf",s.safeImgDataUrl),g.xp6(1),g.Udp("width",s.maxSize.width,"px")("height",s.maxSize.height,"px")("margin-left","center"===s.alignImage?s.marginLeft:null),g.xp6(1),g.Q6J("ngIf",s.imageVisible))},directives:[x.O5],styles:['[_nghost-%COMP%]{display:flex;max-height:100%;max-width:100%;overflow:hidden;padding:5px;text-align:center}[_nghost-%COMP%], [_nghost-%COMP%] > div[_ngcontent-%COMP%]{position:relative;width:100%}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image[_ngcontent-%COMP%]{max-height:100%;max-width:100%;transform-origin:center}[_nghost-%COMP%]   .ngx-ic-overlay[_ngcontent-%COMP%]{left:0;outline:var(--cropper-overlay-color,#fff) solid 100vw;pointer-events:none;position:absolute;top:0;touch-action:none}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{background:transparent;color:#53535c;display:flex;outline:100vw solid hsla(0,0%,100%,.3);outline:var(--cropper-outline-color,hsla(0,0%,100%,.3)) solid 100vw;position:absolute;touch-action:none}@media (orientation:portrait){[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{outline-width:100vh}}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:after{border:1px dashed;bottom:0;color:inherit;content:"";left:0;opacity:.75;pointer-events:none;position:absolute;right:0;top:0;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{border:1px solid hsla(0,0%,100%,.5);cursor:move;width:100%}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-move[_ngcontent-%COMP%]{border-color:#1e90ff;border-width:2px}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]{display:inline-block;line-height:6px;opacity:.85;padding:8px;position:absolute;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{background:#53535c;border:1px solid hsla(0,0%,100%,.5);box-sizing:content-box;display:inline-block;height:6px;width:6px}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topleft[_ngcontent-%COMP%]{cursor:nwse-resize;left:-12px;top:-12px}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-top[_ngcontent-%COMP%]{cursor:ns-resize;left:calc(50% - 12px);top:-12px}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topright[_ngcontent-%COMP%]{cursor:nesw-resize;right:-12px;top:-12px}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-right[_ngcontent-%COMP%]{cursor:ew-resize;right:-12px;top:calc(50% - 12px)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomright[_ngcontent-%COMP%]{bottom:-12px;cursor:nwse-resize;right:-12px}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-12px;cursor:ns-resize;left:calc(50% - 12px)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomleft[_ngcontent-%COMP%]{bottom:-12px;cursor:nesw-resize;left:-12px}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-left[_ngcontent-%COMP%]{cursor:ew-resize;left:-12px;top:calc(50% - 12px)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%]{position:absolute;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-top[_ngcontent-%COMP%]{cursor:ns-resize;height:22px;left:11px;top:-11px;width:calc(100% - 22px)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-right[_ngcontent-%COMP%]{cursor:ew-resize;height:calc(100% - 22px);right:-11px;top:11px;width:22px}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-11px;cursor:ns-resize;height:22px;left:11px;width:calc(100% - 22px)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-left[_ngcontent-%COMP%]{cursor:ew-resize;height:calc(100% - 22px);left:-11px;top:11px;width:22px}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]{outline-color:transparent}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{border-radius:100%;box-shadow:0 0 0 100vw hsla(0,0%,100%,.3);box-shadow:0 0 0 100vw var(--cropper-outline-color,hsla(0,0%,100%,.3))}@media (orientation:portrait){[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{box-shadow:0 0 0 100vh hsla(0,0%,100%,.3);box-shadow:0 0 0 100vh var(--cropper-outline-color,hsla(0,0%,100%,.3))}}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{border-radius:100%}.disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%]{display:none}'],changeDetection:0}),C})(),ot=(()=>{class C{}return C.\u0275fac=function(a){return new(a||C)},C.\u0275mod=g.oAB({type:C}),C.\u0275inj=g.cJS({imports:[[x.ez]]}),C})();function rt(C){const f=C.split(","),a=f[0].replace("data:","").replace(";base64",""),s=atob(f[1]),l=new ArrayBuffer(s.length),d=new Uint8Array(l);for(let p=0;p<s.length;p+=1)d[p]=s.charCodeAt(p);return new Blob([l],{type:a})}},2274:(Ot,V,M)=>{M.r(V),M.d(V,{AdminModule:()=>ho});var g=M(5952),b=M(6019),x=M(9010),W=M(5427),tt=M(6970),N=M(733),lt=M(2451),et=M(6555),t=M(3668);let nt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin"]],decls:6,vars:0,consts:[[1,"left"],["role","main",1,"middle"]],template:function(e,n){1&e&&(t.TgZ(0,"aside",0),t._UZ(1,"app-admin-sidebar"),t.qZA(),t._UZ(2,"app-splitter"),t.TgZ(3,"main",1),t._UZ(4,"router-outlet"),t.qZA(),t._UZ(5,"app-admin-queue-requests"))},styles:["[_nghost-%COMP%]{width:100%;height:100%;flex:1;display:flex;flex-flow:row nowrap;overflow:hidden;align-items:flex-start;align-content:flex-start}[_nghost-%COMP%]   .left[_ngcontent-%COMP%]{width:15%;height:100%;min-width:140px}[_nghost-%COMP%]   .middle[_ngcontent-%COMP%]{width:85%;flex-grow:1;height:100%}@media (max-width: 1400px){[_nghost-%COMP%]   .left[_ngcontent-%COMP%]{width:20%}[_nghost-%COMP%]   .middle[_ngcontent-%COMP%]{width:80%}}@media (max-width: 768px){[_nghost-%COMP%]{min-height:100%;position:absolute;display:block;flex:none;flex-flow:inherit}[_nghost-%COMP%]   app-splitter[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .left[_ngcontent-%COMP%]{width:100%!important;height:auto}[_nghost-%COMP%]   .middle[_ngcontent-%COMP%]{width:100%;min-height:100%}}"]}),o})();var I=M(4762),y=M(4558),J=M(3405),q=M(8805);const dt=["overview","tags","health","tracks","tracks-health"];var u=M(7630),h=M(9723),O=M(433),A=M(7036),Z=M(2508),k=M(8437);function U(o,c){1&o&&t._UZ(0,"i",14)}function $(o,c){if(1&o&&(t.TgZ(0,"i"),t.ALo(1,"stringToggle"),t.qZA()),2&o){const e=t.oxw().$implicit;t.Tol(t.Dn7(1,2,e.expanded,"icon-minus","icon-plus"))}}function G(o,c){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",7),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw().selectNode(r)})("keydown.enter",function(){const r=t.CHM(e).$implicit;return t.oxw().selectNode(r)})("keydown.arrowRight",function(){const r=t.CHM(e).$implicit;return t.oxw().toggleNode(r)})("keydown.arrowLeft",function(){const r=t.CHM(e).$implicit;return t.oxw().toggleNode(r)}),t.TgZ(2,"span",8),t.NdJ("clickenter",function(){const r=t.CHM(e).$implicit;return t.oxw().toggleNode(r)}),t.YNc(3,U,1,0,"i",9),t.YNc(4,$,2,6,"i",10),t.qZA(),t.TgZ(5,"span",11),t.NdJ("clickenter",function(){const r=t.CHM(e).$implicit;return t.oxw().toggleNode(r)}),t.TgZ(6,"i"),t.ALo(7,"stringToggle"),t.qZA(),t.qZA(),t.TgZ(8,"span",12),t._uU(9),t.qZA(),t.TgZ(10,"span",13),t._uU(11),t.qZA(),t.qZA(),t.BQk()}if(2&o){const e=c.$implicit,n=t.oxw();t.xp6(1),t.Udp("padding-left",12*e.level,"px"),t.ekj("active",e===n.selected),t.xp6(1),t.MGl("title","Subfolders: ",e.folder.folderCount,""),t.xp6(1),t.Q6J("ngIf",e.isLoading),t.xp6(1),t.Q6J("ngIf",!e.isLoading&&e.hasChildren),t.xp6(1),t.Udp("color",e.color),t.Q6J("title",e.folder.type),t.xp6(1),t.Tol(t.Dn7(7,15,e.expanded,"icon-folder-open","icon-folder")),t.xp6(2),t.Q6J("title",e.folder.name),t.xp6(1),t.Oqu(e.folder.name),t.xp6(2),t.hij("| ",e.folder.type,"")}}function E(o,c){if(o.children)for(const e of o.children)c(e),E(e,c)}let R=(()=>{class o{constructor(e,n,i,r){this.app=e,this.jam=n,this.notify=i,this.folderService=r,this.nodes=[],this.expandIDs=[],this.autoSelect=!1,this.selectionChange=new t.vpe,this.unsubscribe=new J.xQ}ngOnInit(){this.folderService.foldersChange.pipe((0,q.R)(this.unsubscribe)).subscribe(e=>{const n=this.nodes.find(i=>i.folder.id===e.id);n&&this.jam.folder.id({id:e.id,folderIncTrackCount:!0,folderIncChildFolderCount:!0}).then(i=>{n.folder=i,e.mode===u.dw.fsnRefreshChilds&&n.expanded&&(this.collapseNode(n),n.hasChildren=(i.folderCount||0)>0,n.children=void 0,n.isLoading=!1,n.hasChildren&&(n.expanded=!0,this.checkLoadExpanded(n)))}).catch(i=>{console.error(i)})})}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}selectNode(e){this.selectionChange.emit(e.folder),this.autoSelect&&(this.selected=e)}toggleNode(e){e.expanded?this.collapseNode(e):this.expandNode(e)}refresh(){!this.jam.auth.isLoggedIn()||this.jam.folder.search({level:0,folderIncChildFolderCount:!0,folderIncTrackCount:!0}).then(e=>{this.nodes=e.items.map(n=>({folder:n,hasChildren:(n.folderCount||0)>0,level:0,color:this.typeToColor(n),expanded:this.expandIDs.includes(n.id),isLoading:!1}));for(const n of this.nodes)this.checkLoadExpanded(n)}).catch(e=>{this.notify.error(e)})}typeToColor(e){switch(e.type){case h.Sr.unknown:return"#ff9fAA";case h.Sr.artist:return"#6f806e";case h.Sr.collection:return"#adbced";case h.Sr.album:return"#bdbd9c";case h.Sr.multialbum:return"#bdaaae";case h.Sr.extras:return"#bdbdbd";default:return""}}onFolderUpdate(e){const n=this.nodes.find(i=>i.folder.id===e.id);n&&(n.folder=e)}selectFolderByID(e){const n=this.nodes.find(i=>i.folder.id===e);n?this.selected=n:this.jam.folder.id({id:e,folderIncParents:!0}).then(i=>{if(i.parents){for(const r of i.parents)this.expandIDs.includes(r.id)||this.expandIDs.push(r.id);for(const r of this.nodes)r.expanded=this.expandIDs.includes(r.folder.id),this.checkLoadExpanded(r,e)}}).catch(i=>{this.notify.error(i)})}checkLoadExpanded(e,n){e.expanded&&!e.isLoading&&this.loadChildren(e,i=>{for(const r of i)this.checkLoadExpanded(r,n)}),e.folder.id===n&&(this.selected=e,this.viewport&&this.viewport.scrollToIndex(this.nodes.indexOf(e)))}loadChildren(e,n){e.isLoading||(e.isLoading=!0,this.jam.folder.search({parentIDs:[e.folder.id],folderIncChildFolderCount:!0,folderIncTrackCount:!0}).then(i=>{const r=i.items.sort((w,Q)=>w.name.localeCompare(Q.name)).map(w=>({folder:w,hasChildren:(w.folderCount||0)>0,level:e.level+1,color:this.typeToColor(w),expanded:this.expandIDs.includes(w.id),isLoading:!1})),_=this.nodes.indexOf(e);_>=0&&(this.nodes=this.nodes.slice(0,_+1).concat(r).concat(this.nodes.slice(_+1))),e.children=r,e.isLoading=!1,n&&n(r)}).catch(i=>{this.notify.error(i)}))}collapseNode(e){if(e.expanded){const n=[];E(e,i=>n.push(i.folder.id)),this.nodes=this.nodes.filter(i=>!n.includes(i.folder.id)),e.expanded=!1,e.children=void 0,this.expandIDs=(this.expandIDs||[]).filter(i=>i!==e.folder.id)}}expandNode(e){if(!e.expanded){if(e.children){const n=this.nodes.indexOf(e);this.nodes=this.nodes.slice(0,n+1).concat(e.children).concat(this.nodes.slice(n+1))}else this.loadChildren(e);this.expandIDs.push(e.folder.id),e.expanded=!0}}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(h.K4),t.Y36(u.c),t.Y36(u.Cr))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder-tree"]],viewQuery:function(e,n){if(1&e&&t.Gf(g.N7,7),2&e){let i;t.iGM(i=t.CRH())&&(n.viewport=i.first)}},inputs:{autoSelect:"autoSelect"},outputs:{selectionChange:"selectionChange"},decls:8,vars:2,consts:[[1,"actions"],[1,"name"],["title","Refresh Folder Tree",1,"button-on-control",3,"click"],["aria-hidden","true",1,"icon-reload"],["appFocusKeyList","",1,"tree"],[1,"list-container","list-group",2,"height","100%",3,"itemSize"],[4,"cdkVirtualFor","cdkVirtualForOf"],["appFocusKeyListItem","",1,"node",3,"click","keydown.enter","keydown.arrowRight","keydown.arrowLeft"],[1,"node-toggle",3,"title","clickenter"],["class","icon-spin icon-spinner",4,"ngIf"],[3,"class",4,"ngIf"],[1,"node-icon",3,"title","clickenter"],[3,"title"],[1,"node-type"],[1,"icon-spin","icon-spinner"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"span",1),t._uU(2,"Folders"),t.qZA(),t.TgZ(3,"button",2),t.NdJ("click",function(){return n.refresh()}),t._UZ(4,"i",3),t.qZA(),t.qZA(),t.TgZ(5,"div",4),t.TgZ(6,"cdk-virtual-scroll-viewport",5),t.YNc(7,G,12,19,"ng-container",6),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.Q6J("itemSize",22),t.xp6(1),t.Q6J("cdkVirtualForOf",n.nodes))},directives:[O.R,g.N7,g.xd,g.x0,A.j,Z.X,b.O5],pipes:[k.C],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{padding:15px 15px 10px;background-color:var(--background-transparent);color:var(--on-control)}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{padding-right:10px;vertical-align:middle;color:var(--on-control-active);font-size:20px;font-weight:100}[_nghost-%COMP%]   .tree[_ngcontent-%COMP%]{margin-top:10px;flex:1}[_nghost-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{width:100%;height:100%;min-height:100%;overflow-x:hidden}[_nghost-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]     .cdk-virtual-scroll-content-wrapper{width:100%}[_nghost-%COMP%]   .node[_ngcontent-%COMP%]{width:100%;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-decoration:none;vertical-align:middle;height:22px;cursor:pointer;-webkit-user-select:none;user-select:none;font-size:.9em}[_nghost-%COMP%]   .node[_ngcontent-%COMP%]   .node-toggle[_ngcontent-%COMP%]{display:inline-block;min-width:20px}[_nghost-%COMP%]   .node[_ngcontent-%COMP%]   .node-type[_ngcontent-%COMP%]{padding-left:5px;font-size:.7em;text-transform:uppercase}[_nghost-%COMP%]   .node.active[_ngcontent-%COMP%]{color:var(--on-control-hover)}"]}),o})();var ot=M(9135);function rt(o,c){1&o&&(t.TgZ(0,"a"),t._UZ(1,"i",8),t._uU(2," Show Folder Tools"),t.qZA())}function C(o,c){1&o&&(t.TgZ(0,"a"),t._UZ(1,"i",9),t._uU(2," Show Folder Tree"),t.qZA())}const f=function(o){return["/admin/folder",o,"overview"]},a=function(o){return["/admin/folder",o,"tracks"]},s=function(o){return["/admin/folder",o,"sub-folders"]},l=function(o){return["/admin/folder",o,"tags"]},d=function(o){return["/admin/folder",o,"health"]},p=function(o){return["/admin/folder",o,"tracks-health"]};function m(o,c){if(1&o&&(t.TgZ(0,"nav",10),t.TgZ(1,"ul",11),t.TgZ(2,"li",12),t.TgZ(3,"a"),t._uU(4,"Overview"),t.qZA(),t.qZA(),t.TgZ(5,"li",12),t.TgZ(6,"a"),t._uU(7,"Tracks"),t.qZA(),t.qZA(),t.TgZ(8,"li",12),t.TgZ(9,"a"),t._uU(10,"Folders"),t.qZA(),t.qZA(),t.TgZ(11,"li",12),t.TgZ(12,"a"),t._uU(13,"Tags"),t.qZA(),t.qZA(),t.TgZ(14,"li",12),t.TgZ(15,"a"),t._uU(16,"Health"),t.qZA(),t.qZA(),t.TgZ(17,"li",12),t.TgZ(18,"a"),t._uU(19,"Track Health"),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("routerLink",t.VKq(6,f,e.id)),t.xp6(3),t.Q6J("routerLink",t.VKq(8,a,e.id)),t.xp6(3),t.Q6J("routerLink",t.VKq(10,s,e.id)),t.xp6(3),t.Q6J("routerLink",t.VKq(12,l,e.id)),t.xp6(3),t.Q6J("routerLink",t.VKq(14,d,e.id)),t.xp6(3),t.Q6J("routerLink",t.VKq(16,p,e.id))}}let v=(()=>{class o{constructor(e,n,i){this.route=e,this.router=n,this.uiState=i,this.id="",this.rightActive=!1,this.unsubscribe=new J.xQ,this.mode="overview"}refresh(){this.tree&&this.tree.refresh()}selectionChange(e){this.router.navigate([`/admin/folder/${e.id}/${this.mode}`]).catch(n=>{console.error(n)})}onFolderUpdate(e){this.tree&&this.tree.onFolderUpdate(e)}ngOnInit(){this.router.events.pipe((0,q.R)(this.unsubscribe)).subscribe(e=>{if(e instanceof y.m2&&this.route.firstChild&&this.route.firstChild.snapshot.url[0]){const n=this.route.firstChild.snapshot.url[0].path;dt.includes(n)&&(this.mode=n)}}),this.route&&this.route.params.pipe((0,q.R)(this.unsubscribe)).subscribe(e=>{const n=e.id;this.id=n,this.tree&&n&&setTimeout(()=>{this.tree&&this.tree.selectFolderByID(n)})}),this.tree&&(this.tree.expandIDs=this.uiState.data["app-admin-folders"]||[]),this.refresh()}ngOnDestroy(){this.tree&&(this.uiState.data["app-admin-folders"]=this.tree.expandIDs),this.unsubscribe.next(),this.unsubscribe.complete()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(y.gz),t.Y36(y.F0),t.Y36(u.JU))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder"]],viewQuery:function(e,n){if(1&e&&t.Gf(R,7),2&e){let i;t.iGM(i=t.CRH())&&(n.tree=i.first)}},hostVars:2,hostBindings:function(e,n){2&e&&t.ekj("right-active",n.rightActive)},decls:11,vars:3,consts:[[1,"toggle",3,"click"],[4,"ngIf"],[1,"content"],[1,"left-content"],[3,"selectionChange"],[1,"right-content"],["class","navigation",4,"ngIf"],[1,"router-content"],[1,"icon-right"],[1,"icon-left"],[1,"navigation"],[1,"tabs"],["routerLinkActive","active",3,"routerLink"]],template:function(e,n){1&e&&(t.TgZ(0,"button",0),t.NdJ("click",function(){return n.rightActive=!n.rightActive}),t.YNc(1,rt,3,0,"a",1),t.YNc(2,C,3,0,"a",1),t.qZA(),t.TgZ(3,"div",2),t.TgZ(4,"div",3),t.TgZ(5,"app-admin-folder-tree",4),t.NdJ("selectionChange",function(r){return n.selectionChange(r)}),t.qZA(),t.qZA(),t._UZ(6,"app-splitter"),t.TgZ(7,"div",5),t.YNc(8,m,20,18,"nav",6),t.TgZ(9,"div",7),t._UZ(10,"router-outlet"),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",!n.rightActive),t.xp6(1),t.Q6J("ngIf",n.rightActive),t.xp6(6),t.Q6J("ngIf",n.id))},directives:[b.O5,R,ot.H,y.lC,y.Od,y.rH],styles:["[_nghost-%COMP%]{overflow-y:auto;overflow-x:hidden;height:100%;width:100%;min-height:100%;flex:1 1 auto;position:relative;display:flex;flex-direction:column;overflow:hidden}[_nghost-%COMP%]   .toggle[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]{width:100%;z-index:1;display:flex;flex-flow:row wrap;justify-content:space-between;align-items:center;background-color:var(--background-transparent);color:var(--on-control)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%]{padding-left:0;margin-top:0;margin-bottom:0;list-style:none;border:none;display:flex;flex-flow:row wrap;width:100%}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{position:relative;display:block;margin-bottom:-1px;flex:1;align-self:stretch;border-top-width:4px;border-top-style:solid;border-top-color:transparent;border-bottom-width:4px;border-bottom-style:solid;border-bottom-color:transparent;padding:0}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]:hover{background-color:var(--control-hover);transition:all .4s ease;border-bottom-width:4px;border-bottom-style:solid;border-bottom-color:transparent}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{padding:10px 0;text-align:center;align-items:center;align-content:center;justify-content:center;margin-right:2px;line-height:1.42857143;border-radius:4px 4px 0 0;position:relative;display:flex;cursor:pointer;border:none;font-size:14px;text-transform:uppercase;letter-spacing:.5px;height:100%;color:var(--on-control);-webkit-user-select:none;user-select:none}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:focus, [_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:hover{background-color:unset;border:none;color:var(--on-control-hover)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]{cursor:default;border-bottom-color:var(--primary)!important}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{cursor:default;background-color:unset;color:var(--on-control-hover)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]:focus, [_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]:hover{border-bottom-color:var(--primary)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.disabled[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{color:var(--on-control-ambient-disabled)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.disabled[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:focus, [_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.disabled[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:hover{color:var(--on-control-ambient-disabled);text-decoration:none;cursor:not-allowed;background-color:transparent}@media (max-width: 768px){[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%]{align-items:center;align-content:center;justify-content:center}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{padding:5px;min-width:33%}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{font-size:.8em}}@media (max-width: 400px){[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{padding:0 5px}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{font-size:.7em}}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs.mini[_ngcontent-%COMP%]{padding-left:15px;padding-right:15px}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs.mini[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{flex:0}@media (max-width: 768px){[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs.mini[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{min-width:20px}}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;height:100%;flex:1;display:flex;flex-flow:row nowrap;overflow:hidden;align-items:flex-start;align-content:flex-start;padding:0;min-height:100%}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .left-content[_ngcontent-%COMP%]{height:100%;width:20%;display:block;border-right:1px solid var(--background-border);min-width:240px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]{width:80%;flex-shrink:1;flex-grow:1;height:100%;display:flex;flex-flow:column nowrap;position:relative;overflow:hidden}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]   .router-content[_ngcontent-%COMP%]{width:100%;height:100%;display:block;overflow:hidden}@media (max-width: 522px){[_nghost-%COMP%]{height:100%;width:100%;min-height:100%;overflow:hidden}[_nghost-%COMP%]   .toggle[_ngcontent-%COMP%]{display:block;position:relative;width:100%;height:33px;text-align:center;padding-top:5px;border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;height:calc(100% - 33px);min-height:calc(100% - 33px);overflow:hidden;display:block;flex:none;position:relative}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-splitter[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .left-content[_ngcontent-%COMP%]{display:flex;height:100%;width:100%}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]{display:none;height:100%;width:100%}.right-active[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .left-content[_ngcontent-%COMP%]{display:none}.right-active[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]{display:flex}}"]}),o})(),P=(()=>{class o{constructor(e){this.route=e,this.unsubscribe=new J.xQ}ngOnInit(){this.route&&this.route.parent&&this.route.parent.params.pipe((0,q.R)(this.unsubscribe)).subscribe(e=>{this.resolve(e),this.refresh()})}idChanged(){}refresh(){}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}resolve(e){this.id=e.id,this.idChanged()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(y.gz))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-base-parent-view-id"]],decls:0,vars:0,template:function(e,n){},styles:[""]}),o})(),T=(()=>{class o{selectionChange(e){this.data&&(this.data.folder=e)}dialogInit(e,n){var i;this.data=n.data,this.tree&&(this.tree.refresh(),(null===(i=this.data)||void 0===i?void 0:i.selectID)&&this.tree.selectFolderByID(this.data.selectID))}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-choose-folder"]],viewQuery:function(e,n){if(1&e&&t.Gf(R,7),2&e){let i;t.iGM(i=t.CRH())&&(n.tree=i.first)}},decls:1,vars:1,consts:[[3,"autoSelect","selectionChange"]],template:function(e,n){1&e&&(t.TgZ(0,"app-admin-folder-tree",0),t.NdJ("selectionChange",function(r){return n.selectionChange(r)}),t.qZA()),2&e&&t.Q6J("autoSelect",!0)},directives:[R],styles:["[_nghost-%COMP%]{flex:1}"]}),o})();const F=function(){return{standalone:!0}};function z(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"form"),t.TgZ(2,"div",1),t.TgZ(3,"label",2),t._uU(4,"Name"),t.qZA(),t.TgZ(5,"input",3),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().edit.name=i}),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=t.oxw();t.xp6(5),t.Q6J("ngModel",e.edit.name)("ngModelOptions",t.DdM(2,F))}}let Y=(()=>{class o{dialogInit(e,n){this.edit=n.data}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-folder"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"user-form-control"],["for","dialog-folder-edit"],["id","dialog-folder-edit","type","text","name","folder-name",3,"ngModel","ngModelOptions","ngModelChange"]],template:function(e,n){1&e&&t.YNc(0,z,6,3,"div",0),2&e&&t.Q6J("ngIf",n.edit)},directives:[b.O5,x._Y,x.JL,x.F,x.Fj,x.JJ,x.On],styles:["[_nghost-%COMP%] > div[_ngcontent-%COMP%]{margin-left:20px;margin-right:20px}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{font-size:1.3em;line-height:1.3em}[_nghost-%COMP%]   .user-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block}"]}),o})();var S=M(4758),H=M(444),D=M(2952),B=M(2676);function L(o,c){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij(" / ",null==e.folder.tag?null:e.folder.tag.albumType,"")}}const at=function(o){return["/admin/folder",o,"overview"]};function ut(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"tr",10),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return r.selected=!r.selected}),t.TgZ(1,"td",4),t.TgZ(2,"a",11),t._uU(3),t.qZA(),t.qZA(),t.TgZ(4,"td",5),t._uU(5),t.qZA(),t.TgZ(6,"td",6),t._uU(7),t.qZA(),t.TgZ(8,"td",7),t._uU(9),t.qZA(),t.TgZ(10,"td",8),t._uU(11),t.YNc(12,L,2,1,"ng-container",12),t.qZA(),t.qZA()}if(2&o){const e=c.$implicit;t.ekj("selected",e.selected),t.xp6(2),t.Q6J("routerLink",t.VKq(9,at,e.folder.id)),t.xp6(1),t.Oqu(e.folder.name),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.artist),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.album),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.year),t.xp6(2),t.hij(" ",e.folder.type," "),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.albumType)}}function mt(o,c){if(1&o&&(t.TgZ(0,"table",2),t.TgZ(1,"tr",3),t.TgZ(2,"td",4),t._uU(3,"Title"),t.qZA(),t.TgZ(4,"td",5),t._uU(5,"Artist"),t.qZA(),t.TgZ(6,"td",6),t._uU(7,"Album"),t.qZA(),t.TgZ(8,"td",7),t._uU(9,"Year"),t.qZA(),t.TgZ(10,"td",8),t._uU(11,"Type"),t.qZA(),t.qZA(),t.YNc(12,ut,13,11,"tr",9),t.qZA()),2&o){const e=t.oxw();t.xp6(12),t.Q6J("ngForOf",e.folderItems)}}class ft{constructor(c){this.folder=c}}let Ct=(()=>{class o{constructor(){this.folders=[],this.folderItems=[]}getSortValue(e,n){var i,r;switch(e){case"name":return n.name;case"artist":return null===(i=n.tag)||void 0===i?void 0:i.artist;case"album":return null===(r=n.tag)||void 0===r?void 0:r.album;case"type":return n.type;default:return}}ngOnChanges(){this.folderItems=(this.folders||[]).map(e=>new ft(e))}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder-list"]],inputs:{folders:"folders"},features:[t.TTD],decls:2,vars:2,consts:[["name","Folders",3,"list"],["class","folders",4,"ngIf"],[1,"folders"],[1,"folder","heading"],[1,"title"],[1,"artist"],[1,"album"],[1,"year"],[1,"type"],["class","folder",3,"selected","click",4,"ngFor","ngForOf"],[1,"folder",3,"click"],[3,"routerLink"],[4,"ngIf"]],template:function(e,n){1&e&&(t._UZ(0,"app-background-text-list",0),t.YNc(1,mt,13,1,"table",1)),2&e&&(t.Q6J("list",n.folderItems),t.xp6(1),t.Q6J("ngIf",n.folderItems&&n.folderItems.length>0))},directives:[B.$,b.O5,b.sg,y.yS],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]{padding:15px;font-size:.8em;width:100%}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{font-size:.9em}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]{border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .folder.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}"]}),o})();function xt(o,c){1&o&&t._UZ(0,"app-loading")}function bt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).moveSubfolders()}),t._UZ(1,"i",12),t.qZA()}}function At(o,c){if(1&o&&t._UZ(0,"app-admin-folder-list",13),2&o){const e=t.oxw(2);t.Q6J("folders",e.folder.folders)}}function gt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",2),t.TgZ(1,"div",3),t.TgZ(2,"button",4),t.NdJ("click",function(){return t.CHM(e),t.oxw().refresh()}),t._UZ(3,"i",5),t.qZA(),t.TgZ(4,"button",6),t.NdJ("click",function(){return t.CHM(e),t.oxw().newFolder()}),t._UZ(5,"i",7),t.qZA(),t.YNc(6,bt,2,0,"button",8),t.qZA(),t._UZ(7,"app-background-text-list",9),t.YNc(8,At,1,1,"app-admin-folder-list",10),t.qZA()}if(2&o){const e=t.oxw();t.xp6(6),t.Q6J("ngIf",null==e.folder||null==e.folder.folders?null:e.folder.folders.length),t.xp6(1),t.Q6J("list",e.folder.folders),t.xp6(1),t.Q6J("ngIf",null==e.folder.folders?null:e.folder.folders.length)}}let pt=(()=>{class o extends P{constructor(e,n,i,r,_,w){super(e),this.jam=n,this.notify=i,this.folderService=r,this.dialogsService=_,this.dialogOverlay=w}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,q.R)(this.unsubscribe)).subscribe(e=>{e.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}refresh(){this.folder=void 0,this.id&&this.jam.folder.id({id:this.id,folderIncFolders:!0,folderIncTag:!0}).then(e=>{this.folder=e}).catch(e=>{this.notify.error(e)})}newFolder(){if(!this.folder)return;const e=this.folder,n={folder:e,name:""};this.dialogOverlay.open({childComponent:Y,title:"New Folder",data:n,onOkBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){try{this.jam.folder.create({id:e.id,name:n.name}).then(i=>{this.folderService.waitForQueueResult("Creating Folder",i,[],[e.id])}).catch(i=>{this.notify.error(i)})}catch(i){return this.notify.error(i),Promise.reject(i)}}),onCancelBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){return Promise.resolve()})})}moveSubfolders(){var e;if(!this.id||!(null===(e=this.folder)||void 0===e?void 0:e.folders))return;const n=this.id,i=this.folder.folders.map(w=>w.id),r=[n].concat(i),_={selectID:n,disableIDs:r};this.dialogOverlay.open({title:"Move Subfolders to",childComponent:T,data:_,panelClass:"overlay-panel-large-buttons",onOkBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){try{const w=_.folder;if(!w)return;r.push(w.id),this.jam.folder.move({ids:i,newParentID:w.id}).then(Q=>{this.folderService.waitForQueueResult("Moving Folders",Q,[],r)}).catch(Q=>{this.notify.error(Q)})}catch(w){return this.notify.error(w),Promise.reject(w)}}),onCancelBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){return Promise.resolve()})})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(y.gz),t.Y36(h.K4),t.Y36(u.c),t.Y36(u.Cr),t.Y36(S.Hr),t.Y36(H.SL))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder-folders"]],features:[t.qOj],decls:2,vars:2,consts:[[4,"ngIf"],["class","folders",4,"ngIf"],[1,"folders"],[1,"actions"],["title","Refresh",1,"button-on-control",3,"click"],[1,"icon-reload"],["title","New Folder\u2026",1,"button-on-control",3,"click"],[1,"icon-plus"],["class","button-on-control","title","Move Subfolders\u2026",3,"click",4,"ngIf"],["name","Folders",3,"list"],[3,"folders",4,"ngIf"],["title","Move Subfolders\u2026",1,"button-on-control",3,"click"],[1,"icon-right-bold"],[3,"folders"]],template:function(e,n){1&e&&(t.YNc(0,xt,1,0,"app-loading",0),t.YNc(1,gt,9,3,"div",1)),2&e&&(t.Q6J("ngIf",!n.folder),t.xp6(1),t.Q6J("ngIf",n.folder&&n.folder.folders))},directives:[b.O5,D.N,B.$,Ct],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:block;overflow:hidden}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   app-admin-folder-list[_ngcontent-%COMP%]{overflow-y:auto}"]}),o})();var st=M(7564),j=M(4522),wt=M(5805),yt=M(8646);function ct(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"image-cropper",6),t.NdJ("imageCropped",function(i){return t.CHM(e),t.oxw().imageCropped(i)})("imageLoaded",function(){return t.CHM(e),t.oxw().imageLoaded()})("cropperReady",function(){return t.CHM(e),t.oxw().cropperReady()})("loadImageFailed",function(){return t.CHM(e),t.oxw().loadImageFailed()}),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("imageBase64",e.imageBase64)("format","jpeg")("maintainAspectRatio",e.maintainAspectRatio)}}function Mt(o,c){if(1&o&&(t.TgZ(0,"div",7),t._UZ(1,"img",8),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("src",e.croppedImage,t.LSH)}}let X=(()=>{class o{constructor(e,n,i,r){this.app=e,this.jam=n,this.folderService=i,this.notify=r,this.imageBase64="",this.mimeType="image/jpeg",this.maintainAspectRatio=!0,this.imageEdited=new t.vpe,this.unsubscribe=new J.xQ}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}load(){this.data&&this.jam.image.imageBinary({id:this.data.artwork.id}).then(e=>{this.imageBase64=`data:${e.contentType||"image/jpeg"};base64,${(0,yt.q)(e.buffer)}`}).catch(e=>{this.notify.error(e)})}imageCropped(e){e.base64&&(this.croppedImage=e.base64,this.croppedImageFile=(0,et.Ll)(e.base64))}imageLoaded(){}cropperReady(){}loadImageFailed(){}ngOnChanges(e){this.load()}upload(){if(!this.croppedImageFile||!this.data)return;const e=this.data.folderID,n=new File([this.croppedImageFile],this.data.artwork.name,{type:this.croppedImageFile.type});this.jam.artwork.update({id:this.data.artwork.id},n).pipe((0,q.R)(this.unsubscribe)).subscribe(i=>{i.type===j.dt.Response&&(this.folderService.waitForQueueResult("Updating Folder Artwork",i.body,[e]),this.imageEdited.emit())},i=>{this.notify.error(i)},()=>{this.notify.success("Upload done")})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(h.K4),t.Y36(u.Cr),t.Y36(u.c))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-artwork-edit"]],inputs:{data:"data"},outputs:{imageEdited:"imageEdited"},features:[t.TTD],decls:9,vars:4,consts:[[1,"image-crop"],["type","checkbox",3,"ngModel","checked","ngModelChange"],[3,"imageBase64","format","maintainAspectRatio","imageCropped","imageLoaded","cropperReady","loadImageFailed",4,"ngIf"],["class","image-preview",4,"ngIf"],[1,"buttons"],[1,"button-on-control",3,"click"],[3,"imageBase64","format","maintainAspectRatio","imageCropped","imageLoaded","cropperReady","loadImageFailed"],[1,"image-preview"],["alt","Cropped Image",3,"src"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"label"),t.TgZ(2,"input",1),t.NdJ("ngModelChange",function(r){return n.maintainAspectRatio=r}),t.qZA(),t._uU(3," Maintain Aspect Ratio "),t.qZA(),t.YNc(4,ct,1,3,"image-cropper",2),t.qZA(),t.YNc(5,Mt,2,1,"div",3),t.TgZ(6,"div",4),t.TgZ(7,"button",5),t.NdJ("click",function(){return n.upload()}),t._uU(8,"Use Cropped Artwork"),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Q6J("ngModel",n.maintainAspectRatio)("checked",n.maintainAspectRatio),t.xp6(2),t.Q6J("ngIf",n.imageBase64),t.xp6(1),t.Q6J("ngIf",n.croppedImage))},directives:[x.Wl,x.JJ,x.On,b.O5,et.ap],styles:["[_nghost-%COMP%]{width:100%;display:block;text-align:center}[_nghost-%COMP%]   image-cropper[_ngcontent-%COMP%]{width:300px;display:block}[_nghost-%COMP%]   .image-crop[_ngcontent-%COMP%]{display:inline-block;text-align:center;margin-left:10px;margin-right:10px}[_nghost-%COMP%]   .image-preview[_ngcontent-%COMP%]{margin-left:10px;margin-right:10px;display:inline-block}[_nghost-%COMP%]   .image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:300px}"]}),o})();function K(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"app-admin-artwork-edit",1),t.NdJ("imageEdited",function(){return t.CHM(e),t.oxw().onImageEdited()}),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("data",e.data)}}let Et=(()=>{class o{constructor(){this.loading=!0}dialogInit(e,n){this.data=n.data,this.reference=e}onImageEdited(){this.reference&&this.reference.close()}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-image-edit-overlay-content"]],decls:1,vars:1,consts:[[3,"data","imageEdited",4,"ngIf"],[3,"data","imageEdited"]],template:function(e,n){1&e&&t.YNc(0,K,1,1,"app-admin-artwork-edit",0),2&e&&t.Q6J("ngIf",n.data)},directives:[b.O5,X],styles:[""]}),o})();const Yt=["inlineEditControl"];function zt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",2),t.TgZ(1,"input",3,4),t.NdJ("blur",function(i){return t.CHM(e),t.oxw().onBlur(i)})("keydown.enter",function(){return t.CHM(e),t.oxw().apply()})("ngModelChange",function(i){return t.CHM(e),t.oxw().value=i}),t.qZA(),t.qZA()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("required",e.required)("name",e.value)("ngModel",e.value)("type",e.type)("placeholder",e.placeholder)}}function Lt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"div",5),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return i.edit(i.value)})("focus",function(){t.CHM(e);const i=t.oxw();return i.edit(i.value)}),t._uU(2),t._UZ(3,"i",6),t.qZA(),t.qZA()}if(2&o){const e=t.oxw();t.xp6(2),t.hij("",e.value,"\xa0")}}let Ft=(()=>{class o{constructor(){this.placeholder="",this.type="text",this.required=!1,this.disabled=!1,this.endEditRequest=new t.vpe,this.editing=!1,this.editValue="",this.preValue="",this.onChange=Function.prototype,this.onTouched=Function.prototype}get value(){return this.editValue}set value(e){e!==this.editValue&&(this.editValue=e,this.onChange(e))}writeValue(e){this.editValue=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}onBlur(e){this.editing=!1,this.preValue!==this.editValue&&this.endEditRequest.emit()}apply(){this.editing=!1,this.endEditRequest.emit()}edit(e){this.disabled||(this.preValue=e,this.editing=!0,setTimeout(()=>{var n;(null===(n=this.inlineEditControl)||void 0===n?void 0:n.nativeElement)&&this.inlineEditControl.nativeElement.focus()}))}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-inline-edit"]],viewQuery:function(e,n){if(1&e&&t.Gf(Yt,5),2&e){let i;t.iGM(i=t.CRH())&&(n.inlineEditControl=i.first)}},inputs:{placeholder:"placeholder",type:"type",required:"required",disabled:"disabled"},outputs:{endEditRequest:"endEditRequest"},features:[t._Bn([{provide:x.JU,useExisting:o,multi:!0}])],decls:2,vars:2,consts:[["class","inline-edit-edit",4,"ngIf"],[4,"ngIf"],[1,"inline-edit-edit"],[3,"required","name","ngModel","type","placeholder","blur","keydown.enter","ngModelChange"],["inlineEditControl",""],["title","Click to edit","tabindex","0",1,"inline-edit",3,"click","focus"],[1,"icon-edit"]],template:function(e,n){1&e&&(t.YNc(0,zt,3,5,"div",0),t.YNc(1,Lt,4,1,"div",1)),2&e&&(t.Q6J("ngIf",n.editing),t.xp6(1),t.Q6J("ngIf",!n.editing))},directives:[b.O5,x.Fj,x.Q7,x.JJ,x.On],styles:[".inline-edit{cursor:pointer}.inline-edit i{font-size:.7em}.inline-edit-edit{width:100%;display:block}.inline-edit-edit input{width:100%}\n"],encapsulation:2}),o})();var Bt=M(4131);function jt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",2),t.NdJ("keydown.enter",function(){const r=t.CHM(e).$implicit;return t.oxw().editArtwork(r.artwork)}),t.TgZ(1,"div",3),t.TgZ(2,"img",4),t.NdJ("clickenter",function(){const r=t.CHM(e).$implicit;return t.oxw().editArtwork(r.artwork)}),t.qZA(),t.TgZ(3,"div",5),t._uU(4),t.qZA(),t.TgZ(5,"div",6),t._uU(6),t.qZA(),t.TgZ(7,"div",7),t._uU(8),t.qZA(),t.TgZ(9,"div",8),t._uU(10),t.ALo(11,"filesize"),t.qZA(),t.qZA(),t.TgZ(12,"div",9),t.TgZ(13,"app-inline-edit",10),t.NdJ("ngModelChange",function(i){return t.CHM(e).$implicit.name=i})("endEditRequest",function(){const r=t.CHM(e).$implicit;return t.oxw().editArtworkName(r)}),t.qZA(),t.TgZ(14,"a",11),t.NdJ("clickenter",function(){const r=t.CHM(e).$implicit;return t.oxw().removeArtwork(r)}),t._UZ(15,"i",12),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=c.$implicit;t.xp6(2),t.Q6J("src",e.thumbnail,t.LSH),t.xp6(2),t.Oqu(e.artwork.types),t.xp6(2),t.Oqu(e.artwork.format),t.xp6(2),t.AsE("",e.artwork.width,"x",e.artwork.height,""),t.xp6(2),t.Oqu(t.lcZ(11,7,e.artwork.size)),t.xp6(3),t.Q6J("ngModel",e.name)}}function Wt(o){const c=o.split(".");return c.pop(),c.join(".")}function $t(o){const c=o.split(".");return c[c.length-1]}let qt=(()=>{class o{constructor(e,n,i,r,_,w){this.app=e,this.jam=n,this.notify=i,this.folderService=r,this.dialogs=_,this.dialogOverlay=w}trackByFn(e,n){return n.artwork.id}ngOnChanges(e){this.displayArtworks()}editArtworkName(e){this.jam.artwork.rename({id:e.artwork.id,newName:e.name}).then(n=>{this.folderService.waitForQueueResult("Renaming Artwork",n,this.folderID?[this.folderID]:[],[])}).catch(n=>{this.notify.error(n)})}editArtwork(e){this.dialogOverlay.open({childComponent:Et,title:"Edit Image",data:{artwork:e,folderID:this.folderID},panelClass:""})}showArtwork(e){const n=e.types.join(", ");this.dialogOverlay.open({title:n,childComponent:wt.$w,data:{name:n,url:this.jam.image.imageUrl({id:e.id})}})}removeArtwork(e){this.dialogs.confirm("Remove Artworks?",`Do you want to delete "${e.artwork.name}"?`,()=>{this.jam.artwork.remove({id:e.artwork.id}).then(n=>{this.nodes&&(this.nodes=this.nodes.filter(i=>i!==e)),this.folderService.waitForQueueResult("Removing Artwork",n,this.folderID?[this.folderID]:[])}).catch(n=>{this.notify.error(n)})})}displayArtworks(){this.nodes=[],this.artworks&&(this.nodes=this.artworks.map(e=>({name:Wt(e.name),type:$t(e.name),artwork:e,thumbnail:this.jam.image.imageUrl({id:e.id,size:128,format:h.GU.webp})})))}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(h.K4),t.Y36(u.c),t.Y36(u.Cr),t.Y36(S.Hr),t.Y36(H.SL))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-artwork-list"]],inputs:{artworks:"artworks",folderID:"folderID"},features:[t.TTD],decls:2,vars:2,consts:[["appFocusKeyList",""],["class","artwork","appFocusKeyListItem","",3,"keydown.enter",4,"ngFor","ngForOf","ngForTrackBy"],["appFocusKeyListItem","",1,"artwork",3,"keydown.enter"],[1,"artwork-img"],["alt","Artwork",3,"src","clickenter"],[1,"mode"],[1,"format"],[1,"dims"],[1,"size"],[1,"artwork-types"],["type","text",3,"ngModel","ngModelChange","endEditRequest"],["title","Delete Image",1,"delete-button",3,"clickenter"],["aria-hidden","true",1,"icon-trash"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,jt,16,9,"div",1),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngForOf",n.nodes)("ngForTrackBy",n.trackByFn))},directives:[O.R,b.sg,A.j,Z.X,Ft,x.JJ,x.On],pipes:[Bt.c],styles:["[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]{display:inline-block;padding-top:15px;padding-right:15px;font-size:.8em;text-align:center;width:200px}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]{position:relative;overflow:hidden}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .dims[_ngcontent-%COMP%], [_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%], [_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .format[_ngcontent-%COMP%], [_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .mode[_ngcontent-%COMP%]{position:absolute;padding:5px;background-color:var(--background-transparent);color:var(--on-background-active)}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .mode[_ngcontent-%COMP%]{top:0;left:0}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .format[_ngcontent-%COMP%]{bottom:0;left:0}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .dims[_ngcontent-%COMP%]{top:0;right:0}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{bottom:0;right:0}[_nghost-%COMP%]   .artwork-types[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;overflow:hidden}[_nghost-%COMP%]   .artwork-types[_ngcontent-%COMP%]   app-inline-edit[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .artwork-types[_ngcontent-%COMP%]   .delete-button[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}"]}),o})();function Gt(o,c){1&o&&t._UZ(0,"app-loading")}function Vt(o,c){1&o&&t._UZ(0,"i",18)}function Xt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"input",19),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().$implicit.checked=i}),t.qZA()}if(2&o){const e=t.oxw().$implicit;t.Q6J("ngModel",e.checked)("checked",e.checked)}}function Kt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",11),t.NdJ("keydown.enter",function(){const r=t.CHM(e).$implicit;return r.checked=!r.checked}),t.TgZ(1,"div",12),t.NdJ("clickenter",function(){const r=t.CHM(e).$implicit;return r.checked=!r.checked}),t._UZ(2,"img",13),t.qZA(),t.TgZ(3,"div",14),t.TgZ(4,"div",15),t.TgZ(5,"label"),t.YNc(6,Vt,1,0,"i",16),t.YNc(7,Xt,1,2,"input",17),t._uU(8),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=c.$implicit;t.xp6(2),t.s9C("alt",e.name),t.Q6J("src",e.thumbnail,t.LSH),t.xp6(4),t.Q6J("ngIf",e.storing),t.xp6(1),t.Q6J("ngIf",!e.storing),t.xp6(1),t.hij(" ",e.name," ")}}function te(o,c){if(1&o&&(t.TgZ(0,"div"),t._UZ(1,"app-background-text-list",8),t.TgZ(2,"div",9),t.YNc(3,Kt,9,5,"div",10),t.qZA(),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("list",e.nodes),t.xp6(2),t.Q6J("ngForOf",e.nodes)("ngForTrackBy",e.trackByFn)}}function ee(o,c){if(1&o&&t._UZ(0,"app-admin-artwork-list",22),2&o){const e=t.oxw(2);t.Q6J("folderID",e.data.folder.id)("artworks",e.artworks)}}function ne(o,c){if(1&o&&(t.TgZ(0,"div",20),t.TgZ(1,"div",2),t._uU(2,"Current Images"),t.qZA(),t.YNc(3,ee,1,2,"app-admin-artwork-list",21),t.qZA()),2&o){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",!e.isArtRefreshing)}}function oe(o,c){1&o&&(t.TgZ(0,"button",25),t._UZ(1,"i",18),t.qZA())}function ie(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).use()}),t._uU(1,"Use Checked Artwork"),t.qZA()}}function re(o,c){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,oe,2,0,"button",23),t.YNc(2,ie,2,0,"button",24),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.isWorking),t.xp6(1),t.Q6J("ngIf",!e.isWorking)}}let ae=(()=>{class o{constructor(e,n,i,r){this.jam=e,this.notify=n,this.folderService=i,this.http=r,this.isWorking=!1,this.isArtRefreshing=!1,this.searchSource={name:"",url:""},this.unsubscribe=new J.xQ}trackByFn(e,n){return n.image}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}ngOnChanges(e){this.search(),this.data&&this.data.folder&&(this.data.folder.artworks?this.artworks=this.data.folder.artworks:this.refreshArtworks())}refreshArtworks(){!this.data||(this.isArtRefreshing=!0,this.jam.artwork.search({folderIDs:[this.data.folder.id]}).then(e=>{this.isArtRefreshing=!1,this.artworks=e.items}).catch(e=>{this.isArtRefreshing=!1,console.error(e)}))}loadWikiDataID(e){var n,i;return(0,I.mG)(this,void 0,void 0,function*(){const r=yield this.jam.metadata.musicbrainzLookup({type:h.ej.artist,mbID:e});if(null===(i=null===(n=null==r?void 0:r.data)||void 0===n?void 0:n.artist)||void 0===i?void 0:i.relations){const _=r.data.artist.relations.find(w=>"wikidata"===w.type);if(null==_?void 0:_.url)return _.url.resource.split("/").pop()}})}loadWikiCommonImage(e){var n,i;return(0,I.mG)(this,void 0,void 0,function*(){const r=yield this.loadWikiDataID(e);if(!r)return;const _=yield this.jam.metadata.wikidataLookup({wikiDataID:r}),w=null===(i=null===(n=null==_?void 0:_.data)||void 0===n?void 0:n.entity)||void 0===i?void 0:i.claims;if(!w)return;const Q=Object.keys(w);for(const Tt of Q){let kt=w[Tt];kt=kt.filter(It=>"string"==typeof It.mainsnak.datavalue.value&&(0,st.U_)(It.mainsnak.datavalue.value.toLowerCase(),["jpg","jpeg","png"]));const Nt=kt[0];if(Nt){const _o=`https://en.wikipedia.org/w/api.php?format=json&action=query&origin=*&titles=File:${Nt.mainsnak.datavalue.value}&prop=imageinfo&iiprop=extmetadata|url&iiextmetadatafilter=LicenseShortName`,vt=yield this.http.get(_o).toPromise();if(vt&&vt.query.pages){const _t=vt.query.pages[Object.keys(vt.query.pages)[0]];if(_t&&_t.imageinfo[0])return{name:h.iJ.artist,thumbnail:_t.imageinfo[0].url,image:_t.imageinfo[0].url,licence:_t.imageinfo[0].extmetadata.LicenseShortName.value,checked:!0,storing:!1,types:[h.iJ.artist]}}}}})}loadWikiCommon(e){this.loadWikiCommonImage(e).then(n=>{this.nodes=[],n&&(n.checked=!0,this.nodes.push(n))}).catch(n=>{this.nodes=[],this.notify.error(n)})}use(){var e;const n=(this.nodes||[]).find(r=>r.checked&&!r.storing),i=null===(e=this.data)||void 0===e?void 0:e.folder;n&&i?(this.isWorking=!0,n.storing=!0,this.jam.artwork.createByUrl({folderID:i.id,url:n.image,types:n.types}).then(r=>{this.folderService.waitForQueueResult("Creating Artwork",r,[i.id]).pipe((0,q.R)(this.unsubscribe)).subscribe(()=>{n.storing=!1,n.checked=!1}),this.use()}).catch(r=>{n.storing=!1,this.notify.error(r)})):this.isWorking=!1}ngOnInit(){this.folderService.foldersChange.pipe((0,q.R)(this.unsubscribe)).subscribe(e=>{var n;e.id===(null===(n=this.data)||void 0===n?void 0:n.folder.id)&&this.refreshArtworks()})}loadReleaseGroupAndRelease(e,n){this.jam.metadata.coverartarchiveLookup({type:h.xB.releaseGroup,mbID:n}).then(i=>{let r=this.coverArtResponseToNodes(i.data);this.jam.metadata.coverartarchiveLookup({type:h.xB.release,mbID:e}).then(_=>{r=r.concat(this.coverArtResponseToNodes(_.data)),this.display(r)}).catch(_=>{this.notify.error(_)})}).catch(i=>{this.notify.error(i)})}loadReleaseGroup(e){this.jam.metadata.coverartarchiveLookup({type:h.xB.releaseGroup,mbID:e}).then(n=>{const i=this.coverArtResponseToNodes(n.data);this.display(i)}).catch(n=>{this.notify.error(n)})}loadRelease(e){e&&this.jam.metadata.coverartarchiveLookup({type:h.xB.release,mbID:e}).then(n=>{const i=this.coverArtResponseToNodes(n.data);this.display(i),0===i.length&&this.data&&this.data.folder&&this.data.folder.tag&&this.data.folder.tag.mbReleaseGroupID&&(this.nodes=void 0,this.loadReleaseGroup(this.data.folder.tag.mbReleaseGroupID))}).catch(n=>{this.notify.error(n)})}coverArtResponseToNodes(e){return e.images?e.images.map(n=>(0===n.types.length&&n.types.push("Other"),{name:(n.types||[]).join("/").toLowerCase(),thumbnail:this.jam.metadata.coverartarchiveImageUrl({url:n.thumbnails.small}),licence:"",image:n.image,types:(n.types||[]).map(i=>i.toLowerCase()),checked:!1,storing:!1,stored:!1})):[]}search(){this.data&&this.data.folder&&this.data.folder.tag&&(this.data.folder.type===h.Sr.artist?this.data.folder.tag.mbArtistID&&(this.searchSource={name:"Wiki Commons",url:"https://commons.wikimedia.org"},this.loadWikiCommon(this.data.folder.tag.mbArtistID)):this.data&&this.data.folder&&this.data.folder.tag&&(this.searchSource={name:"Coverart Archive",url:"https://coverartarchive.org"},this.data.folder.tag.mbReleaseID&&this.data.folder.tag.mbReleaseGroupID?this.loadReleaseGroupAndRelease(this.data.folder.tag.mbReleaseID,this.data.folder.tag.mbReleaseGroupID):this.data.folder.tag.mbReleaseID?this.loadRelease(this.data.folder.tag.mbReleaseID):this.data.folder.tag.mbReleaseGroupID&&this.loadReleaseGroup(this.data.folder.tag.mbReleaseGroupID)))}display(e){this.nodes=e;let n=e.find(i=>1===i.types.length&&i.types[0]===h.iJ.front);n||(n=e.find(i=>i.types.includes(h.iJ.front))),n&&this.nodes.forEach(i=>i.checked=i===n)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(h.K4),t.Y36(u.c),t.Y36(u.Cr),t.Y36(j.eN))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder-artwork-search"]],inputs:{data:"data"},features:[t.TTD],decls:11,vars:6,consts:[[1,"image-selector"],[1,"art-source"],[1,"section"],["rel","noopener","target","_blank",3,"href"],[4,"ngIf"],[1,"artwork"],["class","current",4,"ngIf"],[1,"buttons"],["name","Images",3,"list"],["appFocusKeyList","",1,"images"],["appFocusKeyListItem","",3,"keydown.enter",4,"ngFor","ngForOf","ngForTrackBy"],["appFocusKeyListItem","",3,"keydown.enter"],[1,"image",3,"clickenter"],[3,"alt","src"],[1,"footer"],[1,"footer-content"],["class","icon-spin icon-spinner",4,"ngIf"],["type","checkbox",3,"ngModel","checked","ngModelChange",4,"ngIf"],[1,"icon-spin","icon-spinner"],["type","checkbox",3,"ngModel","checked","ngModelChange"],[1,"current"],[3,"folderID","artworks",4,"ngIf"],[3,"folderID","artworks"],["class","button-on-control",4,"ngIf"],["class","button-on-control",3,"click",4,"ngIf"],[1,"button-on-control"],[1,"button-on-control",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"a",3),t._uU(4),t.qZA(),t.qZA(),t.YNc(5,Gt,1,0,"app-loading",4),t.YNc(6,te,4,3,"div",4),t.qZA(),t.TgZ(7,"div",5),t.YNc(8,ne,4,1,"div",6),t.qZA(),t.qZA(),t.TgZ(9,"div",7),t.YNc(10,re,3,2,"div",4),t.qZA()),2&e&&(t.xp6(3),t.Q6J("href",n.searchSource.url,t.LSH),t.xp6(1),t.Oqu(n.searchSource.name),t.xp6(1),t.Q6J("ngIf",!n.nodes),t.xp6(1),t.Q6J("ngIf",n.nodes),t.xp6(2),t.Q6J("ngIf",n.data&&n.artworks),t.xp6(2),t.Q6J("ngIf",n.nodes&&n.nodes.length>0))},directives:[b.O5,D.N,B.$,O.R,b.sg,A.j,Z.X,x.Wl,x.JJ,x.On,qt],styles:["[_nghost-%COMP%]   .image-selector[_ngcontent-%COMP%]{display:flex;flex-flow:column wrap;height:calc(100% - 40px)}[_nghost-%COMP%]   .image-buttons[_ngcontent-%COMP%]{height:40px}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]{overflow-y:auto;width:50%;height:100%;padding-left:15px}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]{padding-right:15px;overflow-y:auto;width:50%;height:100%;border-right:1px solid var(--background-border)}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{display:inline-block;padding-top:15px;padding-right:15px;font-size:.8em}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:185px;min-width:185px;min-height:185px;height:auto}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{font-size:.8em}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]{border-bottom:1px solid var(--background-border);padding-bottom:5px}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-active)}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}"]}),o})(),Ut=(()=>{class o{dialogInit(e,n){this.data=n.data}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-folder-artwork-search"]],decls:1,vars:1,consts:[[3,"data"]],template:function(e,n){1&e&&t._UZ(0,"app-admin-folder-artwork-search",0),2&e&&t.Q6J("data",n.data)},directives:[ae],styles:[""]}),o})();function se(o,c){1&o&&(t.TgZ(0,"div",1),t.TgZ(1,"div",2),t._UZ(2,"i",3),t.qZA(),t.qZA())}function ce(o,c){1&o&&(t.TgZ(0,"div",2),t._uU(1,"No Hints"),t.qZA())}function le(o,c){if(1&o&&(t.TgZ(0,"div",10),t._uU(1),t.qZA()),2&o){const e=c.$implicit;t.xp6(1),t.Oqu(e)}}function de(o,c){if(1&o&&(t.TgZ(0,"div",2),t._UZ(1,"i",8),t._uU(2),t.YNc(3,le,2,1,"div",9),t.qZA()),2&o){const e=c.$implicit;t.xp6(2),t.hij(" ",e.hint.name," "),t.xp6(1),t.Q6J("ngForOf",e.details)}}function ge(o,c){1&o&&t._UZ(0,"i",3)}function pe(o,c){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.name)}}function he(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){return t.CHM(e).$implicit.click()}),t.YNc(1,ge,1,0,"i",12),t.YNc(2,pe,2,1,"ng-container",13),t.qZA()}if(2&o){const e=c.$implicit;t.xp6(1),t.Q6J("ngIf",e.running),t.xp6(1),t.Q6J("ngIf",!e.running)}}function _e(o,c){if(1&o&&(t.TgZ(0,"div",1),t.YNc(1,ce,2,0,"div",4),t.YNc(2,de,4,2,"div",5),t.TgZ(3,"div",6),t.YNc(4,he,3,2,"button",7),t.qZA(),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",0===e.hints.length),t.xp6(1),t.Q6J("ngForOf",e.hints)("ngForTrackBy",e.trackByFn),t.xp6(2),t.Q6J("ngForOf",e.solutions)}}let ue=(()=>{class o{constructor(e,n,i,r,_,w){this.app=e,this.router=n,this.jam=i,this.notify=r,this.dialogOverlay=_,this.folderService=w,this.solutions=[],this.unsubscribe=new J.xQ}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}trackByFn(e,n){return n.hint.id}searchImages(e){this.dialogOverlay.open({title:"Search Artwork Images",childComponent:Ut,data:{folder:e},panelClass:"overlay-panel-large-buttons"})}ngOnChanges(){this.display(this.folderHealth)}static describeImageInvalidHint(e,n){if(!e.details||0===e.details.length)return[];const i=[e.details[0].reason];return e.details[0].expected&&i.push(`Expected: ${e.details[0].expected} Actual: ${e.details[0].actual}`),i}static describeAlbumTracksMissingHint(e,n){if(!e.details||0===e.details.length)return[];const i=[];return e.details[0].expected&&i.push(`Expected: ${e.details[0].expected} Actual: ${e.details[0].actual}`),i}describeImageQualityHint(e,n){if(this.addAlbumImageSearchSolution(n),!e.details||0===e.details.length)return[];const i=[e.details[0].reason];return i.push(`Expected: ${e.details[0].expected} Actual: ${e.details[0].actual}`),i}addArtistImageSearchSolution(e){e.tag&&e.tag.mbArtistID&&this.solutions.push({name:"Search",click:()=>(0,I.mG)(this,void 0,void 0,function*(){this.searchImages(e)})})}addAlbumImageSearchSolution(e){e.tag&&(e.tag.mbReleaseID||e.tag.mbReleaseGroupID)&&this.solutions.push({name:"Search",click:()=>(0,I.mG)(this,void 0,void 0,function*(){this.searchImages(e)})})}addRenameSolution(e,n){if(!this.solutions.find(i=>"Rename"===i.name)){const i={name:"Rename",click:()=>(0,I.mG)(this,void 0,void 0,function*(){if(i.running)return;i.running=!0;const r=yield this.jam.folder.rename({id:e.id,name:n});this.folderService.waitForQueueResult("Renaming Folder",r,[e.id]).pipe((0,q.R)(this.unsubscribe)).subscribe(()=>{i.running=!1})})};this.solutions.push(i)}}addEditTagSolution(e){this.solutions.find(n=>"Edit Tags"===n.name)||this.solutions.push({name:"Edit Tags",click:()=>(0,I.mG)(this,void 0,void 0,function*(){this.router.navigate([`/admin/folder/${e.id}/tags`]).catch(i=>{console.error(i)})})})}describeMBIDMissingHint(e,n){return this.addEditTagSolution(n),[]}describeAlbumTagMissingHint(e,n){return this.addEditTagSolution(n),e.details?[`Expected: ${e.details.map(i=>i.expected).join(",")}`]:[]}describeNameNonConformHint(e,n){const i=e.details&&e.details.length>0?e.details[0].expected:"";return i?(this.addRenameSolution(n,i),[`Current: ${n.name}`,`Suggested Name: ${i}`]):[]}describeArtistImageMissingHint(e,n){return this.addArtistImageSearchSolution(n),[]}describeAlbumImageMissingHint(e,n){return this.addAlbumImageSearchSolution(n),[]}describeHint(e,n){switch(e.id){case h.Mx.albumMBIDExists:return this.describeMBIDMissingHint(e,n);case h.Mx.albumTagsExists:return this.describeAlbumTagMissingHint(e,n);case h.Mx.albumNameConform:case h.Mx.artistNameConform:return this.describeNameNonConformHint(e,n);case h.Mx.albumImageExists:return this.describeAlbumImageMissingHint(e,n);case h.Mx.albumTracksComplete:return o.describeAlbumTracksMissingHint(e,n);case h.Mx.artistImageExists:return this.describeArtistImageMissingHint(e,n);case h.Mx.artistImageValid:case h.Mx.albumImageValid:return o.describeImageInvalidHint(e,n);case h.Mx.albumImageQuality:return this.describeImageQualityHint(e,n)}return[]}display(e){this.hints=[],this.solutions=[],(null==e?void 0:e.health)&&(this.hints=e.health.map(n=>({hint:n,details:this.describeHint(n,e.folder)})))}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(y.F0),t.Y36(h.K4),t.Y36(u.c),t.Y36(H.SL),t.Y36(u.Cr))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-folder-health"]],inputs:{folderHealth:"folderHealth"},features:[t.TTD],decls:2,vars:2,consts:[["class","hints",4,"ngIf"],[1,"hints"],[1,"hint"],[1,"icon-spin","icon-spinner"],["class","hint",4,"ngIf"],["class","hint",4,"ngFor","ngForOf","ngForTrackBy"],[1,"solutions"],["class","button-on-background",3,"click",4,"ngFor","ngForOf"],[1,"icon-warning"],["class","details",4,"ngFor","ngForOf"],[1,"details"],[1,"button-on-background",3,"click"],["class","icon-spin icon-spinner",4,"ngIf"],[4,"ngIf"]],template:function(e,n){1&e&&(t.YNc(0,se,3,0,"div",0),t.YNc(1,_e,5,4,"div",0)),2&e&&(t.Q6J("ngIf",!n.hints),t.xp6(1),t.Q6J("ngIf",n.hints))},directives:[b.O5,b.sg],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .icon-warning[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]{padding-left:28px;font-size:.8em;text-transform:uppercase;min-width:30%;display:inline-block}[_nghost-%COMP%]   .hints[_ngcontent-%COMP%]{padding-top:10px}[_nghost-%COMP%]   .hint[_ngcontent-%COMP%]{padding-bottom:10px}"]}),o})();function me(o,c){if(1&o&&(t.TgZ(0,"option",11),t._uU(1),t.qZA()),2&o){const e=c.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function fe(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"select",9),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().filter=i})("ngModelChange",function(){return t.CHM(e),t.oxw().onFilterChange()}),t.YNc(1,me,2,2,"option",10),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("ngModel",e.filter),t.xp6(1),t.Q6J("ngForOf",e.modes)}}function Ce(o,c){1&o&&t._UZ(0,"app-loading")}function xe(o,c){if(1&o&&(t.ynx(0),t.TgZ(1,"div",20),t._uU(2,"Album"),t.qZA(),t.TgZ(3,"div",21),t._uU(4),t.qZA(),t.TgZ(5,"div",22),t._uU(6),t.qZA(),t.TgZ(7,"div",23),t._uU(8),t.qZA(),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(4),t.Oqu(null==e.folder.tag?null:e.folder.tag.album),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.artist),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.year)}}function Me(o,c){if(1&o&&(t.ynx(0),t.TgZ(1,"div",20),t._uU(2,"Album"),t.qZA(),t.TgZ(3,"div",21),t._uU(4),t.qZA(),t.TgZ(5,"div",22),t._uU(6),t.qZA(),t.TgZ(7,"div",23),t._uU(8),t.qZA(),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(4),t.Oqu(null==e.folder.tag?null:e.folder.tag.album),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.artist),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.year)}}function ve(o,c){if(1&o&&(t.ynx(0),t.TgZ(1,"div",20),t._uU(2,"Artist"),t.qZA(),t.TgZ(3,"div",21),t._uU(4),t.qZA(),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(4),t.Oqu(null==e.folder.tag?null:e.folder.tag.artist)}}function Oe(o,c){if(1&o&&(t.ynx(0),t.TgZ(1,"div",20),t._uU(2,"Collection"),t.qZA(),t.TgZ(3,"div",21),t._uU(4),t.qZA(),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(4),t.Oqu(e.folder.name)}}function be(o,c){if(1&o&&(t.ynx(0),t.TgZ(1,"div",21),t._uU(2),t.qZA(),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(2),t.Oqu(e.folder.name)}}const Ae=function(o){return["/admin/folder",o,"overview"]};function we(o,c){if(1&o&&(t.TgZ(0,"div",12),t.TgZ(1,"div",13),t.TgZ(2,"a",14),t.ynx(3,15),t.YNc(4,xe,9,3,"ng-container",16),t.YNc(5,Me,9,3,"ng-container",16),t.YNc(6,ve,5,1,"ng-container",16),t.YNc(7,Oe,5,1,"ng-container",16),t.YNc(8,be,3,1,"ng-container",17),t.BQk(),t.qZA(),t.qZA(),t.TgZ(9,"div",18),t._UZ(10,"app-folder-health",19),t.qZA(),t.qZA()),2&o){const e=c.$implicit;t.xp6(2),t.Q6J("routerLink",t.VKq(7,Ae,e.folder.id)),t.xp6(1),t.Q6J("ngSwitch",e.folder.type),t.xp6(1),t.Q6J("ngSwitchCase","multialbum"),t.xp6(1),t.Q6J("ngSwitchCase","album"),t.xp6(1),t.Q6J("ngSwitchCase","artist"),t.xp6(1),t.Q6J("ngSwitchCase","collection"),t.xp6(3),t.Q6J("folderHealth",e)}}let ye=(()=>{class o extends P{constructor(e,n,i,r,_){super(e),this.app=n,this.jam=i,this.notify=r,this.folderService=_,this.modes=[]}onFilterChange(){this.reDisplay()}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,q.R)(this.unsubscribe)).subscribe(e=>{if(e.id===this.id)this.refresh();else if(this.all){const n=this.all.find(i=>i.folder.id===e.id);n&&this.jam.folder.health({ids:[e.id],folderIncTag:!0}).then(i=>{if(this.all){const r=i.find(_=>_.folder.id===n.folder.id);r?this.all[this.all.indexOf(n)]=r:this.all=this.all.filter(_=>_.folder.id!==n.folder.id)}this.reDisplay()}).catch(i=>{this.notify.error(i)})}})}ngOnDestroy(){super.ngOnDestroy()}refresh(){this.hints=void 0,this.jam.folder.health({childOfID:this.id,folderIncTag:!0}).then(e=>{this.display(e)}).catch(e=>{this.notify.error(e)})}reDisplay(){this.hints=this.filter&&this.all?this.all.filter(e=>e.health&&e.health.find(n=>n.name===this.filter)):this.all}display(e){this.all=e,this.modes=[];for(const n of e)if(n.health)for(const i of n.health)this.modes.includes(i.name)||this.modes.push(i.name);this.reDisplay()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(y.gz),t.Y36(u.zi),t.Y36(h.K4),t.Y36(u.c),t.Y36(u.Cr))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder-health"]],features:[t.qOj],decls:9,vars:4,consts:[[1,"health"],[1,"actions"],["title","Refresh List",1,"button-on-control",3,"click"],[1,"icon-reload"],["placeholder","Type of Hints",3,"ngModel","ngModelChange",4,"ngIf"],[1,"health-content"],[4,"ngIf"],["name","Folder Health Issues",3,"list"],["class","folder",4,"ngFor","ngForOf"],["placeholder","Type of Hints",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"folder"],[1,"meta"],[3,"routerLink"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"folder-health"],[3,"folderHealth"],[1,"type"],[1,"name"],[1,"artist"],[1,"year"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"button",2),t.NdJ("click",function(){return n.refresh()}),t._UZ(3,"i",3),t.qZA(),t.YNc(4,fe,2,2,"select",4),t.qZA(),t.TgZ(5,"div",5),t.YNc(6,Ce,1,0,"app-loading",6),t._UZ(7,"app-background-text-list",7),t.YNc(8,we,11,9,"div",8),t.qZA(),t.qZA()),2&e&&(t.xp6(4),t.Q6J("ngIf",n.modes.length>0),t.xp6(2),t.Q6J("ngIf",!n.hints),t.xp6(1),t.Q6J("list",n.hints),t.xp6(1),t.Q6J("ngForOf",n.hints))},directives:[b.O5,B.$,b.sg,x.EJ,x.JJ,x.On,x.YN,x.Kr,D.N,y.yS,b.RF,b.n9,b.ED,ue],styles:["[_nghost-%COMP%]{height:100%;width:100%}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .health-content[_ngcontent-%COMP%]{padding:15px;overflow-y:auto;overflow-x:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]{border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:var(--background-border);padding:15px;display:flex;flex-flow:row wrap;flex-flow:row nowrap}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{width:30%;padding-right:15px;margin-left:15px;display:flex;flex-flow:column wrap;position:relative}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;text-overflow:ellipsis;overflow:hidden}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%]{text-transform:uppercase}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .year[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .state[_ngcontent-%COMP%]{letter-spacing:1px;font-size:.8em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:24px;font-weight:100;color:var(--on-background-active)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-active)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:14px;line-height:1.2em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:5px;margin-right:5px;height:27px;font-weight:500;padding:1px 15px 0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transform:scale(1.3);transform-origin:center}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;border:1px solid transparent;padding:4px 9px 7px;border-radius:50%;display:none;position:absolute;right:1px;bottom:0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:var(--control-hover);color:var(--on-background-hover)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]:hover   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]:hover   app-fav-icon[_ngcontent-%COMP%]{display:inline}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .folder-health[_ngcontent-%COMP%]{display:flex;width:70%}@media (max-width: 400px){[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]{padding-left:0;padding-right:0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-size:.8em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:16px}}"]}),o})();var Ze=M(2950);function Pe(o,c){if(1&o&&(t.TgZ(0,"div"),t.TgZ(1,"div"),t._uU(2),t.ALo(3,"stringToggle"),t.qZA(),t._UZ(4,"app-loading"),t.qZA()),2&o){const e=t.oxw();t.xp6(2),t.Oqu(t.Dn7(3,1,e.isUploading,"Uploading","Creating Artwork"))}}function Te(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",2),t.NdJ("drop",function(i){return t.CHM(e),t.oxw().onDropFile(i)})("dragover",function(i){return t.CHM(e),t.oxw().onDragOverFile(i)}),t.TgZ(1,"form"),t.TgZ(2,"input",3),t.NdJ("change",function(i){return t.CHM(e),t.oxw().selectFile(i)}),t.qZA(),t.qZA(),t.qZA()}}let ke=(()=>{class o{constructor(e,n,i){this.jam=e,this.notify=n,this.folderService=i,this.isIdle=!0,this.isUploading=!1,this.unsubscribe=new J.xQ}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}dialogInit(e,n){var i;this.reference=e,this.folder=null===(i=n.data)||void 0===i?void 0:i.folder}waitForCreationEnd(e){if(!this.folder)return;const n=this.folder.id;this.folderService.waitForQueueResult("Creating Artwork",e,[]).pipe((0,q.R)(this.unsubscribe)).subscribe(i=>{this.isIdle=!0,this.folderService.notifyFolderChange(n,u.dw.fsnRefresh),e.error||(this.notify.success("Upload done"),this.reference&&this.reference.close())})}onDropFile(e){var n;e.preventDefault(),this.uploadFile(null===(n=e.dataTransfer)||void 0===n?void 0:n.files)}onDragOverFile(e){e.stopPropagation(),e.preventDefault()}selectFile(e){this.uploadFile(e.target.files)}uploadFile(e){if(!e||0===e.length||!this.folder)return;const n=e[0];this.isIdle=!1,this.isUploading=!0,this.jam.artwork.createByUpload({folderID:this.folder.id,types:[]},n).pipe((0,q.R)(this.unsubscribe)).subscribe(i=>{if(i.type!==j.dt.UploadProgress&&i instanceof j.Zn){const r=i.body;r&&this.waitForCreationEnd(r)}},i=>{this.isUploading=!1,this.isIdle=!0,this.notify.error(i)},()=>{this.isUploading=!1})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(h.K4),t.Y36(u.c),t.Y36(u.Cr))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-upload-image"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","drop-zone",3,"drop","dragover",4,"ngIf"],[1,"drop-zone",3,"drop","dragover"],["type","file","placeholder","Upload image","accept",".png,.jpeg,.jpg",3,"change"]],template:function(e,n){1&e&&(t.YNc(0,Pe,5,5,"div",0),t.YNc(1,Te,3,0,"div",1)),2&e&&(t.Q6J("ngIf",!n.isIdle),t.xp6(1),t.Q6J("ngIf",n.isIdle))},directives:[b.O5,D.N,x._Y,x.JL,x.F],pipes:[k.C],styles:["[_nghost-%COMP%]   .drop-zone[_ngcontent-%COMP%]{margin:10px 20px;border-width:2px;border-style:dotted;border-color:var(--secondary);height:80%}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}"]}),o})();var Ie=M(6061);function Fe(o,c){1&o&&t._UZ(0,"app-loading")}function qe(o,c){if(1&o&&t._UZ(0,"app-info-note",21),2&o){const e=t.oxw(2);t.Q6J("info",e.folder.info)}}function Ue(o,c){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=t.oxw(2);t.xp6(1),t.hij(" / ",null==e.folder.tag?null:e.folder.tag.albumType,"")}}function Se(o,c){if(1&o&&(t.TgZ(0,"div"),t.TgZ(1,"div",13),t._uU(2,"Artist"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.qZA(),t.qZA()),2&o){const e=t.oxw(2);t.xp6(4),t.Oqu(null==e.folder.tag?null:e.folder.tag.artist)}}function Re(o,c){if(1&o&&(t.TgZ(0,"div"),t.TgZ(1,"div",13),t._uU(2,"Album"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.qZA(),t.qZA()),2&o){const e=t.oxw(2);t.xp6(4),t.Oqu(null==e.folder.tag?null:e.folder.tag.album)}}function He(o,c){if(1&o&&(t.TgZ(0,"div"),t.TgZ(1,"div",13),t._uU(2,"Year"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.qZA(),t.qZA()),2&o){const e=t.oxw(2);t.xp6(4),t.hij(" ",null==e.folder.tag?null:e.folder.tag.year,"")}}function Je(o,c){if(1&o&&(t.TgZ(0,"div"),t.TgZ(1,"div",13),t._uU(2,"Genres"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.qZA(),t.qZA()),2&o){const e=t.oxw(2);t.xp6(4),t.hij(" ",null==e.folder.tag?null:e.folder.tag.genres,"")}}function Qe(o,c){if(1&o&&(t.TgZ(0,"div"),t.TgZ(1,"div",13),t._uU(2,"MB Release Id"),t.qZA(),t.TgZ(3,"div"),t.TgZ(4,"a",22),t._uU(5),t.qZA(),t.qZA(),t.qZA()),2&o){const e=t.oxw(2);t.xp6(4),t.MGl("href","https://musicbrainz.org/release/",null==e.folder.tag?null:e.folder.tag.mbReleaseID,"",t.LSH),t.xp6(1),t.Oqu(null==e.folder.tag?null:e.folder.tag.mbReleaseID)}}function De(o,c){if(1&o&&(t.TgZ(0,"div"),t.TgZ(1,"div",13),t._uU(2,"MB Artist Id"),t.qZA(),t.TgZ(3,"div"),t.TgZ(4,"a",22),t._uU(5),t.qZA(),t.qZA(),t.qZA()),2&o){const e=t.oxw(2);t.xp6(4),t.MGl("href","https://musicbrainz.org/artist/",null==e.folder.tag?null:e.folder.tag.mbArtistID,"",t.LSH),t.xp6(1),t.Oqu(null==e.folder.tag?null:e.folder.tag.mbArtistID)}}const Ne=function(o){return["/admin/folder",o]};function Ee(o,c){if(1&o&&(t.TgZ(0,"div"),t.TgZ(1,"div",13),t._uU(2,"Parent Folder Id"),t.qZA(),t.TgZ(3,"div"),t.TgZ(4,"a",23),t._uU(5),t.qZA(),t.qZA(),t.qZA()),2&o){const e=t.oxw(2);t.xp6(4),t.Q6J("routerLink",t.VKq(2,Ne,e.folder.parentID)),t.xp6(1),t.Oqu(e.folder.parentID)}}function Ye(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",24),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).searchImages()}),t._UZ(1,"i",25),t._uU(2," Search Artwork "),t.qZA()}}function ze(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).searchImages()}),t._UZ(1,"i",25),t._uU(2," Search Art"),t.qZA()}}function Le(o,c){if(1&o&&(t.TgZ(0,"div",27),t._UZ(1,"app-admin-artwork-list",28),t.qZA()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("folderID",e.folder.id)("artworks",e.folder.artworks)}}function Be(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",2),t.TgZ(1,"div",3),t.TgZ(2,"button",4),t.NdJ("click",function(){return t.CHM(e),t.oxw().refresh()}),t._UZ(3,"i",5),t.qZA(),t.TgZ(4,"button",6),t.NdJ("click",function(){return t.CHM(e),t.oxw().moveFolder()}),t._UZ(5,"i",7),t.qZA(),t.TgZ(6,"button",8),t.NdJ("click",function(){return t.CHM(e),t.oxw().removeFolder()}),t._UZ(7,"i",9),t.qZA(),t.qZA(),t.TgZ(8,"div",10),t.YNc(9,qe,1,1,"app-info-note",11),t.TgZ(10,"div",12),t.TgZ(11,"div"),t.TgZ(12,"div"),t.TgZ(13,"div",13),t._uU(14,"Name"),t.qZA(),t.TgZ(15,"div"),t.TgZ(16,"app-inline-edit",14),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().name=i})("endEditRequest",function(){return t.CHM(e),t.oxw().editFolderName()}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(17,"div"),t.TgZ(18,"div",13),t._uU(19,"Type"),t.qZA(),t.TgZ(20,"div"),t._uU(21),t.YNc(22,Ue,2,1,"ng-container",0),t.qZA(),t.qZA(),t.TgZ(23,"div"),t.TgZ(24,"div",13),t._uU(25,"Track Count"),t.qZA(),t.TgZ(26,"div"),t._uU(27),t.qZA(),t.qZA(),t.TgZ(28,"div"),t.TgZ(29,"div",13),t._uU(30,"Folder Count"),t.qZA(),t.TgZ(31,"div"),t._uU(32),t.qZA(),t.qZA(),t.YNc(33,Se,5,1,"div",0),t.YNc(34,Re,5,1,"div",0),t.qZA(),t.TgZ(35,"div"),t.YNc(36,He,5,1,"div",0),t.YNc(37,Je,5,1,"div",0),t.YNc(38,Qe,6,2,"div",0),t.YNc(39,De,6,2,"div",0),t.YNc(40,Ee,6,4,"div",0),t.qZA(),t.qZA(),t.TgZ(41,"div",15),t.TgZ(42,"div",3),t.TgZ(43,"button",16),t.NdJ("click",function(){return t.CHM(e),t.oxw().uploadImage()}),t._UZ(44,"i",17),t._uU(45," Upload Artwork"),t.qZA(),t.YNc(46,Ye,3,0,"button",18),t.YNc(47,ze,3,0,"button",19),t.qZA(),t.YNc(48,Le,2,2,"div",20),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=t.oxw();t.xp6(9),t.Q6J("ngIf",null==e.folder.info?null:e.folder.info.description),t.xp6(7),t.Q6J("ngModel",e.name),t.xp6(5),t.hij("",e.folder.type," "),t.xp6(1),t.Q6J("ngIf",e.isAlbum),t.xp6(5),t.Oqu(e.folder.trackCount),t.xp6(5),t.Oqu(e.folder.folderCount),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.artist),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.album),t.xp6(2),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.year),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag||null==e.folder.tag.genres?null:e.folder.tag.genres.length),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.mbReleaseID),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.mbArtistID),t.xp6(1),t.Q6J("ngIf",e.folder.parentID),t.xp6(6),t.Q6J("ngIf",e.isAlbum&&e.folder.tag&&(e.folder.tag.mbReleaseID||e.folder.tag.mbReleaseGroupID)),t.xp6(1),t.Q6J("ngIf",e.isArtist&&e.folder.tag&&e.folder.tag.mbArtistID),t.xp6(1),t.Q6J("ngIf",e.folder.artworks&&e.folder.artworks.length>0)}}let je=(()=>{class o extends P{constructor(e,n,i,r,_,w,Q,Tt){super(e),this.app=n,this.jam=i,this.notify=r,this.dialogsService=_,this.dialogOverlay=w,this.folderService=Q,this.router=Tt,this.name="",this.isAlbum=!1,this.isArtist=!1}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,q.R)(this.unsubscribe)).subscribe(e=>{e.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}editFolderName(){if(!this.folder)return;const e=(this.name||"").trim();if(0===e.length||e===this.folder.name)return void(this.name=this.folder.name);const n=this.folder.id;this.jam.folder.rename({id:n,name:e}).then(i=>{this.folderService.waitForQueueResult("Renaming Folder",i,[n])}).catch(i=>{this.notify.error(i)})}refresh(){this.id&&this.jam.folder.id({id:this.id,folderIncTag:!0,folderIncParents:!0,folderIncArtworks:!0,folderIncChildFolderCount:!0,folderIncTrackCount:!0}).then(e=>{this.display(e)}).catch(e=>{404===e.code?this.router.navigate(["/admin/folder/"]).catch(n=>{console.error(n)}):this.notify.error(e)})}uploadImage(){this.dialogOverlay.open({title:"Upload Folder Images",childComponent:ke,data:{folder:this.folder},panelClass:"overlay-panel-large-buttons"})}searchImages(){this.dialogOverlay.open({title:"Search Artwork Images",childComponent:Ut,data:{folder:this.folder},panelClass:"overlay-panel-large-buttons"})}removeFolder(){const e=this.folder;!e||this.dialogsService.confirm("Remove Folder?",`Sure to remove Folder "${e.name}"?`,()=>{this.jam.folder.remove({id:e.id}).then(n=>{e.parentID&&this.router.navigate([`/admin/folder/${e.parentID}/overview`]).catch(i=>{console.error(i)}),this.folderService.waitForQueueResult("Removing Folder",n,[e.id],e.parentID?[e.parentID]:[])}).catch(n=>{this.notify.error(n)})})}moveFolder(){const e=this.folder;if(!e)return;const n={selectID:e.id,disableIDs:[e.id]};this.dialogOverlay.open({title:"Move Folder to",childComponent:T,data:n,panelClass:"overlay-panel-large-buttons",onOkBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){const i=n.folder;if(i)try{this.jam.folder.move({ids:[e.id],newParentID:i.id}).then(r=>{this.folderService.waitForQueueResult("Moving Folder",r,[e.id],(e.parentID?[e.parentID]:[]).concat([i.id]))}).catch(r=>{this.notify.error(r)})}catch(r){return this.notify.error(r),Promise.reject(r)}}),onCancelBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){return Promise.resolve()})})}display(e){this.name="",this.isAlbum=!1,this.isArtist=!1,this.folder=e,e&&(this.name=e.name,this.isAlbum=Ze.Dz.includes(e.type),this.isArtist=e.type===h.Sr.artist)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(y.gz),t.Y36(u.zi),t.Y36(h.K4),t.Y36(u.c),t.Y36(S.Hr),t.Y36(H.SL),t.Y36(u.Cr),t.Y36(y.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder"]],features:[t.qOj],decls:2,vars:2,consts:[[4,"ngIf"],["class","folder",4,"ngIf"],[1,"folder"],[1,"actions"],["title","Refresh",1,"button-on-control",3,"click"],[1,"icon-reload"],["title","Move Folder\u2026",1,"button-on-control",3,"click"],[1,"icon-right-bold"],["title","Remove Folder\u2026",1,"button-on-control",3,"click"],[1,"icon-trash"],[1,"content"],[3,"info",4,"ngIf"],[1,"properties"],[1,"label"],["type","text",3,"ngModel","ngModelChange","endEditRequest"],[1,"artworks"],[1,"button-on-control",3,"click"],[1,"icon-upload-cloud"],["class","button-on-control","title","Album Images",3,"click",4,"ngIf"],["class","button-on-control","title","Artist Images",3,"click",4,"ngIf"],["class","artworks-content",4,"ngIf"],[3,"info"],["target","_blank","rel","noopener",3,"href"],[3,"routerLink"],["title","Album Images",1,"button-on-control",3,"click"],[1,"icon-picture"],["title","Artist Images",1,"button-on-control",3,"click"],[1,"artworks-content"],[3,"folderID","artworks"]],template:function(e,n){1&e&&(t.YNc(0,Fe,1,0,"app-loading",0),t.YNc(1,Be,49,16,"div",1)),2&e&&(t.Q6J("ngIf",!n.folder),t.xp6(1),t.Q6J("ngIf",n.folder))},directives:[b.O5,D.N,Ft,x.JJ,x.On,Ie.a,y.yS,qt],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow:hidden;display:block}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{overflow-y:auto;display:flex;flex-direction:column}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%]{width:100%;display:flex;flex-wrap:wrap;flex-direction:row;padding:15px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:0 0 50%}@media (max-width: 522px){[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:0 0 100%}}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding-top:5px;padding-bottom:5px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{color:var(--on-background-active)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-active)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--on-background);font-size:.7em;text-transform:uppercase;padding-bottom:2px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .artworks[_ngcontent-%COMP%]{border-top:1px solid var(--background-border)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .artworks[_ngcontent-%COMP%]   .artworks-content[_ngcontent-%COMP%]{padding:0 15px 15px}"]}),o})();function We(o,c){1&o&&(t.TgZ(0,"div",2),t.TgZ(1,"div",3),t._UZ(2,"i",4),t.qZA(),t.qZA())}function $e(o,c){1&o&&(t.TgZ(0,"div",3),t._uU(1,"No Hints"),t.qZA())}function Ge(o,c){if(1&o&&(t.TgZ(0,"div",3),t._UZ(1,"i",9),t._uU(2),t.TgZ(3,"div",10),t._uU(4),t.qZA(),t.qZA()),2&o){const e=c.$implicit;t.xp6(2),t.hij(" ",e.hint.name," "),t.xp6(2),t.Oqu(e.description)}}function Ve(o,c){1&o&&t._UZ(0,"i",4)}function Xe(o,c){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.name)}}function Ke(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){return t.CHM(e).$implicit.click()}),t.YNc(1,Ve,1,0,"i",12),t.YNc(2,Xe,2,1,"ng-container",0),t.qZA()}if(2&o){const e=c.$implicit;t.xp6(1),t.Q6J("ngIf",e.running),t.xp6(1),t.Q6J("ngIf",!e.running)}}function tn(o,c){if(1&o&&(t.TgZ(0,"div",2),t.YNc(1,$e,2,0,"div",5),t.YNc(2,Ge,5,2,"div",6),t.TgZ(3,"div",7),t.YNc(4,Ke,3,2,"button",8),t.qZA(),t.qZA()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",0===e.hints.length),t.xp6(1),t.Q6J("ngForOf",e.hints)("ngForTrackBy",e.trackByFn),t.xp6(2),t.Q6J("ngForOf",e.solutions)}}function en(o,c){if(1&o&&(t.ynx(0),t.YNc(1,We,3,0,"div",1),t.YNc(2,tn,5,4,"div",1),t.BQk()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!(e.trackHealth.health&&e.hints)),t.xp6(1),t.Q6J("ngIf",e.trackHealth.health&&e.hints)}}let Zt=(()=>{class o{constructor(e,n,i,r,_){this.app=e,this.jam=n,this.notify=i,this.folderService=r,this.router=_,this.solutions=[],this.resolvedEvent=new t.vpe,this.unsubscribe=new J.xQ}trackByFn(e,n){return n.hint.id}ngOnChanges(e){this.display(this.trackHealth)}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}ngOnInit(){this.folderService.tracksChange.pipe((0,q.R)(this.unsubscribe)).subscribe(e=>{const n=this.trackHealth;n&&n.track.id===e.id&&(n.health=[],this.jam.track.health({ids:[n.track.id],healthMedia:!0}).then(i=>{const r=i.find(_=>_.track.id===n.track.id);r&&r.health?(n.track=r.track,n.health=r.health):n.health=[],0===n.health.length&&this.resolvedEvent.emit(),this.display(n)}).catch(i=>{this.notify.error(i)}))})}fixAll(){for(const e of this.solutions)e.fixable&&!e.running&&e.click&&e.click()}display(e){this.hints=[],this.solutions=[],(null==e?void 0:e.health)&&(this.hints=e.health.map(n=>({hint:n,description:this.describeHint(n,e.track)})))}describeTagHint(e,n){let i="";return e.id===h.U.tagValuesExists?i=(e.details||[]).map(r=>r.reason.toUpperCase()).join(", "):e.id===h.U.id3v2Garbage?i=(e.details||[]).map(r=>r.reason).join(", "):e.id===h.U.id3v2Valid&&(i=(e.details||[]).map(r=>r.expected&&r.actual?`${r.reason}  (${r.actual} instead of ${r.expected})`:r.reason).join(", ")),this.solutions.find(r=>"Edit Tag"===r.name)||this.solutions.push({name:"Edit Tag",click:()=>{this.router.navigate([`/admin/folder/${n.parentID}/tags`]).catch(_=>{console.error(_)})}}),i}describeMp3GarbageHint(e,n){let i="";if(e.details&&e.details.length>0&&(i=`${e.details[0].reason} (${e.details[0].actual} bytes)`),!this.solutions.find(r=>"Fix MP3"===r.name)){const r={name:"Fix MP3",fixable:!0,click:()=>{r.running||(r.running=!0,this.jam.track.fix({id:n.id,fixID:e.id}).then(_=>{this.folderService.waitForQueueResult("Fixing Track MP3",_,[],[],[n.id])}).catch(_=>{this.notify.error(_)}))}};this.solutions.push(r)}return i}describeMp3ErrorHint(e,n){const i=`Stream Errors: ${(e.details||[]).length}`;if(!this.solutions.find(r=>"Fix Stream"===r.name)){const r={name:"Fix Stream",fixable:!0,click:()=>{r.running||(r.running=!0,this.jam.track.fix({id:n.id,fixID:e.id}).then(_=>{this.folderService.waitForQueueResult("Fixing Track Stream",_,[],[],[n.id])}).catch(_=>{this.notify.error(_)}))}};this.solutions.push(r)}return i}describeID3v1Hint(e,n){if(!this.solutions.find(i=>"Remove ID3v1"===i.name)){const i={name:"Remove ID3v1",fixable:!0,click:()=>{i.running||(i.running=!0,this.jam.track.fix({id:n.id,fixID:e.id}).then(r=>{this.folderService.waitForQueueResult("Remove ID3v1",r,[],[],[n.id])}).catch(r=>{this.notify.error(r)}))}};this.solutions.push(i)}return""}describeMP3HeaderHint(e,n){let i="";if(e.id===h.U.mp3HeaderValid&&(i=(e.details||[]).map(r=>r.expected&&r.actual?`${r.reason}  (${r.actual} instead of ${r.expected})`:r.reason).join(", ")),!this.solutions.find(r=>"Fix Header"===r.name)){const r={name:"Fix Header",fixable:!0,click:()=>{r.running||(r.running=!0,this.jam.track.fix({id:n.id,fixID:e.id}).then(_=>{this.folderService.waitForQueueResult("Fixing Track Header",_,[],[],[n.id])}).catch(_=>{this.notify.error(_)}))}};this.solutions.push(r)}return i}describeHint(e,n){switch(e.id){case h.U.tagValuesExists:case h.U.id3v2Garbage:case h.U.id3v2Exists:case h.U.id3v2Valid:return this.describeTagHint(e,n);case h.U.mp3Garbage:return this.describeMp3GarbageHint(e,n);case h.U.mp3MediaValid:return this.describeMp3ErrorHint(e,n);case h.U.id3v2NoId3v1:return this.describeID3v1Hint(e,n);case h.U.mp3HeaderExists:case h.U.mp3HeaderValid:return this.describeMP3HeaderHint(e,n)}return""}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(h.K4),t.Y36(u.c),t.Y36(u.Cr),t.Y36(y.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-track-health"]],inputs:{trackHealth:"trackHealth"},outputs:{resolvedEvent:"resolvedEvent"},features:[t.TTD],decls:1,vars:1,consts:[[4,"ngIf"],["class","hints",4,"ngIf"],[1,"hints"],[1,"hint"],[1,"icon-spin","icon-spinner"],["class","hint",4,"ngIf"],["class","hint",4,"ngFor","ngForOf","ngForTrackBy"],[1,"solutions"],["class","button-on-background",3,"click",4,"ngFor","ngForOf"],[1,"icon-warning"],[1,"details"],[1,"button-on-background",3,"click"],["class","icon-spin icon-spinner",4,"ngIf"]],template:function(e,n){1&e&&t.YNc(0,en,3,2,"ng-container",0),2&e&&t.Q6J("ngIf",n.trackHealth)},directives:[b.O5,b.sg],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .icon-warning[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]{padding-left:28px;font-size:.8em;display:block;padding-top:5px}[_nghost-%COMP%]   .hint[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .solutions[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .solutions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}[_nghost-%COMP%]   .detail[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1.25px;font-size:11px;min-width:80px;margin-right:10px;display:inline-block}"]}),o})();function nn(o,c){1&o&&t._UZ(0,"app-loading")}function on(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",9),t.TgZ(1,"div",10),t._uU(2),t.qZA(),t.TgZ(3,"div",11),t.TgZ(4,"app-track-health",12),t.NdJ("resolvedEvent",function(){const r=t.CHM(e).$implicit;return t.oxw().trackHealthResolved(r)}),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=c.$implicit;t.xp6(2),t.hij(" ",e.track.name," "),t.xp6(2),t.Q6J("trackHealth",e)}}let rn=(()=>{class o extends P{constructor(e,n,i,r,_){super(e),this.app=n,this.jam=i,this.notify=r,this.folderService=_,this.modes=[],this.mediaCheck=!1}onFilterChange(){this.reDisplay()}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,q.R)(this.unsubscribe)).subscribe(e=>{e.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}checkChange(){this.refresh()}trackHealthResolved(e){this.all&&(this.all=this.all.filter(n=>n!==e),this.reDisplay())}refresh(){this.hints=void 0,this.id&&this.jam.track.health({folderIDs:[this.id],healthMedia:this.mediaCheck}).then(e=>{this.display(e)}).catch(e=>{this.notify.error(e)})}reDisplay(){this.hints=this.filter&&this.all?this.all.filter(e=>e.health&&e.health.find(n=>n.name===this.filter)):this.all}display(e){this.all=e,this.modes=[];for(const n of e)if(n.health)for(const i of n.health)this.modes.includes(i.name)||this.modes.push(i.name);this.reDisplay()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(y.gz),t.Y36(u.zi),t.Y36(h.K4),t.Y36(u.c),t.Y36(u.Cr))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-tracks-health"]],features:[t.qOj],decls:11,vars:5,consts:[[1,"health"],[1,"actions"],["title","Refresh List",1,"button-on-control",3,"click"],[1,"icon-reload"],["type","checkbox",3,"ngModel","checked","ngModelChange","change"],[1,"content"],[4,"ngIf"],["name","Track Health Issues",3,"list"],["class","track",4,"ngFor","ngForOf"],[1,"track"],[1,"meta"],[1,"track-health"],[3,"trackHealth","resolvedEvent"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"button",2),t.NdJ("click",function(){return n.refresh()}),t._UZ(3,"i",3),t.qZA(),t.TgZ(4,"label"),t.TgZ(5,"input",4),t.NdJ("ngModelChange",function(r){return n.mediaCheck=r})("change",function(){return n.checkChange()}),t.qZA(),t._uU(6," Check Media "),t.qZA(),t.qZA(),t.TgZ(7,"div",5),t.YNc(8,nn,1,0,"app-loading",6),t._UZ(9,"app-background-text-list",7),t.YNc(10,on,5,2,"div",8),t.qZA(),t.qZA()),2&e&&(t.xp6(5),t.Q6J("ngModel",n.mediaCheck)("checked",n.mediaCheck),t.xp6(3),t.Q6J("ngIf",!n.hints),t.xp6(1),t.Q6J("list",n.hints),t.xp6(1),t.Q6J("ngForOf",n.hints))},directives:[x.Wl,x.JJ,x.On,b.O5,B.$,b.sg,D.N,Zt],styles:["[_nghost-%COMP%]{height:100%;width:100%}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:15px;overflow-y:auto;overflow-x:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]{flex-flow:row nowrap}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{width:30%;overflow:hidden;padding-right:15px;text-overflow:ellipsis}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{width:70%}"]}),o})();var an=M(4339);function sn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"tr",13),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return r.selected=!r.selected}),t.TgZ(1,"td",4),t._uU(2),t.qZA(),t.TgZ(3,"td",5),t._uU(4),t.qZA(),t.TgZ(5,"td",6),t._uU(6),t.qZA(),t.TgZ(7,"td",7),t._uU(8),t.qZA(),t.TgZ(9,"td",8),t._uU(10),t.qZA(),t.TgZ(11,"td",9),t._uU(12),t.qZA(),t.TgZ(13,"td",10),t._uU(14),t.qZA(),t.TgZ(15,"td",11),t._uU(16),t.ALo(17,"duration"),t.qZA(),t.qZA()}if(2&o){const e=c.$implicit;t.ekj("selected",e.selected),t.xp6(2),t.Oqu(null==e.track.tag?null:e.track.tag.trackNr),t.xp6(2),t.Oqu(null==e.track.tag?null:e.track.tag.title),t.xp6(2),t.Oqu(null==e.track.tag?null:e.track.tag.artist),t.xp6(2),t.Oqu(null==e.track.tag?null:e.track.tag.album),t.xp6(2),t.Oqu(null==e.track.media?null:e.track.media.format),t.xp6(2),t.Oqu(null==e.track.media?null:e.track.media.bitRate),t.xp6(2),t.Oqu(null==e.track.media?null:e.track.media.sampleRate),t.xp6(2),t.Oqu(t.lcZ(17,10,e.track.duration))}}function cn(o,c){if(1&o&&(t.TgZ(0,"table",2),t.TgZ(1,"tr",3),t.TgZ(2,"td",4),t._uU(3,"Track Nr."),t.qZA(),t.TgZ(4,"td",5),t._uU(5,"Title"),t.qZA(),t.TgZ(6,"td",6),t._uU(7,"Artist"),t.qZA(),t.TgZ(8,"td",7),t._uU(9,"Album"),t.qZA(),t.TgZ(10,"td",8),t._uU(11,"Format"),t.qZA(),t.TgZ(12,"td",9),t._uU(13,"BitRate"),t.qZA(),t.TgZ(14,"td",10),t._uU(15,"SampleRate"),t.qZA(),t.TgZ(16,"td",11),t._uU(17,"Duration"),t.qZA(),t.qZA(),t.YNc(18,sn,18,12,"tr",12),t.qZA()),2&o){const e=t.oxw();t.xp6(18),t.Q6J("ngForOf",e.trackItems)}}let St=(()=>{class o{constructor(e){this.router=e,this.tracks=[]}getSortValue(e,n){var i,r,_;switch(e){case"number":return null===(i=n.track.tag)||void 0===i?void 0:i.trackNr;case"name":return n.track.name;case"artist":return null===(r=n.track.tag)||void 0===r?void 0:r.artist;case"album":return null===(_=n.track.tag)||void 0===_?void 0:_.album;case"duration":return n.track.duration;default:return}}ngOnChanges(e){this.trackItems=(this.tracks||[]).map(n=>({track:n}))}toTrackFolder(e){this.router.navigate([`/admin/folder/${e.parentID}/overview`]).catch(n=>{console.error(n)})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(y.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-track-list"]],inputs:{tracks:"tracks"},features:[t.TTD],decls:2,vars:2,consts:[["name","Tracks",3,"list"],["class","tracks",4,"ngIf"],[1,"tracks"],[1,"track","heading"],[1,"number"],[1,"title"],[1,"artist"],[1,"album"],[1,"format"],[1,"bitrate"],[1,"samplerate"],[1,"duration"],["class","track",3,"selected","click",4,"ngFor","ngForOf"],[1,"track",3,"click"]],template:function(e,n){1&e&&(t._UZ(0,"app-background-text-list",0),t.YNc(1,cn,19,1,"table",1)),2&e&&(t.Q6J("list",n.tracks),t.xp6(1),t.Q6J("ngIf",n.tracks&&n.tracks.length>0))},directives:[B.$,b.O5,b.sg],pipes:[an.u],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]{padding:15px;font-size:.8em;width:100%}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{font-size:.9em}[_nghost-%COMP%]   .track[_ngcontent-%COMP%]{border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .track[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .track[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .track.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}"]}),o})();function ln(o,c){1&o&&t._UZ(0,"app-loading")}function dn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",3),t.TgZ(1,"div",4),t.TgZ(2,"button",5),t.NdJ("click",function(){return t.CHM(e),t.oxw().refresh()}),t._UZ(3,"i",6),t.qZA(),t.TgZ(4,"button",7),t.NdJ("click",function(){return t.CHM(e),t.oxw().moveTracks()}),t._UZ(5,"i",8),t.qZA(),t.TgZ(6,"button",9),t.NdJ("click",function(){return t.CHM(e),t.oxw().deleteTracks()}),t._UZ(7,"i",10),t.qZA(),t.qZA(),t._UZ(8,"app-admin-track-list",11),t.qZA()}if(2&o){const e=t.oxw();t.xp6(8),t.Q6J("tracks",e.folder.tracks)}}let gn=(()=>{class o extends P{constructor(e,n,i,r,_,w){super(e),this.jam=n,this.notify=i,this.folderService=r,this.dialogsService=_,this.dialogOverlay=w}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,q.R)(this.unsubscribe)).subscribe(e=>{e.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}deleteTracks(){const e=this.getTrackIDs();0!==e.length&&this.dialogsService.confirm("Remove Tracks?",`Sure to remove ${e.length} Track${e.length>1?"s":""}?`,()=>{for(const n of e)this.jam.track.remove({id:n}).then(i=>{this.folderService.waitForQueueResult("Removing Track",i,[],[],[n])}).catch(i=>{this.notify.error(i)})})}getTrackIDs(){var e,n;if(!(null===(e=this.tracks)||void 0===e?void 0:e.trackItems)||!(null===(n=this.folder)||void 0===n?void 0:n.tracks))return[];const i=this.tracks.trackItems.filter(r=>r.selected).map(r=>r.track.id);return i.length>0?i:this.folder.tracks.map(r=>r.id)}moveTracks(){const e=this.getTrackIDs();if(0===e.length)return;const n={selectID:this.id};this.dialogOverlay.open({title:"Move Tracks to",childComponent:T,data:n,panelClass:"overlay-panel-large-buttons",onOkBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){const i=n.folder;if(i)return this.jam.track.move({ids:e,folderID:i.id}).then(r=>{var _;this.folderService.waitForQueueResult("Moving Tracks",r,[],[i.id].concat((null===(_=this.folder)||void 0===_?void 0:_.parentID)?[this.folder.parentID]:[]),e)}).catch(r=>{this.notify.error(r)}),Promise.resolve()}),onCancelBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){return Promise.resolve()})})}refresh(){this.folder=void 0,this.id&&this.jam.folder.id({id:this.id,folderIncTracks:!0,trackIncTag:!0,trackIncMedia:!0}).then(e=>{this.folder=e}).catch(e=>{this.notify.error(e)})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(y.gz),t.Y36(h.K4),t.Y36(u.c),t.Y36(u.Cr),t.Y36(S.Hr),t.Y36(H.SL))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-folder-tracks"]],viewQuery:function(e,n){if(1&e&&t.Gf(St,5),2&e){let i;t.iGM(i=t.CRH())&&(n.tracks=i.first)}},features:[t.qOj],decls:3,vars:3,consts:[[4,"ngIf"],["name","Tracks",3,"list"],["class","tracks",4,"ngIf"],[1,"tracks"],[1,"actions"],["title","Refresh",1,"button-on-control",3,"click"],[1,"icon-reload"],["title","Move Tracks\u2026",1,"button-on-control",3,"click"],[1,"icon-right-bold"],["title","Delete Tracks\u2026",1,"button-on-control",3,"click"],[1,"icon-trash"],[1,"content",3,"tracks"]],template:function(e,n){1&e&&(t.YNc(0,ln,1,0,"app-loading",0),t._UZ(1,"app-background-text-list",1),t.YNc(2,dn,9,1,"div",2)),2&e&&(t.Q6J("ngIf",!n.folder),t.xp6(1),t.Q6J("list",null==n.folder?null:n.folder.tracks),t.xp6(1),t.Q6J("ngIf",n.folder&&n.folder.tracks&&n.folder.tracks.length>0))},directives:[b.O5,B.$,D.N,St],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:block;overflow:hidden}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   app-admin-track-list[_ngcontent-%COMP%]{overflow-y:auto}"]}),o})();var ht=M(9539);function pn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(3);return i.refresh(i.current.pos,!1)}),t._UZ(1,"i",10),t._uU(2," Refresh"),t.qZA()}}function hn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){return t.CHM(e),t.oxw(3).fixAll()}),t._uU(1,"Fix all fixable"),t.qZA()}}function _n(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",5),t.TgZ(1,"button",6),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).start()}),t._UZ(2,"i",7),t._uU(3," Next"),t.qZA(),t.YNc(4,pn,3,0,"button",8),t.YNc(5,hn,2,0,"button",8),t.qZA()}if(2&o){const e=t.oxw(2);t.xp6(4),t.Q6J("ngIf",e.current),t.xp6(1),t.Q6J("ngIf",e.current&&e.current.health&&e.current.health.length>0)}}function un(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",5),t.TgZ(1,"button",9),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).stop()}),t._UZ(2,"i",11),t._uU(3," Stop"),t.qZA(),t.qZA()}}function mn(o,c){if(1&o&&(t.ynx(0),t.YNc(1,_n,6,2,"div",4),t.YNc(2,un,4,0,"div",4),t.BQk()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.searching),t.xp6(1),t.Q6J("ngIf",e.searching)}}function fn(o,c){1&o&&t._UZ(0,"app-loading")}function Cn(o,c){1&o&&t._UZ(0,"i",16)}function xn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",18),t.TgZ(1,"div",19),t._uU(2),t.qZA(),t.TgZ(3,"div",20),t.TgZ(4,"app-track-health",21),t.NdJ("resolvedEvent",function(){const r=t.CHM(e).$implicit;return t.oxw(3).trackHealthResolved(r)}),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=c.$implicit;t.xp6(2),t.hij(" ",e.track.name," "),t.xp6(2),t.Q6J("trackHealth",e)}}function Mn(o,c){if(1&o&&(t.ynx(0),t.YNc(1,xn,5,2,"div",17),t.BQk()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.current.health)("ngForTrackBy",e.trackByFn)}}const vn=function(o){return["/admin/folder",o,"tags"]};function On(o,c){if(1&o&&(t.TgZ(0,"div"),t.TgZ(1,"div",12),t.TgZ(2,"span"),t.YNc(3,Cn,1,0,"i",13),t.qZA(),t.TgZ(4,"span"),t._uU(5),t.qZA(),t.TgZ(6,"a",14),t._UZ(7,"i",15),t._uU(8),t.qZA(),t.qZA(),t.YNc(9,Mn,2,2,"ng-container",2),t.qZA()),2&o){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",e.searching),t.xp6(2),t.AsE("",e.current.pos+1," / ",e.folders.length,""),t.xp6(1),t.Q6J("routerLink",t.VKq(6,vn,e.current.folder.id)),t.xp6(2),t.hij(" ",e.current.folder.name,""),t.xp6(1),t.Q6J("ngIf",e.current.health)}}let bn=(()=>{class o{constructor(e,n,i,r,_,w){this.app=e,this.jam=n,this.notify=i,this.uiState=r,this.folderService=_,this.userStorage=w,this.searching=!1,this.unsubscribe=new J.xQ,w.userChange.pipe((0,q.R)(this.unsubscribe)).subscribe(Q=>{this.loadFromStorage()})}trackHealthResolved(e){this.current&&this.current.health&&(this.current.health=this.current.health.filter(n=>n!==e))}trackByFn(e,n){return n.track.id}stop(){this.searching=!1}start(){this.searching||!this.folders||(this.searching=!0,this.request())}request(){if(!this.searching)return;let e=0;this.current&&(e=this.current.pos+1),this.refresh(e,!0)}fixAll(){this.searching||!this.current||!this.trackHealthComponents||this.trackHealthComponents.forEach(e=>{e.fixAll()})}refresh(e,n){this.current=void 0,this.searching=!0;const i=this.folders&&this.folders[e];if(!i)return void(this.searching=!1);const r={folder:i,pos:e};this.current=r,this.userStorage.set(o.localStorageName,{folderID:i.id}),this.jam.track.health({folderIDs:[i.id],healthMedia:!0}).then(_=>{_.length>0?(r.health=_,this.searching=!1):n?this.request():(r.health=[],this.searching=!1)}).catch(_=>{this.current=void 0,this.searching=!1,this.notify.error(_)})}ngOnInit(){const e=this.uiState.data["app-admin-radar"];e&&(this.folders=e.folders,this.current=e.current,this.folders)||this.loadFolders()}ngOnDestroy(){this.uiState.data["app-admin-radar"]={folders:this.folders,current:this.current},this.current=void 0,this.searching=!1,this.folders=void 0,this.unsubscribe.next(),this.unsubscribe.complete()}loadFromStorage(){const e=this.userStorage.get(o.localStorageName);if((null==e?void 0:e.folderID)&&this.folders){const n=this.folders.findIndex(i=>i.id===e.folderID);n>=0&&(this.current={folder:this.folders[n],pos:n},this.refresh(n,!1))}}loadFolders(){this.jam.folder.search({folderTypes:[h.Sr.album,h.Sr.multialbum]}).then(e=>{this.folders=e.items,this.loadFromStorage()}).catch(e=>{this.notify.error(e)})}}return o.localStorageName="admin.radar",o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(h.K4),t.Y36(u.c),t.Y36(u.JU),t.Y36(u.Cr),t.Y36(u.TZ))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-radar"]],viewQuery:function(e,n){if(1&e&&t.Gf(Zt,5),2&e){let i;t.iGM(i=t.CRH())&&(n.trackHealthComponents=i)}},decls:6,vars:3,consts:[[1,"radar"],["section","Health Radar"],[4,"ngIf"],[1,"content"],["class","buttons",4,"ngIf"],[1,"buttons"],[1,"button-primary",3,"click"],[1,"icon-play"],["class","button-on-control",3,"click",4,"ngIf"],[1,"button-on-control",3,"click"],[1,"icon-reload"],[1,"icon-stop"],[1,"current"],["class","icon-spin icon-spinner",4,"ngIf"],[3,"routerLink"],[1,"icon-folder"],[1,"icon-spin","icon-spinner"],["class","track",4,"ngFor","ngForOf","ngForTrackBy"],[1,"track"],[1,"meta"],[1,"track-health"],[3,"trackHealth","resolvedEvent"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"app-view-header-slim",1),t.YNc(2,mn,3,2,"ng-container",2),t.qZA(),t.TgZ(3,"div",3),t.YNc(4,fn,1,0,"app-loading",2),t.YNc(5,On,10,8,"div",2),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Q6J("ngIf",n.folders),t.xp6(2),t.Q6J("ngIf",!n.folders),t.xp6(1),t.Q6J("ngIf",n.folders&&n.current))},directives:[ht.p,b.O5,D.N,y.yS,b.sg,Zt],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{min-width:130px;display:inline-block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]{padding-top:15px;padding-bottom:15px;border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-right:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]{border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{padding-top:15px;padding-bottom:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{padding-left:15px}@media (max-width: 768px){[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{padding-left:0}}"]}),o})();const Rt=function(){return{standalone:!0}};function An(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"form"),t.TgZ(1,"div",1),t.TgZ(2,"label",2),t._uU(3,"Root name"),t.qZA(),t.TgZ(4,"input",3),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().edit.name=i}),t.qZA(),t.qZA(),t.TgZ(5,"div",1),t.TgZ(6,"label",4),t._uU(7,"Path"),t.qZA(),t.TgZ(8,"input",5),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().edit.path=i}),t.qZA(),t.qZA(),t.TgZ(9,"div",1),t.TgZ(10,"label",6),t._uU(11,"Scan Strategy"),t.qZA(),t.TgZ(12,"fieldset",7),t.TgZ(13,"label",8),t.TgZ(14,"input",9),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().edit.strategy=i}),t.qZA(),t._uU(15," Auto"),t.qZA(),t.TgZ(16,"label",8),t.TgZ(17,"input",9),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().edit.strategy=i}),t.qZA(),t._uU(18," Artist/Album"),t.qZA(),t.TgZ(19,"label",8),t.TgZ(20,"input",9),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().edit.strategy=i}),t.qZA(),t._uU(21," Compilations"),t.qZA(),t.TgZ(22,"label",8),t.TgZ(23,"input",9),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().edit.strategy=i}),t.qZA(),t._uU(24," Audiobook"),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=t.oxw();t.xp6(4),t.Q6J("ngModel",e.edit.name)("ngModelOptions",t.DdM(12,Rt)),t.xp6(4),t.Q6J("ngModel",e.edit.path)("ngModelOptions",t.DdM(13,Rt)),t.xp6(6),t.Q6J("ngModel",e.edit.strategy)("value",e.RootScanStrategy.auto),t.xp6(3),t.Q6J("ngModel",e.edit.strategy)("value",e.RootScanStrategy.artistalbum),t.xp6(3),t.Q6J("ngModel",e.edit.strategy)("value",e.RootScanStrategy.compilation),t.xp6(3),t.Q6J("ngModel",e.edit.strategy)("value",e.RootScanStrategy.audiobook)}}let Ht=(()=>{class o{constructor(){this.RootScanStrategy=h.hy}dialogInit(e,n){this.edit=n.data}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-root"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"root-form-control"],["for","root-name"],["id","root-name","type","text",3,"ngModel","ngModelOptions","ngModelChange"],["for","root-path"],["id","root-path","type","text",3,"ngModel","ngModelOptions","ngModelChange"],["for","strategy"],["id","strategy"],[1,"select"],["type","radio","name","strategy",3,"ngModel","value","ngModelChange"]],template:function(e,n){1&e&&t.YNc(0,An,25,14,"form",0),2&e&&t.Q6J("ngIf",n.edit)},directives:[b.O5,x._Y,x.JL,x.F,x.Fj,x.JJ,x.On,x._],styles:["[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%;line-height:1.3em;padding:5px;min-width:300px}[_nghost-%COMP%]   input[type=radio][_ngcontent-%COMP%]{margin-right:5px}[_nghost-%COMP%]   .root-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block}[_nghost-%COMP%]   .select[_ngcontent-%COMP%]{margin-right:15px;display:block;font-size:.8em;line-height:1.5em}"]}),o})();var wn=M(4376);function yn(o,c){1&o&&(t.TgZ(0,"span"),t._uU(1,"Not scanned"),t.qZA())}function Zn(o,c){if(1&o&&(t.TgZ(0,"span",22),t._uU(1,"Error:"),t._UZ(2,"br"),t._uU(3),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(3),t.Oqu(e.status.error)}}function Pn(o,c){1&o&&(t.ynx(0),t._uU(1,"Working\u2026"),t.BQk())}function Tn(o,c){if(1&o&&(t.ynx(0),t._uU(1,"Last Change:"),t._UZ(2,"br"),t._uU(3),t.ALo(4,"date"),t.BQk()),2&o){const e=t.oxw(2).$implicit;t.xp6(3),t.Oqu(t.xi3(4,1,e.status.lastScan,"medium"))}}function kn(o,c){if(1&o&&(t.TgZ(0,"span"),t.YNc(1,Pn,2,0,"ng-container",11),t.YNc(2,Tn,5,4,"ng-container",11),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",e.status.scanning),t.xp6(1),t.Q6J("ngIf",!e.status.scanning)}}function In(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"tr",10),t.NdJ("dblclick",function(){const r=t.CHM(e).$implicit;return t.oxw(2).editRoot(r)})("keydown.enter",function(){const r=t.CHM(e).$implicit;return t.oxw(2).editRoot(r)}),t.TgZ(1,"td",4),t._uU(2),t.qZA(),t.TgZ(3,"td",5),t._uU(4),t.qZA(),t.TgZ(5,"td",6),t._uU(6),t.qZA(),t.TgZ(7,"td",7),t.YNc(8,yn,2,0,"span",11),t.YNc(9,Zn,4,1,"span",12),t.YNc(10,kn,3,2,"span",11),t.qZA(),t.TgZ(11,"td",8),t.TgZ(12,"div",13),t.TgZ(13,"button",14),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(2).refreshRoot(r)}),t._UZ(14,"i",15),t.qZA(),t.TgZ(15,"button",16),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(2).refreshRootMeta(r)}),t._UZ(16,"i",17),t.qZA(),t.TgZ(17,"button",18),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(2).editRoot(r)}),t._UZ(18,"i",19),t.qZA(),t.TgZ(19,"button",20),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(2).deleteRoot(r)}),t._UZ(20,"i",21),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=c.$implicit;t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.path),t.xp6(2),t.Oqu(e.strategy),t.xp6(2),t.Q6J("ngIf",!e.status),t.xp6(1),t.Q6J("ngIf",e.status&&e.status.error),t.xp6(1),t.Q6J("ngIf",e.status&&!e.status.error)}}function Fn(o,c){if(1&o&&(t.TgZ(0,"table",2),t.TgZ(1,"tr",3),t.TgZ(2,"td",4),t._uU(3,"Name"),t.qZA(),t.TgZ(4,"td",5),t._uU(5,"Path"),t.qZA(),t.TgZ(6,"td",6),t._uU(7,"Strategy"),t.qZA(),t.TgZ(8,"td",7),t._uU(9,"Status"),t.qZA(),t.TgZ(10,"td",8),t._uU(11,"Actions"),t.qZA(),t.qZA(),t.YNc(12,In,21,6,"tr",9),t.qZA()),2&o){const e=t.oxw();t.xp6(12),t.Q6J("ngForOf",e.roots)}}let qn=(()=>{class o{constructor(e,n,i,r,_,w,Q){this.router=e,this.route=n,this.app=i,this.notify=r,this.dialogs=_,this.rootService=w,this.dialogOverlay=Q,this.roots=[]}refreshRoot(e){this.rootService.rescanRoot(e)}refreshRootMeta(e){this.rootService.refreshRootMeta(e)}editRoot(e){const n={root:e,name:e.name,path:e.path,strategy:e.strategy};this.dialogOverlay.open({title:"Edit Root",childComponent:Ht,data:n,onOkBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){try{yield this.rootService.applyDialogRoot(n)}catch(i){return this.notify.error(i),Promise.reject(i)}}),onCancelBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){return Promise.resolve()})})}deleteRoot(e){this.dialogs.confirm("Delete Root","Do you want to the delete the root folder?",()=>{this.rootService.removeRoot(e)})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(y.F0),t.Y36(y.gz),t.Y36(u.zi),t.Y36(u.c),t.Y36(S.Hr),t.Y36(u.Nb),t.Y36(H.SL))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-root-list"]],inputs:{roots:"roots"},decls:2,vars:2,consts:[["name","Roots",3,"list"],["class","roots","appFocusKeyList","",4,"ngIf"],["appFocusKeyList","",1,"roots"],[1,"root","heading"],[1,"title"],[1,"path"],[1,"strategy"],[1,"status"],[1,"actions"],["class","root","appFocusKeyListItem","",3,"dblclick","keydown.enter",4,"ngFor","ngForOf"],["appFocusKeyListItem","",1,"root",3,"dblclick","keydown.enter"],[4,"ngIf"],["class","error",4,"ngIf"],[1,"action-buttons"],["title","Rescan Root","appClickStop","",3,"click"],["aria-hidden","true",1,"icon-rescan"],["title","Refresh Root Meta","appClickStop","",3,"click"],["aria-hidden","true",1,"icon-broom"],["title","Edit Root","appClickStop","",3,"click"],["aria-hidden","true",1,"icon-edit"],["title","Delete Root","appClickStop","",3,"click"],["aria-hidden","true",1,"icon-remove"],[1,"error"]],template:function(e,n){1&e&&(t._UZ(0,"app-background-text-list",0),t.YNc(1,Fn,13,1,"table",1)),2&e&&(t.Q6J("list",n.roots),t.xp6(1),t.Q6J("ngIf",n.roots&&n.roots.length>0))},directives:[B.$,b.O5,O.R,b.sg,A.j,wn.D],pipes:[b.uU],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .roots[_ngcontent-%COMP%]{padding:15px;font-size:.9em;width:100%}[_nghost-%COMP%]   .root[_ngcontent-%COMP%]{height:60px;border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .root[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .root[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .root.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}[_nghost-%COMP%]   .error[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{height:40px;font-size:.9em}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{width:100px}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px;flex:50%;margin:0;display:inline-block;color:var(--on-control);border:1px solid transparent}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--on-control-active);border:1px solid var(--control-active)}"]}),o})(),Un=(()=>{class o{constructor(e,n,i,r,_,w,Q){this.router=e,this.route=n,this.app=i,this.notify=r,this.dialogs=_,this.rootService=w,this.dialogOverlay=Q,this.unsubscribe=new J.xQ}static getSortValue(e,n){switch(e){case"name":return n.name;case"path":return n.path;default:return}}ngOnInit(){this.rootService.rootsChange.pipe((0,q.R)(this.unsubscribe)).subscribe(e=>{this.roots=(e||[]).sort((n,i)=>n.name.localeCompare(i.name))},e=>{this.notify.error(e)}),this.rootService.refreshRoots()}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}refresh(){this.rootService.refreshRoots()}newRoot(){const e={name:"",path:"",strategy:h.hy.auto};this.dialogOverlay.open({title:"New Root",childComponent:Ht,data:e,onOkBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){try{yield this.rootService.applyDialogRoot(e)}catch(n){return this.notify.error(n),Promise.reject(n)}}),onCancelBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){return Promise.resolve()})})}refreshRoots(){this.rootService.rescanRoots()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(y.F0),t.Y36(y.gz),t.Y36(u.zi),t.Y36(u.c),t.Y36(S.Hr),t.Y36(u.Nb),t.Y36(H.SL))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-root"]],decls:11,vars:1,consts:[[1,"roots"],["section","Roots"],[1,"actions"],["title","Refresh",1,"button-on-control",3,"click"],[1,"icon-reload"],["title","New Root\u2026",1,"button-on-control",3,"click"],[1,"icon-plus"],["title","Rescan all Roots",1,"button-on-control",3,"click"],[1,"icon-rescan"],[1,"content"],[3,"roots"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"app-view-header-slim",1),t.TgZ(2,"div",2),t.TgZ(3,"button",3),t.NdJ("click",function(){return n.refresh()}),t._UZ(4,"i",4),t.qZA(),t.TgZ(5,"button",5),t.NdJ("click",function(){return n.newRoot()}),t._UZ(6,"i",6),t.qZA(),t.TgZ(7,"button",7),t.NdJ("click",function(){return n.refreshRoots()}),t._UZ(8,"i",8),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"div",9),t._UZ(10,"app-admin-root-list",10),t.qZA(),t.qZA()),2&e&&(t.xp6(10),t.Q6J("roots",n.roots))},directives:[ht.p,qn],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .roots[_ngcontent-%COMP%]{height:100%;overflow-y:auto;overflow-x:hidden}[_nghost-%COMP%]   .roots[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}"]}),o})();function Sn(o,c){1&o&&t._UZ(0,"app-loading")}function Rn(o,c){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"div"),t.TgZ(2,"div",6),t._uU(3,"Server"),t.qZA(),t.TgZ(4,"div",7),t.TgZ(5,"label"),t.TgZ(6,"input",8),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().settings.library.scanAtStart=i})("ngModelChange",function(){return t.CHM(e),t.oxw().onChange()}),t.qZA(),t._uU(7," Scan all Roots on Server Start "),t.qZA(),t.qZA(),t.qZA(),t.TgZ(8,"div"),t.TgZ(9,"div",6),t._uU(10,"External Services"),t.qZA(),t.TgZ(11,"div",7),t.TgZ(12,"label"),t.TgZ(13,"input",9),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().settings.externalServices.enabled=i})("ngModelChange",function(){return t.CHM(e),t.oxw().onChange()}),t.qZA(),t._uU(14," Allow Request to External Services "),t.qZA(),t.qZA(),t.qZA(),t.TgZ(15,"div"),t.TgZ(16,"div",6),t._uU(17,"Chat"),t.qZA(),t.TgZ(18,"div",7),t.TgZ(19,"label",10),t._uU(20,"Maximum Number of Messages"),t.qZA(),t.TgZ(21,"input",11),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().settings.chat.maxMessages=i})("ngModelChange",function(){return t.CHM(e),t.oxw().onChange()}),t.qZA(),t.qZA(),t.TgZ(22,"div",7),t.TgZ(23,"div",12),t.TgZ(24,"label",13),t._uU(25,"Maximum Age of Message"),t.qZA(),t.TgZ(26,"input",14),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().settings.chat.maxAge.value=i})("ngModelChange",function(){return t.CHM(e),t.oxw().onChange()}),t.qZA(),t.qZA(),t.TgZ(27,"select",15),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().settings.chat.maxAge.unit=i})("ngModelChange",function(){return t.CHM(e),t.oxw().onChange()}),t.TgZ(28,"option",16),t._uU(29,"year"),t.qZA(),t.TgZ(30,"option",16),t._uU(31,"years"),t.qZA(),t.TgZ(32,"option",16),t._uU(33,"month"),t.qZA(),t.TgZ(34,"option",16),t._uU(35,"months"),t.qZA(),t.TgZ(36,"option",16),t._uU(37,"day"),t.qZA(),t.TgZ(38,"option",16),t._uU(39,"days"),t.qZA(),t.TgZ(40,"option",16),t._uU(41,"minute"),t.qZA(),t.TgZ(42,"option",16),t._uU(43,"minutes"),t.qZA(),t.TgZ(44,"option",16),t._uU(45,"second"),t.qZA(),t.TgZ(46,"option",16),t._uU(47,"seconds"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(48,"div"),t.TgZ(49,"div",6),t._uU(50,"Artist Index"),t.qZA(),t.TgZ(51,"div",7),t.TgZ(52,"label",17),t._uU(53,"Ignored Articles in Artist Names"),t.qZA(),t.TgZ(54,"textarea",18),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().ignoreArticles=i})("ngModelChange",function(){return t.CHM(e),t.oxw().onChange()}),t.qZA(),t.qZA(),t.qZA(),t.BQk()}if(2&o){const e=t.oxw();t.xp6(6),t.Q6J("ngModel",e.settings.library.scanAtStart),t.xp6(7),t.Q6J("ngModel",e.settings.externalServices.enabled),t.xp6(8),t.Q6J("ngModel",e.settings.chat.maxMessages),t.xp6(5),t.Q6J("ngModel",e.settings.chat.maxAge.value),t.xp6(1),t.Q6J("ngModel",e.settings.chat.maxAge.unit),t.xp6(1),t.Q6J("value","year"),t.xp6(2),t.Q6J("value","years"),t.xp6(2),t.Q6J("value","month"),t.xp6(2),t.Q6J("value","months"),t.xp6(2),t.Q6J("value","day"),t.xp6(2),t.Q6J("value","days"),t.xp6(2),t.Q6J("value","minute"),t.xp6(2),t.Q6J("value","minutes"),t.xp6(2),t.Q6J("value","second"),t.xp6(2),t.Q6J("value","seconds"),t.xp6(8),t.Q6J("ngModel",e.ignoreArticles)}}let Hn=(()=>{class o{constructor(e,n,i){this.app=e,this.jam=n,this.notify=i,this.ignoreArticles=""}ngOnInit(){this.refresh()}onChange(){}refresh(){this.jam.admin.settings().then(e=>{this.display(e)}).catch(e=>{this.notify.error(e)})}save(){const e=this.settings;!e||(e.index.ignoreArticles=this.ignoreArticles.split("\n").map(n=>n.trim()).filter(n=>n.length>0),this.settings=void 0,this.jam.admin.settingsUpdate(e).then(()=>{this.notify.success("Settings updated"),this.settings=e}).catch(n=>{this.notify.error(n),this.settings=e}))}display(e){this.settings=e,this.ignoreArticles=e.index.ignoreArticles.join("\n")}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(h.K4),t.Y36(u.c))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-settings"]],decls:8,vars:2,consts:[[1,"settings"],["section","Admin Settings"],["title","Save",1,"button-on-control",3,"click"],[1,"icon-floppy"],[1,"content"],[4,"ngIf"],[1,"section-title"],[1,"section-entry"],["type","checkbox","title","Scan all Roots on Server Start",3,"ngModel","ngModelChange"],["type","checkbox","title","Allow Request to External Services",3,"ngModel","ngModelChange"],["for","max_messages"],["id","max_messages","type","number",3,"ngModel","ngModelChange"],[1,"chat-max-age"],["for","max_age"],["id","max_age","type","number",3,"ngModel","ngModelChange"],["placeholder","Unit of Age",3,"ngModel","ngModelChange"],[3,"value"],["for","ignore_articles"],["id","ignore_articles","rows","10","cols","20",3,"ngModel","ngModelChange"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"app-view-header-slim",1),t.TgZ(2,"button",2),t.NdJ("click",function(){return n.save()}),t._UZ(3,"i",3),t._uU(4," Save Settings"),t.qZA(),t.qZA(),t.TgZ(5,"div",4),t.YNc(6,Sn,1,0,"app-loading",5),t.YNc(7,Rn,55,16,"ng-container",5),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.Q6J("ngIf",!n.settings),t.xp6(1),t.Q6J("ngIf",n.settings))},directives:[ht.p,b.O5,D.N,x.Wl,x.JJ,x.On,x.wV,x.Fj,x.EJ,x.YN,x.Kr],styles:["[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:hidden;height:100%}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:15px 15px 0}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .chat-max-age[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .section-entry[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:12px;padding-bottom:3px}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-top:-1px;display:inline-block;vertical-align:middle}"]}),o})(),Jt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-start"]],decls:4,vars:0,consts:[[1,"start"],["section","Administration"],[1,"content"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"app-view-header-slim",1),t.TgZ(2,"div",2),t._UZ(3,"app-admin-section-cards"),t.qZA(),t.qZA())},styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .start[_ngcontent-%COMP%]{height:100%;overflow-y:auto;overflow-x:hidden}"]}),o})();const it=function(){return{standalone:!0}};function Jn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"form"),t.TgZ(2,"div",1),t.TgZ(3,"label",2),t._uU(4,"Name"),t.qZA(),t.TgZ(5,"input",3),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().edit.edit.name=i}),t.qZA(),t.qZA(),t.TgZ(6,"div",1),t.TgZ(7,"label",4),t._uU(8,"Email"),t.qZA(),t.TgZ(9,"input",5),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().edit.edit.email=i}),t.qZA(),t.qZA(),t.TgZ(10,"div",6),t._uU(11,"Roles"),t.qZA(),t.TgZ(12,"div",7),t.TgZ(13,"label"),t.TgZ(14,"input",8),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().edit.edit.roleAdmin=i}),t.qZA(),t._uU(15," Administrator "),t.qZA(),t._UZ(16,"br"),t.TgZ(17,"label"),t.TgZ(18,"input",9),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().edit.edit.rolePodcast=i}),t.qZA(),t._uU(19," Manage Podcasts "),t.qZA(),t._UZ(20,"br"),t.TgZ(21,"label"),t.TgZ(22,"input",9),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().edit.edit.roleStream=i}),t.qZA(),t._uU(23," Can Stream/Download "),t.qZA(),t._UZ(24,"br"),t.TgZ(25,"label"),t.TgZ(26,"input",10),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().edit.edit.roleUpload=i}),t.qZA(),t._uU(27," Can Upload "),t.qZA(),t.qZA(),t._UZ(28,"hr"),t.TgZ(29,"div",1),t._UZ(30,"input",11,12),t.TgZ(32,"label",13),t._uU(33,"Your Admin Password"),t.qZA(),t.TgZ(34,"input",14),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().edit.edit.password=i}),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=t.oxw();t.xp6(5),t.Q6J("ngModel",e.edit.edit.name)("ngModelOptions",t.DdM(14,it)),t.xp6(4),t.Q6J("ngModel",e.edit.edit.email)("ngModelOptions",t.DdM(15,it)),t.xp6(5),t.Q6J("ngModel",e.edit.edit.roleAdmin)("ngModelOptions",t.DdM(16,it)),t.xp6(4),t.Q6J("ngModel",e.edit.edit.rolePodcast)("ngModelOptions",t.DdM(17,it)),t.xp6(4),t.Q6J("ngModel",e.edit.edit.roleStream)("ngModelOptions",t.DdM(18,it)),t.xp6(4),t.Q6J("ngModel",e.edit.edit.roleUpload)("ngModelOptions",t.DdM(19,it)),t.xp6(8),t.Q6J("ngModel",e.edit.edit.password)("ngModelOptions",t.DdM(20,it))}}let Qt=(()=>{class o{dialogInit(e,n){this.edit=n.data}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-user"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"user-form-control"],["for","user-name"],["id","user-name","type","text","name","username",3,"ngModel","ngModelOptions","ngModelChange"],["for","user-mail"],["id","user-mail","type","email","name","mail",3,"ngModel","ngModelOptions","ngModelChange"],[1,"user-form-section"],[1,"user-form-roles"],["type","checkbox","title","Allow User to administrate",3,"ngModel","ngModelOptions","ngModelChange"],["type","checkbox","title","Allow User to manage podcasts",3,"ngModel","ngModelOptions","ngModelChange"],["type","checkbox","title","Allow User to upload files",3,"ngModel","ngModelOptions","ngModelChange"],["type","text","name","user","autocomplete","username",1,"dummy"],["name",""],["for","admin-pass",1,"label-pass"],["id","admin-pass","name","pass","type","password","autocomplete","password",3,"ngModel","ngModelOptions","ngModelChange"]],template:function(e,n){1&e&&t.YNc(0,Jn,35,21,"div",0),2&e&&t.Q6J("ngIf",n.edit)},directives:[b.O5,x._Y,x.JL,x.F,x.Fj,x.JJ,x.On,x.Wl],styles:["[_nghost-%COMP%] > div[_ngcontent-%COMP%]{margin-left:15px;margin-right:15px}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%], [_nghost-%COMP%]   input[type=email][_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{line-height:1.3em;padding:5px}[_nghost-%COMP%]   .label-pass[_ngcontent-%COMP%]{padding-right:15px;font-size:.8em}[_nghost-%COMP%]   .dummy[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .user-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block}[_nghost-%COMP%]   .user-form-roles[_ngcontent-%COMP%]{margin-bottom:10px}[_nghost-%COMP%]   .user-form-roles[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{line-height:1.5em}"]}),o})();var Qn=M(4343);let Dn=(()=>{class o{constructor(e,n){this.jam=e,this.notify=n,this.hasChanged=!1,this.unsubscribe=new J.xQ}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}dialogInit(e,n){this.user=n.data,this.setImageSource()}dialogResult(){return this.hasChanged}setImageSource(){this.userAvatar=this.user?`${this.jam.image.imageUrl({id:this.user.id,size:60,format:h.GU.webp})}?${(0,Qn.O)()}`:void 0}onDropFile(e){var n;e.preventDefault(),this.uploadFile(null===(n=e.dataTransfer)||void 0===n?void 0:n.files)}onDragOverFile(e){e.stopPropagation(),e.preventDefault()}selectFile(e){this.uploadFile(e.target.files)}uploadFile(e){e&&0!==e.length&&this.user&&this.jam.user.uploadUserImage({id:this.user.id},e[0]).pipe((0,q.R)(this.unsubscribe)).subscribe(i=>{i.type===j.dt.UploadProgress||i instanceof j.Zn&&(this.setImageSource(),this.hasChanged=!0)},i=>{this.setImageSource(),this.notify.error(i)},()=>{this.notify.success("Upload done")})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(h.K4),t.Y36(u.c))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-avatar"]],decls:6,vars:1,consts:[[1,"drop-zone",3,"drop","dragover"],[1,"root-form-control"],["alt","User Avatar",3,"src"],["type","file","placeholder","Upload image","accept",".png,.jpeg,.jpg",3,"change"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.NdJ("drop",function(r){return n.onDropFile(r)})("dragover",function(r){return n.onDragOverFile(r)}),t.TgZ(1,"form"),t.TgZ(2,"div",1),t._UZ(3,"img",2),t.qZA(),t.qZA(),t.TgZ(4,"form"),t.TgZ(5,"input",3),t.NdJ("change",function(r){return n.selectFile(r)}),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(3),t.Q6J("src",n.userAvatar,t.LSH))},directives:[x._Y,x.JL,x.F],styles:["[_nghost-%COMP%]   .drop-zone[_ngcontent-%COMP%]{margin:10px 20px;border-width:2px;border-style:dotted;border-color:var(--secondary)}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .root-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block;text-align:center}"]}),o})();const Dt=function(){return{standalone:!0}};function Nn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",1),t.TgZ(1,"form"),t._UZ(2,"input",2),t.TgZ(3,"label",3),t._uU(4,"Your Admin Password"),t.qZA(),t.TgZ(5,"input",4),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().data.password=i}),t.qZA(),t.qZA(),t.TgZ(6,"form"),t._UZ(7,"input",5),t.TgZ(8,"label",6),t._uU(9,"New Password for User "),t.TgZ(10,"span"),t._uU(11),t.qZA(),t.qZA(),t.TgZ(12,"input",7),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().data.newPassword=i}),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=t.oxw();t.xp6(5),t.Q6J("ngModel",e.data.password)("ngModelOptions",t.DdM(5,Dt)),t.xp6(6),t.Oqu(e.data.user.name),t.xp6(1),t.Q6J("ngModel",e.data.newPassword)("ngModelOptions",t.DdM(6,Dt))}}let En=(()=>{class o{dialogInit(e,n){this.data=n.data}dialogResult(){return!0}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog-user-pass"]],decls:1,vars:1,consts:[["class","user-form-control",4,"ngIf"],[1,"user-form-control"],["type","text","name","user","autocomplete","username",1,"dummy"],["for","admin-pass"],["id","admin-pass","name","pass","type","password","autocomplete","current-password",3,"ngModel","ngModelOptions","ngModelChange"],["type","text","name","new_name",1,"dummy"],["for","new-pass"],["id","new-pass","name","new_password","autocomplete","off","type","password","autocomplete","new-password",3,"ngModel","ngModelOptions","ngModelChange"]],template:function(e,n){1&e&&t.YNc(0,Nn,13,7,"div",0),2&e&&t.Q6J("ngIf",n.data)},directives:[b.O5,x._Y,x.JL,x.F,x.Fj,x.JJ,x.On],styles:["[_nghost-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:10px}[_nghost-%COMP%]   label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:bold}[_nghost-%COMP%]   .dummy[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{line-height:1.3em;padding:5px;width:100%;margin-bottom:15px}"]}),o})();var Yn=M(9343);function zn(o,c){1&o&&t._UZ(0,"i",22)}function Ln(o,c){1&o&&(t.TgZ(0,"span",23),t._uU(1,"Is Admin"),t.qZA())}function Bn(o,c){1&o&&t._UZ(0,"i",22)}function jn(o,c){1&o&&(t.TgZ(0,"span",23),t._uU(1,"Can manage podcast"),t.qZA())}function Wn(o,c){1&o&&t._UZ(0,"i",22)}function $n(o,c){1&o&&(t.TgZ(0,"span",23),t._uU(1,"Can upload"),t.qZA())}function Gn(o,c){1&o&&t._UZ(0,"i",22)}function Vn(o,c){1&o&&(t.TgZ(0,"span",23),t._uU(1,"Can stream"),t.qZA())}function Xn(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"tr",9),t.NdJ("dblclick",function(){const r=t.CHM(e).$implicit;return t.oxw(2).editUser(r)})("keydown.enter",function(){const r=t.CHM(e).$implicit;return t.oxw(2).editUser(r)}),t.TgZ(1,"td",3),t._UZ(2,"app-coverart-image",10),t.qZA(),t.TgZ(3,"td",4),t._uU(4),t.qZA(),t.TgZ(5,"td",5),t._uU(6),t.qZA(),t.TgZ(7,"td",6),t.YNc(8,zn,1,0,"i",11),t.YNc(9,Ln,2,0,"span",12),t.qZA(),t.TgZ(10,"td",6),t.YNc(11,Bn,1,0,"i",11),t.YNc(12,jn,2,0,"span",12),t.qZA(),t.TgZ(13,"td",6),t.YNc(14,Wn,1,0,"i",11),t.YNc(15,$n,2,0,"span",12),t.qZA(),t.TgZ(16,"td",6),t.YNc(17,Gn,1,0,"i",11),t.YNc(18,Vn,2,0,"span",12),t.qZA(),t.TgZ(19,"td",7),t.TgZ(20,"div",13),t.TgZ(21,"button",14),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(2).editUserAvatar(r)}),t._UZ(22,"i",15),t.qZA(),t.TgZ(23,"button",16),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(2).setUserPassword(r)}),t._UZ(24,"i",17),t.qZA(),t.TgZ(25,"button",18),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(2).editUser(r)}),t._UZ(26,"i",19),t.qZA(),t.TgZ(27,"button",20),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(2).deleteUser(r)}),t._UZ(28,"i",21),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=c.$implicit;t.xp6(2),t.Q6J("coverArtObj",e)("alt",e.name)("size",28)("round",!0),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.email),t.xp6(2),t.Q6J("ngIf",e.roles.admin),t.xp6(1),t.Q6J("ngIf",e.roles.admin),t.xp6(2),t.Q6J("ngIf",e.roles.podcast),t.xp6(1),t.Q6J("ngIf",e.roles.admin),t.xp6(2),t.Q6J("ngIf",e.roles.upload),t.xp6(1),t.Q6J("ngIf",e.roles.admin),t.xp6(2),t.Q6J("ngIf",e.roles.stream),t.xp6(1),t.Q6J("ngIf",e.roles.stream)}}function Kn(o,c){if(1&o&&(t.TgZ(0,"table",1),t.TgZ(1,"tr",2),t.TgZ(2,"td",3),t._uU(3,"Avatar"),t.qZA(),t.TgZ(4,"td",4),t._uU(5,"Name"),t.qZA(),t.TgZ(6,"td",5),t._uU(7,"Email"),t.qZA(),t.TgZ(8,"td",6),t._uU(9,"Administrator"),t.qZA(),t.TgZ(10,"td",6),t._uU(11,"Manage Podcasts"),t.qZA(),t.TgZ(12,"td",6),t._uU(13,"Can Upload"),t.qZA(),t.TgZ(14,"td",6),t._uU(15,"Can Stream"),t.qZA(),t.TgZ(16,"td",7),t._uU(17,"Actions"),t.qZA(),t.qZA(),t.YNc(18,Xn,29,14,"tr",8),t.qZA()),2&o){const e=t.oxw();t.xp6(18),t.Q6J("ngForOf",e.users)}}let to=(()=>{class o{constructor(e,n,i,r,_,w,Q){this.router=e,this.route=n,this.app=i,this.notify=r,this.dialogs=_,this.userService=w,this.dialogOverlay=Q,this.users=[],this.unsubscribe=new J.xQ}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}editUser(e){const n={user:e,edit:{password:"",name:e.name,email:e.email||"",roleAdmin:e.roles.admin,rolePodcast:e.roles.podcast,roleStream:e.roles.stream,roleUpload:e.roles.upload}};this.dialogOverlay.open({childComponent:Qt,title:"Edit User",data:n,onOkBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){try{yield this.userService.applyDialogUser(n),this.notify.success("User edited")}catch(i){return this.notify.error(i),Promise.reject(i)}}),onCancelBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){return Promise.resolve()})})}editUserAvatar(e){this.dialogOverlay.open({childComponent:Dn,title:"Edit User Avatar",data:e}).afterClosed().pipe((0,q.R)(this.unsubscribe)).subscribe(()=>{this.userService.refreshUser(e.id)})}setUserPassword(e){const n={user:e,password:"",newPassword:""};this.dialogOverlay.open({childComponent:En,title:"Set User Password",data:n,onOkBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){try{yield this.userService.setPassword(e.id,n.password,n.newPassword),this.notify.success("Password changed")}catch(i){return this.notify.error(i),Promise.reject(i)}}),onCancelBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){return Promise.resolve()})})}deleteUser(e){this.dialogs.confirm("Delete User","Do you want to the delete the user?",()=>{this.userService.removeUser(e).then(()=>{this.notify.success("User deleted")}).catch(n=>{this.notify.error(n)})})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(y.F0),t.Y36(y.gz),t.Y36(u.zi),t.Y36(u.c),t.Y36(S.Hr),t.Y36(u.NZ),t.Y36(H.SL))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-user-list"]],inputs:{users:"users"},decls:1,vars:1,consts:[["class","users","appFocusKeyList","",4,"ngIf"],["appFocusKeyList","",1,"users"],[1,"user","heading"],[1,"avatar"],[1,"title"],[1,"email"],[1,"role"],[1,"actions"],["class","user","appFocusKeyListItem","",3,"dblclick","keydown.enter",4,"ngFor","ngForOf"],["appFocusKeyListItem","",1,"user",3,"dblclick","keydown.enter"],[3,"coverArtObj","alt","size","round"],["class","icon-checkmark","aria-hidden","true",4,"ngIf"],["class","visually-hidden",4,"ngIf"],[1,"action-buttons"],["title","Change Avatar",3,"click"],["aria-hidden","true",1,"icon-picture"],["title","Set Password",3,"click"],["aria-hidden","true",1,"icon-key"],["title","Edit User",3,"click"],["aria-hidden","true",1,"icon-edit"],["title","Delete User",3,"click"],["aria-hidden","true",1,"icon-remove"],["aria-hidden","true",1,"icon-checkmark"],[1,"visually-hidden"]],template:function(e,n){1&e&&t.YNc(0,Kn,19,1,"table",0),2&e&&t.Q6J("ngIf",n.users&&n.users.length>0)},directives:[b.O5,O.R,b.sg,A.j,Yn.A],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]{padding:15px;font-size:.9em;width:100%}[_nghost-%COMP%]   .user[_ngcontent-%COMP%]{height:60px;border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .user[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .user[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .user.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{font-size:.9em;height:40px}[_nghost-%COMP%]   .icon-checkmark[_ngcontent-%COMP%]{color:var(--primary)}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{width:100px}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px;flex:50%;margin:0;display:inline-block;color:var(--on-control);border:1px solid transparent}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--on-control-active);border:1px solid var(--control-active)}"]}),o})();const Pt=[{path:"",component:nt,children:[{path:"",pathMatch:"full",component:Jt,data:{name:"Admin"}},{path:"settings",component:Hn,data:{name:"Admin Settings"}},{path:"root",component:Un,data:{name:"Roots",icon:"icon-root"}},{path:"user",component:(()=>{class o{constructor(e,n,i,r,_,w){this.app=e,this.dialogs=n,this.jam=i,this.notify=r,this.userService=_,this.dialogOverlay=w,this.unsubscribe=new J.xQ}getSortValue(e,n){switch(e){case"name":return n.name;case"email":return n.email;case"roleAdmin":return n.roles.admin?1:0;case"rolePodcast":return n.roles.podcast?1:0;case"roleUpload":return n.roles.upload?1:0;case"roleStream":return n.roles.stream?1:0;default:return}}ngOnInit(){this.userService.usersChange.pipe((0,q.R)(this.unsubscribe)).subscribe(e=>{this.users=(e||[]).sort((n,i)=>n.name.localeCompare(i.name))},e=>{this.notify.error(e)}),this.userService.refreshUsers()}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}refresh(){this.userService.refreshUsers()}newUser(){const e={edit:{password:"",name:"",email:"",roleAdmin:!1,rolePodcast:!1,roleStream:!0,roleUpload:!1}};this.dialogOverlay.open({title:"New User",childComponent:Qt,data:e,onOkBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){try{yield this.userService.applyDialogUser(e),this.notify.success("User created")}catch(n){return this.notify.error(n),Promise.reject(n)}}),onCancelBtn:()=>(0,I.mG)(this,void 0,void 0,function*(){return Promise.resolve()})})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.zi),t.Y36(S.Hr),t.Y36(h.K4),t.Y36(u.c),t.Y36(u.NZ),t.Y36(H.SL))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-users"]],decls:9,vars:1,consts:[[1,"users"],["section","Users"],[1,"actions"],["title","Refresh",1,"button-on-control",3,"click"],[1,"icon-reload"],["title","New User\u2026",1,"button-on-control",3,"click"],[1,"icon-plus"],[1,"content"],[3,"users"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"app-view-header-slim",1),t.TgZ(2,"div",2),t.TgZ(3,"button",3),t.NdJ("click",function(){return n.refresh()}),t._UZ(4,"i",4),t.qZA(),t.TgZ(5,"button",5),t.NdJ("click",function(){return n.newUser()}),t._UZ(6,"i",6),t.qZA(),t.qZA(),t.qZA(),t.TgZ(7,"div",7),t._UZ(8,"app-admin-user-list",8),t.qZA(),t.qZA()),2&e&&(t.xp6(8),t.Q6J("users",n.users))},directives:[ht.p,to],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]{height:100%;overflow-y:auto;overflow-x:hidden}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:0 15px 15px}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1.25px;font-size:13.2px;margin-bottom:10px;color:var(--on-control-ambient)}@media (max-width: 522px){[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding-left:10px;padding-right:10px}}"]}),o})(),data:{name:"Users",icon:"icon-user"}},{path:"folder",redirectTo:"folder/"},{path:"folder/:id",component:v,data:{id:"folder",name:"Folders",icon:"icon-folder",link:"folder"},children:[{path:"overview",component:je},{path:"health",component:ye},{path:"sub-folders",component:pt},{path:"tracks",component:gn},{path:"tracks-health",component:rn},{path:"tags",loadChildren:()=>(0,I.mG)(void 0,void 0,void 0,function*(){return Promise.all([M.e(592),M.e(615)]).then(M.bind(M,9615)).then(o=>o.TagEditorModule)})}]},{path:"radar",component:bn,data:{name:"Health Radar",icon:"icon-health"}}]}],eo=y.Bz.forChild(Pt);function no(o,c){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=t.oxw(2);t.xp6(1),t.hij("(",e.folderService.current.count,")")}}function oo(o,c){if(1&o&&(t.TgZ(0,"div",7),t.TgZ(1,"span",3),t._uU(2,"Other requests in queue:"),t.qZA(),t._uU(3),t.qZA()),2&o){const e=t.oxw(2);t.xp6(3),t.hij(" ",e.folderService.queue.length," ")}}function io(o,c){if(1&o&&(t.TgZ(0,"div",1),t.TgZ(1,"div",2),t.TgZ(2,"span",3),t._uU(3,"Current:"),t.qZA(),t._UZ(4,"i",4),t._uU(5),t.YNc(6,no,2,1,"ng-container",5),t.qZA(),t.YNc(7,oo,4,1,"div",6),t.qZA()),2&o){const e=t.oxw();t.xp6(5),t.hij(" ",e.folderService.current.title," "),t.xp6(1),t.Q6J("ngIf",e.folderService.current.count>1),t.xp6(1),t.Q6J("ngIf",e.folderService.queue.length>0)}}let ro=(()=>{class o{constructor(e){this.folderService=e}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.Cr))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-queue-requests"]],decls:1,vars:1,consts:[["class","queue-overlay",4,"ngIf"],[1,"queue-overlay"],[1,"current"],[1,"label"],[1,"icon-spin","icon-spinner"],[4,"ngIf"],["class","other",4,"ngIf"],[1,"other"]],template:function(e,n){1&e&&t.YNc(0,io,8,3,"div",0),2&e&&t.Q6J("ngIf",n.folderService.current)},directives:[b.O5],styles:["[_nghost-%COMP%]   .queue-overlay[_ngcontent-%COMP%]{position:fixed;right:16px;bottom:16px;padding:15px;background-color:var(--control);color:var(--on-control);border:1px solid var(--control-border);z-index:1000}[_nghost-%COMP%]   .queue-overlay[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{text-transform:uppercase;font-size:.8em;letter-spacing:1px;color:var(--on-control-ambient)}[_nghost-%COMP%]   .queue-overlay[_ngcontent-%COMP%]   .other[_ngcontent-%COMP%]{border-top:1px solid var(--background-border)}"]}),o})();var ao=M(8939);let so=(()=>{class o{constructor(){this.sections=[];const n=(Pt[0].children||[]).filter(i=>{var r;return i.path&&i.path.length>0&&(null===(r=i.data)||void 0===r?void 0:r.name)}).map(i=>({link:`/admin/${i.data&&i.data.link?i.data.link:i.path}`,name:i.data?i.data.name:"",icon:i.data&&i.data.icon?i.data.icon:"icon-admin"}));this.sections=[{name:"Administration",entries:n}]}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-sidebar"]],decls:1,vars:1,consts:[[3,"sections"]],template:function(e,n){1&e&&t._UZ(0,"app-sidebar",0),2&e&&t.Q6J("sections",n.sections)},directives:[ao.k],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}"]}),o})();var co=M(6154);const lo=function(o){return["/admin",o]};function go(o,c){if(1&o&&(t.TgZ(0,"div",1),t.TgZ(1,"div",2),t._UZ(2,"app-iconart-image",3),t.qZA(),t.TgZ(3,"div",4),t.TgZ(4,"a",5),t._uU(5),t.qZA(),t.qZA(),t.qZA()),2&o){const e=c.$implicit;t.Q6J("routerLink",t.VKq(3,lo,e.id)),t.xp6(2),t.Q6J("icon",e.icon),t.xp6(3),t.Oqu(e.text)}}let po=(()=>{class o{constructor(){this.sections=[],this.sections=(Pt[0].children||[]).filter(n=>{var i;return n.path&&n.path.length>0&&(null===(i=n.data)||void 0===i?void 0:i.name)}).map(n=>({id:n.data&&n.data.link?n.data.link:n.path,text:n.data?n.data.name:"",icon:n.data&&n.data.icon?n.data.icon:"icon-admin"}))}trackByFn(e,n){return n.id}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-admin-section-cards"]],decls:1,vars:2,consts:[["class","section-card no-hover",3,"routerLink",4,"ngFor","ngForOf","ngForTrackBy"],[1,"section-card","no-hover",3,"routerLink"],[1,"image"],[3,"icon"],[1,"footer"],[1,"footer-content"]],template:function(e,n){1&e&&t.YNc(0,go,6,5,"div",0),2&e&&t.Q6J("ngForOf",n.sections)("ngForTrackBy",n.trackByFn)},directives:[b.sg,y.rH,co.B],styles:['[_nghost-%COMP%]{display:flex;flex-flow:row wrap}@media (max-width: 768px){[_nghost-%COMP%]{justify-content:space-around}}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{margin:15px;width:calc(25% - 30px);position:relative;overflow:hidden;display:flex;cursor:pointer}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:before{content:"";display:block;margin-top:100%}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{position:absolute;top:1px;padding:5px;transform:translateY(-31px);transition:transform .3s}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]{right:1px;border-bottom-left-radius:3px;cursor:pointer;-webkit-user-select:none;user-select:none}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{left:1px;font-size:.8em;border-bottom-right-radius:3px}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{padding:5px;position:absolute;bottom:1px;left:1px;right:1px;overflow:hidden;height:auto}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:hover   .fav[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:hover   .date[_ngcontent-%COMP%]{transform:translateY(0)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:hover   .footer[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]{background-color:var(--background-transparent);color:var(--on-background-active)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-active)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer-subline[_ngcontent-%COMP%]{display:block;font-size:.8em}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]{height:40px;padding-top:10px;white-space:nowrap}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:5px;margin-right:5px}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{float:right;margin-right:5px}@media (max-width: 1600px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{width:calc(25% - 30px)}}@media (max-width: 1200px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{width:calc(33.33333% - 30px)}}@media (max-width: 522px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{width:calc(50% - 30px)}}@media (max-width: 400px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{font-size:.8em}}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{min-height:135px;min-width:135px;display:flex;align-items:center;justify-content:center}']}),o})(),ho=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({providers:[],imports:[[b.ez,lt.m,x.u5,W.t6,et.QG,N.vI,g.Cl,tt.In,eo]]}),o})();t.B6R(nt,[so,ot.H,y.lC,ro],[]),t.B6R(Jt,[ht.p,po],[])},7564:(Ot,V,M)=>{function b(u,h){if(void 0===u&&void 0===h)throw new Error("Trying to compare two undefined values");if(void 0===u||void 0===h)return 0;const O=String(u),A=String(h),Z=function(u,h){const O=[];let Z,A=0;for(let k=0;k<=h.length;k++)for(let U=0;U<=u.length;U++)Z=k&&U?u.charAt(U-1)===h.charAt(k-1)?A:Math.min(O[U],O[U-1],A)+1:k+U,A=O[U],O[U]=Z;return O.pop()||0}(O,A);return O.length>A.length?1-Z/O.length:1-Z/A.length}function W(u,h){const O={};return function(u,h){const A=h||2,Z=`-${u.toLowerCase().replace(/[^\w, ]+/,"")}-`,k=[];for(let U=0;U<Z.length-A+1;U+=1)k.push(Z.slice(U,U+A));return k}(u,h||2).forEach(Z=>{Z in O?O[Z]+=1:O[Z]=1}),O}function N(u){if("string"!=typeof u)throw new Error("Must use a string as argument to FuzzySet functions");return u.toLowerCase()}M.d(V,{VI:()=>nt,Cb:()=>q,C6:()=>dt,U_:()=>I,kQ:()=>y,RQ:()=>et,f_:()=>t});class lt{constructor(h,O,A,Z){this.version="0.0.1",this.exactSet={},this.matchDict={},this.items={},this.arr=h||[],this.useLevenshtein=O||!0,this.gramSizeLower=A||2,this.gramSizeUpper=Z||3;for(let k=this.gramSizeLower;k<this.gramSizeUpper+1;k+=1)this.items[k]=[];this.arr.forEach(k=>{this.add(k)})}get(h,O){const A=this.getVal(h);return!A&&O?O:A}add(h){if(!(N(h)in this.exactSet))for(let A=this.gramSizeLower;A<this.gramSizeUpper+1;A+=1)this.addVal(h,A)}length(){let h=0;for(const O in this.exactSet)Object.prototype.hasOwnProperty.call(this.exactSet,O)&&(h+=1);return h}isEmpty(){for(const h in this.exactSet)if(Object.prototype.hasOwnProperty.call(this.exactSet,h))return!1;return!0}values(){const h=[];for(const O in this.exactSet)Object.prototype.hasOwnProperty.call(this.exactSet,O)&&h.push(this.exactSet[O]);return h}getVal(h){const O=N(h),A=this.exactSet[O];if(A)return[[1,A]];for(let Z=this.gramSizeUpper;Z>=this.gramSizeLower;Z-=1){const k=this.getValGram(h,Z);if(k)return k}}getValGram(h,O){const A=N(h),Z={},k=W(A,O),U=this.items[O];let G,$=0;for(const f in k)if(Object.prototype.hasOwnProperty.call(k,f)){const a=k[f];if($+=Math.pow(a,2),f in this.matchDict)for(const s of this.matchDict[f]){const l=s[0];G=s[1],l in Z?Z[l]+=a*G:Z[l]=a*G}}if(function(u){for(const h in u)if(Object.prototype.hasOwnProperty.call(u,h))return!1;return!0}(Z))return;const E=Math.sqrt($);let ot,R=[];Object.keys(Z).forEach(f=>{ot=Z[f];const a=parseInt(f,10);R.push([ot/(E*U[a][0]),U[a][1]])});const rt=(f,a)=>f[0]<a[0]?1:f[0]>a[0]?-1:0;if(R.sort(rt),this.useLevenshtein){const f=[],a=Math.min(50,R.length);for(let s=0;s<a;s+=1)f.push([b(R[s][1],A),R[s][1]]);R=f,R.sort(rt)}const C=[];for(const f of R)f[0]===R[0][0]&&C.push([f[0],this.exactSet[f[1]]]);return C}addVal(h,O){const A=N(h),Z=this.items[O]||[],k=Z.length;Z.push(0);const U=W(A,O);let $=0;for(const E in U)if(Object.prototype.hasOwnProperty.call(U,E)){const R=U[E];$+=Math.pow(R,2),E in this.matchDict?this.matchDict[E].push([k,R]):this.matchDict[E]=[[k,R]]}const G=Math.sqrt($);Z[k]=[G,A],this.items[O]=Z,this.exactSet[A]=h}}function et(u){return u.split(/[.,\\/ -]/).map(h=>h.trim()).filter(h=>h.length>0)}function t(u){return u.replace(/\.[^/.]+$/,"")}function nt(u){return u.substring(u.lastIndexOf(".")+1,u.length)||u}function I(u,h){return h.includes(nt(u))}function y(u,h){return u.toString().replace(/:/g," - ").replace(/[?/!\\]/g,h)}function q(u){if(!u)return 0;const O=t(u).split(/[ \-_.:;?!~,`"&|()<>{}[\]\r\n/\\]+/).map(Number).filter(A=>!isNaN(A));return O.length>0?O[0]:0}function dt(u,h){const O=new lt;O.add(u);const A=O.get(h);return A?A[0][0]:0}},8646:(Ot,V,M)=>{function g(b){let x="";const W=new Uint8Array(b),tt=W.byteLength;for(let N=0;N<tt;N++)x+=String.fromCharCode(W[N]);return window.btoa(x)}M.d(V,{q:()=>g})}}]);