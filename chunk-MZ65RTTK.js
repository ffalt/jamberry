import{b as lt,d as ct,f as at,g as pt,h as ut,i as ht,j as mt}from"./chunk-AQDYGNZB.js";import{r as nt,w as st,x as D,z as rt}from"./chunk-ZVKVGF76.js";import{Aa as P,C as T,Da as K,F as a,Gc as G,Hb as F,Ib as H,J as N,M as I,Nb as $,Nc as J,Ob as Q,Pb as j,Uc as Z,Vc as l,Wb as X,Wc as tt,X as M,Y as p,Yc as et,Z as q,a as C,ab as R,db as V,dc as g,e as b,fc as w,gc as Y,hc as L,ia as u,ib as B,k as m,mc as U,nb as d,nc as W,oc as x,pb as f,rc as z,rd as ot,sb as A,v as k,wd as it,z as S}from"./chunk-H2EXZDP6.js";var _=(()=>{let o=class o{constructor(){this.tpl=u(V)}};o.\u0275fac=function(t){return new(t||o)},o.\u0275dir=f({type:o,selectors:[["","appAutocompleteContent",""]]});let i=o;return i})();var dt=["root"],ft=i=>({control:i});function gt(i,o){i&1&&X(0)}function vt(i,o){if(i&1&&(Q(0,"div",1),A(1,gt,1,0,"ng-container",2),j()),i&2){let c=w().control,e=w();R(),$("ngTemplateOutlet",e.content().tpl)("ngTemplateOutletContext",G(2,ft,c))}}function yt(i,o){if(i&1&&F(0,vt,2,4,"div",1),i&2){let c=o.control;H(c!=null&&c.isVisible?0:-1)}}var Tt=(()=>{let o=class o{constructor(){this.rootTemplate=tt.required("root"),this.content=et.required(_)}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=d({type:o,selectors:[["app-autocomplete"]],contentQueries:function(t,n,s){t&1&&U(s,n.content,_,5),t&2&&x()},viewQuery:function(t,n){t&1&&W(n.rootTemplate,dt,5),t&2&&x()},exportAs:["appAutocomplete"],decls:2,vars:0,consts:[["root",""],[1,"ac-content"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(t,n){t&1&&A(0,yt,1,1,"ng-template",null,0,J)},dependencies:[it,ot],styles:[".ac-content[_ngcontent-%COMP%]{width:100%;display:block;overflow-y:auto;background-color:var(--control);color:var(--on-control);box-shadow:var(--control-box-shadow);border-color:var(--control-box-border);border-width:1px;border-style:solid;border-radius:0;font-size:14px}"]});let i=o;return i})();var Ct=["*"],Pt=(()=>{let o=class o{constructor(){this.option=l(),this.control=l()}get getActive(){let e=this.control();return e?e.options[e.activeIndex]===this.option():!1}mouseDownEvent(e){let t=this.control(),n=this.option();t&&n&&(t.selectOption(n),e.stopPropagation())}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=d({type:o,selectors:[["app-autocomplete-option"]],hostVars:2,hostBindings:function(t,n){t&1&&g("mousedown",function(r){return n.mouseDownEvent(r)}),t&2&&z("active",n.getActive)},inputs:{option:[1,"option"],control:[1,"control"]},ngContentSelectors:Ct,decls:1,vars:0,template:function(t,n){t&1&&(Y(),L(0))},styles:["[_nghost-%COMP%]{display:block;padding:5px;cursor:pointer}[_nghost-%COMP%]:hover{background-color:var(--control-hover);color:var(--on-control-hover)}.active[_nghost-%COMP%]{background-color:var(--control-active);color:var(--on-control-active)}[_nghost-%COMP%]     b{color:var(--on-control-active)}"],changeDetection:0});let i=o;return i})();function bt(i){return i.target.value}var h=-1;function At(i,o){return T(document,"click").pipe(a(c=>{let e=c.target,t=e!==o,n=!i.overlayElement.contains(e);return t&&n}),p(i.detachments()))}var Qt=(()=>{let o=class o{constructor(){this.appAutocomplete=l(),this.appAutocompleteControl=l(),this.appAutocompleteSettings=l(),this.appAutocompleteNavigKeyDown=Z(),this.isVisible=!1,this.activeIndex=h,this.query="",this.options=[],this.unsubscribe=new m,this.host=u(K),this.vcr=u(B),this.overlay=u(rt),this.keydown$=new m,this.keyup$=new m,this.settings={allowEmpty:!1,debounceTime:300},this.isCreated=!1}ngOnInit(){this.filterEnterEvent(this.keydown$),this.listenAndSuggest(this.keyup$),this.navigateSuggestionsWithArrows(this.keydown$)}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}ngOnChanges(e){e.appAutocompleteSettings&&(this.settings=C(C({},this.settings),this.appAutocompleteSettings()))}selectOption(e){this.hide();let t=this.appAutocompleteControl();t&&(this.query=t.autocompleteSelectResult(e))}handleEsc(e){mt(e)&&(this.hide(),e.preventDefault()),this.keydown$.next(e)}onkeyup(e){e.preventDefault(),e.stopPropagation(),this.keyup$.next(e)}run(){!this.query||this.query.length===0||this.request(this.query).then(e=>{this.activeIndex=h,this.options=e,this.display()}).catch(e=>{console.error(e)})}static resolveNextIndex(e,t,n){let s=t?1:-1,r=n.length-1,E=h,v=e+s,y=v;return v===r+1&&(y=E),v===E-1&&(y=r),y}updateIndex(e){this.activeIndex=o.resolveNextIndex(this.activeIndex,ut(e),this.options)}listenAndSuggest(e){e.pipe(a(t=>!lt(t)),k(bt),N(this.settings.debounceTime),S,I(),q(t=>(this.query=t,t)),a(t=>this.settings.allowEmpty||t.length>0),M(t=>b(this,null,function*(){return this.request(t)})),p(this.unsubscribe)).subscribe(t=>{this.activeIndex=h,this.options=t,this.display()})}display(){if(this.options.length===0){this.isVisible=!1;return}this.isCreated||this.openDropdown(),this.isVisible=this.options.length>0}request(e){return b(this,null,function*(){let t=this.appAutocompleteControl();return t?t.autocompleteGetData(e):[]})}filterEnterEvent(e){e.pipe(a(ht),p(this.unsubscribe)).subscribe(()=>{if(!this.isVisible){this.query=this.host.nativeElement.value;let s=this.appAutocompleteControl();s&&s.autocompleteEnter(this.query);return}let t=this.options.at(this.activeIndex);this.hide();let n=this.appAutocompleteControl();t?this.selectOption(t):n&&n.autocompleteEnter(this.query)})}navigateSuggestionsWithArrows(e){e.pipe(a(ct),p(this.unsubscribe)).subscribe(t=>{at(t)?(this.hide(),this.host.nativeElement.selectionStart===this.host.nativeElement.value.length&&this.appAutocompleteNavigKeyDown.emit(t)):pt(t)?(this.hide(),this.host.nativeElement.selectionEnd===0&&this.appAutocompleteNavigKeyDown.emit(t)):this.isVisible?(this.updateIndex(t),this.display()):this.appAutocompleteNavigKeyDown.emit(t)})}openDropdown(){let e=this.appAutocomplete()?.rootTemplate();if(!e)return;this.overlayRef=this.createOverlay();let t=new nt(e,this.vcr,{control:this});this.overlayRef.attach(t),At(this.overlayRef,this.host.nativeElement).pipe(p(this.unsubscribe)).subscribe(()=>{this.close()}),this.isCreated=!0,this.isVisible=!0}hide(){this.isVisible=!1,this.activeIndex=h}close(){this.overlayRef&&(this.overlayRef.detach(),this.overlayRef=void 0),this.isCreated=!1}createOverlay(){return this.overlay.create(this.getOverlayConfig())}getOverlayConfig(){return new st({hasBackdrop:!1,backdropClass:"",panelClass:"ngx-autocomplete",scrollStrategy:this.overlay.scrollStrategies.block(),positionStrategy:this.getOverlayPosition()})}getOverlayPosition(){let e=[new D({originX:"start",originY:"bottom"},{overlayX:"start",overlayY:"top"}),new D({originX:"start",originY:"top"},{overlayX:"start",overlayY:"bottom"})];return this.overlay.position().flexibleConnectedTo(this.host).withFlexibleDimensions(!1).withPositions(e).withPush(!1)}};o.\u0275fac=function(t){return new(t||o)},o.\u0275dir=f({type:o,selectors:[["","appAutocomplete",""]],hostBindings:function(t,n){t&1&&g("keydown",function(r){return n.handleEsc(r)})("keyup",function(r){return n.onkeyup(r)})},inputs:{appAutocomplete:[1,"appAutocomplete"],appAutocompleteControl:[1,"appAutocompleteControl"],appAutocompleteSettings:[1,"appAutocompleteSettings"]},outputs:{appAutocompleteNavigKeyDown:"appAutocompleteNavigKeyDown"},features:[P]});let i=o;return i})();export{_ as a,Tt as b,Pt as c,Qt as d};
