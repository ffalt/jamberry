import{a as gi,b as Ci,c as hi,d as Je,e as Ti,g as fi,h as Mi,i as Oi}from"./chunk-HMP63COV.js";import{b as pi}from"./chunk-JNPRJ3MQ.js";import{a as Ei}from"./chunk-O4OFMMXO.js";import{a as di,b as _i,c as ui,d as mi}from"./chunk-MZ65RTTK.js";import{a as li}from"./chunk-6WAGYCOA.js";import{a as Ke}from"./chunk-JSUNL6NZ.js";import{a as ci}from"./chunk-AVB7SNA4.js";import{a as Ve,b as Ue,c as We,d as je}from"./chunk-SDT7PSNL.js";import"./chunk-24DMSAFT.js";import{b as ge,c as Ce,d as K,e as Be,f as $e,g as J,h as Fe,k as Jt,l as Yt,m as Qt,o as Y}from"./chunk-Y5Z5ITNC.js";import{a as ai}from"./chunk-K7RVMPTP.js";import"./chunk-F6BYEP4R.js";import"./chunk-VP6KNDS4.js";import{a as ri,b as ze}from"./chunk-D2CLWX7O.js";import{c as ei,e as ti,f as ii,h as ni,k as He}from"./chunk-AQDYGNZB.js";import{a as si}from"./chunk-PZTZCA44.js";import"./chunk-4HNSRH53.js";import{G as Re}from"./chunk-ZVKVGF76.js";import{f as oi}from"./chunk-T6GM3CFW.js";import{$b as Se,$c as jt,$d as he,Aa as j,Ac as X,Ba as Rt,Cc as De,Dc as Ft,Ec as Xt,Fc as Ht,Gb as Nt,Gc as zt,Hb as T,Hc as Vt,Ib as f,Ic as ce,Jb as It,Jc as pe,Kb as te,Kd as qt,Lb as I,Lc as Ut,Mb as y,Nb as S,Ob as d,Od as q,Pb as c,Pd as Xe,Qb as M,Qd as _t,Rb as G,Rd as ut,Sb as B,Tb as Pe,Ub as k,Uc as Q,Vb as D,Vc as v,Wb as yt,Wc as ne,Wd as Zt,Xc as Wt,Y as Me,Ya as ke,_a as bt,_b as A,a as we,ab as _,ac as C,bc as Lt,ca as St,cc as wt,dc as h,e as E,ec as kt,fc as u,ia as H,ib as ct,k as se,na as p,nb as b,nc as ie,oa as g,oc as oe,pa as At,pc as Dt,pd as Kt,qb as xt,qc as dt,rb as vt,rc as le,sb as ee,sc as Gt,tc as O,uc as w,ud as Ge,vc as V,wc as Bt,wd as Ae,xc as $t,yc as $,zc as F}from"./chunk-H2EXZDP6.js";var Te=class{};var Ye=["2 Tone","2-Step Garage","4-Beat","A Cappella","Abstract","Acid","Acid Breaks","Acid House","Acid Jazz","Acid Punk","Acid Rock","Acid Techno","Acid Trance","Acousmatic Music","Acoustic","Adult Contemporary","African","African Blues","African Heavy Metal","African Hip Hop","Afro / Cosmic Disco","Afro-Cuban Jazz","Afrobeat","Aggrotech","Alternative","Alternative Country","Alternative Dance","Alternative Hip Hop","Alternative Metal","Alternative Rock","Ambient","Ambient Dub","Ambient House","American Folk Revival","Americana","Anarcho Punk","Anime","Anti-folk","Apala","Arab Pop","Art Punk","Art Rock","Asian","Asian American Jazz","Asian Underground","Atlanta Hip Hop","Audio Theatre","Audiobook","Australian Country Music","Australian Hip Hop","AustroPop","Avant-garde","Avant-garde Jazz","Avant-garde Metal","Avantgarde","Ax\xE9","Bachata","Background Music","Baila","Baithak Gana","Bakersfield sound","Balearic Beat","Balearic Trance","Ballad","Baltimore Club","Banda","Baroque","Baroque Pop","Bass","Bassline","Baul","Beat","Beat Music","Beautiful Music","Bebop","Benga","Berlin School","Bhangra","Big Band","Big Beat","Big Room","Bikutsi","BitPop","Black Metal","Blue-Eyed Soul","Bluegrass","Blues","Blues Country","Blues Rock","Blues Shouter","Bolero","Bongo Flava","Boogie","Boogie-Woogie","Booty Bass","Bossa Nova","Bounce Music","Bouncy House","Bouncy Techno","Bouyon","Brazilian","Brazilian Rock","Breakbeat","Breakbeat Hardcore","Breakcore","Breakstep","Brega","Brick City club","Brill Building","British Blues","British Dance Band","British Folk revival","British Hip Hop","BritPop","Broken Beat","Brostep","Bubblegum Dance","Bubblegum Pop","Bullerengue","C-Pop","Cabaret","Cadence-lypso","Cajun","Cajun fiddle tunes","Calypso","Canadian Blues","Canci\xF3n","Canterbury scene","Canzone","Cape Jazz","Caribbean","Celtic","Celtic Metal","Celtic Music","Celtic Punk","Cha Cha Cha","Chalga","Chamber Jazz","Chamber Music","Chanson","Chap Hop","Chicago Blues","Chicago Hip Hop","Chicago House","Chicano Rap","Chicha","Chill-out","Chillout","Chillstep","Chillwave","Chimurenga","Chinese Rock","Chiptune","Chopped & Screwed","Choro","Chorus","Christian Country Music","Christian Gangsta Rap","Christian Hip Hop","Christian Metal","Christian Pop","Christian Punk","Christian Rap","Christian Rock","Chutney","Chutney soca","Classic Country","Classic female Blues","Classic Rock","Classical","Classical crossover","Close harmony","Club","Club-House","Coldwave","Comedy","Compas","Complextro","Congolese rumba","Conscious Hip Hop","Contemporary Christian","Contemporary Folk","Contemporary R&B","Continental Jazz","Cool Jazz","Country","Country Blues","Country Pop","Country Rap","Country Rock","Country-Rap","Coup\xE9-D\xE9cal\xE9","Western Music","CowPunk","Criolla","Crossover","Crossover Jazz","Crossover Thrash","Crunk","Crunkcore","Crust Punk","Crustgrind","Cult","Cumbia","Cumbia Rap","Cybergrind","D-beat","Dance","Dance Hall","Dance-Pop","Dance-Punk","Dance-Rock","Dancehall","Dancehall Music","Dangdut","Dansband Music","Dark Ambient","Dark Cabaret","Dark Electro","Dark Wave","Darkcore","Darkcore jungle","Darkstep","Darkwave","Death 'n' roll","Death industrial","Death Metal","Death-Doom","Deathcore","DeathRock","Deep Funk","Deep House","Delta Blues","Desert Rock","Detroit Blues","Detroit Hip Hop","Detroit Techno","Digital hardcore","Disco","Disco polo","Diva House","Dixieland","Djent","Doom Metal","Doomcore","Downtempo","Dream","Dream Pop","Dream Trance","Drill","Drill & Bass","Drone Metal","Drone Music","Drum & Bass","Drum Solo","Drumstep","Dub","Dub Techno","Dubstep","Dubstyle","Dubtronica","Duet","Dunedin Sound","Dutch House","East Coast Hip Hop","Easy Listening","EBM","Eclectic","Electric Blues","Electro","Electro House","Electro Music","Electro Swing","Electro-Industrial","Electroacoustic","Electroacoustic Music","Electroclash","Electronic","Electronic Body Music","Electronic Rock","Electronica","Electronicore","ElectroPop","ElectroPunk","Elevator Music","Emo","Ethereal Wave","Ethnic","Ethnic electronica","Ethno Jazz","Euro Disco","Euro-House","Euro-Techno","Eurobeat","Eurodance","European free Jazz","EuroPop","Experimental","Experimental Hip Hop","Experimental Music","Experimental Rock","Fado","Fann at-Tanbura","Fast Fusion","Fidget House","Fijiri","Filk Music","Filmi","Flamenco","Florida Breaks","Folk","Folk Metal","Folk Pop","Folk Punk","Folk Rock","Folk-Rock","Folklore","Folktronica","Forr\xF3","Franco-Country","Freak Folk","Freakbeat","Free Funk","Free Improvisation","Free Jazz","Free Tekno","Freestyle","Freestyle Music","Freestyle Rap","French House","French Pop","Frevo","Fuji Music","Full On","Funk","Funk Carioca","Funk Metal","Funkstep","Funktronica","Funky House","Furniture Music","Fusion","Future Garage","Future House","FuturePop","G-Funk","Gabba","Game","Game Boy Music","Gamelan","Gangsta Rap","Garage","Garage House","Garage Punk","Garage Rock","Genge","Ghetto House","Ghettotech","Glam Metal","Glam Rock","Glitch","Glitch Hop","Global","Go-go","Goa","Goa Trance","Golden Age Hip Hop","Goregrind","Gospel","Gospel Blues","Gothic","Gothic Metal","Gothic Rock","Grime","Grindcore","Grindie","Groove Metal","Grunge","Grupera","Guajira","Gypsy Jazz","Gypsy Punk","Happy Hardcore","Hard Bop","Hard House","Hard NRG","Hard Rock","Hard Trance","Hardbag","Hardcore","Hardcore Rap","Hardcore Hip Hop","Hardcore Punk","Hardstep","Hardstyle","Heavy Metal","Hellbilly Music","Hi-NRG","Highlife","Hill Country Blues","Hip Hop","Hip Hop Soul","Hip House","Hip Pop","Hip Hop","Hiplife","Hokum","Hokum Blues","Honky Tonk","Horror Punk","Horrorcore","House","House Music","Houston Hip Hop","Huayno","Humour","Hyphy","IDM","Igbo highlife","Igbo Rap","Illbient","Indian Pop","Indie","Indie Folk","Indie Pop","Indie Rock","Indietronica","Industrial","Industrial Folk","Industrial Hip Hop","Industrial Metal","Industrial Music","Industrial Rock","Industro-Goth","Instrumental","Instrumental Country","Instrumental Hip Hop","Instrumental Pop","Instrumental Rock","Iranian Pop","Isicathamiya","Isolationism","Italo Dance","Italo Disco","Italo House","J-Pop","Jam Band","Jangle Pop","Japanoise","Jazz","Jazz Blues","Jazz Fusion","Jazz House","Jazz Rap","Jazz Rock","Jazz-Funk","Jazz+Funk","Jerkin'","Jersey Club","Jit","JPop","J\xF9j\xFA","Jump Blues","Jump-up","Jumpstyle","Jungle","K-Pop","Kadongo Kamu","Kansas City Blues","Kansas City Jazz","Kapuka","Keroncong","Khaliji","Kizomba","Krautrock","Kuduro","Kwaito","Kwassa Kwassa","Kwela","La\xEFk\xF3","Lambada","Laptronica","Latin","Latin alternative","Latin ballad","Latin Christian","Latin House","Latin Jazz","Latin Metal","Latin Pop","Latin Rock","Latin Swing","Lavani","Leftfield","Lento Violento","Liquid Dubstep","Liquid Funk","Livetronica","Liwa","Lo-fi","Lo-Fi","Louisiana Blues","Louisiana Swamp Pop","Lounge","Lounge Music","Lovers Rock","Low Bap","Lowercase","Luk Krung","Luk Thung","Lyrical Hip Hop","M-Base","Mafioso Rap","Mainstream Jazz","M\xE1kina","Makossa","Maloya","Mambo","MandoPop","Manila Sound","Maracatu","Mariachi","Marrabenta","Math Rock","Mathcore","Mbalax","Mbaqanga","Mbube","Medieval Metal","Meditative","Melbourne Bounce","Melodic Death Metal","Melodic Metalcore","Memphis Blues","Merengue","MerenRap","M\xE9ringue","Metal","Metalcore","Mexican Pop","Mexican Son","Miami Bass","Microhouse","Middle of the road","Midwest Hip Hop","Minimal Techno","Minimal Wave","Modal Jazz","Moombahcore","Moombahton","Morlam","Morna","Mosambique","Motswako","M\xFAsica Criolla","M\xFAsica Popular Brasileira","M\xFAsica Sertaneja","Musical","Musique Concr\xE8te","Nagoya Kei","Nashville Sound","National Folk","Native American","NDW","Ndombolo","NederPop","Neo Soul","Neo-Bop Jazz","Neo-Psychedelia","Neo-Swing","Neoclassical","Neoclassical Metal","Neofolk","Neotraditional Country","Nerdcore","Neue Deutsche Welle","NeuroFunk","Neurohop","New Age","New Beat","New jack swing","New Jersey Hip Hop","New Prog","New Rave","New Romantic","New Romanticism","New School Hip Hop","New Wave","New-age Music","Nintendocore","Nitzhonot","No wave","Noise","Noise Rock","Noisegrind","Nortec","Norte\xF1o","Northern Soul","Novelty Ragtime","Nu Jazz","Nu Metal","Nu Skool Breaks","Nu-Breakz","Nu-Disco","Nu-Funk","Nu-Gaze","Nu-NRG","Nueva canci\xF3n","Old School Hip Hop","Oldies","Opera","Operatic Pop","Orchestral Jazz","Original Pilipino Music","Other","Outlaw Country","Outsider House","P-Funk","Pagan Metal","Pagode","Paisley Underground","Palm-wine","Piedmont Blues","Pinoy Pop","Podcast","Political Hip Hop","Polka","Polsk Punk","Pop","Pop Punk","Pop Rap","Pop Rock","Pop Soul","Pop Sunda","Pop-Folk","Pop-Funk","Porn Groove","Porro","Post-Bop","Post-Disco","Post-Grunge","Post-Hardcore","Post-Metal","Post-Punk","Post-Punk Revival","Post-Rock","Power Ballad","Power Electronics","Power Metal","Power Noise","Power Pop","Powerviolence","Pranks","Primus","Progressive Bluegrass","Progressive Country","Progressive Folk","Progressive House","Progressive Metal","Progressive Pop","Progressive Rock","Progressive Trance","Protest Song","Psybient","Psychedelic","Psychedelic Folk","Psychedelic Pop","Psychedelic Rock","Psychedelic Trance","Psychobilly","Punkabilly","Psytrance","Punk","Punk Blues","Punk Jazz","Punk Rock","Punta","Punta Rock","R&B","Raga Rock","Ragga","Ragga Jungle","Raggacore","Ragini","Ragtime","Ra\xEF","Ranchera","Rap","Rap Metal","Rap Music","Rap Opera","Rap Rock","Rapcore","Rara tech","Rasin","Rave","Reactionary Bluegrass","Rebetiko","Red Dirt","Reggae","Reggae Espa\xF1ol","Spanish Reggae","Reggae Fusion","Reggaestep","Reggaeton","Regional Mexican","Retro","Revival","Rhythm & Blues","Rhythmic Soul","Riot grrrl","Rock","Rock & Roll","Rock en Espa\xF1ol","Rock in Opposition","Rockabilly","Rocksteady","Rumba","Russian Pop","Sadcore","Sakara","Salsa","Salsa rom\xE1ntica","Samba","Samba Rock","Sambass","Satire","Sawt","Schlager","Screamo","Sega","Seggae","Semba","Sertanejo","Shangaan electro","Shibuya-kei","Shoegaze","Showtunes","Singer-songwriter","Ska","Ska Jazz","Ska Punk","Skate Punk","Skiffle","Skweee","Slow Jam","Slow Rock","Slowcore","Sludge Metal","Smooth Jazz","Snap Music","Soca","Soft Rock","Son","Son Cubano","Sonata","Songo","Songo-Salsa","Sophisti-Pop","Soukous","Soul","Soul Blues","Soul Jazz","Sound Clip","Soundtrack","Southern Hip Hop","Southern Rock","Southern Soul","Space","Space Age Pop","Space Disco","Space Music","Space Rock","Speech","Speed garage","Speed Metal","Speedcore","St.Louis Blues","St.Louis Hip Hop","Stoner Rock","Straight-ahead Jazz","Street Punk","Stride Jazz","Sufi Rock","SungPoetry","Sunshine Pop","Suomisaundi","Surf Pop","Surf Rock","Swamp Blues","Swing","Symphonic black Metal","Symphonic Metal","Symphonic Rock","Symphony","Synthpop","SynthPop","Synthwave","Taarab","Tango","Tech House","Tech Trance","Techdombe","Technical death Metal","Techno","Techno-Industrial","Techstep","Tecno Brega","Tecnobrega","Teen Pop","Tejano","Terror","Texas Blues","Texas Country","Thai Pop","Third stream","Thrash Metal","Thrashcore","Timba","Top 40","Trad Jazz","Traditional Country Music","Traditional Pop Music","Trailer","Trance","Trance Music","TRap","TRapstep","Tribal","Tribal House","Trip hop","Trip-Hop","Trival","Trop Rock","Tropical","Tropical House","Tropicalia","TropiPop","Truck-driving Country","Turkish Pop","Turntablism","Twin Cities Hip Hop","Twoubadou","UK Funky","UK Garage","UK Hardcore","Unblack Metal","Underground Hip Hop","Uplifting Trance","Urban Pasifika","V-Pop","Vallenato","Vaporwave","Video game Music","Viking Metal","VisPop","Visual Kei","Vocal","Vocal Jazz","Vocal Trance","War Metal","Weltmusik","West Coast Blues","West Coast Hip Hop","West Coast Jazz","Western swing","Witch House","Wonky","Wonky Pop","World Fusion","World Music","Worldbeat","Zouglou","Zouk","Zouk-Lambada","Zydeco"];var s=(function(r){return r[r.Filename=1]="Filename",r[r.IdText=2]="IdText",r[r.IdBin=3]="IdBin",r[r.Text=4]="Text",r[r.TextList=5]="TextList",r[r.LangDescText=6]="LangDescText",r[r.PlayCounter=7]="PlayCounter",r[r.Popularimeter=8]="Popularimeter",r[r.MusicCDId=9]="MusicCDId",r[r.EventTimingCodes=10]="EventTimingCodes",r[r.SYLT=11]="SYLT",r[r.GEOB=12]="GEOB",r[r.ETCO=13]="ETCO",r[r.PCST=14]="PCST",r[r.LINK=15]="LINK",r[r.AENC=16]="AENC",r[r.Pic=17]="Pic",r[r.RVAD=18]="RVAD",r[r.RGAD=19]="RGAD",r[r.RVAD2=20]="RVAD2",r[r.CTOC=21]="CTOC",r[r.CHAP=22]="CHAP",r[r.Bool=23]="Bool",r[r.Unknown=24]="Unknown",r})(s||{});function mt(r){return L[r]}var L={internal_file:{title:"Filename",versions:[2,3,4],impl:s.Filename},UFI:{title:"Unique file identifier",versions:[2],impl:s.IdText,upgrade:"UFID"},TOT:{title:"Original album/Movie/Show title",versions:[2],impl:s.Text,upgrade:"TOAL"},CDM:{title:"Compressed Data Metaframe",versions:[2],impl:s.Unknown},CRM:{title:"Encrypted meta",versions:[2],impl:s.Unknown},TT1:{title:"Content group",versions:[2],impl:s.Text,upgrade:"TIT1"},TT2:{title:"Title",versions:[2],impl:s.Text,upgrade:"TIT2"},TT3:{title:"Subtitle",versions:[2],impl:s.Text,upgrade:"TIT3"},TP1:{title:"Artist",versions:[2],impl:s.Text,upgrade:"TPE1"},TP2:{title:"Album Artist",versions:[2],impl:s.Text,upgrade:"TPE2"},TP3:{title:"Conductor",versions:[2],impl:s.Text,upgrade:"TPE3"},TP4:{title:"Remixer",versions:[2],impl:s.Text,upgrade:"TPE4"},TCM:{title:"Composer",versions:[2],impl:s.Text,upgrade:"TCOM"},TXT:{title:"Lyricist",versions:[2],impl:s.Text,upgrade:"TEXT"},TLA:{title:"Languages",versions:[2],impl:s.Text,upgrade:"TLAN"},TCO:{title:"Genre",versions:[2],impl:s.Text,upgrade:"TCON"},TAL:{title:"Album",versions:[2],impl:s.Text,upgrade:"TALB"},TPA:{title:"Part of a set",versions:[2],impl:s.Text,upgrade:"TPOS"},TRK:{title:"Track number",versions:[2],impl:s.Text,upgrade:"TRCK"},TRC:{title:"ISRC (international standard recording code)",versions:[2],impl:s.Text,upgrade:"TSRC"},TYE:{title:"Year",versions:[2],impl:s.Text,upgrade:"TYER"},TDA:{title:"Date",versions:[2],impl:s.Text,upgrade:"TDAT"},TIM:{title:"Time",versions:[2],impl:s.Text,upgrade:"TIME"},TRD:{title:"Recording dates",versions:[2],impl:s.Text,upgrade:"TRDA"},TMT:{title:"Media type",versions:[2],impl:s.Text,upgrade:"TMED"},TBP:{title:"BPM",versions:[2],impl:s.Text,upgrade:"TBPM"},TCR:{title:"Copyright message",versions:[2],impl:s.Text,upgrade:"TCOP"},TPB:{title:"Publisher",versions:[2],impl:s.Text,upgrade:"TPUB"},TEN:{title:"Encoded by",versions:[2],impl:s.Text,upgrade:"TENC"},TSS:{title:"Encoding Software/Hardware",versions:[2],impl:s.Text,upgrade:"TSSE"},TOF:{title:"Original filename",versions:[2],impl:s.Text,upgrade:"TOFN"},TLE:{title:"Length",versions:[2],impl:s.Text,upgrade:"TLEN"},TSI:{title:"Size",versions:[2],impl:s.Text,upgrade:"TSIZ"},TDY:{title:"Playlist delay",versions:[2],impl:s.Text,upgrade:"TDLY"},TKE:{title:"Initial key",versions:[2],impl:s.Text,upgrade:"TKEY"},TOL:{title:"Original lyricist",versions:[2],impl:s.Text,upgrade:"TOLY"},TOA:{title:"Original artist",versions:[2],impl:s.Text,upgrade:"TOPE"},TOR:{title:"Original release year",versions:[2],impl:s.Text,upgrade:"TORY"},TXX:{title:"User defined text",versions:[2],impl:s.IdText,upgrade:"TXXX"},WAF:{title:"Official audio file webpage",versions:[2],impl:s.Text,upgrade:"WOAF"},WAR:{title:"Official artist/performer webpage",versions:[2],impl:s.Text,upgrade:"WOAR"},WAS:{title:"Official audio source webpage",versions:[2],impl:s.Text,upgrade:"WOAS"},WCM:{title:"Commercial information",versions:[2],impl:s.Text,upgrade:"WCOM"},WCP:{title:"Copyright/Legal information",versions:[2],impl:s.Text,upgrade:"WCOP"},WPB:{title:"Publishers official webpage",versions:[2],impl:s.Text,upgrade:"WPUB"},WXX:{title:"User defined URL link frame",versions:[2],impl:s.IdText,upgrade:"WXXX"},IPL:{title:"Involved people list",versions:[2],impl:s.TextList,upgrade:"IPLS"},ETC:{title:"Event timing codes",versions:[2],impl:s.EventTimingCodes,upgrade:"ETCO"},MLL:{title:"MPEG location lookup table",versions:[2],impl:s.Unknown,upgrade:"MLLT"},STC:{title:"Synchronised tempo codes",versions:[2],impl:s.Unknown,upgrade:"SYTC"},ULT:{title:"Lyrics",versions:[2],impl:s.LangDescText,upgrade:"USLT"},SLT:{title:"Synchronised Lyrics",versions:[2],impl:s.SYLT,upgrade:"SYLT"},COM:{title:"Comments",versions:[2],impl:s.LangDescText,upgrade:"COMM"},RVA:{title:"Relative volume adjustment",versions:[2],impl:s.RVAD,upgrade:"RVAD"},EQU:{title:"Equalisation",versions:[2],impl:s.Unknown,upgrade:"EQUA"},REV:{title:"Reverb",versions:[2],impl:s.Unknown,upgrade:"RVRB"},PIC:{title:"Attached picture",versions:[2],impl:s.Pic,upgrade:"APIC"},GEO:{title:"General encapsulated object",versions:[2],impl:s.GEOB,upgrade:"GEOB"},CNT:{title:"Play counter",versions:[2],impl:s.PlayCounter,upgrade:"PCNT"},POP:{title:"Popularimeter",versions:[2],impl:s.Popularimeter,upgrade:"POPM"},BUF:{title:"Recommended buffer size",versions:[2],impl:s.Unknown,upgrade:"RBUF"},CRA:{title:"Audio encryption",versions:[2],impl:s.AENC,upgrade:"AENC"},LNK:{title:"Linked information",versions:[2],impl:s.LINK,upgrade:"LINK"},NCO:{title:"MusicMatch Binary",versions:[2],impl:s.Unknown,upgrade:"NCON"},PRI:{title:"Private frame",versions:[2],impl:s.IdBin,upgrade:"PRIV"},TCP:{title:"iTunes Compilation Flag",versions:[2],impl:s.Bool,upgrade:"TCMP"},TST:{title:"Title sort order",versions:[2],impl:s.Text,upgrade:"XSOT"},TSP:{title:"Artist sort order",versions:[2],impl:s.Text,upgrade:"XSOP"},TSA:{title:"Album sort order",versions:[2],impl:s.Text,upgrade:"XSOA"},TS2:{title:"Album Artist sort order",versions:[2],impl:s.Text,upgrade:"TSO2"},TSC:{title:"Composer sort order",versions:[2],impl:s.Text,upgrade:"TSOC"},TDR:{title:"Release time",versions:[2],impl:s.Text,upgrade:"TDRL"},TDS:{title:"iTunes podcast description",versions:[2],impl:s.Text,upgrade:"TDES"},TID:{title:"Podcast URL",versions:[2],impl:s.Text,upgrade:"TGID"},WFD:{title:"Podcast feed URL",versions:[2],impl:s.Text,upgrade:"WFED"},PCS:{title:"iTunes podcast marker",versions:[2],impl:s.PCST,upgrade:"PCST"},XSOA:{title:"Album sort order",versions:[3],impl:s.Text,upgrade:"TSOA"},XSOP:{title:"Performer sort order",versions:[3],impl:s.Text,upgrade:"TSOP"},XSOT:{title:"Title sort order",versions:[3],impl:s.Text,upgrade:"TSOT"},XDOR:{title:"Original release time",versions:[3],impl:s.Text,upgrade:"TDOR"},TIT1:{title:"Group",versions:[3,4],impl:s.Text},TIT2:{title:"Title",versions:[3,4],impl:s.Text},TIT3:{title:"Subtitle",versions:[3,4],impl:s.Text},TALB:{title:"Album",versions:[3,4],impl:s.Text},TOAL:{title:"Original album",versions:[3,4],impl:s.Text},TRCK:{title:"Track number",versions:[3,4],impl:s.Text},TPOS:{title:"Part of a set",versions:[3,4],impl:s.Text},TSRC:{title:"ISRC (international standard recording code)",versions:[3,4],impl:s.Text},TPE1:{title:"Artist",versions:[3,4],impl:s.Text},TPE2:{title:"Album Artist",versions:[3,4],impl:s.Text},TPE3:{title:"Conductor",versions:[3,4],impl:s.Text},TPE4:{title:"Remixer",versions:[3,4],impl:s.Text},TOPE:{title:"Original artist",versions:[3,4],impl:s.Text},TEXT:{title:"Lyricist",versions:[3,4],impl:s.Text},TOLY:{title:"Original lyricist",versions:[3,4],impl:s.Text},TCOM:{title:"Composer",versions:[3,4],impl:s.Text},TENC:{title:"Encoded by",versions:[3,4],impl:s.Text},TBPM:{title:"BPM",versions:[3,4],impl:s.Text},TLEN:{title:"Length",versions:[3,4],impl:s.Text},TKEY:{title:"Initial key",versions:[3,4],impl:s.Text},TLAN:{title:"Languages",versions:[3,4],impl:s.Text},TCON:{title:"Genre",versions:[3,4],impl:s.Text},TFLT:{title:"File type",versions:[3,4],impl:s.Text},TMED:{title:"Media type",versions:[3,4],impl:s.Text},TCOP:{title:"Copyright message",versions:[3,4],impl:s.Text},TPUB:{title:"Publisher",versions:[3,4],impl:s.Text},TOWN:{title:"File owner",versions:[3,4],impl:s.Text},TRSN:{title:"Internet radio station name",versions:[3,4],impl:s.Text},TRSO:{title:"Internet radio station owner",versions:[3,4],impl:s.Text},TOFN:{title:"Original filename",versions:[3,4],impl:s.Text},TDLY:{title:"Playlist delay",versions:[3,4],impl:s.Text},TSSE:{versions:[3,4],title:"Encoding Software/Hardware",impl:s.Text},TSST:{versions:[3,4],title:"Set subtitle",impl:s.Text},TDAT:{title:"Date",versions:[3],impl:s.Text},TIME:{title:"Time",versions:[3],impl:s.Text},TORY:{title:"Original release year",versions:[3],impl:s.Text},TRDA:{title:"Recording dates",versions:[3],impl:s.Text},TSIZ:{title:"Size",versions:[3],impl:s.Text},TYER:{title:"Year",versions:[3],impl:s.Text},TMCL:{versions:[4],title:"Musician credits list",impl:s.TextList},TIPL:{versions:[4],title:"Involved people list",impl:s.TextList},TMOO:{title:"Mood",versions:[4],impl:s.Text},TPRO:{title:"Produced notice",versions:[4],impl:s.Text},TDOR:{title:"Original release time",versions:[4],impl:s.Text},TDRC:{versions:[4],title:"Recording time",impl:s.Text},TDRL:{versions:[3,4],title:"Release time",impl:s.Text},TDTG:{versions:[4],title:"Tagging time",impl:s.Text},TSOA:{versions:[4],title:"Album sort order",impl:s.Text},TSOP:{versions:[4],title:"Artist sort order",impl:s.Text},TSOT:{versions:[4],title:"Title sort order",impl:s.Text},WCOM:{title:"Commercial information",versions:[3,4],impl:s.Text},WCOP:{title:"Copyright/Legal information",versions:[3,4],impl:s.Text},WOAF:{title:"Official audio file webpage",versions:[3,4],impl:s.Text},WOAR:{title:"Official artist/performer webpage",versions:[3,4],impl:s.Text},WOAS:{title:"Official audio source webpage",versions:[3,4],impl:s.Text},WORS:{title:"Official internet radio station homepage",versions:[3,4],impl:s.Text},WPAY:{title:"Payment",versions:[3,4],impl:s.Text},WPUB:{title:"Publishers official webpage",versions:[3,4],impl:s.Text},TXXX:{title:"User defined text",versions:[3,4],impl:s.IdText},WXXX:{title:"User defined URL link frame",versions:[3,4],impl:s.IdText},UFID:{title:"Unique file identifier",versions:[3,4],impl:s.IdText},MCDI:{title:"Music CD identifier",versions:[3,4],impl:s.MusicCDId},ETCO:{title:"Event timing codes",versions:[3,4],impl:s.ETCO},MLLT:{title:"MPEG location lookup table",versions:[3,4],impl:s.Unknown},SYTC:{title:"Synchronised tempo codes",versions:[3,4],impl:s.Unknown},USLT:{title:"Lyrics",versions:[3,4],impl:s.LangDescText},SYLT:{title:"Synchronised Lyrics",versions:[3,4],impl:s.SYLT},COMM:{title:"Comments",versions:[3,4],impl:s.LangDescText},RVAD:{title:"Relative volume adjustment",versions:[3,4],impl:s.RVAD},RVA2:{title:"Relative volume adjustment 2",versions:[4],impl:s.RVAD2},EQUA:{title:"Equalisation",versions:[3,4],impl:s.Unknown},RVRB:{title:"Reverb",versions:[3,4],impl:s.Unknown},APIC:{title:"Attached picture",versions:[3,4],impl:s.Pic},GEOB:{title:"General encapsulated object",versions:[3,4],impl:s.GEOB},PCNT:{title:"Play counter",versions:[3,4],impl:s.PlayCounter},POPM:{title:"Popularimeter",versions:[3,4],impl:s.Popularimeter},RBUF:{title:"Recommended buffer size",versions:[3,4],impl:s.Unknown},AENC:{title:"Audio encryption",versions:[3,4],impl:s.AENC},LINK:{title:"Linked information",versions:[3,4],impl:s.LINK},POSS:{title:"Position synchronisation",versions:[3,4],impl:s.Unknown},USER:{title:"Terms of use",versions:[3,4],impl:s.Unknown},OWNE:{title:"Ownership",versions:[3,4],impl:s.Unknown},COMR:{title:"Commercial",versions:[3,4],impl:s.Unknown},ENCR:{title:"Encryption method registration",versions:[3,4],impl:s.Unknown},GRID:{title:"Group ID registration",versions:[3,4],impl:s.Unknown},PRIV:{title:"Private frame",versions:[3,4],impl:s.IdBin},IPLS:{title:"Involved people list",versions:[3],impl:s.TextList},SIGN:{title:"Signature",versions:[4],impl:s.Unknown},SEEK:{title:"Seek",versions:[4],impl:s.Unknown},ASPI:{title:"Audio seek point index",versions:[4],impl:s.Unknown},RGAD:{title:"Replay Gain Adjustment",versions:[3,4],impl:s.RGAD},TCMP:{title:"iTunes Compilation Flag",versions:[3,4],impl:s.Bool},TSO2:{title:"Album Artist sort order",versions:[3,4],impl:s.Text},TSOC:{title:"Composer sort order",versions:[3,4],impl:s.Text},PCST:{title:"iTunes podcast marker",versions:[3,4],impl:s.PCST},TDES:{title:"iTunes podcast description",versions:[3,4],impl:s.Text},TKWD:{title:"iTunes podcast keywords",versions:[3,4],impl:s.Unknown},TGID:{title:"Podcast URL",versions:[3,4],impl:s.Text},TDEN:{title:"Encoding time",versions:[3,4],impl:s.Text},WFED:{title:"Podcast feed URL",versions:[3,4],impl:s.Text},GRP1:{title:"Group Number",versions:[3,4],impl:s.Text},NCON:{title:"MusicMatch Binary",versions:[3,4],impl:s.Unknown},CTOC:{title:"Chapter TOC",versions:[4],impl:s.CTOC},CHAP:{title:"Chapter",versions:[4],impl:s.CHAP},XHD3:{title:"mp3hd",versions:[3,4],impl:s.Unknown},CM1:{title:"User defined text",versions:[2],impl:s.Text,upgrade:"TXXX"}},ve={ASIN:"ASIN Id",CATALOGNUMBER:"Catalog Nr",SCRIPT:"Script",BARCODE:"Barcode",originalyear:"Original Year",replaygain_track_gain:"Replaygain track gain",replaygain_album_gain:"Replaygain album gain",replaygain_track_peak:"Replaygain track peak",replaygain_album_peak:"Replaygain album peak",Artists:"Artists",Supplier:"Supplier","Release type":"Release type","Acoustid Id":"Acoustid Id","MusicBrainz Track Disambiguation":"MusicBrainz Track Disambiguation","MusicBrainz Album Type":"MusicBrainz Album Type","MusicBrainz Album Artist Id":"MusicBrainz Album Artist Id","MusicBrainz Artist Id":"MusicBrainz Artist Id","MusicBrainz Album Id":"MusicBrainz Album Id","MusicBrainz Release Track Id":"MusicBrainz Release Track Id","MusicBrainz Release Group Id":"MusicBrainz Release Group Id","MusicBrainz Recording Id":"MusicBrainz Recording Id","MusicBrainz Album Status":"MusicBrainz Album Status","MusicBrainz Album Release Country":"MusicBrainz Album Release Country","MusicBrainz TRM Id":"MusicBrainz TRM Id","Discogs Artist ID":"Discogs Artist Id","Discogs Label ID":"Discogs Label Id","Discogs Master Release ID":"Discogs Master Release Id","Discogs Release ID":"Discogs Master Release Id","Discogs Votes":"Discogs Votes","Discogs Rating":"Discogs Rating"},be={"http://musicbrainz.org":"MusicBrainz Track Id"},Ne={"http://musicbrainz.org":"MusicBrainz Track Id","":"Default Comment"};function Pi(r){return r==="TXXX"?Object.keys(ve).map(e=>({subid:e,name:ve[e]})):r==="UFID"?Object.keys(be).map(e=>({subid:e,name:be[e]})):r==="COMM"?Object.keys(Ne).map(e=>({subid:e,name:Ne[e]})):[]}var re="internal_file",xe=[{id:re,width:200,force:!0},{id:"TRCK",width:60,force:!0},{id:"TIT2",width:200,force:!0},{id:"TALB",width:200,force:!0},{id:"TPE1",width:140,force:!0},{id:"TPE2",width:140,force:!0},{id:"TOPE",width:140},{id:"TCON",width:100,force:!0},{id:"TPOS",width:60,force:!0},{id:"TIT1",width:200,force:!0},{id:"GRP1",width:60,force:!0},{id:"TMOO",width:100},{id:"APIC",width:100,force:!0},{id:"USLT",width:200,force:!0},{id:"TSOP",width:140},{id:"TSO2",width:140},{id:"TXXX",subid:"Artists",width:140},{id:"IPLS",width:140},{id:"TIPL",width:140},{id:"TMCL",width:140},{id:"TYER",width:100},{id:"TDOR",width:100,force:!0},{id:"TDRC",width:100,force:!0},{id:"TDRL",width:80},{id:"TDAT",width:60},{id:"TORY",width:60},{id:"TXXX",subid:"originalyear",width:60},{id:"TXXX",subid:"MusicBrainz Album Type",width:100,force:!0},{id:"TXXX",subid:"MusicBrainz Album Status",width:60,force:!0},{id:"TXXX",subid:"MusicBrainz Album Release Country",width:60},{id:"TXXX",subid:"MusicBrainz Track Disambiguation",width:100},{id:"TXXX",subid:"Release type",width:100},{id:"TXXX",subid:"SCRIPT",width:60},{id:"TLAN",width:60},{id:"TMED",width:40},{id:"TLEN",width:60},{id:"TIME",width:60},{id:"TKEY",width:60},{id:"TBPM",width:60},{id:"APIC",width:80},{id:"TPUB",width:140},{id:"WPUB",width:140},{id:"WCOP",width:140},{id:"TCOP",width:140},{id:"TCOM",width:140},{id:"TSOC",width:140},{id:"MCDI",width:40},{id:"TXXX",subid:"Acoustid Id",width:40},{id:"TXXX",subid:"ASIN",width:100},{id:"UFID",subid:"http://musicbrainz.org",width:80},{id:"TXXX",subid:"MusicBrainz Release Track Id",width:80},{id:"TXXX",subid:"MusicBrainz Album Id",width:80},{id:"TXXX",subid:"MusicBrainz Album Artist Id",width:80},{id:"TXXX",subid:"MusicBrainz Artist Id",width:80},{id:"TXXX",subid:"MusicBrainz Release Group Id",width:80},{id:"TSSE",width:80},{id:"TFLT",width:80},{id:"TSST",width:80},{id:"TXXX",subid:"Ripping tool",width:80},{id:"TXXX",subid:"Ripping date",width:80},{id:"TDEN",width:80},{id:"TXXX",subid:"Rip date",width:80},{id:"TXXX",subid:"Source",width:80},{id:"TXXX",subid:"Supplier",width:80},{id:"TENC",width:80},{id:"TXXX",subid:"ASIN",width:110},{id:"TSRC",width:110},{id:"TXXX",subid:"BARCODE",width:110},{id:"PRIV",subid:"http://www.cdtag.com",width:100},{id:"TXXX",subid:"CATALOGNUMBER",width:110},{id:"TCMP",width:40},{id:"COMM",width:140},{id:"WXXX",width:140},{id:"GEOB",width:140}],Si={0:"Other",1:"32x32 pixels 'file icon' (PNG only)",2:"Other file icon",3:"Cover (front)",4:"Cover (back)",5:"Leaflet page",6:"Media (e.g. lable side of CD)",7:"Lead artist/lead performer/soloist",8:"Artist/performer",9:"Conductor",10:"Band/Orchestra",11:"Composer",12:"Lyricist/text writer",13:"Recording Location",14:"During recording",15:"During performance",16:"Movie/video screen capture",17:"A bright coloured fish",18:"Illustration",19:"Band/artist logotype",20:"Publisher/Studio logotype"};function Qe(r){let e={};for(let i of r.cells)if(i.column.def.id!==re)for(let t of i.frames){let n=e[i.column.def.id]??[];n.push(t),e[i.column.def.id]=n}return{version:4,frames:e}}function pt(r){let e=hi(r);if(e=e.filter(i=>!Number.isNaN(Number(i))),e.length>0)return e[0]}function Ie(r){let e=r.cells.find(i=>i.column.def.id==="TPOS");return`${r.track.parentID}|${e&&e.frames.length>0?e.frames[0].value.text:""}`}function Ai(r,e){let i=[],t="";if(e.frames.TPOS&&e.frames.TPOS.length>0){let o=e.frames.TPOS[0],a=(o.value.text||"").split("/")[0],l=(o.value.text||"").split("/")[1]||"99";if(Number(l)>1){for(;a.length<l.length;)a=`0${a}`;t+=`${a}-`}}if(e.frames.TRCK&&e.frames.TRCK.length>0){let o=e.frames.TRCK[0],a=(o.value.text||"").split("/")[0],l=(o.value.text||"").split("/")[1]||"99";for(;a.length<l.length;)a=`0${a}`;t+=a}if(i.push(t),e.frames.TIT2&&e.frames.TIT2.length>0){let o=e.frames.TIT2[0];i.push(o.value.text)}if(e.frames.TPE1&&e.frames.TPE1.length>0){let o=e.frames.TPE1[0];i.push(o.value.text)}let n=`.${Ti(r.name)}`;return`${fi(i.join(" - "),"")}${n}`}var qe=class r{constructor(e){this.jam=e,this.columns=[],this.edits=[]}removeColumnText(e,i){let t=this.columns.indexOf(e);for(let n of this.edits){let o=n.cells[t],a=o.frames.length>0?o.frames[0].value.text:void 0;a&&this.updateEditTextCell(n,e,a.replace(i,""))}}updateEditTextCell(e,i,t){let n=this.columns.indexOf(i),o=e.cells[n],a=t??"",l=[];a.length>0&&(l=s.LangDescText===i.def.impl?[{id:o.column.def.id,value:{id:"",language:"",text:a}}]:[{id:o.column.def.subid,value:{text:a}}]),(o.frames.length===0||o.frames[0].value.text!==a)&&(e.cells[n]={parent:e,track:o.track,column:i,frames:l,changed:!0},e.changed=!0)}setColumnTrackNrFromFile(e){let i={};for(let t of this.edits){let n=Ie(t);i[n]=(i[n]??0)+1}for(let t of this.edits){let n=pt(t.track.name);if(n){let o=Ie(t),a=`${n}/${(i[o]??0).toString()}`;this.updateEditTextCell(t,e,a)}}}setColumnFilenames(e){let i=this.columns.indexOf(e);for(let t of this.edits){let n=t.cells[i],o=Ai(n.track,Qe(t));this.updateEditTextCell(t,e,o)}}setColumnTrackNrByIndex(e){let i={},t={};for(let n of this.edits){let o=Ie(n);i[o]=(i[o]??0)+1}for(let n of this.edits){let o=Ie(n);t[o]=(t[o]??0)+1;let a=`${(t[o]??0).toString()}/${(i[o]??0).toString()}`;this.updateEditTextCell(n,e,a)}}addIndexToTitleCol(e){let i=this.columns.indexOf(e);for(let[t,n]of this.edits.entries()){let o=n.cells[i],a=o.frames.length>0?o.frames[0].value.text:"";a=`${a} ${(t+1).toString()}`.trim(),this.updateEditTextCell(n,e,a)}}setColumnPartOfSet(e){let i=this.columns.indexOf(e),t=[];for(let n of this.edits)t.includes(n.track.parentID)||t.push(n.track.parentID);for(let n of this.edits){let o=n.cells[i],a=`${(t.indexOf(o.track.parentID)+1).toString()}/${t.length.toString()}`;this.updateEditTextCell(n,e,a)}}setColumnTotalTrack(e){let i={};for(let n of this.edits)i[n.track.parentID]=(i[n.track.parentID]??0)+1;let t=this.columns.indexOf(e);for(let[n,o]of this.edits.entries()){let a=o.cells[t],l;a.frames.length>0?(l=a.frames[0].value.text.split("/")[0],Number.isNaN(Number(l))||(l=Number(l).toString())):l=pt(o.track.name),l??=(n+1).toString();let m=`${l}/${(i[o.track.parentID]??0).toString()}`;this.updateEditTextCell(o,e,m)}}setAlbumArtistFrames(e){let i=this.columns.findIndex(t=>t.def.id==="TPE1");if(i!==-1)for(let t of this.edits){let n=t.cells[i],o=n.frames.length>0?n.frames[0].value.text:void 0;o&&this.updateEditTextCell(t,e,o)}}setReleaseDateFromYearFrames(e){this.copyColumn(this.columns.findIndex(i=>i.def.id==="TYER"),e)}getCellText(e){return e.frames.length>0?e.frames[0].value.text:void 0}insertFromColumn(e,i,t){let n=this.columns.indexOf(t);if(e>=0)for(let o of this.edits){let a=this.getCellText(o.cells[e]),l=this.getCellText(o.cells[n])??"";if(a){let m=l.slice(0,i)+a+l.slice(i);this.updateEditTextCell(o,t,m)}}}copyColumn(e,i){if(e>=0)for(let t of this.edits){let n=t.cells[e],o=n.frames.length>0?n.frames[0].value.text:void 0;o&&this.updateEditTextCell(t,i,o)}}appendFromColumn(e,i){let t=this.columns.indexOf(i);if(e>=0)for(let n of this.edits){let o=this.getCellText(n.cells[e]);if(o){let a=this.getCellText(n.cells[t])??"";this.updateEditTextCell(n,i,a+o)}}}setColumnText(e,i){for(let t of this.edits)this.updateEditTextCell(t,e,i)}appendColumnText(e,i){let t=this.columns.indexOf(e);for(let n of this.edits){let o=this.getCellText(n.cells[t])??"";this.updateEditTextCell(n,e,o+i)}}setColumnFromTitleFrames(e){this.copyColumn(this.columns.findIndex(i=>i.def.id==="TIT2"),e)}clearColumn(e){let i=this.columns.indexOf(e);for(let t of this.edits)t.cells[i].frames.length>0&&(t.cells[i]={parent:t,track:t.cells[i].track,column:t.cells[i].column,frames:[],changed:!0},t.changed=!0)}findMissingLyrics(){return E(this,arguments,function*(e=[]){let i=this.findOrAddColumn(e,{frameDef:L.USLT,id:"USLT"}),t=this.findOrAddColumn(e,{frameDef:L.TPE1,id:"TPE1"}),n=this.findOrAddColumn(e,{frameDef:L.TIT2,id:"TIT2"}),o=this.columns.indexOf(i),a=this.columns.indexOf(t),l=this.columns.indexOf(n);for(let m of this.edits)if(!this.getCellText(m.cells[o])){let R=this.getCellText(m.cells[a]),N=this.getCellText(m.cells[l]);if(N&&R){let Z=yield this.jam.metadata.lyricsovhSearch({title:N,artist:R});Z.data?.lyrics&&this.updateEditTextCell(m,i,Z.data.lyrics)}}})}setAudiobookFrames(e=[]){let i=this.findOrAddColumn(e,{frameDef:L.TCON,id:"TCON"}),t=this.findOrAddColumn(e,{frameDef:L.TXXX,id:"TXXX",subid:"MusicBrainz Album Type"});for(let n of this.edits)this.updateEditTextCell(n,i,"Audiobook"),this.updateEditTextCell(n,t,"album/audiobook")}setAudioSeriesFrames(e=[]){let i=this.findOrAddColumn(e,{frameDef:L.TCON,id:"TCON"}),t=this.findOrAddColumn(e,{frameDef:L.TXXX,id:"TXXX",subid:"MusicBrainz Album Type"});for(let n of this.edits)this.updateEditTextCell(n,i,"Audio Series"),this.updateEditTextCell(n,t,"album/audiodrama")}setSoundtrackFrames(e=[]){let i=this.findOrAddColumn(e,{frameDef:L.TCON,id:"TCON"}),t=this.findOrAddColumn(e,{frameDef:L.TXXX,id:"TXXX",subid:"MusicBrainz Album Type"});for(let n of this.edits)this.updateEditTextCell(n,i,"Soundtrack"),this.updateEditTextCell(n,t,"album/soundtrack")}setVariousArtistFrames(e=[]){let i=this.findOrAddColumn(e,{frameDef:L.TXXX,id:"TXXX",subid:"MusicBrainz Album Type"}),t=this.findOrAddColumn(e,{frameDef:L.TXXX,id:"TXXX",subid:"MusicBrainz Album Artist Id"}),n=this.findOrAddColumn(e,{frameDef:L.TPE2,id:"TPE2"});for(let o of this.edits)this.updateEditTextCell(o,i,"album/compilation"),this.updateEditTextCell(o,n,ze),this.updateEditTextCell(o,t,ri)}setBootlegFrames(e=[]){let i=this.findOrAddColumn(e,{frameDef:L.TXXX,id:"TXXX",subid:"MusicBrainz Album Status"}),t=this.findOrAddColumn(e,{frameDef:L.TXXX,id:"TXXX",subid:"MusicBrainz Album Type"});for(let n of this.edits)this.updateEditTextCell(n,i,"bootleg"),this.updateEditTextCell(n,t,"album/live")}build(e){this.edits=[],this.upgradeTrackTags(e),this.buildColumns(e),this.buildEdits(e)}upgradeTrackTags(e){for(let i of e)this.upgradeTrackTag(i)}upgradeTrackTag(e){let i=e.tagRaw;if(i?.version!==void 0&&i.version<4){let t=r.getRawTagFrames(i),n={version:4,frames:{}},o=this.upgradeDateFramesTov24Date(t);o&&(t=t.filter(a=>!o.dateFrames.includes(a)),t.push(o.newFrame));for(let a of t){let l=this.ensureID3v2FrameVersionDef(a.id,4);l?(a.id=l,n.frames[l]=n.frames[l]??[],n.frames[l].push(a)):console.error("upgradeTrackTag","missing id3v2 update",a.id,"=>",l)}e.tagRaw=n}}ensureID3v2FrameVersionDef(e,i){let t=mt(e);if(!t)return;if(t.versions.includes(i))return e;if(t.versions[0]>i){let a=Object.keys(L).find(m=>L[m].upgrade===e);if(!a){console.error(`ensureID3v2FrameVersionDef: Missing v2.${t.versions} -> v2.${i} mapping ${e}`);return}let l=L[a];return l.versions.includes(i)?a:l.versions[0]>i?this.ensureID3v2FrameVersionDef(a,i):void 0}if(!t.upgrade){console.error(`ensureID3v2FrameVersionDef: Missing v2.${t.versions} -> v2.${i} mapping ${e}`);return}let n=t.upgrade,o=L[n];return o.versions.includes(i)?n:o.versions[0]<i?this.ensureID3v2FrameVersionDef(n,i):void 0}upgradeDateFramesTov24Date(e){let i=e.find(l=>["TYER","TYE"].includes(l.id)),t=e.find(l=>["TDAT","TDA"].includes(l.id)),n=e.find(l=>["TIME","TIM"].includes(l.id));if(!i&&!t&&!n)return;let o=[],a=[];return i?.value&&Object.hasOwn(i.value,"text")&&(o.push(i),a.push(i.value.text)),t?.value&&Object.hasOwn(t.value,"text")&&(o.push(t),a.push(t.value.text)),n?.value&&Object.hasOwn(n.value,"text")&&(o.push(n),a.push(n.value.text)),{newFrame:{id:"TDRC",value:{text:a.join("-")}},dateFrames:o}}findOrAddColumn(e,i){let t=this.columns.find(o=>o.def.id===i.id&&o.def.subid===i.subid);if(t)return t;let n=this.frameDef2Column(i.id,i.subid,i.frameDef,xe.findIndex(o=>r.matchColumn({id:i.id,value:i.subid?{id:i.subid}:void 0},o)));return this.columns.push(n),this.buildEdits(e),n}updateColumns(e,i){let t=[],n=[];for(let o of this.columns)i.find(l=>l.id===o.def.id&&l.subid===o.def.subid)||t.push(o);for(let o of i)if(!this.columns.find(l=>l.def.id===o.id&&l.def.subid===o.subid)){let l=this.frameDef2Column(o.id,o.subid,o.frameDef,0);n.push(l)}this.columns=[...this.columns.filter(o=>!t.includes(o)),...n],this.buildEdits(e)}static getRawTagFrames(e){let i=[];for(let t of Object.keys(e.frames)){let n=e.frames[t]??[];i=[...i,...n]}return i}static getFrameDefName(e,i,t){let n=t.title,o=i??"";return t.impl===s.IdText?e==="TXXX"&&ve[o]?n=ve[o]:e==="UFID"&&be[o]?n=be[o]:i&&(n+=` (${i})`):t.impl===s.LangDescText?e==="COMM"&&Ne[o]?n=Ne[o]:i&&(n+=` (${i})`):t.impl===s.IdBin&&i&&(n+=` (${i})`),n}static matchColumn(e,i){return i.subid&&(!e.value?.id||e.value.id!==i.subid)?!1:e.id===i.id}getAutoCompleteList(e,i){if(e.def.id==="TCON")return Ye;if(e.def.id==="TXXX"&&e.def.subid==="MusicBrainz Album Type")return["album","album/compilation","album/soundtrack","album/spokenword","album/interview","album/audiobook","album/audiodrama","album/live","album/remix","album/dj-mix","album/mixtape/street","single","ep","broadcast","other","other/spokenword","other/audiodrama","other/interview"];if(e.def.id==="TXXX"&&e.def.subid==="MusicBrainz Album Status")return["official","promotional","bootleg","pseudo-release"];if(e.def.id==="TPOS")return["1/1","1/2","2/2","1/3","2/3","3/3","1/4","2/4","3/4","4/4"];let t=this.columns.indexOf(e),n=[];for(let o of this.edits){let a=o.cells[t];if(a!==i&&a.frames.length>0&&a.frames[0].value.text){let l=a.frames[0].value.text;n.includes(l)||n.push(l)}}return e.def.id==="TPE2"&&!n.includes(ze)&&n.push(ze),n}setColumnActions(e,i,t,n){let o=[];if([s.IdText,s.Text,s.LangDescText].includes(n))switch(e.multi=!0,i){case"TRCK":{o.push({icon:"icon-down-thin",title:"Set Track Nr by Index",click:()=>{this.setColumnTrackNrByIndex(e)}},{icon:"icon-down-thin",title:"Set Track Nr by Filename",click:()=>{this.setColumnTrackNrFromFile(e)}},{icon:"icon-down-thin",title:"Set Total Tracks",click:()=>{this.setColumnTotalTrack(e)}});break}case"TPOS":{o.push({icon:"icon-down-thin",title:"Try find Part of Set",click:()=>{this.setColumnPartOfSet(e)}});break}case"TIT2":{o.push({icon:"icon-down-thin",title:"Add Index Nr to Title",click:()=>{this.addIndexToTitleCol(e)}});break}case"TPE2":{o.push({icon:"icon-down-thin",title:"Copy from Artist Column",click:()=>{this.setAlbumArtistFrames(e)}});break}case"TALB":{o.push({icon:"icon-down-thin",title:"Copy from Title Column",click:()=>{this.setColumnFromTitleFrames(e)}});break}case"TDOR":{o.push({icon:"icon-down-thin",title:"Copy from Year Column",click:()=>{this.setReleaseDateFromYearFrames(e)}});break}case"USLT":{o.push({icon:"icon-down-thin",title:"Search for missing Lyrics",click:()=>{this.findMissingLyrics().catch(a=>{console.error(a)})}});break}}n===s.Filename?o.push({icon:"icon-down-thin",title:"Set Filenames by Meta Data",click:()=>{this.setColumnFilenames(e)}}):o.push({icon:"icon-remove",title:"Clear all Cells in this Column",click:()=>{this.clearColumn(e)}}),e.actions=o}frameDef2Column(e,i,t,n){let o=r.getFrameDefName(e,i,t),a=t.impl;e==="UFID"&&be[i??""]&&(a=s.IdText);let l={def:{id:e,subid:i,name:o,width:n>=0?xe[n].width:100,impl:a},sort:n>=0?n+1:-1,actions:[]};return this.setColumnActions(l,e,i,a),l.getAutoCompleteList=m=>this.getAutoCompleteList(l,m),l}frame2Column(e,i){let t=e.value.id?` - ${e.value.id}`:"",n={def:{id:e.id,name:`${e.id}${t}`,subid:e.value.id,width:i>=0?xe[i].width:100,impl:s.Unknown},sort:i,actions:[]};return n.getAutoCompleteList=o=>this.getAutoCompleteList(n,o),n}addDefaultColumns(){for(let[e,i]of xe.entries())if(i.force){let t=this.frameDef2Column(i.id,i.subid,L[i.id],e);this.columns.push(t)}}findExistingColumn(e){return this.columns.find(i=>r.matchColumn(e,i.def))}createColumnFromFrame(e){let i=mt(e.id),t=xe.findIndex(n=>r.matchColumn(e,n));i?this.columns.push(this.frameDef2Column(e.id,e.value.id,i,t)):this.columns.push(this.frame2Column(e,t))}buildColumns(e){if(this.columns=[],!e||e.length===0)return;let i=n=>{if(!n.tagRaw?.frames)return[];let o=r.getRawTagFrames(n.tagRaw);return o.unshift({id:re,value:{text:n.name}}),o},t=n=>{let o=i(n);for(let a of o)this.findExistingColumn(a)||this.createColumnFromFrame(a)};this.addDefaultColumns();for(let n of e)n.tagRaw?.frames&&t(n)}buildEdits(e){this.columns.sort((n,o)=>n.sort<0?1:o.sort<0?-1:n.sort-o.sort);let i=(n,o,a,l,m)=>this.columns.map(P=>{let R=m?m.cells.find(N=>N.column.def.id===P.def.id&&N.column.def.subid===P.def.subid):void 0;return{parent:l,track:n,tag:o,column:P,frames:R?R.frames:a.filter(N=>r.matchColumn(N,P.def)),changed:R?R.changed:!1}}),t=this.edits;this.edits=e.map(n=>{let o=[];if(o.push({id:re,value:{text:n.name}}),n.tagRaw)for(let m of Object.keys(n.tagRaw.frames)){let P=n.tagRaw.frames[m];o=[...o,...P]}let a=t.find(m=>m.track===n),l={track:n,tag:n.tagRaw,cells:[],editing:!1,changed:a?a.changed:!1,saving:!1};return l.cells=i(n,n.tagRaw,o,l,a),l})}};var Zi=(r,e)=>e.id;function en(r,e){if(r&1){let i=A();d(0,"div",7)(1,"div",8)(2,"label")(3,"input",9),X("ngModelChange",function(n){let o=p(i).$implicit;return F(o.checked,n)||(o.checked=n),g(n)}),h("change",function(){p(i);let n=u();return g(n.checkChange())}),c(),O(4),c()(),d(5,"div",10),O(6),c()()}if(r&2){let i=e.$implicit;_(3),S("checked",i.checked),$("ngModel",i.checked),_(),V(" ",i.name||i.frameDef.title," "),_(2),V(" ",i.id," ")}}var Ri=(()=>{let e=class e{constructor(){this.filteredColumns=[],this.allColumns=[],this.version=4,this.urls={2:"http://id3.org/id3v2-00",3:"http://id3.org/id3v2.3.0",4:"http://id3.org/id3v2.4.0-frames"}}trackByFn(t,n){return n.id}checkChange(){this.setResult()}setResult(){this.data&&(this.data.resultColumns=this.filteredColumns.filter(t=>t.checked))}refresh(){this.filteredColumns=this.allColumns.filter(t=>t.frameDef.versions.includes(this.version)),this.setResult()}setVersion(t){this.version=t,this.refresh()}dialogInit(t,n){this.data=n.data,this.allColumns=[];let o=this.data?.columns??[];for(let a of Object.keys(L)){let l=Pi(a);if(l.length===0){let m=o.find(P=>P.def.id===a);this.allColumns.push({id:a,frameDef:L[a],column:m,checked:!!m})}else for(let m of l){let P=o.find(R=>R.def.id===a&&R.def.subid===m.subid);this.allColumns.push({id:a,subid:m.subid,name:m.name,frameDef:L[a],column:P,checked:!!P})}}this.allColumns=this.allColumns.toSorted((a,l)=>(a.name??a.frameDef.title).localeCompare(l.name??l.frameDef.title)),this.refresh()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-dialog-choose-columns"]],decls:20,vars:5,consts:()=>{let t;return t=$localize`:␟367a4acc6ee5c0c00dafae1ce57a32bed7ed035e␟2271963085536331910:ID3v2 Tag Version`,[t,[1,"choose-version"],[1,"select"],["name","release","type","radio",3,"click","checked"],["rel","noopener","target","_blank",3,"href"],[1,"icon-info"],[1,"columns"],[1,"column"],[1,"title"],["type","checkbox",3,"ngModelChange","change","checked","ngModel"],[1,"id"]]},template:function(n,o){n&1&&(d(0,"form",1)(1,"fieldset")(2,"span"),C(3,0),c(),d(4,"label",2)(5,"input",3),h("click",function(){return o.setVersion(4)}),c(),O(6," 2.4"),c(),d(7,"label",2)(8,"input",3),h("click",function(){return o.setVersion(3)}),c(),O(9," 2.3"),c(),d(10,"label",2)(11,"input",3),h("click",function(){return o.setVersion(2)}),c(),O(12," 2.2"),c(),M(13,"br"),d(14,"a",4),M(15,"i",5),O(16),c()()(),d(17,"div",6),I(18,en,7,4,"div",7,Zi),c()),n&2&&(_(5),S("checked",o.version===4),_(3),S("checked",o.version===3),_(3),S("checked",o.version===2),_(3),S("href",o.urls[o.version],ke),_(2),V(" ",o.urls[o.version]),_(2),y(o.filteredColumns))},dependencies:[Y,Fe,ge,K,Be,J,$e],styles:["[_nghost-%COMP%]   .choose-version[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-left:15px}[_nghost-%COMP%]   .choose-version[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-size:.8em}[_nghost-%COMP%]   .columns[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap}[_nghost-%COMP%]   .column[_ngcontent-%COMP%]{width:33%;border-top-width:1px;border-top-style:solid;border-bottom-width:0;border-bottom-style:solid;border-color:var(--control-border);padding-top:5px;padding-bottom:5px;padding-right:15px;display:flex;flex-flow:row nowrap;align-items:center;font-size:.8em}[_nghost-%COMP%]   .column[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:var(--on-control-hover)}[_nghost-%COMP%]   .column[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.8em;color:var(--on-control)}[_nghost-%COMP%]   .column[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]{margin-left:auto;width:80px;padding-right:15px;text-align:right;font-size:.8em}[_nghost-%COMP%]   .column[_ngcontent-%COMP%]:last-child{border-bottom-width:1px}@media (max-width: 1400px){[_nghost-%COMP%]   .column[_ngcontent-%COMP%]{width:50%}}@media (max-width: 768px){[_nghost-%COMP%]   .column[_ngcontent-%COMP%]{width:100%}}"]});let r=e;return r})();var bi;function xi(r){return r.replaceAll(/[& \-.]/g,"").toLowerCase()}function gt(r){let e=xi(r);return bi??=Object.fromEntries(Ye.map(i=>[xi(i),i])),bi[e]}function Ze(r,e){let i=[...r];for(let t of e){let n=i.find(o=>o.name===t.name);n?n.count+=t.count:i.push(t)}return i}function vi(r){if(!r?.length)return[];let e=[];for(let i of r){let t=i.name.split("/").map(n=>n.trim()).filter(n=>n.length>0);for(let n of t){let o=gt(n);if(o){let a=e.find(l=>l.name===o);a?a.count+=i.count:e.push({name:o,count:i.count})}}}return e.sort((i,t)=>t.count-i.count)}function Ni(r){if(!r?.length)return[];let e=[];for(let i of r){let t=i.name.split(";").map(n=>n.trim()).filter(n=>n.length>0);for(let n of t){let o=gt(n);if(o){let a=e.find(l=>l.name===o);a?a.count+=i.count:e.push({name:o,count:i.count})}}}return e.sort((i,t)=>t.count-i.count)}function Ii(r){if(!r)return[];let e=[];for(let i of r){let t=gt(i.name);if(t){let n=e.find(o=>o.name===t);n?n.count+=1:e.push({name:t,count:1})}}return e}function yi(r){return r.tags?Ii(r.tags):[]}function Li(r){return r?Ii(r.tags):[]}function tn(r,e){if(r&1&&Pe(0,"img",0),r&2){let i,t=u();Se("src",t.src,ke)("alt",(i=t.image())==null?null:i.title)}}var wi=(()=>{let e=class e{constructor(){this.image=v()}ngOnChanges(){this.src=void 0;let t=this.image();t&&(this.src=`data:${t.mimeType||"image/jpeg"};base64,${t.base64}`)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-image-base64"]],inputs:{image:[1,"image"]},features:[j],decls:1,vars:1,consts:[[3,"src","alt"]],template:function(n,o){n&1&&T(0,tn,1,2,"img",0),n&2&&f(o.src?0:-1)},styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto}"]});let r=e;return r})();var nn=(r,e)=>e.image.id;function on(r,e){r&1&&M(0,"i",7)}function rn(r,e){if(r&1&&(d(0,"div",12),M(1,"app-image-base64",13),c(),d(2,"div",14)(3,"div",15)(4,"label"),M(5,"input",16),O(6),c()()()),r&2){let i=u().$implicit;_(),S("image",i.base64),_(4),S("checked",i.checked),_(),V(" ",i.image.types)}}function an(r,e){if(r&1&&(d(0,"div",11),T(1,rn,7,3),c()),r&2){let i=e.$implicit;_(),f(i.base64?1:-1)}}function sn(r,e){if(r&1&&(d(0,"div",8),M(1,"app-background-text-list",9),d(2,"div",10),I(3,an,2,1,"div",11,nn),c()()),r&2){let i=u();_(),S("list",i.images),_(2),y(i.images)}}var et=(()=>{let e=class e{constructor(){this.data=v(),this.isImageSearchRunning=!1,this.showFrontImagesOnly=!0,this.jam=H(he),this.notify=H(Re)}ngOnChanges(){let t=this.data();t?this.loadCoverartImages(t).catch(n=>{this.notify.error(n)}):(this.images=void 0,this.coverArtArchive=void 0)}onToggleShowFrontImagesOnly(){if(!this.showFrontImagesOnly&&this.coverArtArchive)for(let t of this.coverArtArchive)!t.base64&&!t.requested&&this.getBase64Image(t).catch(n=>{console.error(n)});this.coverArtArchive&&(this.images=this.coverArtArchive.filter(t=>t.image.front||!this.showFrontImagesOnly))}getChecked(){return this.coverArtArchive?this.coverArtArchive.filter(t=>t.checked&&t.base64):[]}loadImages(t){return E(this,null,function*(){if(t.images){this.coverArtArchive=t.images.map(a=>{if(a.types=a.types??[],a.types.length===0&&a.types.push("Other"),a.image&&(a.image=a.image.replace("http:","https:")),a.thumbnails){let m=a.thumbnails;for(let P of Object.keys(m))m[P]=m[P].replace("http:","https:")}return{image:a,checked:!1}});let n=this.coverArtArchive.filter(a=>a.image.front||a.image.types?.includes("Front")).sort((a,l)=>(a.image.types?.length??0)-(l.image.types?.length??0));this.images=this.showFrontImagesOnly?n:this.coverArtArchive;for(let a of this.images)this.getBase64Image(a).catch(l=>{console.error(l)});let o=n.find(a=>a.image.types?.length===1);o??=n.at(0),o&&(o.checked=!0)}else this.images=void 0,this.coverArtArchive=[]})}loadCoverartImages(t){return E(this,null,function*(){if(t.mbReleaseID){this.isImageSearchRunning=!0;let n=yield this.jam.metadata.coverartarchiveLookup({type:ut.release,mbID:t.mbReleaseID}),o=n.data;yield this.loadImages(o),this.coverArtArchive&&this.coverArtArchive.length===0&&t.mbReleaseGroupID?(this.images=void 0,this.coverArtArchive=void 0,n=yield this.jam.metadata.coverartarchiveLookup({type:ut.releaseGroup,mbID:t.mbReleaseGroupID}),o=n.data,yield this.loadImages(o),this.isImageSearchRunning=!1):this.isImageSearchRunning=!1}})}getBase64Image(t){return E(this,null,function*(){if(t.requested)return;let n=t.image.thumbnails?.["500"]??t.image.thumbnails?.small;if(!n){this.notify.error({error:"No image to fetch from https://coverartarchive.org"});return}t.requested=!0;let o;try{o=yield this.jam.metadata.coverartarchiveImageBinary({url:n})}catch(a){console.error(a)}t.requested=!1,o?t.base64={title:n,mimeType:o.contentType,base64:Ci(o.buffer)}:this.notify.error({error:"Invalid result from https://coverartarchive.org"})})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-match-coverart"]],inputs:{data:[1,"data"]},features:[j],decls:10,vars:4,consts:()=>{let t;t=$localize`:␟2f1af3c61d7c0984f04ef0e8c4838aa7e6d90d93␟6069974144025121503:Front only`;let n;return n=$localize`:␟2689f5742c952b88d105a84ff9e924d15e269dba␟2840633634490107011:Coverart`,[t,n,[1,"match-album-images"],[1,"front-only-choice"],["type","checkbox",3,"change","ngModelChange","ngModel","checked"],[1,"section"],["href","https://coverartarchive.org/","rel","noopener","target","_blank"],[1,"icon-spin","icon-spinner"],[1,"match-images"],["name","Images",3,"list"],[1,"media-cards"],[1,"media-card","no-hover"],[1,"image"],[3,"image"],[1,"footer"],[1,"footer-content"],["type","checkbox",3,"checked"]]},template:function(n,o){n&1&&(d(0,"div",2)(1,"label",3)(2,"input",4),h("change",function(){return o.onToggleShowFrontImagesOnly()}),X("ngModelChange",function(l){return F(o.showFrontImagesOnly,l)||(o.showFrontImagesOnly=l),l}),c(),k(3),C(4,0),D(),c(),d(5,"div",5)(6,"a",6),C(7,1),c()(),T(8,on,1,0,"i",7),T(9,sn,5,1,"div",8),c()),n&2&&(_(2),$("ngModel",o.showFrontImagesOnly),S("checked",o.showFrontImagesOnly),_(6),f(o.isImageSearchRunning?8:-1),_(),f(o.images&&!o.isImageSearchRunning?9:-1))},dependencies:[Y,ge,K,J,wi,li],styles:["[_nghost-%COMP%]{padding-top:15px}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]{color:var(--on-background-highlight);text-transform:uppercase;padding-bottom:10px;white-space:nowrap}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-highlight)}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .front-only-choice[_ngcontent-%COMP%]{float:right;font-size:.8em}[_nghost-%COMP%]   .match-images[_ngcontent-%COMP%]{min-height:200px;display:flex;flex-flow:row wrap}@media (max-width: 768px){[_nghost-%COMP%]   .match-images[_ngcontent-%COMP%]{justify-content:space-around}}[_nghost-%COMP%]   .match-images[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{max-width:200px;max-height:200px}"]});let r=e;return r})();function ln(r,e){r&1&&M(0,"i",6)}function cn(r,e){if(r&1){let i=A();d(0,"label",10)(1,"input",12),X("ngModelChange",function(n){let o=p(i).$implicit;return F(o.checked,n)||(o.checked=n),g(n)}),c(),O(2),c()}if(r&2){let i=e.$implicit;S("title",De("Usage Count: ",i.tag.count)),_(),$("ngModel",i.checked),_(),Bt(" ",i.tag.name," [",i.tag.count,"] ")}}function dn(r,e){if(r&1){let i=A();I(0,cn,3,5,"label",10,te),d(2,"label",11)(3,"input",12),X("ngModelChange",function(n){p(i);let o=u();return F(o.customGenre.checked,n)||(o.customGenre.checked=n),g(n)}),c(),d(4,"input",13),X("ngModelChange",function(n){p(i);let o=u();return F(o.customGenre.text,n)||(o.customGenre.text=n),g(n)}),c()()}if(r&2){let i=u();y(i.genres),_(3),$("ngModel",i.customGenre.checked),_(),$("ngModel",i.customGenre.text)}}function _n(r,e){if(r&1&&M(0,"app-match-coverart",7),r&2){let i=u();S("data",i.coverArtSearch)}}var tt=(()=>{let e=class e{constructor(){this.isRunning=v(!1),this.loadLyricsRequest=Q(),this.loadMoodsRequest=Q(),this.isGenreSearchRunning=!1,this.customGenre={text:"",checked:!0},this.coverArt=ne(et),this.jam=H(he)}getGenres(){let t=(this.genres??[]).filter(n=>n.checked).map(n=>n.tag.name);return this.customGenre.checked&&this.customGenre.text.trim().length>0&&t.push(this.customGenre.text.trim()),t}getCoverArtImages(){let t=this.coverArt();return t?t.getChecked():[]}loadGenres(t,n,o){return E(this,null,function*(){this.isGenreSearchRunning=!0;let a=this.getCombinedTags(o,n),l=this.collectTrackGenres(n,t),m=Ze(vi(l),Ni(a));m=yield this.getLastFMGenres(o,m),this.genres=m.toSorted((P,R)=>R.count-P.count).map((P,R)=>({tag:P,checked:R===0})),this.isGenreSearchRunning=!1})}getLastFMGenres(t,n){return E(this,null,function*(){let o=n,l=(yield this.jam.metadata.lastfmLookup({type:_t.album,mbID:t.mbRelease.id})).data;return l.album&&(o=Ze(o,yi(l.album))),o.length===0&&t.mbRelease.artistCredit.length>0&&(l=(yield this.jam.metadata.lastfmLookup({type:_t.artist,mbID:t.mbRelease.artistCredit[0].artist.id})).data,l.artist&&(o=Ze(n,Li(l.artist)))),o})}getCombinedTags(t,n){let o=[];return t.mbRelease.tags&&(o=[...o,...t.mbRelease.tags]),n.mbGroup.tags&&(o=[...o,...n.mbGroup.tags]),o}collectTrackGenres(t,n){let o=[];t.mbGroup.secondaryTypes?.some(a=>["audiobook","audio drama","spokenword"].includes(a))&&o.push({count:1,name:"Audiobook"});for(let a of n)if(a.track.tag?.genres&&a.track.tag.genres.length>0){let l=a.track.tag.genres[0],m=o.find(P=>P.name===l);m?m.count++:o.push({count:1,name:l})}return o}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-match-apply"]],viewQuery:function(n,o){n&1&&ie(o.coverArt,et,5),n&2&&oe()},inputs:{isRunning:[1,"isRunning"]},outputs:{loadLyricsRequest:"loadLyricsRequest",loadMoodsRequest:"loadMoodsRequest"},decls:14,vars:7,consts:()=>{let t;t=$localize`:␟33c750c68c3e29d7fee57a180f508d8d202bdd04␟1790640569414740156:Genres`;let n;n=$localize`:␟ac0f81713a84217c9bd1d9bb460245d8190b073f␟5937251202465808296:More`;let o;o=$localize`:␟64573fe39daeccde26bea87757731f84dbbb1e20␟8931780837517904129:Load Lyrics`;let a;return a=$localize`:␟fcc14666a1cf83864f70059f03a0a3855d901235␟896097993346243998:Load AcousticBrainz Moods`,[t,n,o,a,[1,"match-apply"],[1,"section"],[1,"icon-spin","icon-spinner"],[3,"data"],[1,"match-track-moods"],[1,"button-on-background",3,"click"],[1,"select",3,"title"],[1,"select"],["type","checkbox",3,"ngModelChange","ngModel"],["type","text",3,"ngModelChange","ngModel"]]},template:function(n,o){n&1&&(d(0,"div",4)(1,"div")(2,"div",5),C(3,0),c(),T(4,ln,1,0,"i",6),T(5,dn,5,2),c(),T(6,_n,1,1,"app-match-coverart",7),d(7,"div",8)(8,"div",5),C(9,1),c(),d(10,"button",9),h("click",function(){return o.loadLyricsRequest.emit()}),C(11,2),c(),d(12,"button",9),h("click",function(){return o.loadMoodsRequest.emit()}),C(13,3),c()()()),n&2&&(_(4),f(o.isGenreSearchRunning?4:-1),_(),f(o.genres&&!o.isGenreSearchRunning?5:-1),_(),f(o.coverArtSearch?6:-1),_(4),le("disabled",!o.isRunning()),_(2),le("disabled",!o.isRunning()))},dependencies:[Y,Ce,ge,K,J,et],styles:["[_nghost-%COMP%]   .match-apply[_ngcontent-%COMP%]{flex:1 1 auto;overflow-y:auto;overflow-x:auto;padding:15px}[_nghost-%COMP%]   .match-apply[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding-bottom:10px}[_nghost-%COMP%]   .match-apply[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{padding-right:4px;font-size:.9em;text-transform:uppercase}[_nghost-%COMP%]   .match-apply[_ngcontent-%COMP%]   .select[_ngcontent-%COMP%]{padding-top:2px;padding-bottom:2px;display:block;font-size:.9em}[_nghost-%COMP%]   .match-apply[_ngcontent-%COMP%]   .select[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:4px}[_nghost-%COMP%]   .match-apply[_ngcontent-%COMP%]   .select[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]{color:var(--on-background-highlight);text-transform:uppercase;padding-bottom:10px;white-space:nowrap}[_nghost-%COMP%]   app-match-coverart[_ngcontent-%COMP%]{border-top:1px solid var(--background-border)}[_nghost-%COMP%]   .match-track-moods[_ngcontent-%COMP%]{border-top:1px solid var(--background-border);padding-top:15px}"]});let r=e;return r})();var Ct=class{constructor(){this.frameValues={}}build(){return this.frameValues}text(e,i){if(i){let t={id:e,value:{text:i}};this.frameValues[e]=[t]}return this}idText(e,i,t){if(t){let n={id:e,value:{id:i,text:t}},o=(this.frameValues[e]??[]).filter(a=>a.value.id!==i);this.frameValues[e]=[...o,n]}return this}nrAndTotal(e,i,t){if(i){let n=i.toString()+(t?`/${t.toString()}`:""),o={id:e,value:{text:n}};this.frameValues[e]=[o]}return this}keyTextList(e,i,t){if(t){let n=this.frameValues[e]??[],o=n.length>0?n[0]:{id:e,value:{list:[]}};o.value.list.push(i,t),this.frameValues[e]=[o]}return this}bool(e,i){if(i!==void 0){let t={id:e,value:{bool:i}};this.frameValues[e]=[t]}return this}idLangText(e,i,t,n){if(i){let o=n??"",a=(this.frameValues[e]??[]).filter(m=>m.value.id!==o),l={id:e,value:{id:o,language:t??"",text:i}};this.frameValues[e]=[...a,l]}return this}addPicture(e,i,t,n,o){let a={id:e,value:{description:t,pictureType:i,bin:o,mimeType:n}};return this.frameValues[e]=[...this.frameValues[e]??[],a],this}addChapter(e,i,t,n,o,a,l){let m={id:e,value:{id:i,start:t,end:n,offset:o,offsetEnd:a},subframes:l};return this.frameValues[e]=[...this.frameValues[e]??[],m],this}},it=class{constructor(){this.rawBuilder=new Ct}buildFrames(){return this.rawBuilder.build()}artist(e){return this.rawBuilder.text("TPE1",e),this}artistSort(e){return this.rawBuilder.text("TSOP",e),this}albumArtist(e){return this.rawBuilder.text("TPE2",e),this}albumArtistSort(e){return this.rawBuilder.text("TSO2",e),this}album(e){return this.rawBuilder.text("TALB",e),this}albumSort(e){return this.rawBuilder.text("TSOA",e),this}originalAlbum(e){return this.rawBuilder.text("TOAL",e),this}originalArtist(e){return this.rawBuilder.text("TOPE",e),this}originalDate(e){return this.rawBuilder.text("TDOR",e),this}title(e){return this.rawBuilder.text("TIT2",e),this}work(e){return this.rawBuilder.text("TIT1",e),this}titleSort(e){return this.rawBuilder.text("TSOT",e),this}genre(e){return this.rawBuilder.text("TCON",e),this}bmp(e){return this.rawBuilder.text("TBPM",e?e.toString():void 0),this}mood(e){return this.rawBuilder.text("TMOO",e),this}media(e){return this.rawBuilder.text("TMED",e),this}language(e){return this.rawBuilder.text("TLAN",e),this}grouping(e){return this.rawBuilder.text("GRP1",e),this}date(e){return this.rawBuilder.text("TDRC",e),this}track(e,i){return this.rawBuilder.nrAndTotal("TRCK",e,i),this}disc(e,i){return this.rawBuilder.nrAndTotal("TPOS",e,i),this}year(e){return this.rawBuilder.text("TORY",e?e.toString():void 0),this}artists(e){return this.rawBuilder.idText("TXXX","Artists",e),this}isCompilation(e){return e!==void 0&&this.rawBuilder.bool("TCMP",e===1||e==="true"||e===!0),this}originalYear(e){return this.rawBuilder.text("TYER",e),this}composer(e){return this.rawBuilder.text("TCOM",e),this}composerSort(e){return this.rawBuilder.text("TSOC",e),this}remixer(e){return this.rawBuilder.text("TPE4",e),this}label(e){return this.rawBuilder.text("TPUB",e),this}subtitle(e){return this.rawBuilder.text("TIT3",e),this}discSubtitle(e){return this.rawBuilder.text("TSST",e),this}lyricist(e){return this.rawBuilder.text("TEXT",e),this}lyrics(e,i,t){return this.rawBuilder.idLangText("USLT",e,i,t),this}encoder(e){return this.rawBuilder.text("TENC",e),this}encoderSettings(e){return this.rawBuilder.text("TSSE",e),this}key(e){return this.rawBuilder.text("TKEY",e),this}copyright(e){return this.rawBuilder.text("TCOP",e),this}isrc(e){return this.rawBuilder.text("TSRC",e),this}barcode(e){return this.rawBuilder.idText("TXXX","BARCODE",e),this}asin(e){return this.rawBuilder.idText("TXXX","ASIN",e),this}catalogNumber(e){return this.rawBuilder.idText("TXXX","CATALOGNUMBER",e),this}script(e){return this.rawBuilder.idText("TXXX","SCRIPT",e),this}license(e){return this.rawBuilder.idText("TXXX","LICENSE",e),this}website(e){return this.rawBuilder.text("WOAR",e),this}movement(e){return this.rawBuilder.text("MVNM",e),this}movementNr(e,i){return this.rawBuilder.nrAndTotal("MVIN",e,i),this}writer(e){return this.rawBuilder.idText("TXXX","Writer",e),this}custom(e,i){return this.rawBuilder.idText("TXXX","VERSION",i),this}musicianCredit(e,i){return this.rawBuilder.keyTextList("TMCL",e,i),this}involved(e,i){return this.rawBuilder.keyTextList("TIPL",e,i),this}discogsArtistID(e){return this.rawBuilder.idText("TXXX","Discogs Artist ID",e),this}discogsAlbumArtistID(e){return this.rawBuilder.idText("TXXX","Discogs Album Artist ID",e),this}discogsLabelID(e){return this.rawBuilder.idText("TXXX","Discogs Label ID",e),this}discogsMasterReleaseID(e){return this.rawBuilder.idText("TXXX","Discogs Master Release ID",e),this}discogsReleaseID(e){return this.rawBuilder.idText("TXXX","Discogs Release ID",e),this}discogsVotes(e){return this.rawBuilder.idText("TXXX","Discogs Votes",e),this}discogsRating(e){return this.rawBuilder.idText("TXXX","Discogs Rating",e),this}mbAlbumStatus(e){return this.rawBuilder.idText("TXXX","MusicBrainz Album Status",e),this}mbAlbumType(e){return this.rawBuilder.idText("TXXX","MusicBrainz Album Type",e),this}mbAlbumReleaseCountry(e){return this.rawBuilder.idText("TXXX","MusicBrainz Album Release Country",e),this}mbTrackID(e){return this.rawBuilder.idText("UFID","http://musicbrainz.org",e),this}mbReleaseTrackID(e){return this.rawBuilder.idText("TXXX","MusicBrainz Release Track Id",e),this}mbAlbumID(e){return this.rawBuilder.idText("TXXX","MusicBrainz Album Id",e),this}mbOriginalAlbumID(e){return this.rawBuilder.idText("TXXX","MusicBrainz Original Album Id",e),this}mbArtistID(e){return this.rawBuilder.idText("TXXX","MusicBrainz Artist Id",e),this}mbOriginalArtistID(e){return this.rawBuilder.idText("TXXX","MusicBrainz Original Artist Id",e),this}mbAlbumArtistID(e){return this.rawBuilder.idText("TXXX","MusicBrainz Album Artist Id",e),this}mbReleaseGroupID(e){return this.rawBuilder.idText("TXXX","MusicBrainz Release Group Id",e),this}mbWorkID(e){return this.rawBuilder.idText("TXXX","MusicBrainz Work Id",e),this}mbTRMID(e){return this.rawBuilder.idText("TXXX","MusicBrainz TRM Id",e),this}mbDiscID(e){return this.rawBuilder.idText("TXXX","MusicBrainz Disc Id",e),this}acoustidID(e){return this.rawBuilder.idText("TXXX","Acoustid Id",e),this}acoustidFingerprint(e){return this.rawBuilder.idText("TXXX","Acoustid Fingerprint",e),this}musicIPPUID(e){return this.rawBuilder.idText("TXXX","MusicIP PUID",e),this}comment(e,i){return this.rawBuilder.idText("COMM",e,i),this}trackLength(e){return this.rawBuilder.text("TLEN",e?e.toString():void 0),this}mbTrackDisambiguation(e){return this.rawBuilder.idText("TXXX","MusicBrainz Track Disambiguation",e),this}addPicture(e,i,t,n){return this.rawBuilder.addPicture("APIC",e,i,t,n),this}chapter(e,i,t,n,o,a){return this.rawBuilder.addChapter("CHAP",e,i,t,n,o,a),this}};function un(r,e,i){if(i&&i.length>0)r.genre(i.slice(0,2).join("/"));else if(e.track.tagRaw){let t=e.track.tagRaw.frames.TCON;if(t){let n=t.map(o=>o.value.text);r.genre(n.slice(0,2).join("/"))}}}function mn(r,e,i,t,n,o){r.mbTrackID(i.recording?.id).date(t?.date).originalDate(n?.firstReleaseDate).album(t?.title).albumSort(t?.sortName).title(i.title).media(o?.format).track(i.position,o?.trackCount).disc(o?.position,t?.media.length).trackLength(i.length).language(t?.textRepresentation.language).script(t?.textRepresentation.script).barcode(t?.barcode).isrc(i.recording?.isrcs&&i.recording.isrcs.length>0?i.recording.isrcs[0]:void 0).mbAlbumStatus(t?.status?t.status.toLowerCase():void 0).mbAlbumReleaseCountry(t?.country).mbAlbumID(t?.id).mbReleaseTrackID(i.id).mbReleaseGroupID(t?.releaseGroup.id).mbTrackDisambiguation(i.recording?.disambiguation).asin(t?.asin).discSubtitle(o?.title),i.recording?.aliases&&i.recording.aliases.length>0&&i.recording.aliases[0].sortName&&i.recording.aliases[0].sortName!==i.title&&r.titleSort(i.recording.aliases[0].sortName);let a=t?.artistCredit[0];if(a&&r.albumArtist(a.name).albumArtistSort(a.artist.sortName).mbAlbumArtistID(a.artist.id),i.artistCredit&&i.artistCredit.length>0){let m=i.artistCredit.map(R=>`${R.artist.name} ${R.joinphrase}`).join(" ").replaceAll(/ {2}/g," ").trim(),P=i.artistCredit.map(R=>(R.artist.sortName??"").trim()).filter(R=>R.length>0).join(" & ").replaceAll(/ {2}/g," ").trim();r.artist(m).artistSort(P).mbArtistID(i.artistCredit[0].artist.id)}else a&&r.artist(a.name).artistSort(a.artist.sortName).mbArtistID(a.artist.id);let l=t?.labelInfo[0];l&&(l.label&&r.label(l.label.name),r.catalogNumber(l.catalogNumber))}function pn(r,e,i,t){let n=[];t?.releaseGroup.primaryType&&n.push(t.releaseGroup.primaryType),t?.releaseGroup.secondaryTypes&&(n=[...n,...t.releaseGroup.secondaryTypes]),n.length>0&&r.mbAlbumType(n.map(o=>o.toLowerCase()).join("/")),n.includes("compilation")&&r.isCompilation(!0)}function gn(r,e,i){i&&i.length>0?hn(r,i):e.track.tagRaw&&Tn(r,e.track.tagRaw.frames.APIC)}function Cn(r=[]){return r.includes("Medium")?6:r.includes("Booklet")?5:r.includes("Front")?3:r.includes("Back")?4:0}function hn(r,e){for(let i of e){if(!i.base64)continue;let t=Cn(i.image.types);r.addPicture(t,"",i.base64.mimeType,i.base64.base64)}}function Tn(r,e){if(e)for(let i of e)r.addPicture(i.value.pictureType,i.value.description,i.value.mimeType,i.value.bin)}function fn(r,e){e.abdata?.moods&&e.abdata.moods.length>0&&r.mood(e.abdata.moods.join("/"))}function Mn(r,e,i){if(e.acoustidEntries&&i.recording?.id){let t=e.acoustidEntries.find(n=>n.recordingID===i.recording?.id);t&&r.acoustidID(t.acoustID)}}function ki(r,e,i){if(!r.mbTrack)return;let t=r.mbTrack,n=r.mbRelease,o=r.mbGroup,a=r.mbMedia,l=new it;return mn(l,r,t,n,o,a),pn(l,r,t,n),un(l,r,e),gn(l,r,i),fn(l,r),Mn(l,r,t),r.lyrics&&l.lyrics(r.lyrics.lyrics),{version:4,frames:l.buildFrames()}}function On(r,e,i,t,n,o){return{releaseGroupID:i.id,releaseGroupName:i.title,releaseID:t.id,releaseName:t.title,mediaNr:n.position,mediaTrackCount:n.track_count,recordingID:e.id,recordingName:e.title,recordingDuration:e.duration,trackID:o.id,trackName:o.name,trackDuration:o.duration,score:r.score,acoustID:r.id}}function En(r,e,i){return!e.releasegroups||!e.id?[]:e.releasegroups.flatMap(t=>!t.id||!t.releases?[]:t.releases.flatMap(n=>!n.id||!n.mediums?[]:n.mediums.map(o=>On(r,e,t,n,o,i))))}function Di(r,e){return r?r.flatMap(i=>i.recordings.flatMap(t=>En(i,t,e))):[]}var nt=class{constructor(){this.releasegroups=[]}add(e){let i=this.releasegroups.find(l=>l.id===e.releaseGroupID);i||(i={id:e.releaseGroupID,name:e.releaseGroupName,releases:[],score:0},this.releasegroups.push(i)),i.releases??=[];let t=i.releases.find(l=>l.id===e.releaseID);t||(t={id:e.releaseID,name:e.releaseName,mediums:[],score:0},i.releases.push(t)),t.mediums??=[];let n=t.mediums.find(l=>l.nr===e.mediaNr);n||(n={nr:e.mediaNr,recordings:[],trackCount:e.mediaTrackCount,score:0},t.mediums.push(n)),n.recordings??=[];let o=n.recordings.find(l=>l.id===e.recordingID);o||(o={id:e.recordingID,name:e.recordingName,duration:e.recordingDuration,matches:[]},n.recordings.push(o));let a=o.matches.find(l=>l.trackID===e.trackID);a?a.score<e.score&&(a.score=e.score):o.matches.push({trackID:e.trackID,trackName:e.trackName,trackDuration:e.trackDuration,score:e.score,acoustID:e.acoustID})}};function Pn(r){let e=r.map(i=>[i.score*i.weight,i.weight]).reduce((i,t)=>[i[0]+t[0],i[1]+t[1]],[0,0]);return e[0]/e[1]}function Gi(r){return r.replaceAll(/[ .\-()[\]]/g,"").toLowerCase()}var ht=class{constructor(e,i,t){this.mbTrack=e,this.index=t,this.matchings=[],this.matchings=this.createMatchingScores(i),this.currentMatch=this.matchings[0]}createMatchingScores(e){let i=[];for(let[t,n]of e.entries()){let o={match:n,score:0,scores:this.createScores(n,t)};o.score=Pn(o.scores),i.push(o)}return i=i.filter(t=>t.score>0).sort((t,n)=>n.score-t.score),i}createScores(e,i){let t=[];return this.scoreTitle(e,t),this.scoreTrackNr(e,t),this.scoreDuration(e,t),this.scoreAcoustid(e,t),t.push({name:"index",score:i===this.index?1:0,weight:.1}),t}scoreAcoustid(e,i){if(e.acoustidEntries&&this.mbTrack.recording?.id){let t=this.mbTrack.recording.id,n=e.acoustidEntries.find(o=>o.recordingID===t);n&&i.push({name:"acoustid",score:n.score,weight:1})}}scoreDuration(e,i){if(this.mbTrack.length){let t=Math.abs(Math.round(e.track.duration||0)*1e3-(this.mbTrack.length||0)),n=0;t===0?n=1:t<1e3?n=.8:t<1e4&&(n=.2),i.push({name:"duration",score:n,weight:.2})}}scoreTrackNr(e,i){let t=e.track.tag?.trackNr??Mi(e.track.name);t>0&&i.push({name:"trackNr",score:t===this.mbTrack.position?1:0,weight:.2})}scoreTitle(e,i){let t=e.track.tag?.title??Je(e.track.name);if(t&&t.trim().length>0){let n=this.mbTrack.title.length>0?this.mbTrack.title:this.mbTrack.recording?.title??"Unknown",o=[Gi(n)],a=this.mbTrack.recording?.aliases??[];for(let m of a){let P=Gi(m.name);o.push(P)}let l=o.map(m=>({title:m,score:Oi(t,m)})).sort((m,P)=>P.score-m.score);l.length>0&&i.push({name:"title",score:l[0].score,weight:1})}}};function Sn(r){let e=(r??"").split("-");return new Date(e[0]?Number(e[0]):9999,e[1]?Number(e[1]):12,e[2]?Number(e[2]):31).valueOf()}var Tt=class{constructor(e,i,t){this.mbMedia=e,this.tracks=[],this.score=0,this.complete=!1,this.tracks=(e.tracks??[]).map((n,o)=>new ht(n,i,t+o))}updateScore(){this.score=0,this.complete=this.tracks.length>0;for(let e of this.tracks)e.currentMatch?this.score+=e.currentMatch.score:this.complete=!1;this.tracks.length>0?this.score=this.score/this.tracks.length:this.complete=!1}},ft=class{constructor(e){this.mbRelease=e,this.media=[],this.score=0,this.loaded=!1,this.isLoading=!1,this.sortDate=0,this.totalTrack=0,this.sortDate=Sn(e.date),this.totalTrack=this.mbRelease.media.reduce((i,t)=>i+t.trackCount,0)}updateScore(){this.score=0,this.complete=this.media.length>0;for(let e of this.media)e.updateScore(),this.score=Math.max(e.score,this.score),e.complete||(this.complete=!1)}setLookupRelease(e,i){this.mbRelease=e,this.totalTrack=this.mbRelease.media.reduce((n,o)=>n+o.trackCount,0);let t=0;this.media=e.media.map(n=>{let o=new Tt(n,i,t);return t+=n.trackCount,o}),this.cleanDuplicateMatchings(),this.updateScore()}cleanDuplicateMatchings(){let e={};for(let i of this.media)for(let t of i.tracks)t.currentMatch&&(e[t.currentMatch.match.track.id]=e[t.currentMatch.match.track.id]??[],e[t.currentMatch.match.track.id].push(t));for(let i of Object.keys(e)){let t=e[i];if(t.length>1){t=t.sort((n,o)=>(o.currentMatch?.score??0)-(n.currentMatch?.score??0)),t.shift();for(let n of t)n.currentMatch=void 0}}}},Mt=class{constructor(e){this.mbGroup=e,this.releases=[],this.score=0;for(let i of e.releases??[])this.releases.push(new ft(i));this.releases=this.releases.toSorted((i,t)=>i.sortDate-t.sortDate)}findRelease(e){return this.releases.find(i=>i.mbRelease.id===e)}updateScore(){for(let e of this.releases)e.updateScore();this.score=this.currentRelease?this.currentRelease.score:0}enough(e){return!!(this.currentRelease&&this.currentRelease.totalTrack===e&&this.currentRelease.complete)}},ye=class{constructor(){this.groups=[]}enough(e){return this.groups.some(i=>i.enough(e))}addReleaseGroup(e){let i=new Mt(e);return this.groups.push(i),i}findReleaseGroup(e){return this.groups.find(i=>i.mbGroup.id===e)}sort(){for(let e of this.groups)e.updateScore();this.groups=this.groups.toSorted((e,i)=>i.score-e.score)}};var Bi=(()=>{let e=class e{static processAcousticBrainzData(t){if(!t.highlevel)return;let n={genres:[],moods:[],tonal:[],other:[]};return e.processHighLevelData(t.highlevel,n),{genres:n.genres,moods:n.moods,tonal:n.tonal,other:n.other}}static processHighLevelData(t,n){for(let[o,a]of Object.entries(t)){if(!a||!e.isValidValue(a))return;let l=e.determineCategory(o);e.addToCategory(a.value,l,n)}}static isValidValue(t){return t.probability>e.CONFIDENCE_THRESHOLD&&!t.value.includes("not_")}static determineCategory(t){return e.CATEGORY_MAPPINGS.mood(t)?"moods":e.CATEGORY_MAPPINGS.genre(t)?"genres":e.CATEGORY_MAPPINGS.tonal(t)?"tonal":"other"}static addToCategory(t,n,o){let a=o[n];a.includes(t)||a.push(t)}};e.CONFIDENCE_THRESHOLD=.8,e.CATEGORY_MAPPINGS={mood:t=>t.startsWith("mood_")||["timbre","danceability"].includes(t),genre:t=>t.startsWith("genre_"),tonal:t=>t.startsWith("tonal_")||t==="voice_instrumental"};let r=e;return r})();var ot=class{constructor(e){this.getMatchings=e,this.artists=[],this.albums=[],this.artist="",this.releaseGroup=""}getAutoCompleteAlbumList(){if(this.albums.length===0)for(let e of this.getMatchings()){let i=(e.track.tag?.album??"").trim();i.length>0&&!this.albums.includes(i)&&this.albums.push(i)}return this.albums}getAutoCompleteArtistList(){if(this.artists.length===0)for(let e of this.getMatchings()){let i=(e.track.tag?.artist??"").trim();i.length>0&&!this.artists.includes(i)&&this.artists.push(i)}return this.artists}};var Ee=class{constructor(e){this.q=e,this.matchings=[],this.id=`musicbrainz-${JSON.stringify(e)}`;let t=Object.keys(e).filter(n=>n!=="type").map(n=>`${n}: "${e[n]}"`).join(", ");this.name=`MusicBrainz Search for ${t}`}},Le=class r{static cleanAlbumName(e){let i=e.indexOf("("),t=e;return i>1&&(t=t.slice(0,i)),i=t.indexOf("["),i>1&&(t=t.slice(0,i)),t=t.trim(),t.length===0?e:t}static buildQuickQueries(e,i){let t=[],n=[],o=[];for(let a of e)if(a.track.tag?.album){let l=r.cleanAlbumName(a.track.tag.album);a.track.tag.album&&!n.includes(l)&&n.push(l),a.track.tag.artist&&!o.includes(a.track.tag.artist)&&o.push(a.track.tag.artist)}return n.length===1&&t.push(new Ee({type:q.releaseGroup,releasegroup:n[0],artist:o.length>0?o[0]:void 0})),i?.tag&&t.push(new Ee({type:q.releaseGroup,releasegroup:i.name,artist:i.tag.artist})),t}static buildQueries(e){let i=[],t=e.length;for(let n of e)r.addReleaseGroupQueries(i,n,t),r.addReleaseQueries(i,n,t),r.addRecordingQueries(i,n,t);return i}static addQuery(e,i,t){let n=e.find(o=>o.id===i.id);if(n){n.matchings.push(t);return}i.matchings.push(t),e.push(i)}static addMBQuery(e,i,t,n,o){let a={type:i.type},l=Object.keys(a);for(let m of l){if(m==="type"||m==="tracks")continue;let P=i[m];if(P===void 0||P===""||P.trim()==="")return;a[m]=P.split("(")[0]}o&&(a.tracks=n),r.addQuery(e,new Ee(a),t)}static getTrackTitle(e){return e.track.tag?.title??Je(e.track.name)}static addReleaseGroupQueries(e,i,t){r.addMBQuery(e,{type:q.releaseGroup,releasegroup:i.track.tag?.album,artist:i.track.tag?.artist},i,t),r.addMBQuery(e,{type:q.releaseGroup,releasegroup:i.track.tag?.album},i,t)}static addReleaseQueries(e,i,t){r.addMBQuery(e,{type:q.release,release:i.track.tag?.album,artist:i.track.tag?.artist},i,t,!0),r.addMBQuery(e,{type:q.release,release:i.track.tag?.album,artist:i.track.tag?.artist},i,t),r.addMBQuery(e,{type:q.release,release:i.track.tag?.album},i,t,!0),r.addMBQuery(e,{type:q.release,release:i.track.tag?.album},i,t)}static addRecordingQueries(e,i,t){let n=r.getTrackTitle(i);r.addMBQuery(e,{type:q.recording,recording:n,release:i.track.tag?.album,artist:i.track.tag?.artist},i,t),r.addMBQuery(e,{type:q.recording,recording:n,release:i.track.tag?.album},i,t),r.addMBQuery(e,{type:q.recording,recording:n,artist:i.track.tag?.artist},i,t),r.addMBQuery(e,{type:q.recording,recording:n},i,t)}};var rt=class{constructor(e,i,t,n){this.matchTree=e,this.shouldStop=i,this.addReleaseGroupByID=t,this.loadBestMatchingCurrentRelease=n}loadByReleaseGroups(e){return E(this,null,function*(){for(let i of e){if(this.shouldStop())return;yield this.processRelease(i.id)}})}loadByReleases(e){return E(this,null,function*(){for(let i of e){if(this.shouldStop())return;yield this.processRelease(i.releaseGroup.id)}})}loadByRecordings(e){return E(this,null,function*(){for(let i of e){if(this.shouldStop())return;if(i.releases)for(let t of i.releases){if(this.shouldStop())return;yield this.processRelease(t.releaseGroup.id)}}})}processRelease(e){return E(this,null,function*(){let i=this.matchTree.findReleaseGroup(e);i??=yield this.addReleaseGroupByID(e),i.currentRelease||(yield this.loadBestMatchingCurrentRelease(i))})}};var $i={executeStrategy:(r,e,i,t,n,o)=>E(null,null,function*(){switch(r){case fe.acoustID:{yield e();break}case fe.musicbrainzByTags:{if(yield t(),o())return;yield n();break}case fe.musicbrainzRefresh:{yield i();break}case fe.auto:{if(yield i(),o()||(yield t(),o())||(yield e(),o()))return;yield n();break}default:break}})};var fe=(function(r){return r[r.acoustID=0]="acoustID",r[r.musicbrainzRefresh=1]="musicbrainzRefresh",r[r.musicbrainzByTags=2]="musicbrainzByTags",r[r.auto=3]="auto",r})(fe||{}),at=class{constructor(e,i){this.jam=e,this.notify=i,this.isRunning=!1,this.isAborted=!1,this.manual=!1,this.matchings=[],this.matchTree=new ye,this.manualSearchData=new ot(()=>this.matchings),this.releaseLoader=new rt(this.matchTree,()=>this.shouldStop(),t=>E(this,null,function*(){return this.addReleaseGroupByID(t)}),t=>E(this,null,function*(){return this.loadBestMatchingCurrentRelease(t)}))}abort(){this.matchings=[],this.isAborted=!0}stop(){this.isRunning&&(this.isAborted=!0)}start(e){this.isRunning||(this.isAborted=!1,this.isRunning=!0,this.run(e).then(()=>{this.matchTree.sort(),this.isRunning=!1,this.isAborted=!1,this.currentAction=""}).catch(i=>{this.notify.error(i),this.isRunning=!1,this.isAborted=!1,this.currentAction=""}))}clear(){this.isRunning||(this.matchTree=new ye)}manualSearch(){this.isRunning||(this.isAborted=!1,this.isRunning=!0,this.searchManual().then(()=>{this.isRunning=!1,this.isAborted=!1,this.currentAction=""}).catch(e=>{this.notify.error(e),this.isRunning=!1,this.isAborted=!1,this.currentAction=""}))}prepare(e,i){this.matchings=e,this.folder=i,this.isRunning||(this.isAborted=!1)}selectMatch(e,i,t,n){let o=this.matchings.find(l=>l.track.id===e);if(!o)return;let a=n.matchings.find(l=>l.match.track.id===e);a||(a={match:o,score:1,scores:[]},n.matchings.push(a)),a.score=1,a.scores.some(l=>l.name==="Manual Match")||a.scores.push({name:"Manual Match",score:1,weight:1});for(let l of t.media)for(let m of l.tracks)m.currentMatch&&m.currentMatch.match.track.id===o.track.id&&(m.currentMatch=void 0);n.currentMatch=a,i.updateScore()}setManualSearch(){if(this.manual=!0,this.manualSearchData.artist.length===0){let e=this.manualSearchData.getAutoCompleteArtistList();e.length>0&&(this.manualSearchData.artist=e[0])}if(this.manualSearchData.releaseGroup.length===0){let e=this.manualSearchData.getAutoCompleteAlbumList();e.length>0?this.manualSearchData.releaseGroup=e[0]:this.folder&&(this.manualSearchData.releaseGroup=this.folder.name)}}apply(e,i){for(let t of i.media)for(let n of t.tracks)n.currentMatch&&(n.currentMatch.match.mbTrack=n.mbTrack,n.currentMatch.match.mbMedia=t.mbMedia,n.currentMatch.match.mbRelease=i.mbRelease,n.currentMatch.match.mbGroup=e.mbGroup)}stopApply(){for(let e of this.matchings)e.mbTrack=void 0,e.mbMedia=void 0,e.mbRelease=void 0,e.mbGroup=void 0,e.genres=void 0}setRunning(e){this.currentAction=e,this.isRunning=!0}stopRunning(){this.isRunning=!1,this.currentAction=""}searchManual(){return E(this,null,function*(){let e={type:q.releaseGroup};if(this.manualSearchData.artist&&this.manualSearchData.artist.trim().length>0&&(e.artist=this.manualSearchData.artist),this.manualSearchData.releaseGroup&&this.manualSearchData.releaseGroup.trim().length>0&&(e.releasegroup=this.manualSearchData.releaseGroup),Object.keys(e).length>1){let i=new Ee(e);yield this.runQuery(i,[])}})}setRelease(e,i){e.currentRelease=i,i.loaded||this.loadRelease(i).catch(t=>{this.notify.error(t)})}removeMatching(e,i){i.currentMatch=void 0,e.updateScore()}loadLyrics(e){this.isRunning||!e||(this.setRunning("Searching Lyrics"),this.loadLyricsOVH(e).then(()=>{this.stopRunning()}).catch(i=>{this.stopRunning(),this.notify.error(i)}))}loadMoods(e){this.isRunning||!e||(this.setRunning("Searching Moods"),this.loadAcousticBrainz(e).then(()=>{this.stopRunning()}).catch(i=>{this.stopRunning(),this.notify.error(i)}))}loadAcousticBrainz(e){return E(this,null,function*(){for(let i of e.media)for(let t of i.tracks)if(!t.abData&&t.currentMatch?.match.mbTrack?.recording?.id){let n=t.currentMatch.match.mbTrack.recording.id,a=(yield this.jam.metadata.acousticbrainzLookup({mbID:n})).data,l=Bi.processAcousticBrainzData(a);l&&(t.abData=l,t.currentMatch.match.abdata=l)}})}shouldStop(){return this.matchTree.enough(this.matchings.length)||this.isAborted}collectList(){return E(this,null,function*(){let e=[];for(let i of this.matchings){if(!i.acoustidEntries){this.currentAction=`Checking files with AcoustID: ${i.track.name}`;try{let n=(yield this.jam.metadata.acoustidLookup({trackID:i.track.id})).data;i.acoustidEntries=Di(n,i.track)}catch(t){console.error(t)}if(this.isAborted)return e}i.acoustidEntries&&(e=[...e,...i.acoustidEntries])}return e})}acoustId(){return E(this,null,function*(){this.currentAction="Checking files with AcoustID";let e=yield this.collectList();if(this.isAborted)return;let i=new nt;for(let t of e)i.add(t);yield this.addResultReleases(i)})}addResultReleases(e){return E(this,null,function*(){for(let i of e.releasegroups){if(this.shouldStop())return;let t=this.matchTree.findReleaseGroup(i.id);if(t??=yield this.addReleaseGroupByID(i.id),!t.currentRelease&&(yield this.loadBestMatchingCurrentRelease(t),this.shouldStop()))return;this.matchTree.sort()}})}loadLyricsOVH(e){return E(this,null,function*(){for(let i of e.media)for(let t of i.tracks)if(t.currentMatch&&!t.currentMatch.match.lyrics&&t.mbTrack.artistCredit&&t.mbTrack.artistCredit.length>0){let n=t.mbTrack.artistCredit[0].name,o=t.mbTrack.title,a=yield this.jam.metadata.lyricsovhSearch({title:o,artist:n});t.currentMatch.match.lyrics=a.data}})}loadRelease(e){return E(this,null,function*(){if(!(!e||e.loaded||e.isLoading)){e.isLoading=!0;try{this.currentAction=`Loading MusicBrainz Release: ${e.mbRelease.id}`;let t=(yield this.jam.metadata.musicbrainzLookup({type:Xe.release,mbID:e.mbRelease.id})).data;if(!t.release)throw new Error("Got empty data");e.setLookupRelease(t.release,this.matchings),e.loaded=!0,e.isLoading=!1}catch(i){return e.isLoading=!1,Promise.reject(i)}}})}addReleaseGroupByReleaseID(e){return E(this,null,function*(){this.currentAction=`Loading MusicBrainz Release: ${e}`;let t=(yield this.jam.metadata.musicbrainzLookup({type:Xe.release,mbID:e})).data;return t.release?this.addReleaseGroupByID(t.release.releaseGroup.id):Promise.reject(new Error("Got empty data"))})}addReleaseGroupByID(e){return E(this,null,function*(){let i=this.matchTree.findReleaseGroup(e);if(!i){this.currentAction=`Loading MusicBrainz Release Group: ${e}`;let n=(yield this.jam.metadata.musicbrainzLookup({type:Xe.releaseGroup,mbID:e})).data;if(!n.releaseGroup)return Promise.reject(new Error("Got empty data"));i=this.matchTree.addReleaseGroup(n.releaseGroup)}return i})}buildQuickQueries(){return Le.buildQuickQueries(this.matchings,this.folder)}buildQueries(){return Le.buildQueries(this.matchings)}loadBestMatchingCurrentRelease(e){return E(this,null,function*(){let i=e.releases.toSorted((t,n)=>{let o=Math.abs((t.totalTrack??0)-this.matchings.length),a=Math.abs((n.totalTrack??0)-this.matchings.length);return o===a?t.sortDate-n.sortDate:o-a});for(let t of i){if(this.shouldStop())return;if(yield this.loadRelease(t),t.complete){e.currentRelease=t;return}}e.releases.length>0&&(yield this.loadRelease(e.releases[0]),e.currentRelease=e.releases[0])})}loadByReleaseGroups(e){return E(this,null,function*(){yield this.releaseLoader.loadByReleaseGroups(e)})}loadByReleases(e){return E(this,null,function*(){yield this.releaseLoader.loadByReleases(e)})}loadByRecordings(e){return E(this,null,function*(){yield this.releaseLoader.loadByRecordings(e)})}runQuery(e,i){return E(this,null,function*(){if(this.shouldStop())return;this.currentAction=e.name;let n=(yield this.jam.metadata.musicbrainzSearch(e.q)).data;if(n.releaseGroups?yield this.loadByReleaseGroups(n.releaseGroups):n.releases?yield this.loadByReleases(n.releases):n.recordings?yield this.loadByRecordings(n.recordings):console.error("Not implemented result set",n),this.matchTree.sort(),this.shouldStop())return;let o=i.shift();o&&(yield this.runQuery(o,i))})}musicBrainzByQuickTags(){return E(this,null,function*(){let e=this.buildQuickQueries(),i=e.shift();i&&(yield this.runQuery(i,e))})}musicBrainzByTags(){return E(this,null,function*(){let e=this.buildQueries(),i=e.shift();i&&(yield this.runQuery(i,e))})}musicBrainzRefresh(){return E(this,null,function*(){for(let e of this.matchings){if(this.shouldStop())return;e.track.tag||(yield this.musicBrainzByTrackTag(e))}})}musicBrainzByTrackTag(e){return E(this,null,function*(){if(!e.track.tag)return;let i;e.track.tag.mbReleaseGroupID&&(i=yield this.addReleaseGroupByID(e.track.tag.mbReleaseGroupID)),!i&&e.track.tag.mbReleaseID&&(i=yield this.addReleaseGroupByReleaseID(e.track.tag.mbReleaseID)),i&&(yield this.applyMatchReleaseGroup(e,i))})}applyMatchReleaseGroup(e,i){return E(this,null,function*(){if(e.track.tag?.mbReleaseID){let t=i.findRelease(e.track.tag.mbReleaseID);t?yield this.loadRelease(t):console.error("Could not find the release with id",e.track.tag.mbReleaseID),i.currentRelease=t,i.enough(this.matchings.length)||(i.currentRelease=void 0)}i.currentRelease||(yield this.loadBestMatchingCurrentRelease(i))})}run(e){return E(this,null,function*(){yield $i.executeStrategy(e,()=>E(this,null,function*(){return this.acoustId()}),()=>E(this,null,function*(){return this.musicBrainzRefresh()}),()=>E(this,null,function*(){return this.musicBrainzByQuickTags()}),()=>E(this,null,function*(){return this.musicBrainzByTags()}),()=>this.shouldStop())})}};var An=()=>({allowEmpty:!0});function Rn(r,e){if(r&1&&(d(0,"app-autocomplete-option-header"),O(1),c()),r&2){let i=u().$implicit;_(),w(i.header)}}function bn(r,e){if(r&1&&(T(0,Rn,2,1,"app-autocomplete-option-header"),d(1,"app-autocomplete-option",4),O(2),c()),r&2){let i=e.$implicit,t=u().control;f(i.header?0:-1),_(),S("option",i)("control",t),_(),w(i.data.text)}}function xn(r,e){if(r&1&&I(0,bn,3,4,null,null,te),r&2){let i=e.control;y(i.options)}}var st=(()=>{let e=class e{constructor(){this.standalone=v(!1),this.field=v("text"),this.value=v(""),this.data=v(),this.getList=v(),this.onAutoComplete=v(),this.valueChange=Q(),this.list=[],this.focused=!1,this.edit=""}ngOnChanges(t){t.value?.currentValue&&t.value.currentValue!==this.edit&&(this.edit=t.value.currentValue)}autocompleteGetData(t){return E(this,null,function*(){return t.length===0?this.list.map(n=>({data:n})):this.list.filter(n=>n.text.includes(t)).map(n=>({data:n}))})}autocompleteSelectResult(t){return this.edit=t.data.text,this.edit}autocompleteEnter(t){this.edit=t}onValueChange(){this.value()!==this.edit&&this.valueChange.emit(this.edit)}onFocus(){this.focused=!0,this.edit??="";let t=this.getList();t&&(this.list=t(this.data()).map(n=>({text:n})))}onBlur(){this.focused=!1,this.list=[]}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-tag-editor-autocomplete"]],inputs:{standalone:[1,"standalone"],field:[1,"field"],value:[1,"value"],data:[1,"data"],getList:[1,"getList"],onAutoComplete:[1,"onAutoComplete"]},outputs:{valueChange:"valueChange"},features:[j],decls:5,vars:10,consts:[["autocomplete","appAutocomplete"],["appAutocompleteContent",""],[1,"input-group"],["autocomplete","off","name","auto","type","text",3,"blur","change","focus","ngModelChange","ngModel","appAutocompleteControl","appAutocompleteSettings","appAutocomplete","value"],[3,"option","control"]],template:function(n,o){if(n&1){let a=A();d(0,"app-autocomplete",null,0),ee(2,xn,2,0,"ng-template",1),c(),d(3,"div",2)(4,"input",3),h("blur",function(){return p(a),g(o.onBlur())})("change",function(){return p(a),g(o.onValueChange())})("focus",function(){return p(a),g(o.onFocus())}),X("ngModelChange",function(m){return p(a),F(o.edit,m)||(o.edit=m),g(m)}),c()()}if(n&2){let a=Dt(1);_(3),le("cell",!o.standalone())("focused",o.focused),_(),$("ngModel",o.edit),S("appAutocompleteControl",o)("appAutocompleteSettings",Ht(9,An))("appAutocomplete",a)("value",o.edit)}},dependencies:[Y,Ce,K,J,_i,ui,Ei,mi,di],styles:["[_nghost-%COMP%]{width:100%}[_nghost-%COMP%]   .input-group[_ngcontent-%COMP%]{height:100%;width:100%}[_nghost-%COMP%]   .input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{height:100%;width:100%;background-color:var(--input);color:var(--on-input);border-radius:3px;padding-left:3px;padding-right:3px}[_nghost-%COMP%]   .input-group.cell[_ngcontent-%COMP%]{display:block;border:none}[_nghost-%COMP%]   .input-group.cell[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-left:0;padding-right:0;border-radius:0;border:none;color:inherit;background-color:inherit}"],changeDetection:0});let r=e;return r})();function vn(r,e){if(r&1&&(G(0,"div")(1,"span",15),C(2,5),B(),O(3,"\xA0"),G(4,"span",17),O(5),B()()),r&2){let i=u(2).$implicit;_(5),w(i.abdata.moods)}}function Nn(r,e){r&1&&(G(0,"div")(1,"span",15),C(2,6),B(),O(3,"\xA0"),G(4,"span",17),C(5,7),B()())}function In(r,e){if(r&1&&(G(0,"div")(1,"span",15),C(2,1),B(),O(3,"\xA0"),G(4,"span",16),O(5),B(),O(6,"\xA0 "),G(7,"span",15),C(8,2),B(),O(9,"\xA0"),G(10,"span",17),O(11),B(),O(12,"\xA0 "),G(13,"span",15),C(14,3),B(),O(15,"\xA0"),G(16,"span",17),O(17),ce(18,"mbArtistCredits"),B(),O(19,"\xA0 "),G(20,"span",15),C(21,4),B(),O(22,"\xA0"),G(23,"span",17),O(24),B(),O(25,"\xA0 "),T(26,vn,6,1,"div"),T(27,Nn,6,0,"div"),B()),r&2){let i=u().$implicit;_(5),w(i.mbTrack.position),_(6),w(i.mbTrack.title||"?"),_(6),w(pe(18,6,i.mbTrack.artistCredit)),_(7),w((i.mbRelease==null?null:i.mbRelease.title)||"?"),_(2),f(i.abdata?26:-1),_(),f(i.lyrics?27:-1)}}function yn(r,e){if(r&1){let i=A();G(0,"div",11),kt("dragstart",function(n){let o=p(i).$implicit,a=u();return g(a.drag(n,o))}),G(1,"div",12),Pe(2,"span",13),B(),G(3,"div",14),O(4),T(5,In,28,8,"div"),B()()}if(r&2){let i=e.$implicit;_(4),V(" ",i.track.name," "),_(),f(i.mbTrack?5:-1)}}var Fi=(()=>{let e=class e{constructor(){this.matchings=v([]),this.dragStartRequest=Q(),this.cd=H(jt)}drag(t,n){this.cd.markForCheck(),t.dataTransfer&&t.dataTransfer.setData("text",n.track.id)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-match-file-list"]],inputs:{matchings:[1,"matchings"]},outputs:{dragStartRequest:"dragStartRequest"},decls:5,vars:1,consts:()=>{let t;t=$localize`:␟fdddd307e09dca7fc105290797cf27ea6f091618␟4536546848137525611:${"\uFFFD0\uFFFD"}:INTERPOLATION: Tracks`;let n;n=$localize`:␟62105695c62cfa82a2676943102f9fc3c887bc48␟443542841142643147:TrackNr:`;let o;o=$localize`:␟8737210008395d7b014e5118d2ed198ae9745215␟2517309683610083249:Title:`;let a;a=$localize`:␟7918b6e7567484cccee5e53dca8985639a43479e␟3140202407838809744:Artist:`;let l;l=$localize`:␟ce99fbb2724383169925d4042ed56a458b5cdfc8␟1276947660844876641:Album:`;let m;m=$localize`:␟06c55f883d53d51c34401167ec5fec8dda96de4e␟6458132837581302237:Moods:`;let P;P=$localize`:␟35242a5d250cd67e3698ca65dc94729706a57e9e␟1342610846383662061:Lyrics:`;let R;return R=$localize`:␟0594812d4c50c2adbd1a892a3497c4e5c19e4b32␟6286037250766429054:yes`,[t,n,o,a,l,m,P,R,[1,"match-file-list"],[1,"match-file-list-header"],["draggable","true",1,"match-file"],["draggable","true",1,"match-file",3,"dragstart"],[1,"handle"],[1,"grippy"],[1,"title"],[1,"label"],[1,"currentRelease"],[1,"value"]]},template:function(n,o){n&1&&(G(0,"div",8)(1,"div",9),C(2,0),B(),I(3,yn,6,2,"div",10,te),B()),n&2&&(_(2),Lt(o.matchings().length),wt(2),_(),y(o.matchings()))},dependencies:[Ke],styles:['[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]{display:flex;flex-flow:column wrap;-webkit-user-select:none;user-select:none;width:100%;padding-top:5px;background-color:var(--background);color:var(--on-background);margin-bottom:15px}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file-list-header[_ngcontent-%COMP%]{text-align:center;padding-bottom:5px}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]{min-height:48px;display:flex;flex-flow:row nowrap;align-items:center;align-content:space-evenly;width:100%;padding:10px;line-height:1.25em;margin-bottom:1px;border-top-width:1px;border-top-style:solid;border-bottom-width:0;border-bottom-style:solid;border-bottom-color:var(--background-border);border-top-color:var(--background-border)}@media (max-width: 1000px){[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]{height:auto}}@media (max-width: 522px){[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]{font-size:.9em}}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{min-width:32px;text-align:right}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .play-count[_ngcontent-%COMP%]{min-width:20px;text-align:right}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]{min-width:30px;text-align:center}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .play-date[_ngcontent-%COMP%]{min-width:100px}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]{min-width:30px;text-align:center}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{flex-grow:1}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .length[_ngcontent-%COMP%]{min-width:80px;text-align:right}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-left:15px}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:last-of-type{margin-right:15px}@media (max-width: 400px){[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-left:0}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:last-of-type{margin-right:0}}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]:last-child{border-bottom-width:1px}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .small-screen-icon[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:var(--on-background-highlight)}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--on-background);font-size:.8em}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding:0;display:inline-block;margin:0 10px 0 0}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-size:.8em;vertical-align:middle}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   a.title-link[_ngcontent-%COMP%]{font-size:inherit;margin-right:10px;color:var(--on-background-highlight)}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background)}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background-hover)}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{width:0;margin-left:0;cursor:move}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]   span.grippy[_ngcontent-%COMP%]{display:inline-block;width:26px;height:8px;transform:rotate(90deg);margin-left:-8px}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]   span.grippy[_ngcontent-%COMP%], [_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]   span.grippy[_ngcontent-%COMP%]:before{background-image:radial-gradient(#7b7b7b 40%,transparent 40%);background-size:4px 4px;background-position:0 100%;background-repeat:repeat-x}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]   span.grippy[_ngcontent-%COMP%]:before{content:"";display:block;width:100%;height:33%}@media (max-width: 1000px){[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]{height:auto;min-height:48px}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:inline-block;margin-left:0}}@media (max-width: 400px){[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]{flex-flow:row wrap;align-items:inherit;width:100%;font-size:.9em}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .small-screen-icon[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{order:2;width:25%;text-align:center}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]   span.grippy[_ngcontent-%COMP%]{transform:rotate(0)}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{order:6;margin-left:0;margin-right:0;padding-right:0;padding-left:0;width:100%}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-left:0;margin-right:0;padding-right:0;padding-left:0;overflow:hidden;text-overflow:ellipsis}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{width:100%;margin-left:0;margin-right:0;overflow:hidden;text-overflow:ellipsis}}@media (max-width: 1200px){[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]{display:none}}@media (max-width: 400px){[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%], [_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .play-count[_ngcontent-%COMP%], [_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%], [_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .play-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .length[_ngcontent-%COMP%]{margin-left:0;margin-right:0;padding-right:0;padding-left:0;font-size:.8em;width:30%;flex-grow:1;text-align:center}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{order:1;width:25%;text-align:left}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .play-count[_ngcontent-%COMP%]{order:2}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]{order:3}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .play-date[_ngcontent-%COMP%]{order:4}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .length[_ngcontent-%COMP%]{order:5;width:25%;text-align:right}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{order:6}}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]{padding-left:0}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:11px}[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .match-file[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   span.value[_ngcontent-%COMP%]{color:var(--on-background-highlight);padding-right:5px}@media (max-width: 768px){[_nghost-%COMP%]   .match-file-list[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{display:none}}']});let r=e;return r})();function wn(r,e){if(r&1&&(G(0,"span",0),ce(1,"number"),At(),G(2,"svg",1),Pe(3,"rect",2),B()()),r&2){let i=e,t=u();Se("title",De("Score: ",pe(1,4,i))),_(3),Nt("y",12-i*10)("fill",t.color)}}var Xi=(()=>{let e=class e{constructor(){this.score=v()}getMatchColor(t){return t>.7?"green":t>.3?"yellow":"red"}ngOnChanges(){let t=this.score();this.color=t===void 0?void 0:this.getMatchColor(t)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-score-box"]],inputs:{score:[1,"score"]},features:[j],decls:1,vars:1,consts:[[3,"title"],["xmlns","http://www.w3.org/2000/svg","width","10","height","12"],["height","12","width","10"]],template:function(n,o){if(n&1&&T(0,wn,4,6,"span",0),n&2){let a;f((a=o.score())?0:-1,a)}},dependencies:[Ae,Ge],styles:["[_nghost-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   svg[_ngcontent-%COMP%]{overflow:hidden;vertical-align:middle;background-color:var(--background-hover);border:1px solid var(--background-border)}"]});let r=e;return r})();var Hi=(()=>{let e=class e{transform(t){return JSON.stringify(t,void 0," ")}};e.\u0275fac=function(n){return new(n||e)},e.\u0275pipe=xt({name:"json",type:e,pure:!0});let r=e;return r})();var kn=(r,e)=>({"button-primary":r,"button-on-background":e}),Dn=r=>({missing:r});function Gn(r,e){if(r&1&&(d(0,"span",18),O(1),c()),r&2){let i=u(2).$implicit;_(),w(i.mbGroup.artistCredit[0].name)}}function Bn(r,e){if(r&1&&O(0),r&2){let i=e.$implicit;V(" /",i," ")}}function $n(r,e){if(r&1&&I(0,Bn,1,1,null,null,te),r&2){let i=u(2).$implicit;y(i.mbGroup.secondaryTypes)}}function Fn(r,e){r&1&&M(0,"i",23)}function Xn(r,e){r&1&&M(0,"i",24)}function Hn(r,e){if(r&1&&(d(0,"span",18),O(1),T(2,Fn,1,0,"i",23)(3,Xn,1,0,"i",24),c()),r&2){let i=e.$implicit;_(),V("",i.tracks.length," "),_(),f(i.complete?2:3)}}function zn(r,e){if(r&1&&(d(0,"span",21),C(1,6),c(),d(2,"span",18),O(3),c()),r&2){let i=u(2).$implicit;_(3),w(i.currentRelease.totalTrack)}}function Vn(r,e){if(r&1&&(d(0,"div",19)(1,"span",21),C(2,0),c(),d(3,"span",18),M(4,"app-score-box",22),c(),d(5,"span",21),C(6,1),c(),T(7,Gn,2,1,"span",18),d(8,"span",21),C(9,2),c(),d(10,"span",18),O(11),T(12,$n,2,0),c(),M(13,"br"),d(14,"span",21),C(15,3),c(),d(16,"span",18),O(17),c(),d(18,"span",21),C(19,4),c(),d(20,"span",18),O(21),c(),M(22,"br"),d(23,"span",21),C(24,5),c(),I(25,Hn,4,2,"span",18,te),T(27,zn,4,1),c()),r&2){let i=u().$implicit;_(4),S("score",i.currentRelease.score),_(3),f(i.mbGroup.artistCredit?7:-1),_(4),V("",i.mbGroup.primaryType," "),_(),f(i.mbGroup.secondaryTypes?12:-1),_(5),w(i.currentRelease.mbRelease.date||"?"),_(4),w(i.currentRelease.mbRelease.country||"?"),_(4),y(i.currentRelease.media),_(2),f(i.currentRelease.media.length>1?27:-1)}}function Un(r,e){if(r&1){let i=A();d(0,"button",25),h("click",function(){p(i);let n=u(2).$implicit;return g(n.selecting=!n.selecting)}),C(1,8),c()}}function Wn(r,e){if(r&1){let i=A();d(0,"button",28),h("click",function(){let n=p(i),o=u(2).$implicit,a=u(2);return g(a.chooseRelease(o,n))}),C(1,9),c()}if(r&2){let i=e;S("ngClass",Vt(1,kn,i.complete,!i.complete))}}function jn(r,e){if(r&1){let i=A();d(0,"button",25),h("click",function(){p(i);let n=u().$implicit;return g(n.expanded=!n.expanded)}),C(1,7),c(),T(2,Un,2,0,"button",26),T(3,Wn,2,4,"button",27)}if(r&2){let i,t=u().$implicit;_(2),f(t.releases.length>1?2:-1),_(),f((i=t.currentRelease)?3:-1,i)}}function Kn(r,e){r&1&&O(0," / ")}function Jn(r,e){if(r&1&&(T(0,Kn,1,0),O(1)),r&2){let i=e.$implicit,t=e.$index;f(t>0?0:-1),_(),V(" ",i.trackCount," ")}}function Yn(r,e){if(r&1&&I(0,Jn,2,2,null,null,te),r&2){let i=u().$implicit;y(i.mbRelease.media)}}function Qn(r,e){r&1&&O(0," ? ")}function qn(r,e){if(r&1){let i=A();d(0,"label",30),h("click",function(){let n=p(i).$implicit,o=u(2).$implicit,a=u();return g(a.setRelease(o,n))}),M(1,"input",31),d(2,"span",21),C(3,10),c(),d(4,"span",18),M(5,"app-score-box",22),c(),d(6,"span",21),C(7,11),c(),d(8,"span",18),O(9),c(),d(10,"span",21),C(11,12),c(),d(12,"span",18),O(13),c(),d(14,"span",21),C(15,13),c(),d(16,"span",18),T(17,Yn,2,0),T(18,Qn,1,0),c()()}if(r&2){let i=e.$implicit,t=u(2).$implicit;_(),S("checked",i===t.currentRelease),_(4),S("score",i.score),_(4),w(i.mbRelease.date||"?"),_(4),w(i.mbRelease.country||"?"),_(4),f(i.mbRelease.media?17:-1),_(),f(i.mbRelease.media?-1:18)}}function Zn(r,e){if(r&1&&(d(0,"div")(1,"form")(2,"fieldset"),I(3,qn,19,6,"label",29,te),c()()()),r&2){let i=u().$implicit;_(3),y(i.releases)}}function eo(r,e){r&1&&M(0,"i",34)}function to(r,e){r&1&&M(0,"i",35)}function io(r,e){if(r&1){let i=A();d(0,"div",33),h("click",function(){p(i);let n=u().$implicit;return g(n.expanded=!n.expanded)}),M(1,"i"),ce(2,"stringToggle"),k(3),C(4,14),D(),O(5),T(6,eo,1,0,"i",34)(7,to,1,0,"i",35),c()}if(r&2){let i=u().$implicit;_(),Gt(Ut(2,4,i.expanded,"icon-minus","icon-plus")),_(4),V(" ",i.mbMedia.position," "),_(),f(i.complete?6:7)}}function no(r,e){if(r&1){let i=A();d(0,"div",38),ce(1,"number"),ce(2,"json"),M(3,"app-score-box",22),d(4,"a",39),h("click",function(){p(i);let n=u().$implicit,o=u(5).$implicit,a=u();return g(a.removeMatching(o,n))}),M(5,"i",40),c(),O(6),c()}if(r&2){let i=u().$implicit;S("title",Ft("Score: ",pe(1,5,i.currentMatch.score)," ",pe(2,7,i.currentMatch.scores))),_(3),S("score",i.currentMatch.score),_(3),V(" ",i.currentMatch.match.track.name," ")}}function oo(r,e){if(r&1){let i=A();d(0,"div",37),h("drop",function(n){let o=p(i).$implicit,a=u(3),l=u(2).$implicit,m=u(2);return g(m.drop(n,l,a,o))})("dragover",function(n){p(i);let o=u(7);return g(o.allowDrop(n))}),O(1),ce(2,"mbArtistCredits"),T(3,no,7,9,"div",38),c()}if(r&2){let i=e.$implicit;S("ngClass",zt(7,Dn,!i.currentMatch)),_(),$t(" ",i.mbTrack.position," - ",i.mbTrack.title," - ",pe(2,5,i.mbTrack.artistCredit)," "),_(2),f(i.currentMatch?3:-1)}}function ro(r,e){if(r&1&&(d(0,"div"),I(1,oo,4,9,"div",36,te),c()),r&2){let i=u().$implicit;_(),y(i.tracks)}}function ao(r,e){if(r&1&&(d(0,"div"),T(1,io,8,8,"div"),T(2,ro,3,0,"div"),c()),r&2){let i=e.$implicit,t=e.$count;_(),f(t>1?1:-1),_(),f(i.expanded||t<2?2:-1)}}function so(r,e){if(r&1&&(d(0,"div",32),I(1,ao,3,2,"div",null,te),c()),r&2){let i=u(2).$implicit;_(),y(i.currentRelease.media)}}function lo(r,e){if(r&1&&T(0,so,3,0,"div",32),r&2){let i,t=u().$implicit;f((i=t.currentRelease)?0:-1,i)}}function co(r,e){if(r&1&&(d(0,"div",16)(1,"div",17)(2,"span",18),O(3),c()(),T(4,Vn,28,7,"div",19),d(5,"div",20),T(6,jn,4,2),T(7,Zn,5,0,"div"),c(),T(8,lo,1,1),c()),r&2){let i=e.$implicit,t=u();_(3),w(i.mbGroup.title),_(),f(i.currentRelease?4:-1),_(2),f(t.isRunning?-1:6),_(),f(i.selecting?7:-1),_(),f(i.expanded?8:-1)}}function _o(r,e){r&1&&(d(0,"div",15),I(1,co,9,5,"div",16,te),c()),r&2&&(_(),y(e.matchTree.groups))}var zi=(()=>{let e=class e{constructor(){this.matcher=v(),this.chooseReleaseRequest=Q()}chooseRelease(t,n){this.chooseReleaseRequest.emit({group:t,release:n})}allowDrop(t){t.preventDefault()}drop(t,n,o,a){if(t.preventDefault(),!t.dataTransfer)return;let l=t.dataTransfer.getData("text");this.matcher()?.selectMatch(l,n,o,a)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-match-results"]],inputs:{matcher:[1,"matcher"]},outputs:{chooseReleaseRequest:"chooseReleaseRequest"},decls:1,vars:1,consts:()=>{let t;t=$localize`:␟9c5fdf21ec2cc7baa6f062f2dc417af45c8dbe60␟2332107018974972998:Score:`;let n;n=$localize`:␟181d9cc99eed91d7852bd736b8a79c5907b45171␟2179591033024116895:Artist: `;let o;o=$localize`:␟61402178af0b9f5caed0039f945af2a1aa44a199␟5368772156211954254:Type: `;let a;a=$localize`:␟05fa0bded36de6e73a1fa44838b627349dace044␟6899410641137821757:Date:`;let l;l=$localize`:␟33d64f1b5578cd3ff6413272a9bf0384e9c8626b␟4863373404095396982:Country:`;let m;m=$localize`:␟65bf4c02f9a036e9636d10cf81f1b20d7ed4aaf9␟5867760138967480184:Tracks:`;let P;P=$localize`:␟531e01644fee19759b4ce5a878390932ef913389␟8058716232090816784:All tracks matched`;let R;R=$localize`:␟095b08f20cb01fbf9e6c14b9cc035aac5590010d␟7216252099739448639:Unmatched tracks!`;let N;N=$localize`:␟7879085ff555563b56e31cc46b16fe088b1e491e␟8270728553315605434:Total Tracks:`;let Z;Z=$localize`:␟cb98522066062d775f3b81f29c898a7cc76292c0␟1575810254412583888:Tracks`;let U;U=$localize`:␟43e86094b83c2bf239e942d85e71da6e8d64fb63␟4587452935087847438:Releases`;let de;de=$localize`:␟bf660b21cd43fb3c837bd12259ff6f77893bd35f␟2772629094998888347:Choose `;let _e;_e=$localize`:␟9c5fdf21ec2cc7baa6f062f2dc417af45c8dbe60␟2332107018974972998:Score:`;let ue;ue=$localize`:␟05fa0bded36de6e73a1fa44838b627349dace044␟6899410641137821757:Date:`;let ae;ae=$localize`:␟33d64f1b5578cd3ff6413272a9bf0384e9c8626b␟4863373404095396982:Country:`;let me;me=$localize`:␟65bf4c02f9a036e9636d10cf81f1b20d7ed4aaf9␟5867760138967480184:Tracks:`;let x;x=$localize`:␟531e01644fee19759b4ce5a878390932ef913389␟8058716232090816784:All tracks matched`;let Ot;Ot=$localize`:␟095b08f20cb01fbf9e6c14b9cc035aac5590010d␟7216252099739448639:Unmatched tracks!`;let Et;Et=$localize`:␟8a27a855a00b08d2ca981207638ea9097032412b␟3250391385569692601:Media`;let Pt;return Pt=$localize`:␟588011b76eaa42ff648f34c6418d8732f3b894b8␟6043994951771855575:Remove Matching`,[t,n,o,a,l,m,N,Z,U,de,_e,ue,ae,me,Et,[1,"match-results"],[1,"match-releasegroup"],[1,"match-releasegroup-title"],[1,"value"],[1,"match-release-info"],[1,"match-select-releases"],[1,"label"],[3,"score"],["title",P,1,"icon-checkmark"],["title",R,1,"icon-warning"],[1,"button-on-background",3,"click"],[1,"button-on-background"],[1,"button-primary",3,"ngClass"],[1,"button-primary",3,"click","ngClass"],[1,"select"],[1,"select",3,"click"],["type","radio","name","release",3,"checked"],[1,"match-tracks-info"],[3,"click"],["title",x,1,"icon-checkmark"],["title",Ot,1,"icon-warning"],[1,"match-track-info",3,"ngClass"],[1,"match-track-info",3,"drop","dragover","ngClass"],[3,"title"],["title",Pt,3,"click"],[1,"icon-trash"]]},template:function(n,o){if(n&1&&T(0,_o,3,0,"div",15),n&2){let a;f((a=o.matcher())?0:-1,a)}},dependencies:[Ae,Kt,Xi,Hi,Ge,Ke,ai],styles:["[_nghost-%COMP%]   .match-results[_ngcontent-%COMP%]{flex:1 1 auto;overflow-y:auto;overflow-x:auto}[_nghost-%COMP%]   .match-results[_ngcontent-%COMP%]   .icon-checkmark[_ngcontent-%COMP%]{color:var(--primary)}[_nghost-%COMP%]   .match-results[_ngcontent-%COMP%]   .icon-warning[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .match-results[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:var(--on-background-highlight);padding-right:5px}[_nghost-%COMP%]   .match-results[_ngcontent-%COMP%]   .match-releasegroup[_ngcontent-%COMP%]{padding:5px 5px 5px 15px}[_nghost-%COMP%]   .match-results[_ngcontent-%COMP%]   .match-releasegroup[_ngcontent-%COMP%]   .match-release-info[_ngcontent-%COMP%], [_nghost-%COMP%]   .match-results[_ngcontent-%COMP%]   .match-releasegroup[_ngcontent-%COMP%]   .match-tracks-info[_ngcontent-%COMP%]{font-size:.8em}[_nghost-%COMP%]   .match-results[_ngcontent-%COMP%]   .match-releasegroup[_ngcontent-%COMP%]   .match-release-info[_ngcontent-%COMP%], [_nghost-%COMP%]   .match-results[_ngcontent-%COMP%]   .match-releasegroup[_ngcontent-%COMP%]   .match-tracks-info[_ngcontent-%COMP%], [_nghost-%COMP%]   .match-results[_ngcontent-%COMP%]   .match-releasegroup[_ngcontent-%COMP%]   .match-select-releases[_ngcontent-%COMP%]{padding-top:4px}[_nghost-%COMP%]   .match-results[_ngcontent-%COMP%]   .match-releasegroup[_ngcontent-%COMP%]   .match-select-releases[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:.7em;line-height:.7em;vertical-align:top}[_nghost-%COMP%]   .match-results[_ngcontent-%COMP%]   .match-releasegroup[_ngcontent-%COMP%]   app-image-base64[_ngcontent-%COMP%]{height:32px;width:32px}[_nghost-%COMP%]   .match-results[_ngcontent-%COMP%]   .match-releasegroup[_ngcontent-%COMP%]   .match-track-info[_ngcontent-%COMP%]{padding-top:2px;padding-bottom:2px;border-top:1px solid var(--background-border)}[_nghost-%COMP%]   .match-results[_ngcontent-%COMP%]   .match-releasegroup[_ngcontent-%COMP%]   .match-track-info.missing[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .match-results[_ngcontent-%COMP%]   .match-releasegroup[_ngcontent-%COMP%]   .match-release[_ngcontent-%COMP%]{white-space:nowrap;padding:5px 5px 5px 42px}"]});let r=e;return r})();var po=["actionMenu"];function go(r,e){r&1&&(d(0,"a",18),M(1,"i",26),k(2),C(3,1),D(),c())}function Co(r,e){r&1&&(d(0,"a",18),M(1,"i",27),k(2),C(3,2),D(),c())}function ho(r,e){if(r&1){let i=A();d(0,"app-match-results",28),h("chooseReleaseRequest",function(n){p(i);let o=u();return g(o.chooseRelease(n))}),c()}if(r&2){let i=u();S("matcher",i.matcher)}}function To(r,e){if(r&1&&(d(0,"div",23),M(1,"i",29),O(2),c()),r&2){let i=u();_(2),V(" ",i.matcher.currentAction)}}function fo(r,e){r&1&&C(0,3)}function Mo(r,e){r&1&&C(0,4)}function Oo(r,e){r&1&&C(0,5)}function Eo(r,e){r&1&&C(0,6)}function Po(r,e){r&1&&(d(0,"button",31),M(1,"i",29),c())}function So(r,e){if(r&1){let i=A();d(0,"button",33),h("click",function(){p(i);let n=u(2);return g(n.apply())}),C(1,8),c()}}function Ao(r,e){if(r&1){let i=A();d(0,"div",25)(1,"div",30),T(2,Po,2,0,"button",31)(3,So,2,0,"button",31),d(4,"button",32),h("click",function(){p(i);let n=u();return g(n.stopApply())}),C(5,7),c()()()}if(r&2){let i=u();_(2),f(i.matcher.isRunning?2:3)}}function Ro(r,e){if(r&1){let i=A();d(0,"div")(1,"button",33),h("click",function(){p(i);let n=u(3);return g(n.matcher.manualSearch())}),C(2,11),c(),d(3,"button",32),h("click",function(){p(i);let n=u(3);return g(n.matcher.clear())}),C(4,12),c(),d(5,"button",32),h("click",function(){p(i);let n=u(3);return g(n.matcher.manual=!1)}),C(6,13),c()()}}function bo(r,e){if(r&1){let i=A();d(0,"div")(1,"button",32),h("click",function(){p(i);let n=u(3);return g(n.matcher.stop())}),C(2,14),c()()}}function xo(r,e){if(r&1){let i=A();d(0,"div",30)(1,"div",34)(2,"div")(3,"div"),C(4,9),c(),d(5,"app-tag-editor-autocomplete",35),X("valueChange",function(n){p(i);let o=u(2);return F(o.matcher.manualSearchData.releaseGroup,n)||(o.matcher.manualSearchData.releaseGroup=n),g(n)}),c()(),d(6,"div")(7,"div"),C(8,10),c(),d(9,"app-tag-editor-autocomplete",35),X("valueChange",function(n){p(i);let o=u(2);return F(o.matcher.manualSearchData.artist,n)||(o.matcher.manualSearchData.artist=n),g(n)}),c()()(),T(10,Ro,7,0,"div"),T(11,bo,3,0,"div"),c()}if(r&2){let i=u(2);_(5),S("getList",i.matcher.manualSearchData.getAutoCompleteAlbumList)("standalone",!0),$("value",i.matcher.manualSearchData.releaseGroup),_(4),S("getList",i.matcher.manualSearchData.getAutoCompleteArtistList)("standalone",!0),$("value",i.matcher.manualSearchData.artist),_(),f(i.matcher.isRunning?-1:10),_(),f(i.matcher.isRunning?11:-1)}}function vo(r,e){if(r&1){let i=A();d(0,"div")(1,"button",32),h("click",function(){p(i);let n=u(3);return g(n.matcher.stop())}),C(2,15),c()()}}function No(r,e){if(r&1){let i=A();d(0,"div")(1,"button",36),h("click",function(){p(i);let n=u(3);return g(n.matcher.start(n.RunType.auto))}),C(2,16),c(),d(3,"button",37),h("click",function(n){p(i);let o=u(3);return g(o.onContextMenu(n))}),O(4,"\xA0\u2026\xA0"),c()()}}function Io(r,e){if(r&1&&(d(0,"div",30),T(1,vo,3,0,"div")(2,No,5,0,"div"),c()),r&2){let i=u(2);_(),f(i.matcher.isRunning?1:2)}}function yo(r,e){if(r&1&&(d(0,"div",25),T(1,xo,12,8,"div",30)(2,Io,3,1,"div",30),c()),r&2){let i=u();_(),f(i.matcher.manual?1:2)}}var Vi=(()=>{let e=class e{constructor(){this.data=v(),this.RunType=fe,this.rightActive=!0,this.matchApply=ne.required(tt),this.actionMenu=ne("actionMenu"),this.jam=H(he),this.notify=H(Re),this.contextMenuService=H(Ve);let t=this.jam,n=this.notify;this.matcher=new at(t,n)}ngOnChanges(){let t=this.data();t?this.matcher.prepare(t.matchings.map(n=>({track:n.track})),t.folder):this.matcher.abort()}ngOnDestroy(){this.matcher.abort()}apply(){let t=this.matchApply().getGenres();for(let o of this.matcher.matchings)o.genres=t;let n=this.data();if(n){let o=this.matchApply().getCoverArtImages();for(let a of n.matchings){let l=this.matcher.matchings.find(m=>m.track.id===a.track.id);a.rawTag=l?ki(l,t,o):void 0}n.apply(),n.close&&n.close()}}chooseRelease({group:t,release:n}){this.stopApply(),this.current={group:t,release:n},this.matchApply().coverArtSearch={mbReleaseID:n.mbRelease.id,mbReleaseGroupID:t.mbGroup.id},this.matcher.apply(t,n);let o=this.data();o&&this.matchApply().loadGenres(o.matchings,t,n).catch(a=>{this.notify.error(a)})}stopApply(){this.current=void 0,this.matchApply().genres=void 0,this.matcher.stopApply()}loadLyricsRequest(){this.current&&this.matcher.loadLyrics(this.current.group.currentRelease)}loadMoodsRequest(){this.current&&this.matcher.loadMoods(this.current.group.currentRelease)}onContextMenu(t){this.contextMenuService.show.next({contextMenu:this.actionMenu(),event:t,item:void 0}),t.preventDefault(),t.stopPropagation()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-match-release"]],viewQuery:function(n,o){n&1&&(ie(o.matchApply,tt,5),ie(o.actionMenu,po,5)),n&2&&oe(2)},hostVars:2,hostBindings:function(n,o){n&2&&le("right-active",o.rightActive)},inputs:{data:[1,"data"]},features:[j],decls:16,vars:7,consts:()=>{let t;t=$localize`:␟d8bda62007c2bacc6bd73d2797ba6fab5eb96daf␟1739704243369512276:Show Tracks`;let n;n=$localize`:␟f1bca2b5b0d2d87b0641062e24bb678109d06c8d␟1818664258537534853:Show Matchings`;let o;o=$localize`:␟f8b6e885edfef63c69668c4d6a9580133a00ead7␟3795661313994709664:Manual Search with MusicBrainz`;let a;a=$localize`:␟be9ffa65590ff07f22e4cd0b96ba46657cd645d2␟6390950868913125525:Match with AcoustID`;let l;l=$localize`:␟4eefd958f9ebadbe763175761b9e1f266f8867d4␟6034730998727247542:Match with MusicBrainz (Text)`;let m;m=$localize`:␟c66e707e109490f913f700b7ca5d4eca128bc84c␟8911327935348537973:Match with MusicBrainz (Musicbrainz IDs)`;let P;P=$localize`:␟d7b35c384aecd25a516200d6921836374613dfe7␟2159130950882492111:Cancel`;let R;R=$localize`:␟c2d0ac9f528bbd5f53fd34269fde8b59e029621b␟4391289919356861627:Apply`;let N;N=$localize`:␟37a750182b4e4604bcc5c232d8c485c4721cd80d␟766537929493990192:Album Name`;let Z;Z=$localize`:␟378660a509ecaa4d2dd3b4b0b8975760cfe3576d␟2492300395471245755:Artist`;let U;U=$localize`:␟7e892ba15f2c6c17e83510e273b3e10fc32ea016␟4580988005648117665:Search`;let de;de=$localize`:␟99ee4faa69cd2ea8e3678c1f557c0ff1f05aae46␟8700121026680200191:Clear`;let _e;_e=$localize`:␟f4e529ae5ffd73001d1ff4bbdeeb0a72e342e5c8␟7819314041543176992:Close`;let ue;ue=$localize`:␟1d0d5c9a36e72bd9643ff1ede69736ae063d652b␟3133539296286953705:Stop`;let ae;ae=$localize`:␟1d0d5c9a36e72bd9643ff1ede69736ae063d652b␟3133539296286953705:Stop`;let me;return me=$localize`:␟bc7ebf67b7122e93bd293232982b1b45f3e5d8bc␟9028301309562848662:Auto Match`,[["actionMenu",""],t,n,o,a,l,m,P,R,N,Z,U,de,_e,ue,ae,me,[1,"toggle",3,"click"],[1,"button-on-control"],[1,"content"],[1,"match-files",3,"matchings"],[1,"match-releases",3,"loadLyricsRequest","loadMoodsRequest","hidden","isRunning"],[1,"match-releases",3,"matcher"],[1,"current-log"],["contextMenuItem","",3,"execute"],[1,"buttons"],[1,"icon-left"],[1,"icon-right"],[1,"match-releases",3,"chooseReleaseRequest","matcher"],[1,"icon-spin","icon-spinner"],[1,"match-actions"],[1,"button-primary"],[1,"button-accent",3,"click"],[1,"button-primary",3,"click"],[1,"match-search"],[3,"valueChange","getList","standalone","value"],[1,"button-on-control","button-with-add-on",3,"click"],[1,"button-on-control","button-add-on",3,"click"]]},template:function(n,o){if(n&1){let a=A();d(0,"div",17),h("click",function(){return p(a),g(o.rightActive=!o.rightActive)}),T(1,go,4,0,"a",18)(2,Co,4,0,"a",18),c(),d(3,"div",19),M(4,"app-match-file-list",20),d(5,"app-match-apply",21),h("loadLyricsRequest",function(){return p(a),g(o.loadLyricsRequest())})("loadMoodsRequest",function(){return p(a),g(o.loadMoodsRequest())}),c(),T(6,ho,1,1,"app-match-results",22),c(),T(7,To,3,1,"div",23),d(8,"context-menu",null,0),ee(10,fo,1,0,"ng-template",24),h("execute",function(){return p(a),g(o.matcher.setManualSearch())}),ee(11,Mo,1,0,"ng-template",24),h("execute",function(){return p(a),g(o.matcher.start(o.RunType.acoustID))}),ee(12,Oo,1,0,"ng-template",24),h("execute",function(){return p(a),g(o.matcher.start(o.RunType.musicbrainzByTags))}),ee(13,Eo,1,0,"ng-template",24),h("execute",function(){return p(a),g(o.matcher.start(o.RunType.musicbrainzRefresh))}),c(),T(14,Ao,6,1,"div",25)(15,yo,3,1,"div",25)}n&2&&(_(),f(o.rightActive?1:2),_(3),S("matchings",o.matcher.matchings),_(),S("hidden",!o.current)("isRunning",o.matcher.isRunning),_(),f(o.current?-1:6),_(),f(o.matcher.isRunning?7:-1),_(7),f(o.current?14:15))},dependencies:[je,We,Ue,st,Fi,tt,zi],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%;overflow:hidden}[_nghost-%COMP%]   .toggle[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex:1 1 auto;overflow-y:auto}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .match-files[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:auto;display:block;height:100%;width:50%;font-size:.8em;padding-right:15px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .match-releases[_ngcontent-%COMP%]{border-left:1px solid var(--background-border);display:flex;flex-direction:column;flex:1 1 auto;width:50%;font-size:.9em}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .match-releases[hidden][_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]{flex:0 0 auto;padding:5px;display:flex;align-items:center;justify-content:center;border-top:1px solid var(--background-border)}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   .match-actions[_ngcontent-%COMP%]{text-align:center;vertical-align:middle;margin-top:10px;margin-bottom:30px}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   .match-actions[_ngcontent-%COMP%]   app-tag-editor-autocomplete[_ngcontent-%COMP%]{height:28px;display:block}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   .match-actions[_ngcontent-%COMP%]   .match-search[_ngcontent-%COMP%]{display:flex;flex-direction:row;text-align:left}@media (max-width: 768px){[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   .match-actions[_ngcontent-%COMP%]   .match-search[_ngcontent-%COMP%]{flex-direction:column}}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   .match-actions[_ngcontent-%COMP%]   .match-search[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1;padding-left:10px;padding-right:10px}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   .match-actions[_ngcontent-%COMP%]   .match-search[_ngcontent-%COMP%]{margin-bottom:10px}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   .match-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:10px;margin-right:10px}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   .match-actions[_ngcontent-%COMP%]   .match-progress[_ngcontent-%COMP%]{display:block;font-size:.9em}[_nghost-%COMP%]   .current-log[_ngcontent-%COMP%]{font-size:.8em;padding:5px}@media (max-width: 768px){[_nghost-%COMP%]   .toggle[_ngcontent-%COMP%]{display:block;position:relative;width:100%;height:auto;text-align:center;padding-top:5px;padding-bottom:5px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{overflow-y:auto}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .match-files[_ngcontent-%COMP%]{height:auto;width:100%;overflow-y:inherit;display:block;padding-right:0}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .match-releases[_ngcontent-%COMP%]{height:auto;width:100%;display:none;border-left:none}.right-active[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .match-releases[_ngcontent-%COMP%]{display:block}.right-active[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .match-files[_ngcontent-%COMP%]{display:none}}"]});let r=e;return r})();var Ui=(()=>{let e=class e{constructor(){this.unsubscribe=new se}dialogInit(t,n){this.data=n.data,this.data&&(this.data.close=()=>{t.close()}),t.beforeClose().pipe(Me(this.unsubscribe)).subscribe(()=>{this.data=void 0})}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-dialog-match-release"]],decls:1,vars:1,consts:[[3,"data"]],template:function(n,o){n&1&&M(0,"app-match-release",0),n&2&&S("data",o.data)},dependencies:[Vi],encapsulation:2});let r=e;return r})();var Lo=["inputEl"],Wi=(()=>{let e=class e{constructor(){this.navigKeyDownRequest=Q(),this.navigBlur=new se,this.navigChange=new se,this.input=ne("inputEl"),this.original="",this.val=""}ngOnChanges(){this.changeCell(this.cell)}changeCell(t){t&&(this.original=t.frames.length===0||!t.frames[0].value.text?"":t.frames[0].value.text,this.val=this.original)}ngAfterViewInit(){setTimeout(()=>{let t=this.input();t?.nativeElement&&t.nativeElement.focus()},0)}onEnter(){this.onChange(),this.navigBlur.next(void 0)}onChange(){let t=this.cell;t&&this.val!==this.original&&(t.frames.length===0&&t.frames.push({id:t.column.def.id,value:{id:t.column.def.subid,text:this.val}}),t.frames[0].value.text=this.val,this.navigChange.next(void 0))}onBlur(){this.onChange(),this.navigBlur.next(void 0)}autocompleteEnter(t){this.val=t}autocompleteGetData(t){return E(this,null,function*(){return[]})}autocompleteSelectResult(t){return this.val=t.data,this.val}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-cell-editor-txt"]],viewQuery:function(n,o){n&1&&ie(o.input,Lo,5),n&2&&oe()},inputs:{cell:"cell"},outputs:{navigKeyDownRequest:"navigKeyDownRequest"},features:[j],decls:2,vars:1,consts:[["inputEl",""],["autocomplete","off","type","text",3,"blur","keydown.enter","ngModelChange","ngModel"]],template:function(n,o){if(n&1){let a=A();d(0,"input",1,0),h("blur",function(){return p(a),g(o.onBlur())})("keydown.enter",function(){return p(a),g(o.onEnter())}),X("ngModelChange",function(m){return p(a),F(o.val,m)||(o.val=m),g(m)}),c()}n&2&&$("ngModel",o.val)},dependencies:[Y,Ce,K,J],styles:["[_nghost-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{width:100%;height:100%;text-align:left;background-color:var(--background);color:var(--on-background)}"]});let r=e;return r})();function wo(r,e){if(r&1){let i=A();d(0,"image-cropper",5),h("imageCropped",function(n){p(i);let o=u();return g(o.imageCropped(n))}),c()}if(r&2){let i=u();S("maintainAspectRatio",i.maintainAspectRatio)("format",i.format)("imageBase64",i.current.source)}}var ji=(()=>{let e=class e{constructor(){this.maintainAspectRatio=!0,this.current={},this.format="jpeg"}dialogInit(t,n){this.edit=n.data,this.edit&&(this.edit.result=this.edit.frames.map(o=>({id:o.id,value:we({},o.value)})),this.edit.result.length>0&&this.displayFrame(this.edit.result[0]))}displayFrame(t){let n=`data:${t.value.mimeType??"image/jpeg"};base64,${t.value.bin}`;this.current.frame=t,this.current.source=n}onDropFile(t){t.preventDefault(),this.uploadFile(t.dataTransfer?.files)}selectFile(t){let n=t.target;this.uploadFile(n.files??void 0)}onDragOverFile(t){t.stopPropagation(),t.preventDefault()}splitBase64(t){return{mimeType:t.slice(5,t.indexOf(";")),base64:t.slice(t.indexOf("base64,")+7)}}buildFrame(t){let{mimeType:n,base64:o}=this.splitBase64(t);return{id:"APIC",value:{mimeType:n,description:"",bin:o,pictureType:3}}}uploadFile(t){if(!t||t.length===0)return;let n=t[0],o=new FileReader,a=m=>{let P=m.target?.result;if(typeof P!="string")return;this.current.frame||(this.current.frame=this.buildFrame(P),this.edit?.result&&this.edit.result.push(this.current.frame)),this.current.source=P;let{mimeType:R,base64:N}=this.splitBase64(P);this.current.frame.value.mimeType=R,this.current.frame.value.bin=N},l=m=>{console.error(m)};o.addEventListener("load",a,{once:!0}),o.addEventListener("error",l,{once:!0}),o.readAsDataURL(n)}imageCropped(t){if(this.current.frame&&t.base64){let{mimeType:n,base64:o}=this.splitBase64(t.base64);this.current.frame.value.mimeType=n,this.current.frame.value.bin=o}}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-dialog-tag-image"]],decls:8,vars:3,consts:()=>{let t;t=$localize`:␟d833321cc90a0b0a52714c6d5ec97fbe6c7cfa5c␟2501989539336327542:Upload image`;let n;return n=$localize`:␟9adf24384bd663ce0cf256940aae864e83991330␟6234579371454134968:Maintain Aspect Ratio`,[n,["type","checkbox",3,"ngModelChange","ngModel","checked"],[1,"drop-zone",3,"dragover","drop"],["output","base64",3,"maintainAspectRatio","format","imageBase64"],["accept",".png,.jpeg,.jpg","placeholder",t,"type","file",3,"change"],["output","base64",3,"imageCropped","maintainAspectRatio","format","imageBase64"]]},template:function(n,o){n&1&&(d(0,"label")(1,"input",1),X("ngModelChange",function(l){return F(o.maintainAspectRatio,l)||(o.maintainAspectRatio=l),l}),c(),k(2),C(3,0),D(),c(),d(4,"div",2),h("dragover",function(l){return o.onDragOverFile(l)})("drop",function(l){return o.onDropFile(l)}),T(5,wo,1,3,"image-cropper",3),d(6,"form")(7,"input",4),h("change",function(l){return o.selectFile(l)}),c()()()),n&2&&(_(),$("ngModel",o.maintainAspectRatio),S("checked",o.maintainAspectRatio),_(4),f(o.current.source?5:-1))},dependencies:[Y,Fe,ge,K,Be,J,$e,gi],styles:["[_nghost-%COMP%]   .drop-zone[_ngcontent-%COMP%]{padding:10px 20px;border-width:2px;border-style:dotted;border-color:var(--secondary)}"]});let r=e;return r})();function ko(r,e){if(r&1){let i=A();d(0,"textarea",1),X("ngModelChange",function(n){p(i);let o=u();return F(o.currentLyrics.value.text,n)||(o.currentLyrics.value.text=n),g(n)}),c()}if(r&2){let i=u();$("ngModel",i.currentLyrics.value.text)}}var Ki=(()=>{let e=class e{dialogInit(t,n){if(this.edit=n.data,this.edit){if(this.edit.result=this.edit.frames.map(o=>({id:o.id,value:we({},o.value)})),this.edit.result.length===0){let o={id:"USLT",value:{id:"",language:"",text:""}};this.edit.result.push(o)}this.currentLyrics=this.edit.result[0]}}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-dialog-tag-lyrics"]],decls:1,vars:1,consts:()=>{let t;t=$localize`:␟037aa3ea211cc632fa094de77aaefe2ab6e097a2␟6110089012347909146:off`;let n;return n=$localize`:␟037aa3ea211cc632fa094de77aaefe2ab6e097a2␟6110089012347909146:off`,[["autocomplete","off","autocorrect",t,"autocapitalize",n,"spellcheck","false",3,"ngModel"],["autocomplete","off","autocorrect",t,"autocapitalize",n,"spellcheck","false",3,"ngModelChange","ngModel"]]},template:function(n,o){n&1&&T(0,ko,1,1,"textarea",0),n&2&&f(o.currentLyrics?0:-1)},dependencies:[Y,Ce,K,J],styles:["[_nghost-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;height:100%;background-color:var(--background);color:var(--on-background)}"]});let r=e;return r})();function Do(r,e){if(r&1&&(G(0,"div",0),O(1),B()),r&2){let i=e.$implicit;Se("title",i),_(),w(i)}}var Ji=(()=>{let e=class e{constructor(){this.lines=v()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-cell-editor-display"]],inputs:{lines:[1,"lines"]},decls:2,vars:0,consts:[[3,"title"]],template:function(n,o){n&1&&I(0,Do,2,2,"div",0,It),n&2&&y(o.lines())},styles:["[_nghost-%COMP%]   div[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:left;padding-left:6px;padding-right:6px}"],changeDetection:0});let r=e;return r})();var Go=["cellContainer"];function Bo(r,e){if(r&1&&M(0,"app-cell-editor-display",1),r&2){let i=u();S("lines",i.lines)}}function $o(r,e){r&1&&yt(0,null,0)}var Yi=(()=>{let e=class e extends Te{constructor(){super(...arguments),this.navigKeyDownRequest=Q(),this.container=ne("cellContainer",{read:ct}),this.cell=v(),this.lines=[],this.inactive=!0,this.unsubscribe=new se,this.dialogOverlay=H(He)}ngOnDestroy(){this.clearEdit(),this.unsubscribe.next(),this.unsubscribe.complete()}clickEvent(){this.edit()}ngOnChanges(){this.display()}navigTo(){}static picFrameToString(t){return Si[t.value.pictureType]||"image"}static popularimeterFrameToString(t){return`${t.value.rating} - ${t.value.email} - ${t.value.count}`}static boolFrameToString(t){return`${t.value.bool}`}static textListFrameToString(t){return t.value.list.join(`
`)}static textFrameToString(t){return t.value.text}static idTextFrameToString(t){return t.value.text}static playCounterFrameToString(t){return`${t.value.num}`}static geobFrameToString(t){return`Binary ${t.value.bin.length} bytes`}static idBinFrameToString(t){return`Binary ${t.value.bin.length} bytes`}static langDescFrameToString(t){return t.value.text}edit(){let t=this.cell();switch(t?.column.def.impl){case s.Filename:case s.IdText:case s.LangDescText:case s.Text:{t.column.def.id==="USLT"?this.editLyrics():this.startEdit(Wi);break}case s.Bool:{this.editBool();break}case s.Pic:{this.editPictures();break}default:}}startEdit(t){this.inactive&&(this.inactive=!1,setTimeout(()=>{this.createComponent(t),this.componentRef&&(this.componentRef.instance.cell=this.cell(),this.componentRef.instance.changeCell(this.cell()),this.componentRef.instance.navigBlur.pipe(Me(this.unsubscribe)).subscribe(()=>{this.clearEdit(),this.inactive=!0}),this.componentRef.instance.navigChange.pipe(Me(this.unsubscribe)).subscribe(()=>{this.setChanged()}))}))}clearEdit(){this.componentRef&&this.componentRef.destroy();let t=this.container();t&&t.clear()}createComponent(t){this.clearEdit();let n=this.container();n&&(this.componentRef=n.createComponent(t))}editBool(){let t=this.cell();t&&(t.frames.length===0&&t.frames.push({id:t.column.def.id,value:{bool:!1}}),t.frames[0].value.bool=!t.frames[0].value.bool,this.setChanged())}setChanged(){let t=this.cell();t&&(t.changed=!0,t.parent.changed=!0,this.display())}editPictures(){let t=this.cell();if(t){let n={frames:t.frames};this.dialogOverlay.open({childComponent:ji,title:"Tag Pictures",data:n,onOkBtn:()=>E(this,null,function*(){return t.frames=n.result??[],this.setChanged(),Promise.resolve()}),onCancelBtn:()=>E(this,null,function*(){return Promise.resolve()})})}}editLyrics(){let t=this.cell();if(t){let n={frames:t.frames};this.dialogOverlay.open({childComponent:Ki,title:"Tag Lyrics",data:n,panelClass:"overlay-panel-large-buttons",onOkBtn:()=>E(this,null,function*(){return t.frames=n.result?n.result.filter(o=>o.value.text.length>0):[],this.setChanged(),Promise.resolve()}),onCancelBtn:()=>E(this,null,function*(){return Promise.resolve()})})}}display(){let t=this.cell();this.lines=t?t.frames.map(n=>this.frameToString(n)):[]}frameToString(t){let n=this.cell();switch(n?.column.def.impl){case s.Filename:case s.Text:return e.textFrameToString(t);case s.LangDescText:return e.langDescFrameToString(t);case s.IdText:return e.idTextFrameToString(t);case s.Pic:return e.picFrameToString(t);case s.TextList:return e.textListFrameToString(t);case s.IdBin:return e.idBinFrameToString(t);case s.GEOB:return e.geobFrameToString(t);case s.Bool:return e.boolFrameToString(t);case s.Popularimeter:return e.popularimeterFrameToString(t);case s.PlayCounter:return e.playCounterFrameToString(t);default:return`Not implemented celleditor for: ${n?.column.def.name}`}}};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=Rt(e)))(o||e)}})(),e.\u0275cmp=b({type:e,selectors:[["app-cell-editor"]],viewQuery:function(n,o){n&1&&ie(o.container,Go,5,ct),n&2&&oe()},hostBindings:function(n,o){n&1&&h("click",function(){return o.clickEvent()})},inputs:{cell:[1,"cell"]},outputs:{navigKeyDownRequest:"navigKeyDownRequest"},features:[Xt([{provide:Te,useExisting:St(()=>e)}]),vt,j],decls:2,vars:1,consts:[["cellContainer",""],[3,"lines"]],template:function(n,o){n&1&&T(0,Bo,1,1,"app-cell-editor-display",1)(1,$o,2,0,"ng-container"),n&2&&f(o.inactive?0:1)},dependencies:[Ji],encapsulation:2});let r=e;return r})();var Fo=(r,e)=>e.def.id,Xo=(r,e)=>e.title;function Ho(r,e){if(r&1){let i=A();d(0,"div",15),k(1),C(2,5),D(),d(3,"div",16)(4,"app-tag-editor-autocomplete",22),X("valueChange",function(n){p(i);let o=u(3);return F(o.multiStr,n)||(o.multiStr=n),g(n)}),c()(),d(5,"button",19),h("click",function(){p(i);let n=u(),o=u(),a=u();return g(n.setColumnText(o,a.multiStr))}),C(6,6),c(),d(7,"button",19),h("click",function(){p(i);let n=u(),o=u(),a=u();return g(n.appendColumnText(o,a.multiStr))}),C(8,7),c(),d(9,"button",19),h("click",function(){p(i);let n=u(),o=u(),a=u();return g(n.removeColumnText(o,a.multiStr))}),C(10,8),c()()}if(r&2){let i=u(2),t=u();_(4),S("getList",i.getAutoCompleteList),$("value",t.multiStr)}}function zo(r,e){if(r&1&&(d(0,"option",18),O(1),c()),r&2){let i=e.$implicit,t=e.$index;S("value",t),_(),w(i.def.name)}}function Vo(r,e){if(r&1){let i=A();d(0,"div",15),O(1),M(2,"br"),d(3,"button",19),h("click",function(){let n=p(i).$implicit;return g(n.click())}),M(4,"i",23),c()()}if(r&2){let i=e.$implicit;_(),V(" ",i.title)}}function Uo(r,e){if(r&1){let i=A();d(0,"div",9)(1,"div",10)(2,"div",11)(3,"a",12),h("click",function(){p(i);let n=u(2);return g(n.close())})("keydown.enter",function(){p(i);let n=u(2);return g(n.close())}),M(4,"i",13),c()(),k(5),C(6,0),D(),d(7,"span"),O(8),c()(),d(9,"div",14),T(10,Ho,11,2,"div",15),d(11,"div",15),k(12),C(13,1),D(),d(14,"div",16)(15,"select",17),X("ngModelChange",function(n){p(i);let o=u(2);return F(o.sourceColumnIndex,n)||(o.sourceColumnIndex=n),g(n)}),I(16,zo,2,2,"option",18,Fo),c()(),d(18,"button",19),h("click",function(){let n=p(i),o=u(),a=u();return g(n.copyColumn(a.sourceColumnIndex,o))}),C(19,2),c(),d(20,"button",19),h("click",function(){let n=p(i),o=u(),a=u();return g(n.appendFromColumn(a.sourceColumnIndex,o))}),C(21,3),c(),d(22,"div",20)(23,"button",19),h("click",function(){let n=p(i),o=u(),a=u();return g(n.insertFromColumn(a.sourceColumnIndex,0,o))}),C(24,4),c(),M(25,"input",21),c()(),I(26,Vo,5,1,"div",15,Xo),c()()}if(r&2){let i=u(),t=u();_(8),w(i.def.name),_(2),f(i.multi?10:-1),_(5),$("ngModel",t.sourceColumnIndex),_(),y(e.columns),_(10),y(i.actions)}}function Wo(r,e){if(r&1&&T(0,Uo,28,3,"div",9),r&2){let i,t=u();f((i=t.editor())?0:-1,i)}}var Qi=(()=>{let e=class e{constructor(){this.editor=v(),this.activeCol=v(),this.requestClose=Q(),this.sourceColumnIndex=0,this.multiStr=""}close(){this.requestClose.emit()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-admin-tag-editor-column-tool"]],inputs:{editor:[1,"editor"],activeCol:[1,"activeCol"]},outputs:{requestClose:"requestClose"},decls:1,vars:1,consts:()=>{let t;t=$localize`:␟f4e529ae5ffd73001d1ff4bbdeeb0a72e342e5c8␟7819314041543176992:Close`;let n;n=$localize`:␟d731f73de19f7407b321fce2ff8de9425d72c662␟1607698600866936391:Current Column:`;let o;o=$localize`:␟37b491bdf12da2468699e357868ea7284bbeb61d␟5804004197558421795:Column Source`;let a;a=$localize`:␟1979da7460819153e11d2078244645d94291b69c␟4323470180912194028:Copy`;let l;l=$localize`:␟0d03d787306410e77e4703cc6da4486836dec357␟7771562252675241359:Append`;let m;m=$localize`:␟e97cdb4e187e8c55422b6e55c4285b93e2570553␟6908115012584116794:Insert at`;let P;P=$localize`:␟8fd7e975ff82c96b835d595a37b7c823e0e6b047␟6476905889975409604:Column Text`;let R;R=$localize`:␟55dd9f44e64851bca3b7bfc9283a5ff36f030228␟4359847060009771702:Set`;let N;N=$localize`:␟0d03d787306410e77e4703cc6da4486836dec357␟7771562252675241359:Append`;let Z;return Z=$localize`:␟019d4bd6a5690f0cfa0ecf346a4e6bf7f0d8debb␟4814285799071780083:Remove`,[n,o,a,l,m,P,R,N,Z,[1,"column-tools"],[1,"column-tools-title"],[1,"close-panel"],["tabindex","0","title",t,1,"close",3,"click","keydown.enter"],["aria-hidden","true"],[1,"column-tool-content"],[1,"column-tool"],[1,"input-box"],[3,"ngModelChange","ngModel"],[3,"value"],[1,"button-on-background",3,"click"],[1,"button-with-add-on","button-insert-at"],["type","number"],[3,"valueChange","getList","value"],[1,"icon-down-thin"]]},template:function(n,o){if(n&1&&T(0,Wo,1,1),n&2){let a;f((a=o.activeCol())?0:-1,a)}},dependencies:[Y,Yt,Qt,Jt,K,J,st],styles:['[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]{border:1px solid var(--control-border);padding-bottom:15px}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .close-panel[_ngcontent-%COMP%]{float:right;display:inline-block;overflow:hidden;width:2.5rem;height:2.5rem;max-width:2.5rem;max-height:2.5rem;margin-top:-15px}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .close-panel[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:2.5rem;height:2.5rem;border:none;background-color:transparent;font-size:1.5rem;transition:.25s linear}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .close-panel[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]:before, [_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .close-panel[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]:after{position:absolute;content:"";width:.75rem;height:.125rem;background-color:var(--on-control-hover);overflow:hidden}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .close-panel[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]:before{transform:rotate(-45deg)}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .close-panel[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]:after{transform:rotate(45deg)}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .close-panel[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]:hover{transform:rotate(360deg)}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .close-panel[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]:hover:before, [_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .close-panel[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]:hover:after{background-color:var(--accent)}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .column-tools-title[_ngcontent-%COMP%]{padding-top:15px;padding-left:15px;padding-right:15px}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .column-tools-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--on-control-active)}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .input-box[_ngcontent-%COMP%]{border-radius:3px;padding-left:3px;padding-right:3px;align-items:center;background-color:var(--input);border:1px solid var(--input-border)}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .input-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border:none;min-height:28px;background-color:var(--input);color:var(--on-input)}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .input-box[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--on-input);font-size:14px;cursor:pointer}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .input-box[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:hover{color:var(--on-input-hover)}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .input-box[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .button-insert-at[_ngcontent-%COMP%]{display:inline-flex}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .button-insert-at[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:50px;border-color:var(--on-control-ambient)}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   app-tag-editor-autocomplete[_ngcontent-%COMP%]{flex:1;border:none;min-height:24px;height:24px;background-color:var(--input);color:var(--on-input)}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:1;border:none;height:24px;background-color:var(--input);color:var(--on-input);width:100%}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .column-tool-content[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .column-tools[_ngcontent-%COMP%]   .column-tool[_ngcontent-%COMP%]{padding:15px 15px 0;font-size:.8em;align-self:center}']});let r=e;return r})();var jo=["actionMenu"],qi=(r,e)=>e.def.id+e.def.subid,Ko=(r,e)=>e.track.id,Jo=(r,e)=>e.column.def.id+e.column.def.subid;function Yo(r,e){r&1&&(M(0,"i",11),k(1),C(2,1),D())}function Qo(r,e){r&1&&(M(0,"i",11),k(1),C(2,2),D())}function qo(r,e){r&1&&(M(0,"i",11),k(1),C(2,3),D())}function Zo(r,e){r&1&&(M(0,"i",11),k(1),C(2,4),D())}function er(r,e){r&1&&(M(0,"i",11),k(1),C(2,5),D())}function tr(r,e){r&1&&(M(0,"i",11),k(1),C(2,6),D())}function ir(r,e){if(r&1){let i=A();d(0,"div",12),k(1),C(2,7),D(),M(3,"br"),k(4),C(5,8),D(),M(6,"br"),d(7,"button",16),h("click",function(){p(i);let n=u(2);return g(n.loadRecursive())}),M(8,"i",17),k(9),C(10,9),D(),c()()}}function nr(r,e){r&1&&(d(0,"button",23),M(1,"i",26),c())}function or(r,e){if(r&1){let i=A();d(0,"button",27),h("click",function(){p(i);let n=u(3);return g(n.save())}),M(1,"i",28),c()}}function rr(r,e){if(r&1){let i=A();d(0,"div",13)(1,"button",18),h("click",function(){p(i);let n=u(2);return g(n.refresh())}),M(2,"i",17),c(),d(3,"button",19),h("click",function(){p(i);let n=u(2);return g(n.brainz())}),M(4,"app-mb-icon",20),c(),d(5,"button",21),h("click",function(){p(i);let n=u(2);return g(n.chooseColumns())}),M(6,"i",22),c(),T(7,nr,2,0,"button",23)(8,or,2,0,"button",24),d(9,"button",25),h("click",function(n){p(i);let o=u(2);return g(o.onContextMenu(n))}),O(10,"\u2026"),c()()}if(r&2){let i=u(2);_(4),S("size",12),_(3),f(i.isSaving?7:8)}}function ar(r,e){r&1&&M(0,"app-loading")}function sr(r,e){if(r&1){let i=A();d(0,"th",32),h("click",function(){let n=p(i).$implicit,o=u(3);return g(o.activeCol=n)}),d(1,"div")(2,"span",33),O(3),c()()()}if(r&2){let i=e.$implicit;_(2),S("title",i.def.id),_(),w(i.def.name)}}function lr(r,e){if(r&1&&M(0,"col"),r&2){let i=e.$implicit;dt("min-width",i.def.width||60,"px")}}function cr(r,e){r&1&&M(0,"i",36)}function dr(r,e){if(r&1){let i=A();d(0,"i",37),h("click",function(){p(i);let n=u(2).$implicit,o=u(3);return g(o.saveEdit(n))}),c()}}function _r(r,e){if(r&1&&T(0,cr,1,0,"i",36)(1,dr,1,0,"i",28),r&2){let i=u().$implicit;f(i.saving?0:1)}}function ur(r,e){if(r&1){let i=A();d(0,"td")(1,"app-cell-editor",38),h("navigKeyDownRequest",function(n){p(i);let o=u(4);return g(o.onCellEditorNavigationKeyDown(n))}),c()()}if(r&2){let i=e.$implicit;_(),le("changed",i.changed),S("cell",i)}}function mr(r,e){if(r&1&&(d(0,"tr")(1,"td",34)(2,"div",35),T(3,_r,2,1),c()(),I(4,ur,2,3,"td",null,Jo),c()),r&2){let i=e.$implicit;_(3),f(i.changed?3:-1),_(),y(i.cells)}}function pr(r,e){if(r&1&&(d(0,"div",15)(1,"table")(2,"thead")(3,"tr",29),M(4,"th"),I(5,sr,4,2,"th",30,qi),c()(),d(7,"colgroup"),M(8,"col"),I(9,lr,1,2,"col",31,qi),c(),d(11,"tbody"),I(12,mr,6,1,"tr",null,Ko),c()()()),r&2){let i=u(2);_(5),y(i.editor.columns),_(3),dt("min-width",40,"px"),_(),y(i.editor.columns),_(3),y(i.editor.edits)}}function gr(r,e){if(r&1){let i=A();T(0,ir,11,0,"div",12),T(1,rr,11,2,"div",13),d(2,"app-admin-tag-editor-column-tool",14),h("requestClose",function(){p(i);let n=u();return g(n.activeCol=void 0)}),c(),T(3,ar,1,0,"app-loading"),T(4,pr,14,2,"div",15)}if(r&2){let i=u();f(i.canLoadRecursive?0:-1),_(),f(i.tracks&&i.tracks.length>0&&i.editor.edits?1:-1),_(),S("editor",i.editor)("activeCol",i.activeCol),_(),f(i.tracks?-1:3),_(),f(i.tracks&&i.tracks.length>0&&i.editor.edits?4:-1)}}function Cr(r,e){r&1&&M(0,"app-loading")}var lt=(()=>{let e=class e{constructor(){this.id=v(),this.canLoadRecursive=!1,this.isSaving=!1,this.cellEditors=Wt(Te),this.actionMenu=ne("actionMenu"),this.folderService=H(pi),this.contextMenuService=H(Ve),this.jam=H(he),this.notify=H(Re),this.dialogOverlay=H(He),this.editor=new qe(this.jam)}canDeactivate(){return!this.isSaving}ngOnChanges(){this.refresh()}refresh(){this.folder=void 0,this.tracks=void 0,this.activeCol=void 0;let t=this.id();t&&this.jam.folder.id({id:t,folderIncFolders:!0,folderIncTracks:!0,folderIncParents:!0,folderIncTag:!0,trackIncTag:!0,trackIncRawTag:!0,folderChildIncTag:!0}).then(n=>{this.display(n)}).catch(n=>{this.notify.error(n)})}loadRecursive(){this.folder&&(this.canLoadRecursive=!1,this.tracks=void 0,this.jam.track.search({childOfID:this.folder.id,trackIncTag:!0,trackIncRawTag:!0,orderBy:qt.filename}).then(t=>{this.tracks=t.items,this.editor.build(this.tracks)}).catch(t=>{this.notify.error(t)}))}save(){if(this.isSaving)return;let t=this.editor.edits.filter(a=>a.changed);if(t.length===0)return;let n=[];for(let a of t)a.saving=!0,n.push(this.prepareEditSave(a));let o=n.shift();o&&(this.isSaving=!0,this.runSave(o,n).then(()=>{this.isSaving=!1}).catch(a=>{this.isSaving=!1;for(let l of t)l.saving=!1;this.notify.error(a)}))}prepareEditSave(t){let n={edit:t,track:t.track},o=t.cells.filter(l=>l.changed),a=o.find(l=>l.column.def.id===re);if(a){o=o.filter(m=>m.column.def.id!==re);let l=a.frames[0].value.text;l&&t.track.name!==l&&(n.filename=l)}return o.length>0&&(n.rawTag=Qe(t)),n}saveEdit(t){if(!t.changed||this.isSaving)return;this.isSaving=!0;let n=this.prepareEditSave(t);this.runSave(n,[]).then(()=>{this.isSaving=!1}).catch(o=>{this.isSaving=!1,this.notify.error(o)})}chooseColumns(){this.isSaving&&this.notify.error(new Error("Saving is in progress"));let t={columns:this.editor.columns,resultColumns:[]};this.dialogOverlay.open({childComponent:Ri,title:"Choose Columns",panelClass:"overlay-panel-large-buttons",data:t,onOkBtn:()=>E(this,null,function*(){try{this.tracks&&this.editor.updateColumns(this.tracks,t.resultColumns)}catch(n){return this.notify.error(n),Promise.reject(n)}}),onCancelBtn:()=>E(this,null,function*(){return Promise.resolve()})})}brainz(){if(!this.folder||!this.tracks)return;this.canDeactivate()||this.notify.error(new Error("Saving is in progress"));let t={folder:this.folder,matchings:this.tracks.map(n=>({track:n})),apply:()=>{this.applyMatching(t)}};this.dialogOverlay.open({childComponent:Ui,title:"Release Matching",data:t,panelClass:"overlay-panel-large"})}onContextMenu(t){this.contextMenuService.show.next({contextMenu:this.actionMenu(),event:t,item:void 0}),t.preventDefault(),t.stopPropagation()}onCellEditorNavigationKeyDown(t){ei(t.event)?this.onCellEditorNavigationKeyDownUpDown(t):ti(t.event)&&this.onCellEditorNavigationKeyDownLeftRight(t)}applyMatching(t){for(let n of t.matchings)n.rawTag&&(n.track.tagRaw=n.rawTag);this.tracks&&(this.editor.build(this.tracks),this.applyMatchingTracks(t))}applyMatchingTracks(t){for(let n of t.matchings)n.rawTag&&this.applyMatchingTrack(n)}applyMatchingTrack(t){let n=this.editor.edits.find(o=>o.track===t.track);if(n){n.changed=!0;for(let o of n.cells)o.column.def.id!==re&&(o.changed=!0)}}onCellEditorNavigationKeyDownLeftRight(t){let n=t.cell.parent.cells.at(t.cell.parent.cells.indexOf(t.cell)+(ii(t.event)?1:-1));if(n){let o=this.cellEditors().find(a=>a.cell()===n);o&&setTimeout(()=>{o.navigTo()})}}onCellEditorNavigationKeyDownUpDown(t){let n=this.editor.edits.indexOf(t.cell.parent),o=this.editor.edits.at(n+(ni(t.event)?1:-1));if(o){let a=o.cells.at(t.cell.parent.cells.indexOf(t.cell));if(a){let l=this.cellEditors().find(m=>m.cell()===a);l&&setTimeout(()=>{l.navigTo()})}}}runSave(t,n){return E(this,null,function*(){try{if(t.filename){let a=yield this.jam.track.rename({id:t.track.id,name:t.filename});this.folderService.waitForQueueResult("Renaming Track",a,[t.track.parentID],[],[t.track.id])}if(t.rawTag){let a=yield this.jam.track.rawTagSet({id:t.track.id,tag:t.rawTag});this.folderService.waitForQueueResult("Writing Track Tag",a,[t.track.parentID],[],[t.track.id])}t.edit.saving=!1,t.rawTag&&(t.edit.tag=t.rawTag),t.edit.changed=!1}catch(a){return Promise.reject(a)}let o=n.shift();o&&(yield this.runSave(o,n))})}display(t){this.folder=t,this.tracks=t.tracks??[],this.editor.build(this.tracks),this.canLoadRecursive=this.tracks.length===0&&(t.folders??[]).length>0,this.canLoadRecursive&&t.type===Zt.multialbum&&this.loadRecursive()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-admin-tag-editor"]],viewQuery:function(n,o){n&1&&(ie(o.cellEditors,Te,5),ie(o.actionMenu,jo,5)),n&2&&oe(2)},hostBindings:function(n,o){n&1&&h("beforeunload",function(){return o.canDeactivate()},bt)},inputs:{id:[1,"id"]},features:[j],decls:10,vars:1,consts:()=>{let t;t=$localize`:␟d00dbae4a3e4f5fb5287c3ef6fde8035dc5a79f5␟9064106308242024618:Set Audiobook Frames`;let n;n=$localize`:␟116ee2407dea6f965ec08ff5bb957760df6e2a85␟6656311361426574635:Set Audio Series Frames`;let o;o=$localize`:␟2e873296abc631156e0a97d7e843751195b38829␟63335187416623423:Set Soundtrack Frames`;let a;a=$localize`:␟257a97bb09d914993dd99f36ffd6e9a6a93f8a17␟5117338775318483791:Set Bootleg Frames`;let l;l=$localize`:␟eeb69f5267a060943ed0dc902afd909d53a412f8␟6494641063048624386:Set Various Artists Compilation Frames`;let m;m=$localize`:␟16a5908d3ecf5faa7a16cf0303c1ae1fb559a6cc␟6928752720245775068:Search & Fill Missing Lyrics Frames`;let P;P=$localize`:␟c41714c6798a576f0adf11857f08f0db361d15d7␟3968113785629853013:Load all Tracks`;let R;R=$localize`:␟60b5e271ee1483cf2fc9c49d0b861258f490661d␟930157484605471697:This folder does not contain any tracks with tags.`;let N;N=$localize`:␟2ea320c88da8bc29388471e4b48d5c1f0c8d620e␟7184376553461822627:Do you want to load all tracks from subfolders?`;let Z;Z=$localize`:␟dca3a8d76fb406f412af59611c7bf2dd739df4b5␟6250552114791622521:Load recursive`;let U;U=$localize`:␟c8d1785038d461ec66b5799db21864182b35900a␟1102717806459547726:Refresh`;let de;de=$localize`:␟3f74c61be995a66526e146600cd47c901b71604f␟6520843897216456434:Match with MusicBrainz`;let _e;_e=$localize`:␟9695ccaa90cd56b8b6822739823bd35e4ef835b7␟1194863084167414951:Choose Columns`;let ue;ue=$localize`:␟52c9a103b812f258bcddc3d90a6e3f46871d25fe␟3768927257183755959:Save`;let ae;ae=$localize`:␟52c9a103b812f258bcddc3d90a6e3f46871d25fe␟3768927257183755959:Save`;let me;return me=$localize`:␟ac0f81713a84217c9bd1d9bb460245d8190b073f␟5937251202465808296:More`,[["actionMenu",""],t,n,o,a,l,m,R,N,Z,["contextMenuItem","",3,"execute"],[1,"icon-edit"],[1,"load-recursive"],[1,"actions"],[3,"requestClose","editor","activeCol"],[1,"editor"],["title",P,1,"button-on-control",3,"click"],[1,"icon-reload"],["title",U,1,"button-on-control",3,"click"],["title",de,1,"button-on-control",3,"click"],[3,"size"],["title",_e,1,"button-on-control",3,"click"],[1,"icon-list-add"],["title",ue,1,"button-on-control"],["title",ae,1,"button-on-control"],["title",me,1,"button-on-control",3,"click"],[1,"icon-spin","icon-spnner"],["title",ae,1,"button-on-control",3,"click"],[1,"icon-floppy"],[1,"header-row"],[1,"header-row-title"],[3,"min-width"],[1,"header-row-title",3,"click"],[3,"title"],[1,"col-state"],[1,"cell-editor"],[1,"icon-spin","icon-spinner"],[1,"icon-floppy",3,"click"],[1,"cell-editor",3,"navigKeyDownRequest","cell"]]},template:function(n,o){if(n&1){let a=A();d(0,"context-menu",null,0),ee(2,Yo,3,0,"ng-template",10),h("execute",function(){return p(a),g(o.editor.setAudiobookFrames(o.tracks))}),ee(3,Qo,3,0,"ng-template",10),h("execute",function(){return p(a),g(o.editor.setAudioSeriesFrames(o.tracks))}),ee(4,qo,3,0,"ng-template",10),h("execute",function(){return p(a),g(o.editor.setSoundtrackFrames(o.tracks))}),ee(5,Zo,3,0,"ng-template",10),h("execute",function(){return p(a),g(o.editor.setBootlegFrames(o.tracks))}),ee(6,er,3,0,"ng-template",10),h("execute",function(){return p(a),g(o.editor.setVariousArtistFrames(o.tracks))}),ee(7,tr,3,0,"ng-template",10),h("execute",function(){return p(a),g(o.editor.findMissingLyrics(o.tracks))}),c(),T(8,gr,5,6)(9,Cr,1,0,"app-loading")}n&2&&(_(8),f(o.folder?8:9))},dependencies:[je,We,Ue,Yi,Qi,si,ci],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow:hidden;display:flex;flex-direction:column}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .load-recursive[_ngcontent-%COMP%]{text-align:center;margin-top:30px;margin-left:30px;margin-right:30px}[_nghost-%COMP%]   .load-recursive[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   .editor[_ngcontent-%COMP%]{width:100%;height:100%;display:block;position:relative;overflow:auto}[_nghost-%COMP%]   .editor[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{table-layout:fixed;border-width:0;width:auto}[_nghost-%COMP%]   .editor[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .cell-editor[_ngcontent-%COMP%]{width:100%;height:34px;border-top-width:1px;border-top-style:solid;border-left-width:1px;border-left-style:solid;text-align:left;padding-bottom:1px;padding-top:1px;font-size:11px;color:var(--on-background);border-color:var(--background-border);overflow:hidden;display:flex;align-items:center}[_nghost-%COMP%]   .editor[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .cell-editor.changed[_ngcontent-%COMP%]{padding-bottom:0;padding-top:0;border-width:1px;border-style:solid;border-left-width:2px;border-top-width:2px;border-color:var(--background-box)}[_nghost-%COMP%]   .editor[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .cell-editor[_ngcontent-%COMP%]:focus-within{padding-bottom:0;padding-top:0;border-width:1px;border-style:solid;border-left-width:2px;border-top-width:2px;color:var(--on-background-highlight)}[_nghost-%COMP%]   .editor[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-right-width:1px;border-right-style:solid;border-right-color:var(--background-border)}[_nghost-%COMP%]   .editor[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr.header-row[_ngcontent-%COMP%]{border-top-width:1px;border-top-style:solid;border-top-color:var(--background-border)}[_nghost-%COMP%]   .editor[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr.header-row[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;font-size:.8em;padding-left:4px;padding-right:4px;border-top:none;border-bottom:none;color:var(--on-background-highlight);background-color:var(--background);position:sticky}[_nghost-%COMP%]   .editor[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr.header-row[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:0;visibility:hidden}[_nghost-%COMP%]   .editor[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr.header-row[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:hover   .actions[_ngcontent-%COMP%]{visibility:inherit}[_nghost-%COMP%]   .editor[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th.header-row-title[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}[_nghost-%COMP%]   .editor[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:none;max-width:200px}[_nghost-%COMP%]   .editor[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td.col-state[_ngcontent-%COMP%]{text-align:center;width:40px}[_nghost-%COMP%]   .editor[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td.col-state[_ngcontent-%COMP%]   .cell-editor[_ngcontent-%COMP%]{padding-top:6px;font-size:18px}[_nghost-%COMP%]   .editor[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-of-type   .cell-editor[_ngcontent-%COMP%]{border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:var(--background-border)}"]});let r=e;return r})();var vl=(()=>{let e=class e{constructor(){this.child=ne(lt),this.unsubscribe=new se,this.route=H(oi)}ngOnInit(){this.route.parent?.params&&this.route.parent.paramMap.pipe(Me(this.unsubscribe)).subscribe(t=>{this.id=t.get("id")??void 0})}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}canDeactivate(){return!!this.child()?.canDeactivate()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=b({type:e,selectors:[["app-admin-folder-tag-editor"]],viewQuery:function(n,o){n&1&&ie(o.child,lt,5),n&2&&oe()},decls:1,vars:1,consts:[[3,"id"]],template:function(n,o){n&1&&M(0,"app-admin-tag-editor",0),n&2&&S("id",o.id)},dependencies:[Ae,lt],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow:hidden;display:block}"]});let r=e;return r})();export{vl as AdminFolderTagEditorPageComponent};
