import{a as r}from"./chunk-VSMEHVNZ.js";import{a as S}from"./chunk-NVLAWCOW.js";import{a as I}from"./chunk-PZTZCA44.js";import{G as _}from"./chunk-ZVKVGF76.js";import{$d as E,Aa as c,Hb as y,Ib as g,Nb as M,Ob as q,Pb as C,Qb as l,Vc as n,Wc as L,a as h,ab as m,b as u,dc as v,e as d,ia as p,nb as f,nc as k,oc as T}from"./chunk-H2EXZDP6.js";function b(a,i){a&1&&l(0,"app-loading")}var O=(()=>{let i=class i{constructor(){this.listType=n(),this.latest=n(!1),this.query=n(),this.queryCmd=n(),this.loadMore=L.required(r),this.jam=p(E),this.notify=p(_)}getEpisodes(s){let e=this.loadMore();e.loading.set(!0);let t=s().then(o=>{this.activeRequest===t&&(this.episodes=[...this.episodes??[],...o.items],e.hasMore.set((o.total??0)>this.episodes.length),e.total.set(o.total),e.loading.set(!1))}).catch(o=>{this.activeRequest===t&&this.loadMore().loading.set(!1),this.notify.error(o)});this.activeRequest=t}searchText(){this.getEpisodes(()=>d(this,null,function*(){return this.jam.episode.search({query:this.query(),skip:this.loadMore().skip(),take:this.loadMore().take(),episodeIncTag:!0,episodeIncState:!0})}))}searchCmd(){this.getEpisodes(()=>d(this,null,function*(){return this.jam.episode.search(u(h({},this.queryCmd()),{skip:this.loadMore().skip(),take:this.loadMore().take(),episodeIncTag:!0,episodeIncState:!0}))}))}list(){this.getEpisodes(()=>d(this,null,function*(){return this.jam.episode.search({list:this.listType(),episodeIncState:!0,episodeIncTag:!0,skip:this.loadMore().skip(),take:this.loadMore().take()})}))}searchLatest(){this.getEpisodes(()=>d(this,null,function*(){return this.jam.episode.search({episodeIncState:!0,episodeIncTag:!0,skip:this.loadMore().skip(),take:this.loadMore().take()})}))}load(){this.latest()?this.searchLatest():this.query()?this.searchText():this.queryCmd()?this.searchCmd():this.listType()?this.list():this.episodes=[]}ngOnChanges(){let s=this.loadMore();s.skip.set(0),s.total.set(0),s.hasMore.set(!1),this.episodes=void 0,this.load()}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=f({type:i,selectors:[["app-episodes-loader"]],viewQuery:function(e,t){e&1&&k(t.loadMore,r,5),e&2&&T()},inputs:{listType:[1,"listType"],latest:[1,"latest"],query:[1,"query"],queryCmd:[1,"queryCmd"]},features:[c],decls:3,vars:3,consts:[[3,"episodes","showPodcast"],[3,"requestLoad"]],template:function(e,t){e&1&&(y(0,b,1,0,"app-loading"),l(1,"app-episode-list",0),q(2,"app-load-more-button",1),v("requestLoad",function(){return t.load()}),C()),e&2&&(g(t.episodes?-1:0),m(),M("episodes",t.episodes)("showPodcast",!0))},dependencies:[S,r,I],encapsulation:2});let a=i;return a})();export{O as a};
