import{a as O}from"./chunk-QMOZLFND.js";import"./chunk-JNPRJ3MQ.js";import{a as q}from"./chunk-6T4XJRB7.js";import{a as Q}from"./chunk-CUCEAQEW.js";import"./chunk-24DMSAFT.js";import{b as z}from"./chunk-T2QKBMPN.js";import{a as j}from"./chunk-PZTZCA44.js";import{G as X}from"./chunk-ZVKVGF76.js";import{i as F,k as B}from"./chunk-T6GM3CFW.js";import{$d as V,Gc as L,Hb as c,Ib as s,Lb as D,Mb as k,Nb as S,Ob as l,Pb as a,Qb as m,Ub as N,Vb as x,Wd as T,Xc as G,Y as v,_b as p,ab as _,ac as A,dc as g,fc as d,ia as M,k as b,na as f,nb as I,nc as y,oa as u,oc as $,tc as R,vc as E,wc as w,wd as H}from"./chunk-H2EXZDP6.js";var U=t=>["/admin/folder",t,"tags"],J=(t,o)=>o.track.id;function K(t,o){if(t&1){let i=p();l(0,"div",7)(1,"button",8),g("click",function(){f(i);let e=d(2);return u(e.stop())}),m(2,"i",9),l(3,"span"),A(4,0),a()()()}}function W(t,o){if(t&1){let i=p();l(0,"button",8),g("click",function(){f(i);let e=d(4);return u(e.fixAll())}),A(1,3),a()}}function Y(t,o){if(t&1){let i=p();l(0,"button",8),g("click",function(){f(i);let e=d(3);return u(e.refresh(e.current.pos,!1))}),m(1,"i",12),N(2),A(3,2),x(),a(),c(4,W,2,0,"button",13)}if(t&2){let i=d(3);_(4),s(i.current.health&&i.current.health.length>0?4:-1)}}function Z(t,o){if(t&1){let i=p();l(0,"div",7)(1,"button",10),g("click",function(){f(i);let e=d(2);return u(e.start())}),m(2,"i",11),N(3),A(4,1),x(),a(),c(5,Y,5,1),a()}if(t&2){let i=d(2);_(5),s(i.current?5:-1)}}function tt(t,o){if(t&1&&c(0,K,5,0,"div",7)(1,Z,6,1,"div",7),t&2){let i=d();s(i.searching?0:1)}}function et(t,o){t&1&&m(0,"app-loading")}function nt(t,o){t&1&&m(0,"i",15)}function it(t,o){if(t&1){let i=p();l(0,"div",18)(1,"div",19),R(2),a(),l(3,"div",20)(4,"app-track-health",21),g("resolvedEvent",function(){let e=f(i).$implicit,r=d(3);return u(r.trackHealthResolved(e))}),a()()()}if(t&2){let i=o.$implicit;_(2),E(" ",i.track.name," "),_(2),S("trackHealth",i)}}function ot(t,o){if(t&1&&D(0,it,5,2,"div",18,J),t&2){let i=d(2);k(i.current.health)}}function rt(t,o){if(t&1&&(l(0,"div")(1,"div",14)(2,"span"),c(3,nt,1,0,"i",15),a(),l(4,"span"),R(5),a(),l(6,"a",16),m(7,"i",17),R(8),a()(),c(9,ot,2,0),a()),t&2){let i=d();_(3),s(i.searching?3:-1),_(2),w("",i.current.pos+1," / ",i.folders.length),_(),S("routerLink",L(6,U,i.current.folder.id)),_(2),E(" ",i.current.folder.name),_(),s(i.current.health?9:-1)}}var At=(()=>{let o=class o{constructor(){this.searching=!1,this.trackHealthComponents=G(O),this.unsubscribe=new b,this.jam=M(V),this.notify=M(X),this.uiState=M(Q),this.userStorage=M(z),this.userStorage.userChange.pipe(v(this.unsubscribe)).subscribe(()=>{this.loadFromStorage()})}trackHealthResolved(n){this.current?.health&&(this.current.health=this.current.health.filter(e=>e!==n))}stop(){this.searching=!1}start(){this.searching||!this.folders||(this.searching=!0,this.request())}request(){if(!this.searching)return;let n=0;this.current&&(n=this.current.pos+1),this.refresh(n,!0)}fixAll(){let n=this.trackHealthComponents();if(!(this.searching||!this.current))for(let e of n)e.fixAll()}refresh(n,e){this.current=void 0,this.searching=!0;let r=this.folders?.[n];if(!r){this.searching=!1;return}let h={folder:r,pos:n};this.current=h,this.userStorage.set(o.localStorageName,{folderID:r.id}),this.jam.track.health({folderIDs:[r.id],healthMedia:!0}).then(C=>{C.length>0?(h.health=C,this.searching=!1):e?this.request():(h.health=[],this.searching=!1)}).catch(C=>{this.current=void 0,this.searching=!1,this.notify.error(C)})}ngOnInit(){let n=this.uiState.get("app-admin-radar",{});this.folders=n.folders,this.current=n.current,!this.folders&&this.loadFolders()}ngOnDestroy(){this.uiState.data["app-admin-radar"]={folders:this.folders,current:this.current},this.current=void 0,this.searching=!1,this.folders=void 0,this.unsubscribe.next(),this.unsubscribe.complete()}loadFromStorage(){let n=this.userStorage.get(o.localStorageName);if(n?.folderID&&this.folders){let e=this.folders.findIndex(r=>r.id===n.folderID);e!==-1&&(this.current={folder:this.folders[e],pos:e},this.refresh(e,!1))}}loadFolders(){this.jam.folder.search({folderTypes:[T.album,T.multialbum]}).then(n=>{this.folders=n.items,this.loadFromStorage()}).catch(n=>{this.notify.error(n)})}};o.localStorageName="admin.radar",o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=I({type:o,selectors:[["app-admin-radar"]],viewQuery:function(e,r){e&1&&y(r.trackHealthComponents,O,5),e&2&&$()},decls:6,vars:3,consts:()=>{let n;n=$localize`:␟2b67115641c17c9e2d3e94fd920f48fefdfdc25b␟1962047135999875061:Health Radar`;let e;e=$localize`:␟1d0d5c9a36e72bd9643ff1ede69736ae063d652b␟3133539296286953705:Stop`;let r;r=$localize`:␟f732c304c7433e5a83ffcd862c3dce709a0f4982␟3885497195825665706:Next`;let h;h=$localize`:␟c8d1785038d461ec66b5799db21864182b35900a␟1102717806459547726:Refresh`;let C;return C=$localize`:␟71697936bf93aa7b37f938e213eaf990aaa0715c␟6587306545685043964:Fix all fixable`,[e,r,h,C,[1,"radar"],["section",n],[1,"content"],[1,"buttons"],[1,"button-on-control",3,"click"],[1,"icon-stop"],[1,"button-primary",3,"click"],[1,"icon-play"],[1,"icon-reload"],[1,"button-on-control"],[1,"current"],[1,"icon-spin","icon-spinner"],[3,"routerLink"],[1,"icon-folder"],[1,"track"],[1,"meta"],[1,"track-health"],[3,"resolvedEvent","trackHealth"]]},template:function(e,r){e&1&&(l(0,"div",4)(1,"app-view-header-slim",5),c(2,tt,2,1),a(),l(3,"div",6),c(4,et,1,0,"app-loading"),c(5,rt,10,8,"div"),a()()),e&2&&(_(2),s(r.folders?2:-1),_(2),s(r.folders?-1:4),_(),s(r.folders&&r.current?5:-1))},dependencies:[H,B,F,O,j,q],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{min-width:130px;display:inline-block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]{padding-top:15px;padding-bottom:15px;border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-right:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]{border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{padding-top:15px;padding-bottom:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{padding-left:15px}@media (max-width: 768px){[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{padding-left:0}}"]});let t=o;return t})();export{At as AdminRadarComponent};
