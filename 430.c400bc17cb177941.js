"use strict";(self.webpackChunkjamberry=self.webpackChunkjamberry||[]).push([[430],{2430:(Xt,X,v)=>{v.r(X),v.d(X,{AdminModule:()=>vt});var a=v(1180),h=v(7612),O=v(6895),x=v(433),tt=v(1481),j=v(3926),et=v(2486),Ot=v(2170),st=v(1208),t=v(4650);class R{}(0,a.Z)(R,"\u0275fac",function(n){return new(n||R)}),(0,a.Z)(R,"\u0275cmp",t.Xpm({type:R,selectors:[["app-admin"]],decls:6,vars:0,consts:[[1,"left"],["role","main",1,"middle"]],template:function(n,e){1&n&&(t.TgZ(0,"aside",0),t._UZ(1,"app-admin-sidebar"),t.qZA(),t._UZ(2,"app-splitter"),t.TgZ(3,"main",1),t._UZ(4,"router-outlet"),t.qZA(),t._UZ(5,"app-admin-queue-requests"))},styles:["[_nghost-%COMP%]{width:100%;height:100%;flex:1;display:flex;flex-flow:row nowrap;overflow:hidden;align-items:flex-start;align-content:flex-start}[_nghost-%COMP%]   .left[_ngcontent-%COMP%]{width:15%;height:100%;min-width:140px}[_nghost-%COMP%]   .middle[_ngcontent-%COMP%]{width:85%;flex-grow:1;height:100%}@media (max-width: 1400px){[_nghost-%COMP%]   .left[_ngcontent-%COMP%]{width:20%}[_nghost-%COMP%]   .middle[_ngcontent-%COMP%]{width:80%}}@media (max-width: 768px){[_nghost-%COMP%]{min-height:100%;position:absolute;display:block;flex:none;flex-flow:inherit}[_nghost-%COMP%]   app-splitter[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .left[_ngcontent-%COMP%]{width:100%!important;height:auto}[_nghost-%COMP%]   .middle[_ngcontent-%COMP%]{width:100%;min-height:100%}}"]}));var S=v(5861),A=v(1491),N=v(7579),F=v(2722);const ht=["overview","tags","health","tracks","tracks-health"];var m=v(9291),_=v(3689),b=v(6491),w=v(2205),Z=v(7544),T=v(8986);function U(o,n){1&o&&t._UZ(0,"i",14)}function K(o,n){if(1&o&&(t.TgZ(0,"i"),t.ALo(1,"stringToggle"),t.qZA()),2&o){const e=t.oxw().$implicit;t.Tol(t.Dn7(1,2,e.expanded,"icon-minus","icon-plus"))}}function G(o,n){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",7),t.NdJ("click",function(){const l=t.CHM(e).$implicit,u=t.oxw();return t.KtG(u.selectNode(l))})("keydown.enter",function(){const l=t.CHM(e).$implicit,u=t.oxw();return t.KtG(u.selectNode(l))})("keydown.arrowRight",function(){const l=t.CHM(e).$implicit,u=t.oxw();return t.KtG(u.toggleNode(l))})("keydown.arrowLeft",function(){const l=t.CHM(e).$implicit,u=t.oxw();return t.KtG(u.toggleNode(l))}),t.TgZ(2,"span",8),t.NdJ("clickenter",function(){const l=t.CHM(e).$implicit,u=t.oxw();return t.KtG(u.toggleNode(l))}),t.YNc(3,U,1,0,"i",9),t.YNc(4,K,2,6,"i",10),t.qZA(),t.TgZ(5,"span",11),t.NdJ("clickenter",function(){const l=t.CHM(e).$implicit,u=t.oxw();return t.KtG(u.toggleNode(l))}),t.TgZ(6,"i"),t.ALo(7,"stringToggle"),t.qZA()(),t.TgZ(8,"span",12),t._uU(9),t.qZA(),t.TgZ(10,"span",13),t._uU(11),t.qZA()(),t.BQk()}if(2&o){const e=n.$implicit,i=t.oxw();t.xp6(1),t.Udp("padding-left",12*e.level,"px"),t.ekj("active",e===i.selected),t.xp6(1),t.MGl("title","Subfolders: ",e.folder.folderCount,""),t.xp6(1),t.Q6J("ngIf",e.isLoading),t.xp6(1),t.Q6J("ngIf",!e.isLoading&&e.hasChildren),t.xp6(1),t.Udp("color",e.color),t.Q6J("title",e.folder.type),t.xp6(1),t.Tol(t.Dn7(7,15,e.expanded,"icon-folder-open","icon-folder")),t.xp6(2),t.Q6J("title",e.folder.name),t.xp6(1),t.Oqu(e.folder.name),t.xp6(2),t.hij("| ",e.folder.type,"")}}function L(o,n){if(o.children)for(const e of o.children)n(e),L(e,n)}class H{constructor(n,e,i,r){(0,a.Z)(this,"app",void 0),(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"folderService",void 0),(0,a.Z)(this,"selected",void 0),(0,a.Z)(this,"nodes",[]),(0,a.Z)(this,"expandIDs",[]),(0,a.Z)(this,"autoSelect",!1),(0,a.Z)(this,"selectionChange",new t.vpe),(0,a.Z)(this,"viewport",void 0),(0,a.Z)(this,"unsubscribe",new N.x),this.app=n,this.jam=e,this.notify=i,this.folderService=r}ngOnInit(){this.folderService.foldersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(n=>{const e=this.nodes.find(i=>i.folder.id===n.id);e&&this.jam.folder.id({id:n.id,folderIncTrackCount:!0,folderIncChildFolderCount:!0}).then(i=>{e.folder=i,n.mode===m.dw.fsnRefreshChilds&&e.expanded&&(this.collapseNode(e),e.hasChildren=(i.folderCount||0)>0,e.children=void 0,e.isLoading=!1,e.hasChildren&&(e.expanded=!0,this.checkLoadExpanded(e)))}).catch(i=>{console.error(i)})})}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}selectNode(n){this.selectionChange.emit(n.folder),this.autoSelect&&(this.selected=n)}toggleNode(n){n.expanded?this.collapseNode(n):this.expandNode(n)}refresh(){this.jam.auth.isLoggedIn()&&this.jam.folder.search({level:0,folderIncChildFolderCount:!0,folderIncTrackCount:!0}).then(n=>{this.nodes=n.items.map(e=>({folder:e,hasChildren:(e.folderCount||0)>0,level:0,color:this.typeToColor(e),expanded:this.expandIDs.includes(e.id),isLoading:!1}));for(const e of this.nodes)this.checkLoadExpanded(e)}).catch(n=>{this.notify.error(n)})}typeToColor(n){switch(n.type){case _.Sr.unknown:return"#ff9fAA";case _.Sr.artist:return"#6f806e";case _.Sr.collection:return"#adbced";case _.Sr.album:return"#bdbd9c";case _.Sr.multialbum:return"#bdaaae";case _.Sr.extras:return"#bdbdbd";default:return""}}onFolderUpdate(n){const e=this.nodes.find(i=>i.folder.id===n.id);e&&(e.folder=n)}selectFolderByID(n){const e=this.nodes.find(i=>i.folder.id===n);e?this.selected=e:this.jam.folder.id({id:n,folderIncParents:!0}).then(i=>{if(i.parents){for(const r of i.parents)this.expandIDs.includes(r.id)||this.expandIDs.push(r.id);for(const r of this.nodes)r.expanded=this.expandIDs.includes(r.folder.id),this.checkLoadExpanded(r,n)}}).catch(i=>{this.notify.error(i)})}checkLoadExpanded(n,e){n.expanded&&!n.isLoading&&this.loadChildren(n,i=>{for(const r of i)this.checkLoadExpanded(r,e)}),n.folder.id===e&&(this.selected=n,this.viewport&&this.viewport.scrollToIndex(this.nodes.indexOf(n)))}loadChildren(n,e){n.isLoading||(n.isLoading=!0,this.jam.folder.search({parentIDs:[n.folder.id],folderIncChildFolderCount:!0,folderIncTrackCount:!0}).then(i=>{const r=i.items.sort((u,J)=>u.name.localeCompare(J.name)).map(u=>({folder:u,hasChildren:(u.folderCount||0)>0,level:n.level+1,color:this.typeToColor(u),expanded:this.expandIDs.includes(u.id),isLoading:!1})),l=this.nodes.indexOf(n);l>=0&&(this.nodes=this.nodes.slice(0,l+1).concat(r).concat(this.nodes.slice(l+1))),n.children=r,n.isLoading=!1,e&&e(r)}).catch(i=>{this.notify.error(i)}))}collapseNode(n){if(n.expanded){const e=[];L(n,i=>e.push(i.folder.id)),this.nodes=this.nodes.filter(i=>!e.includes(i.folder.id)),n.expanded=!1,n.children=void 0,this.expandIDs=(this.expandIDs||[]).filter(i=>i!==n.folder.id)}}expandNode(n){if(!n.expanded){if(n.children){const e=this.nodes.indexOf(n);this.nodes=this.nodes.slice(0,e+1).concat(n.children).concat(this.nodes.slice(e+1))}else this.loadChildren(n);this.expandIDs.push(n.folder.id),n.expanded=!0}}}(0,a.Z)(H,"\u0275fac",function(n){return new(n||H)(t.Y36(m.zi),t.Y36(_.K4),t.Y36(m.c),t.Y36(m.Cr))}),(0,a.Z)(H,"\u0275cmp",t.Xpm({type:H,selectors:[["app-admin-folder-tree"]],viewQuery:function(n,e){if(1&n&&t.Gf(h.N7,7),2&n){let i;t.iGM(i=t.CRH())&&(e.viewport=i.first)}},inputs:{autoSelect:"autoSelect"},outputs:{selectionChange:"selectionChange"},decls:8,vars:2,consts:[[1,"actions"],[1,"name"],["title","Refresh Folder Tree",1,"button-on-control",3,"click"],["aria-hidden","true",1,"icon-reload"],["appFocusKeyList","",1,"tree"],[1,"list-container","list-group",2,"height","100%",3,"itemSize"],[4,"cdkVirtualFor","cdkVirtualForOf"],["appFocusKeyListItem","",1,"node",3,"click","keydown.enter","keydown.arrowRight","keydown.arrowLeft"],[1,"node-toggle",3,"title","clickenter"],["class","icon-spin icon-spinner",4,"ngIf"],[3,"class",4,"ngIf"],[1,"node-icon",3,"title","clickenter"],[3,"title"],[1,"node-type"],[1,"icon-spin","icon-spinner"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"span",1),t._uU(2,"Folders"),t.qZA(),t.TgZ(3,"button",2),t.NdJ("click",function(){return e.refresh()}),t._UZ(4,"i",3),t.qZA()(),t.TgZ(5,"div",4)(6,"cdk-virtual-scroll-viewport",5),t.YNc(7,G,12,19,"ng-container",6),t.qZA()()),2&n&&(t.xp6(6),t.Q6J("itemSize",22),t.xp6(1),t.Q6J("cdkVirtualForOf",e.nodes))},dependencies:[O.O5,b.X,w.j,Z.R,h.xd,h.x0,h.N7,T.C],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{padding:15px 15px 10px;background-color:var(--background-transparent);color:var(--on-control)}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{padding-right:10px;vertical-align:middle;color:var(--on-control-active);font-size:20px;font-weight:100}[_nghost-%COMP%]   .tree[_ngcontent-%COMP%]{margin-top:10px;flex:1}[_nghost-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{width:100%;height:100%;min-height:100%;overflow-x:hidden}[_nghost-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]     .cdk-virtual-scroll-content-wrapper{width:100%}[_nghost-%COMP%]   .node[_ngcontent-%COMP%]{width:100%;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-decoration:none;vertical-align:middle;height:22px;cursor:pointer;-webkit-user-select:none;user-select:none;font-size:.9em}[_nghost-%COMP%]   .node[_ngcontent-%COMP%]   .node-toggle[_ngcontent-%COMP%]{display:inline-block;min-width:20px}[_nghost-%COMP%]   .node[_ngcontent-%COMP%]   .node-type[_ngcontent-%COMP%]{padding-left:5px;font-size:.7em;text-transform:uppercase}[_nghost-%COMP%]   .node.active[_ngcontent-%COMP%]{color:var(--on-control-hover)}"]}));var C=v(150);function M(o,n){1&o&&(t.TgZ(0,"a"),t._UZ(1,"i",8),t._uU(2," Show Folder Tools"),t.qZA())}function s(o,n){1&o&&(t.TgZ(0,"a"),t._UZ(1,"i",9),t._uU(2," Show Folder Tree"),t.qZA())}const c=function(o){return["/admin/folder",o,"overview"]},d=function(o){return["/admin/folder",o,"tracks"]},g=function(o){return["/admin/folder",o,"sub-folders"]},p=function(o){return["/admin/folder",o,"tags"]},f=function(o){return["/admin/folder",o,"health"]},y=function(o){return["/admin/folder",o,"tracks-health"]};function I(o,n){if(1&o&&(t.TgZ(0,"nav",10)(1,"ul",11)(2,"li",12)(3,"a"),t._uU(4,"Overview"),t.qZA()(),t.TgZ(5,"li",12)(6,"a"),t._uU(7,"Tracks"),t.qZA()(),t.TgZ(8,"li",12)(9,"a"),t._uU(10,"Folders"),t.qZA()(),t.TgZ(11,"li",12)(12,"a"),t._uU(13,"Tags"),t.qZA()(),t.TgZ(14,"li",12)(15,"a"),t._uU(16,"Health"),t.qZA()(),t.TgZ(17,"li",12)(18,"a"),t._uU(19,"Track Health"),t.qZA()()()()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("routerLink",t.VKq(6,c,e.id)),t.xp6(3),t.Q6J("routerLink",t.VKq(8,d,e.id)),t.xp6(3),t.Q6J("routerLink",t.VKq(10,g,e.id)),t.xp6(3),t.Q6J("routerLink",t.VKq(12,p,e.id)),t.xp6(3),t.Q6J("routerLink",t.VKq(14,f,e.id)),t.xp6(3),t.Q6J("routerLink",t.VKq(16,y,e.id))}}class k{constructor(n,e,i){(0,a.Z)(this,"route",void 0),(0,a.Z)(this,"router",void 0),(0,a.Z)(this,"uiState",void 0),(0,a.Z)(this,"id",""),(0,a.Z)(this,"tree",void 0),(0,a.Z)(this,"rightActive",!1),(0,a.Z)(this,"unsubscribe",new N.x),(0,a.Z)(this,"mode","overview"),this.route=n,this.router=e,this.uiState=i}refresh(){this.tree&&this.tree.refresh()}selectionChange(n){this.router.navigate([`/admin/folder/${n.id}/${this.mode}`]).catch(e=>{console.error(e)})}onFolderUpdate(n){this.tree&&this.tree.onFolderUpdate(n)}ngOnInit(){this.router.events.pipe((0,F.R)(this.unsubscribe)).subscribe(n=>{if(n instanceof A.m2&&this.route.firstChild&&this.route.firstChild.snapshot.url[0]){const e=this.route.firstChild.snapshot.url[0].path;ht.includes(e)&&(this.mode=e)}}),this.route&&this.route.params.pipe((0,F.R)(this.unsubscribe)).subscribe(n=>{const e=n.id;this.id=e,this.tree&&e&&setTimeout(()=>{this.tree&&this.tree.selectFolderByID(e)})}),this.tree&&(this.tree.expandIDs=this.uiState.data["app-admin-folders"]||[]),this.refresh()}ngOnDestroy(){this.tree&&(this.uiState.data["app-admin-folders"]=this.tree.expandIDs),this.unsubscribe.next(),this.unsubscribe.complete()}}(0,a.Z)(k,"\u0275fac",function(n){return new(n||k)(t.Y36(A.gz),t.Y36(A.F0),t.Y36(m.JU))}),(0,a.Z)(k,"\u0275cmp",t.Xpm({type:k,selectors:[["app-admin-folder"]],viewQuery:function(n,e){if(1&n&&t.Gf(H,7),2&n){let i;t.iGM(i=t.CRH())&&(e.tree=i.first)}},hostVars:2,hostBindings:function(n,e){2&n&&t.ekj("right-active",e.rightActive)},decls:11,vars:3,consts:[[1,"toggle",3,"click"],[4,"ngIf"],[1,"content"],[1,"left-content"],[3,"selectionChange"],[1,"right-content"],["class","navigation",4,"ngIf"],[1,"router-content"],[1,"icon-right"],[1,"icon-left"],[1,"navigation"],[1,"tabs"],["routerLinkActive","active",3,"routerLink"]],template:function(n,e){1&n&&(t.TgZ(0,"button",0),t.NdJ("click",function(){return e.rightActive=!e.rightActive}),t.YNc(1,M,3,0,"a",1),t.YNc(2,s,3,0,"a",1),t.qZA(),t.TgZ(3,"div",2)(4,"div",3)(5,"app-admin-folder-tree",4),t.NdJ("selectionChange",function(r){return e.selectionChange(r)}),t.qZA()(),t._UZ(6,"app-splitter"),t.TgZ(7,"div",5),t.YNc(8,I,20,18,"nav",6),t.TgZ(9,"div",7),t._UZ(10,"router-outlet"),t.qZA()()()),2&n&&(t.xp6(1),t.Q6J("ngIf",!e.rightActive),t.xp6(1),t.Q6J("ngIf",e.rightActive),t.xp6(6),t.Q6J("ngIf",e.id))},dependencies:[O.O5,C.H,A.lC,A.rH,A.Od,H],styles:["[_nghost-%COMP%]{overflow-y:auto;overflow-x:hidden;height:100%;width:100%;min-height:100%;flex:1 1 auto;position:relative;display:flex;flex-direction:column;overflow:hidden}[_nghost-%COMP%]   .toggle[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]{width:100%;z-index:1;display:flex;flex-flow:row wrap;justify-content:space-between;align-items:center;background-color:var(--background-transparent);color:var(--on-control)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%]{padding-left:0;margin-top:0;margin-bottom:0;list-style:none;border:none;display:flex;flex-flow:row wrap;width:100%}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{position:relative;display:block;margin-bottom:-1px;flex:1;align-self:stretch;border-top-width:4px;border-top-style:solid;border-top-color:transparent;border-bottom-width:4px;border-bottom-style:solid;border-bottom-color:transparent;padding:0}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]:hover{background-color:var(--control-hover);transition:all .4s ease;border-bottom-width:4px;border-bottom-style:solid;border-bottom-color:transparent}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{padding:10px 0;text-align:center;align-items:center;align-content:center;justify-content:center;margin-right:2px;line-height:1.42857143;border-radius:4px 4px 0 0;position:relative;display:flex;cursor:pointer;border:none;font-size:14px;text-transform:uppercase;letter-spacing:.5px;height:100%;color:var(--on-control);-webkit-user-select:none;user-select:none}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:focus, [_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:hover{background-color:unset;border:none;color:var(--on-control-hover)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]{cursor:default;border-bottom-color:var(--primary)!important}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{cursor:default;background-color:unset;color:var(--on-control-hover)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]:focus, [_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]:hover{border-bottom-color:var(--primary)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.disabled[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{color:var(--on-control-ambient-disabled)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.disabled[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:focus, [_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.disabled[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:hover{color:var(--on-control-ambient-disabled);text-decoration:none;cursor:not-allowed;background-color:transparent}@media (max-width: 768px){[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%]{align-items:center;align-content:center;justify-content:center}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{padding:5px;min-width:33%}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{font-size:.8em}}@media (max-width: 400px){[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{padding:0 5px}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{font-size:.7em}}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs.mini[_ngcontent-%COMP%]{padding-left:15px;padding-right:15px}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs.mini[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{flex:0}@media (max-width: 768px){[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs.mini[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{min-width:20px}}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;height:100%;flex:1;display:flex;flex-flow:row nowrap;overflow:hidden;align-items:flex-start;align-content:flex-start;padding:0;min-height:100%}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .left-content[_ngcontent-%COMP%]{height:100%;width:20%;display:block;border-right:1px solid var(--background-border);min-width:240px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]{width:80%;flex-shrink:1;flex-grow:1;height:100%;display:flex;flex-flow:column nowrap;position:relative;overflow:hidden}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]   .router-content[_ngcontent-%COMP%]{width:100%;height:100%;display:block;overflow:hidden}@media (max-width: 522px){[_nghost-%COMP%]{height:100%;width:100%;min-height:100%;overflow:hidden}[_nghost-%COMP%]   .toggle[_ngcontent-%COMP%]{display:block;position:relative;width:100%;height:33px;text-align:center;padding-top:5px;border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;height:calc(100% - 33px);min-height:calc(100% - 33px);overflow:hidden;display:block;flex:none;position:relative}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-splitter[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .left-content[_ngcontent-%COMP%]{display:flex;height:100%;width:100%}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]{display:none;height:100%;width:100%}.right-active[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .left-content[_ngcontent-%COMP%]{display:none}.right-active[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]{display:flex}}"]}));class P{constructor(n){(0,a.Z)(this,"route",void 0),(0,a.Z)(this,"id",void 0),(0,a.Z)(this,"unsubscribe",new N.x),this.route=n}ngOnInit(){this.route&&this.route.parent&&this.route.parent.params.pipe((0,F.R)(this.unsubscribe)).subscribe(n=>{this.resolve(n),this.refresh()})}idChanged(){}refresh(){}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}resolve(n){this.id=n.id,this.idChanged()}}(0,a.Z)(P,"\u0275fac",function(n){return new(n||P)(t.Y36(A.gz))}),(0,a.Z)(P,"\u0275cmp",t.Xpm({type:P,selectors:[["app-admin-base-parent-view-id"]],decls:0,vars:0,template:function(n,e){}}));class z{constructor(){(0,a.Z)(this,"data",void 0),(0,a.Z)(this,"tree",void 0)}selectionChange(n){this.data&&(this.data.folder=n)}dialogInit(n,e){this.data=e.data,this.tree&&(this.tree.refresh(),this.data?.selectID&&this.tree.selectFolderByID(this.data.selectID))}}(0,a.Z)(z,"\u0275fac",function(n){return new(n||z)}),(0,a.Z)(z,"\u0275cmp",t.Xpm({type:z,selectors:[["app-dialog-choose-folder"]],viewQuery:function(n,e){if(1&n&&t.Gf(H,7),2&n){let i;t.iGM(i=t.CRH())&&(e.tree=i.first)}},decls:1,vars:1,consts:[[3,"autoSelect","selectionChange"]],template:function(n,e){1&n&&(t.TgZ(0,"app-admin-folder-tree",0),t.NdJ("selectionChange",function(r){return e.selectionChange(r)}),t.qZA()),2&n&&t.Q6J("autoSelect",!0)},dependencies:[H],styles:["[_nghost-%COMP%]{flex:1}"]}));const nt=function(){return{standalone:!0}};function B(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div")(1,"form")(2,"div",1)(3,"label",2),t._uU(4,"Name"),t.qZA(),t.TgZ(5,"input",3),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.edit.name=r)}),t.qZA()()()()}if(2&o){const e=t.oxw();t.xp6(5),t.Q6J("ngModel",e.edit.name)("ngModelOptions",t.DdM(2,nt))}}class Q{constructor(){(0,a.Z)(this,"edit",void 0)}dialogInit(n,e){this.edit=e.data}}(0,a.Z)(Q,"\u0275fac",function(n){return new(n||Q)}),(0,a.Z)(Q,"\u0275cmp",t.Xpm({type:Q,selectors:[["app-dialog-folder"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"user-form-control"],["for","dialog-folder-edit"],["id","dialog-folder-edit","type","text","name","folder-name",3,"ngModel","ngModelOptions","ngModelChange"]],template:function(n,e){1&n&&t.YNc(0,B,6,3,"div",0),2&n&&t.Q6J("ngIf",e.edit)},dependencies:[O.O5,x._Y,x.Fj,x.JJ,x.JL,x.On,x.F],styles:["[_nghost-%COMP%] > div[_ngcontent-%COMP%]{margin-left:20px;margin-right:20px}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{font-size:1.3em;line-height:1.3em}[_nghost-%COMP%]   .user-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block}"]}));var q=v(2747),Y=v(7841),D=v(2569),E=v(7480);function Lt(o,n){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij(" / ",null==e.folder.tag?null:e.folder.tag.albumType,"")}}const Bt=function(o){return["/admin/folder",o,"overview"]};function jt(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"tr",10),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.KtG(l.selected=!l.selected)}),t.TgZ(1,"td",4)(2,"a",11),t._uU(3),t.qZA()(),t.TgZ(4,"td",5),t._uU(5),t.qZA(),t.TgZ(6,"td",6),t._uU(7),t.qZA(),t.TgZ(8,"td",7),t._uU(9),t.qZA(),t.TgZ(10,"td",8),t._uU(11),t.YNc(12,Lt,2,1,"ng-container",12),t.qZA()()}if(2&o){const e=n.$implicit;t.ekj("selected",e.selected),t.xp6(2),t.Q6J("routerLink",t.VKq(9,Bt,e.folder.id)),t.xp6(1),t.Oqu(e.folder.name),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.artist),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.album),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.year),t.xp6(2),t.hij(" ",e.folder.type," "),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.albumType)}}function Kt(o,n){if(1&o&&(t.TgZ(0,"table",2)(1,"tr",3)(2,"td",4),t._uU(3,"Title"),t.qZA(),t.TgZ(4,"td",5),t._uU(5,"Artist"),t.qZA(),t.TgZ(6,"td",6),t._uU(7,"Album"),t.qZA(),t.TgZ(8,"td",7),t._uU(9,"Year"),t.qZA(),t.TgZ(10,"td",8),t._uU(11,"Type"),t.qZA()(),t.YNc(12,jt,13,11,"tr",9),t.qZA()),2&o){const e=t.oxw();t.xp6(12),t.Q6J("ngForOf",e.folderItems)}}class Gt{constructor(n){(0,a.Z)(this,"folder",void 0),(0,a.Z)(this,"selected",void 0),this.folder=n}}class ct{constructor(){(0,a.Z)(this,"folders",[]),(0,a.Z)(this,"folderItems",[])}getSortValue(n,e){switch(n){case"name":return e.name;case"artist":return e.tag?.artist;case"album":return e.tag?.album;case"type":return e.type;default:return}}ngOnChanges(){this.folderItems=(this.folders||[]).map(n=>new Gt(n))}}function te(o,n){1&o&&t._UZ(0,"app-loading")}function bt(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.moveSubfolders())}),t._UZ(1,"i",12),t.qZA()}}function yt(o,n){if(1&o&&t._UZ(0,"app-admin-folder-list",13),2&o){const e=t.oxw(2);t.Q6J("folders",e.folder.folders)}}function pt(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",2)(1,"div",3)(2,"button",4),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.refresh())}),t._UZ(3,"i",5),t.qZA(),t.TgZ(4,"button",6),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.newFolder())}),t._UZ(5,"i",7),t.qZA(),t.YNc(6,bt,2,0,"button",8),t.qZA(),t._UZ(7,"app-background-text-list",9),t.YNc(8,yt,1,1,"app-admin-folder-list",10),t.qZA()}if(2&o){const e=t.oxw();t.xp6(6),t.Q6J("ngIf",null==e.folder||null==e.folder.folders?null:e.folder.folders.length),t.xp6(1),t.Q6J("list",e.folder.folders),t.xp6(1),t.Q6J("ngIf",null==e.folder.folders?null:e.folder.folders.length)}}(0,a.Z)(ct,"\u0275fac",function(n){return new(n||ct)}),(0,a.Z)(ct,"\u0275cmp",t.Xpm({type:ct,selectors:[["app-admin-folder-list"]],inputs:{folders:"folders"},features:[t.TTD],decls:2,vars:2,consts:[["name","Folders",3,"list"],["class","folders",4,"ngIf"],[1,"folders"],[1,"folder","heading"],[1,"title"],[1,"artist"],[1,"album"],[1,"year"],[1,"type"],["class","folder",3,"selected","click",4,"ngFor","ngForOf"],[1,"folder",3,"click"],[3,"routerLink"],[4,"ngIf"]],template:function(n,e){1&n&&(t._UZ(0,"app-background-text-list",0),t.YNc(1,Kt,13,1,"table",1)),2&n&&(t.Q6J("list",e.folderItems),t.xp6(1),t.Q6J("ngIf",e.folderItems&&e.folderItems.length>0))},dependencies:[O.sg,O.O5,D.$,A.rH],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]{padding:15px;font-size:.8em;width:100%}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{font-size:.9em}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]{border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .folder.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}"]}));class ot extends P{constructor(n,e,i,r,l,u){super(n),(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"folderService",void 0),(0,a.Z)(this,"dialogsService",void 0),(0,a.Z)(this,"dialogOverlay",void 0),(0,a.Z)(this,"folder",void 0),this.jam=e,this.notify=i,this.folderService=r,this.dialogsService=l,this.dialogOverlay=u}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(n=>{n.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}refresh(){this.folder=void 0,this.id&&this.jam.folder.id({id:this.id,folderIncFolders:!0,folderIncTag:!0}).then(n=>{this.folder=n}).catch(n=>{this.notify.error(n)})}newFolder(){var n=this;if(!this.folder)return;const e=this.folder,i={folder:e,name:""};var r;this.dialogOverlay.open({childComponent:Q,title:"New Folder",data:i,onOkBtn:(r=(0,S.Z)(function*(){try{n.jam.folder.create({id:e.id,name:i.name}).then(l=>{n.folderService.waitForQueueResult("Creating Folder",l,[],[e.id])}).catch(l=>{n.notify.error(l)})}catch(l){return n.notify.error(l),Promise.reject(l)}}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,S.Z)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}moveSubfolders(){var n=this;if(!this.id||!this.folder?.folders)return;const e=this.id,i=this.folder.folders.map(u=>u.id),r=[e].concat(i),l={selectID:e,disableIDs:r};var u;this.dialogOverlay.open({title:"Move Subfolders to",childComponent:z,data:l,panelClass:"overlay-panel-large-buttons",onOkBtn:(u=(0,S.Z)(function*(){try{const J=l.folder;if(!J)return;r.push(J.id),n.jam.folder.move({ids:i,newParentID:J.id}).then(V=>{n.folderService.waitForQueueResult("Moving Folders",V,[],r)}).catch(V=>{n.notify.error(V)})}catch(J){return n.notify.error(J),Promise.reject(J)}}),function(){return u.apply(this,arguments)}),onCancelBtn:function(){var u=(0,S.Z)(function*(){return Promise.resolve()});return function(){return u.apply(this,arguments)}}()})}}(0,a.Z)(ot,"\u0275fac",function(n){return new(n||ot)(t.Y36(A.gz),t.Y36(_.K4),t.Y36(m.c),t.Y36(m.Cr),t.Y36(q.Hr),t.Y36(Y.SL))}),(0,a.Z)(ot,"\u0275cmp",t.Xpm({type:ot,selectors:[["app-admin-folder-folders"]],features:[t.qOj],decls:2,vars:2,consts:[[4,"ngIf"],["class","folders",4,"ngIf"],[1,"folders"],[1,"actions"],["title","Refresh",1,"button-on-control",3,"click"],[1,"icon-reload"],["title","New Folder\u2026",1,"button-on-control",3,"click"],[1,"icon-plus"],["class","button-on-control","title","Move Subfolders\u2026",3,"click",4,"ngIf"],["name","Folders",3,"list"],[3,"folders",4,"ngIf"],["title","Move Subfolders\u2026",1,"button-on-control",3,"click"],[1,"icon-right-bold"],[3,"folders"]],template:function(n,e){1&n&&(t.YNc(0,te,1,0,"app-loading",0),t.YNc(1,pt,9,3,"div",1)),2&n&&(t.Q6J("ngIf",!e.folder),t.xp6(1),t.Q6J("ngIf",e.folder&&e.folder.folders))},dependencies:[O.O5,D.$,E.N,ct],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:block;overflow:hidden}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   app-admin-folder-list[_ngcontent-%COMP%]{overflow-y:auto}"]}));var ee=v(1687),W=v(529),_t=v(3535),Wt=v(2689);function it(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"image-cropper",6),t.NdJ("imageCropped",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.imageCropped(r))})("imageLoaded",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.imageLoaded())})("cropperReady",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.cropperReady())})("loadImageFailed",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.loadImageFailed())}),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("imageBase64",e.imageBase64)("format","jpeg")("maintainAspectRatio",e.maintainAspectRatio)}}function rt(o,n){if(1&o&&(t.TgZ(0,"div",7),t._UZ(1,"img",8),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("src",e.croppedImage,t.LSH)}}class wt{constructor(n,e,i,r){(0,a.Z)(this,"app",void 0),(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"folderService",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"data",void 0),(0,a.Z)(this,"imageBase64",""),(0,a.Z)(this,"croppedImage",void 0),(0,a.Z)(this,"croppedImageFile",void 0),(0,a.Z)(this,"mimeType","image/jpeg"),(0,a.Z)(this,"maintainAspectRatio",!0),(0,a.Z)(this,"imageEdited",new t.vpe),(0,a.Z)(this,"unsubscribe",new N.x),this.app=n,this.jam=e,this.folderService=i,this.notify=r}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}load(){this.data&&this.jam.image.imageBinary({id:this.data.artwork.id}).then(n=>{this.imageBase64=`data:${n.contentType||"image/jpeg"};base64,${(0,Wt.q)(n.buffer)}`}).catch(n=>{this.notify.error(n)})}imageCropped(n){n.base64&&(this.croppedImage=n.base64,this.croppedImageFile=(0,st.Ll)(n.base64))}imageLoaded(){}cropperReady(){}loadImageFailed(){}ngOnChanges(n){this.load()}upload(){if(!this.croppedImageFile||!this.data)return;const n=this.data.folderID,e=new File([this.croppedImageFile],this.data.artwork.name,{type:this.croppedImageFile.type});this.jam.artwork.update({id:this.data.artwork.id},e).pipe((0,F.R)(this.unsubscribe)).subscribe(i=>{i.type===W.dt.Response&&(this.folderService.waitForQueueResult("Updating Folder Artwork",i.body,[n]),this.imageEdited.emit())},i=>{this.notify.error(i)},()=>{this.notify.success("Upload done")})}}function se(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"app-admin-artwork-edit",1),t.NdJ("imageEdited",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.onImageEdited())}),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("data",e.data)}}(0,a.Z)(wt,"\u0275fac",function(n){return new(n||wt)(t.Y36(m.zi),t.Y36(_.K4),t.Y36(m.Cr),t.Y36(m.c))}),(0,a.Z)(wt,"\u0275cmp",t.Xpm({type:wt,selectors:[["app-admin-artwork-edit"]],inputs:{data:"data"},outputs:{imageEdited:"imageEdited"},features:[t.TTD],decls:9,vars:4,consts:[[1,"image-crop"],["type","checkbox",3,"ngModel","checked","ngModelChange"],[3,"imageBase64","format","maintainAspectRatio","imageCropped","imageLoaded","cropperReady","loadImageFailed",4,"ngIf"],["class","image-preview",4,"ngIf"],[1,"buttons"],[1,"button-on-control",3,"click"],[3,"imageBase64","format","maintainAspectRatio","imageCropped","imageLoaded","cropperReady","loadImageFailed"],[1,"image-preview"],["alt","Cropped Image",3,"src"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"label")(2,"input",1),t.NdJ("ngModelChange",function(r){return e.maintainAspectRatio=r}),t.qZA(),t._uU(3," Maintain Aspect Ratio "),t.qZA(),t.YNc(4,it,1,3,"image-cropper",2),t.qZA(),t.YNc(5,rt,2,1,"div",3),t.TgZ(6,"div",4)(7,"button",5),t.NdJ("click",function(){return e.upload()}),t._uU(8,"Use Cropped Artwork"),t.qZA()()),2&n&&(t.xp6(2),t.Q6J("ngModel",e.maintainAspectRatio)("checked",e.maintainAspectRatio),t.xp6(2),t.Q6J("ngIf",e.imageBase64),t.xp6(1),t.Q6J("ngIf",e.croppedImage))},dependencies:[O.O5,x.Wl,x.JJ,x.On,st.ap],styles:["[_nghost-%COMP%]{width:100%;display:block;text-align:center}[_nghost-%COMP%]   image-cropper[_ngcontent-%COMP%]{width:300px;display:block}[_nghost-%COMP%]   .image-crop[_ngcontent-%COMP%]{display:inline-block;text-align:center;margin-left:10px;margin-right:10px}[_nghost-%COMP%]   .image-preview[_ngcontent-%COMP%]{margin-left:10px;margin-right:10px;display:inline-block}[_nghost-%COMP%]   .image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:300px}"]}));class Zt{constructor(){(0,a.Z)(this,"data",void 0),(0,a.Z)(this,"reference",void 0),(0,a.Z)(this,"loading",!0)}dialogInit(n,e){this.data=e.data,this.reference=n}onImageEdited(){this.reference&&this.reference.close()}}(0,a.Z)(Zt,"\u0275fac",function(n){return new(n||Zt)}),(0,a.Z)(Zt,"\u0275cmp",t.Xpm({type:Zt,selectors:[["app-image-edit-overlay-content"]],decls:1,vars:1,consts:[[3,"data","imageEdited",4,"ngIf"],[3,"data","imageEdited"]],template:function(n,e){1&n&&t.YNc(0,se,1,1,"app-admin-artwork-edit",0),2&n&&t.Q6J("ngIf",e.data)},dependencies:[O.O5,wt]}));const ce=["inlineEditControl"];function le(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",2)(1,"input",3,4),t.NdJ("blur",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.onBlur(r))})("keydown.enter",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.apply())})("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.value=r)}),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("required",e.required)("name",e.value)("ngModel",e.value)("type",e.type)("placeholder",e.placeholder)}}function de(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div")(1,"div",5),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.edit(r.value))})("focus",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.edit(r.value))}),t._uU(2),t._UZ(3,"i",6),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(2),t.hij("",e.value,"\xa0")}}class lt{constructor(){(0,a.Z)(this,"inlineEditControl",void 0),(0,a.Z)(this,"placeholder",""),(0,a.Z)(this,"type","text"),(0,a.Z)(this,"required",!1),(0,a.Z)(this,"disabled",!1),(0,a.Z)(this,"endEditRequest",new t.vpe),(0,a.Z)(this,"editing",!1),(0,a.Z)(this,"editValue",""),(0,a.Z)(this,"preValue",""),(0,a.Z)(this,"onChange",Function.prototype),(0,a.Z)(this,"onTouched",Function.prototype)}get value(){return this.editValue}set value(n){n!==this.editValue&&(this.editValue=n,this.onChange(n))}writeValue(n){this.editValue=n}registerOnChange(n){this.onChange=n}registerOnTouched(n){this.onTouched=n}onBlur(n){this.editing=!1,this.preValue!==this.editValue&&this.endEditRequest.emit()}apply(){this.editing=!1,this.endEditRequest.emit()}edit(n){this.disabled||(this.preValue=n,this.editing=!0,setTimeout(()=>{this.inlineEditControl?.nativeElement&&this.inlineEditControl.nativeElement.focus()}))}}(0,a.Z)(lt,"\u0275fac",function(n){return new(n||lt)}),(0,a.Z)(lt,"\u0275cmp",t.Xpm({type:lt,selectors:[["app-inline-edit"]],viewQuery:function(n,e){if(1&n&&t.Gf(ce,5),2&n){let i;t.iGM(i=t.CRH())&&(e.inlineEditControl=i.first)}},inputs:{placeholder:"placeholder",type:"type",required:"required",disabled:"disabled"},outputs:{endEditRequest:"endEditRequest"},features:[t._Bn([{provide:x.JU,useExisting:lt,multi:!0}])],decls:2,vars:2,consts:[["class","inline-edit-edit",4,"ngIf"],[4,"ngIf"],[1,"inline-edit-edit"],[3,"required","name","ngModel","type","placeholder","blur","keydown.enter","ngModelChange"],["inlineEditControl",""],["title","Click to edit","tabindex","0",1,"inline-edit",3,"click","focus"],[1,"icon-edit"]],template:function(n,e){1&n&&(t.YNc(0,le,3,5,"div",0),t.YNc(1,de,4,1,"div",1)),2&n&&(t.Q6J("ngIf",e.editing),t.xp6(1),t.Q6J("ngIf",!e.editing))},dependencies:[O.O5,x.Fj,x.JJ,x.Q7,x.On],styles:[".inline-edit{cursor:pointer}.inline-edit i{font-size:.7em}.inline-edit-edit{width:100%;display:block}.inline-edit-edit input{width:100%}\n"],encapsulation:2}));var ge=v(4627);function he(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",2),t.NdJ("keydown.enter",function(){const l=t.CHM(e).$implicit,u=t.oxw();return t.KtG(u.editArtwork(l.artwork))}),t.TgZ(1,"div",3)(2,"img",4),t.NdJ("clickenter",function(){const l=t.CHM(e).$implicit,u=t.oxw();return t.KtG(u.editArtwork(l.artwork))}),t.qZA(),t.TgZ(3,"div",5),t._uU(4),t.qZA(),t.TgZ(5,"div",6),t._uU(6),t.qZA(),t.TgZ(7,"div",7),t._uU(8),t.qZA(),t.TgZ(9,"div",8),t._uU(10),t.ALo(11,"filesize"),t.qZA()(),t.TgZ(12,"div",9)(13,"app-inline-edit",10),t.NdJ("ngModelChange",function(r){const u=t.CHM(e).$implicit;return t.KtG(u.name=r)})("endEditRequest",function(){const l=t.CHM(e).$implicit,u=t.oxw();return t.KtG(u.editArtworkName(l))}),t.qZA(),t.TgZ(14,"a",11),t.NdJ("clickenter",function(){const l=t.CHM(e).$implicit,u=t.oxw();return t.KtG(u.removeArtwork(l))}),t._UZ(15,"i",12),t.qZA()()()}if(2&o){const e=n.$implicit;t.xp6(2),t.Q6J("src",e.thumbnail,t.LSH),t.xp6(2),t.Oqu(e.artwork.types),t.xp6(2),t.Oqu(e.artwork.format),t.xp6(2),t.AsE("",e.artwork.width,"x",e.artwork.height,""),t.xp6(2),t.Oqu(t.lcZ(11,7,e.artwork.size)),t.xp6(3),t.Q6J("ngModel",e.name)}}function pe(o){const n=o.split(".");return n.pop(),n.join(".")}function _e(o){const n=o.split(".");return n[n.length-1]}class ut{constructor(n,e,i,r,l,u){(0,a.Z)(this,"app",void 0),(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"folderService",void 0),(0,a.Z)(this,"dialogs",void 0),(0,a.Z)(this,"dialogOverlay",void 0),(0,a.Z)(this,"artworks",void 0),(0,a.Z)(this,"folderID",void 0),(0,a.Z)(this,"nodes",void 0),this.app=n,this.jam=e,this.notify=i,this.folderService=r,this.dialogs=l,this.dialogOverlay=u}trackByFn(n,e){return e.artwork.id}ngOnChanges(n){this.displayArtworks()}editArtworkName(n){this.jam.artwork.rename({id:n.artwork.id,newName:n.name}).then(e=>{this.folderService.waitForQueueResult("Renaming Artwork",e,this.folderID?[this.folderID]:[],[])}).catch(e=>{this.notify.error(e)})}editArtwork(n){this.dialogOverlay.open({childComponent:Zt,title:"Edit Image",data:{artwork:n,folderID:this.folderID},panelClass:""})}showArtwork(n){const e=n.types.join(", ");this.dialogOverlay.open({title:e,childComponent:_t.$w,data:{name:e,url:this.jam.image.imageUrl({id:n.id})}})}removeArtwork(n){this.dialogs.confirm("Remove Artworks?",`Do you want to delete "${n.artwork.name}"?`,()=>{this.jam.artwork.remove({id:n.artwork.id}).then(e=>{this.nodes&&(this.nodes=this.nodes.filter(i=>i!==n)),this.folderService.waitForQueueResult("Removing Artwork",e,this.folderID?[this.folderID]:[])}).catch(e=>{this.notify.error(e)})})}displayArtworks(){this.nodes=[],this.artworks&&(this.nodes=this.artworks.map(n=>({name:pe(n.name),type:_e(n.name),artwork:n,thumbnail:this.jam.image.imageUrl({id:n.id,size:128,format:_.GU.webp})})))}}function ue(o,n){1&o&&t._UZ(0,"app-loading")}function me(o,n){1&o&&t._UZ(0,"i",18)}function fe(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"input",19),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw().$implicit;return t.KtG(l.checked=r)}),t.qZA()}if(2&o){const e=t.oxw().$implicit;t.Q6J("ngModel",e.checked)("checked",e.checked)}}function Ce(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",11),t.NdJ("keydown.enter",function(){const l=t.CHM(e).$implicit;return t.KtG(l.checked=!l.checked)}),t.TgZ(1,"div",12),t.NdJ("clickenter",function(){const l=t.CHM(e).$implicit;return t.KtG(l.checked=!l.checked)}),t._UZ(2,"img",13),t.qZA(),t.TgZ(3,"div",14)(4,"div",15)(5,"form")(6,"label"),t.YNc(7,me,1,0,"i",16),t.YNc(8,fe,1,2,"input",17),t._uU(9),t.qZA()()()()()}if(2&o){const e=n.$implicit;t.xp6(2),t.s9C("alt",e.name),t.Q6J("src",e.thumbnail,t.LSH),t.xp6(5),t.Q6J("ngIf",e.storing),t.xp6(1),t.Q6J("ngIf",!e.storing),t.xp6(1),t.hij(" ",e.name," ")}}function xe(o,n){if(1&o&&(t.TgZ(0,"div"),t._UZ(1,"app-background-text-list",8),t.TgZ(2,"div",9),t.YNc(3,Ce,10,5,"div",10),t.qZA()()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("list",e.nodes),t.xp6(2),t.Q6J("ngForOf",e.nodes)("ngForTrackBy",e.trackByFn)}}function Me(o,n){if(1&o&&t._UZ(0,"app-admin-artwork-list",22),2&o){const e=t.oxw(2);t.Q6J("folderID",e.data.folder.id)("artworks",e.artworks)}}function ve(o,n){if(1&o&&(t.TgZ(0,"div",20)(1,"div",2),t._uU(2,"Current Images"),t.qZA(),t.YNc(3,Me,1,2,"app-admin-artwork-list",21),t.qZA()),2&o){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",!e.isArtRefreshing)}}function Oe(o,n){1&o&&(t.TgZ(0,"button",25),t._UZ(1,"i",18),t.qZA())}function be(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.use())}),t._uU(1,"Use Checked Artwork"),t.qZA()}}function ye(o,n){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,Oe,2,0,"button",23),t.YNc(2,be,2,0,"button",24),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.isWorking),t.xp6(1),t.Q6J("ngIf",!e.isWorking)}}(0,a.Z)(ut,"\u0275fac",function(n){return new(n||ut)(t.Y36(m.zi),t.Y36(_.K4),t.Y36(m.c),t.Y36(m.Cr),t.Y36(q.Hr),t.Y36(Y.SL))}),(0,a.Z)(ut,"\u0275cmp",t.Xpm({type:ut,selectors:[["app-admin-artwork-list"]],inputs:{artworks:"artworks",folderID:"folderID"},features:[t.TTD],decls:2,vars:2,consts:[["appFocusKeyList",""],["class","artwork","appFocusKeyListItem","",3,"keydown.enter",4,"ngFor","ngForOf","ngForTrackBy"],["appFocusKeyListItem","",1,"artwork",3,"keydown.enter"],[1,"artwork-img"],["alt","Artwork",3,"src","clickenter"],[1,"mode"],[1,"format"],[1,"dims"],[1,"size"],[1,"artwork-types"],["type","text",3,"ngModel","ngModelChange","endEditRequest"],["title","Delete Image",1,"delete-button",3,"clickenter"],["aria-hidden","true",1,"icon-trash"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0),t.YNc(1,he,16,9,"div",1),t.qZA()),2&n&&(t.xp6(1),t.Q6J("ngForOf",e.nodes)("ngForTrackBy",e.trackByFn))},dependencies:[O.sg,b.X,w.j,Z.R,x.JJ,x.On,lt,ge.c],styles:["[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]{display:inline-block;padding-top:15px;padding-right:15px;font-size:.8em;text-align:center;width:200px}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]{position:relative;overflow:hidden}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .dims[_ngcontent-%COMP%], [_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%], [_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .format[_ngcontent-%COMP%], [_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .mode[_ngcontent-%COMP%]{position:absolute;padding:5px;background-color:var(--background-transparent);color:var(--on-background-active)}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .mode[_ngcontent-%COMP%]{top:0;left:0}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .format[_ngcontent-%COMP%]{bottom:0;left:0}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .dims[_ngcontent-%COMP%]{top:0;right:0}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{bottom:0;right:0}[_nghost-%COMP%]   .artwork-types[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;overflow:hidden}[_nghost-%COMP%]   .artwork-types[_ngcontent-%COMP%]   app-inline-edit[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .artwork-types[_ngcontent-%COMP%]   .delete-button[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}"]}));class Pt{constructor(n,e,i,r){(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"folderService",void 0),(0,a.Z)(this,"http",void 0),(0,a.Z)(this,"data",void 0),(0,a.Z)(this,"artworks",void 0),(0,a.Z)(this,"nodes",void 0),(0,a.Z)(this,"isWorking",!1),(0,a.Z)(this,"isArtRefreshing",!1),(0,a.Z)(this,"searchSource",{name:"",url:""}),(0,a.Z)(this,"unsubscribe",new N.x),this.jam=n,this.notify=e,this.folderService=i,this.http=r}trackByFn(n,e){return e.image}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}ngOnChanges(n){this.search(),this.data&&this.data.folder&&(this.data.folder.artworks?this.artworks=this.data.folder.artworks:this.refreshArtworks())}refreshArtworks(){this.data&&(this.isArtRefreshing=!0,this.jam.artwork.search({folderIDs:[this.data.folder.id]}).then(n=>{this.isArtRefreshing=!1,this.artworks=n.items}).catch(n=>{this.isArtRefreshing=!1,console.error(n)}))}loadWikiDataID(n){var e=this;return(0,S.Z)(function*(){const i=yield e.jam.metadata.musicbrainzLookup({type:_.ej.artist,mbID:n});if(i?.data?.artist?.relations){const r=i.data.artist.relations.find(l=>"wikidata"===l.type);if(r?.url)return r.url.resource.split("/").pop()}})()}loadWikiCommonImage(n){var e=this;return(0,S.Z)(function*(){const i=yield e.loadWikiDataID(n);if(!i)return;const l=(yield e.jam.metadata.wikidataLookup({wikiDataID:i}))?.data?.entity?.claims;if(!l)return;const u=Object.keys(l);for(const J of u){let V=l[J];V=V.filter(oe=>"string"==typeof oe.mainsnak.datavalue.value&&(0,ee.U_)(oe.mainsnak.datavalue.value.toLowerCase(),["jpg","jpeg","png"]));const ae=V[0];if(ae){const uo=`https://en.wikipedia.org/w/api.php?format=json&action=query&origin=*&titles=File:${ae.mainsnak.datavalue.value}&prop=imageinfo&iiprop=extmetadata|url&iiextmetadatafilter=LicenseShortName`,Vt=yield e.http.get(uo).toPromise();if(Vt&&Vt.query.pages){const Et=Vt.query.pages[Object.keys(Vt.query.pages)[0]];if(Et&&Et.imageinfo[0])return{name:_.iJ.artist,thumbnail:Et.imageinfo[0].url,image:Et.imageinfo[0].url,licence:Et.imageinfo[0].extmetadata.LicenseShortName.value,checked:!0,storing:!1,types:[_.iJ.artist]}}}}})()}loadWikiCommon(n){this.loadWikiCommonImage(n).then(e=>{this.nodes=[],e&&(e.checked=!0,this.nodes.push(e))}).catch(e=>{this.nodes=[],this.notify.error(e)})}use(){const n=(this.nodes||[]).find(i=>i.checked&&!i.storing),e=this.data?.folder;n&&e?(this.isWorking=!0,n.storing=!0,this.jam.artwork.createByUrl({folderID:e.id,url:n.image,types:n.types}).then(i=>{this.folderService.waitForQueueResult("Creating Artwork",i,[e.id]).pipe((0,F.R)(this.unsubscribe)).subscribe(()=>{n.storing=!1,n.checked=!1}),this.use()}).catch(i=>{n.storing=!1,this.notify.error(i)})):this.isWorking=!1}ngOnInit(){this.folderService.foldersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(n=>{n.id===this.data?.folder.id&&this.refreshArtworks()})}loadReleaseGroupAndRelease(n,e){this.jam.metadata.coverartarchiveLookup({type:_.xB.releaseGroup,mbID:e}).then(i=>{let r=this.coverArtResponseToNodes(i.data);this.jam.metadata.coverartarchiveLookup({type:_.xB.release,mbID:n}).then(l=>{r=r.concat(this.coverArtResponseToNodes(l.data)),this.display(r)}).catch(l=>{this.notify.error(l)})}).catch(i=>{this.notify.error(i)})}loadReleaseGroup(n){this.jam.metadata.coverartarchiveLookup({type:_.xB.releaseGroup,mbID:n}).then(e=>{const i=this.coverArtResponseToNodes(e.data);this.display(i)}).catch(e=>{this.notify.error(e)})}loadRelease(n){n&&this.jam.metadata.coverartarchiveLookup({type:_.xB.release,mbID:n}).then(e=>{const i=this.coverArtResponseToNodes(e.data);this.display(i),0===i.length&&this.data&&this.data.folder&&this.data.folder.tag&&this.data.folder.tag.mbReleaseGroupID&&(this.nodes=void 0,this.loadReleaseGroup(this.data.folder.tag.mbReleaseGroupID))}).catch(e=>{this.notify.error(e)})}coverArtResponseToNodes(n){return n.images?n.images.map(e=>(0===e.types.length&&e.types.push("Other"),{name:(e.types||[]).join("/").toLowerCase(),thumbnail:this.jam.metadata.coverartarchiveImageUrl({url:e.thumbnails.small}),licence:"",image:e.image,types:(e.types||[]).map(i=>i.toLowerCase()),checked:!1,storing:!1,stored:!1})):[]}search(){this.data&&this.data.folder&&this.data.folder.tag&&(this.data.folder.type===_.Sr.artist?this.data.folder.tag.mbArtistID&&(this.searchSource={name:"Wiki Commons",url:"https://commons.wikimedia.org"},this.loadWikiCommon(this.data.folder.tag.mbArtistID)):this.data&&this.data.folder&&this.data.folder.tag&&(this.searchSource={name:"Coverart Archive",url:"https://coverartarchive.org"},this.data.folder.tag.mbReleaseID&&this.data.folder.tag.mbReleaseGroupID?this.loadReleaseGroupAndRelease(this.data.folder.tag.mbReleaseID,this.data.folder.tag.mbReleaseGroupID):this.data.folder.tag.mbReleaseID?this.loadRelease(this.data.folder.tag.mbReleaseID):this.data.folder.tag.mbReleaseGroupID&&this.loadReleaseGroup(this.data.folder.tag.mbReleaseGroupID)))}display(n){this.nodes=n;let e=n.find(i=>1===i.types.length&&i.types[0]===_.iJ.front);e||(e=n.find(i=>i.types.includes(_.iJ.front))),e&&this.nodes.forEach(i=>i.checked=i===e)}}(0,a.Z)(Pt,"\u0275fac",function(n){return new(n||Pt)(t.Y36(_.K4),t.Y36(m.c),t.Y36(m.Cr),t.Y36(W.eN))}),(0,a.Z)(Pt,"\u0275cmp",t.Xpm({type:Pt,selectors:[["app-admin-folder-artwork-search"]],inputs:{data:"data"},features:[t.TTD],decls:11,vars:6,consts:[[1,"image-selector"],[1,"art-source"],[1,"section"],["rel","noopener","target","_blank",3,"href"],[4,"ngIf"],[1,"artwork"],["class","current",4,"ngIf"],[1,"buttons"],["name","Images",3,"list"],["appFocusKeyList","",1,"images"],["appFocusKeyListItem","",3,"keydown.enter",4,"ngFor","ngForOf","ngForTrackBy"],["appFocusKeyListItem","",3,"keydown.enter"],[1,"image",3,"clickenter"],[3,"alt","src"],[1,"footer"],[1,"footer-content"],["class","icon-spin icon-spinner",4,"ngIf"],["type","checkbox",3,"ngModel","checked","ngModelChange",4,"ngIf"],[1,"icon-spin","icon-spinner"],["type","checkbox",3,"ngModel","checked","ngModelChange"],[1,"current"],[3,"folderID","artworks",4,"ngIf"],[3,"folderID","artworks"],["class","button-on-control",4,"ngIf"],["class","button-on-control",3,"click",4,"ngIf"],[1,"button-on-control"],[1,"button-on-control",3,"click"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3),t._uU(4),t.qZA()(),t.YNc(5,ue,1,0,"app-loading",4),t.YNc(6,xe,4,3,"div",4),t.qZA(),t.TgZ(7,"div",5),t.YNc(8,ve,4,1,"div",6),t.qZA()(),t.TgZ(9,"div",7),t.YNc(10,ye,3,2,"div",4),t.qZA()),2&n&&(t.xp6(3),t.Q6J("href",e.searchSource.url,t.LSH),t.xp6(1),t.Oqu(e.searchSource.name),t.xp6(1),t.Q6J("ngIf",!e.nodes),t.xp6(1),t.Q6J("ngIf",e.nodes),t.xp6(2),t.Q6J("ngIf",e.data&&e.artworks),t.xp6(2),t.Q6J("ngIf",e.nodes&&e.nodes.length>0))},dependencies:[O.sg,O.O5,D.$,E.N,b.X,w.j,Z.R,x._Y,x.Wl,x.JJ,x.JL,x.On,x.F,ut],styles:["[_nghost-%COMP%]   .image-selector[_ngcontent-%COMP%]{display:flex;flex-flow:column wrap;height:calc(100% - 40px)}[_nghost-%COMP%]   .image-buttons[_ngcontent-%COMP%]{height:40px}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]{overflow-y:auto;width:50%;height:100%;padding-left:15px}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]{padding-right:15px;overflow-y:auto;width:50%;height:100%;border-right:1px solid var(--background-border)}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{display:inline-block;padding-top:15px;padding-right:15px;font-size:.8em}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:185px;min-width:185px;min-height:185px;height:auto}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{font-size:.8em}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]{border-bottom:1px solid var(--background-border);padding-bottom:5px}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-active)}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}"]}));class mt{constructor(){(0,a.Z)(this,"data",void 0)}dialogInit(n,e){this.data=e.data}}function we(o,n){1&o&&(t.TgZ(0,"div",1)(1,"div",2),t._UZ(2,"i",3),t.qZA()())}function Ze(o,n){1&o&&(t.TgZ(0,"div",2),t._uU(1,"No Hints"),t.qZA())}function Pe(o,n){if(1&o&&(t.TgZ(0,"div",10),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.Oqu(e)}}function Ae(o,n){if(1&o&&(t.TgZ(0,"div",2),t._UZ(1,"i",8),t._uU(2),t.YNc(3,Pe,2,1,"div",9),t.qZA()),2&o){const e=n.$implicit;t.xp6(2),t.hij(" ",e.hint.name," "),t.xp6(1),t.Q6J("ngForOf",e.details)}}function ke(o,n){1&o&&t._UZ(0,"i",3)}function Te(o,n){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.name)}}function Ie(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.KtG(l.click())}),t.YNc(1,ke,1,0,"i",12),t.YNc(2,Te,2,1,"ng-container",13),t.qZA()}if(2&o){const e=n.$implicit;t.xp6(1),t.Q6J("ngIf",e.running),t.xp6(1),t.Q6J("ngIf",!e.running)}}function Se(o,n){if(1&o&&(t.TgZ(0,"div",1),t.YNc(1,Ze,2,0,"div",4),t.YNc(2,Ae,4,2,"div",5),t.TgZ(3,"div",6),t.YNc(4,Ie,3,2,"button",7),t.qZA()()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",0===e.hints.length),t.xp6(1),t.Q6J("ngForOf",e.hints)("ngForTrackBy",e.trackByFn),t.xp6(2),t.Q6J("ngForOf",e.solutions)}}(0,a.Z)(mt,"\u0275fac",function(n){return new(n||mt)}),(0,a.Z)(mt,"\u0275cmp",t.Xpm({type:mt,selectors:[["app-dialog-folder-artwork-search"]],decls:1,vars:1,consts:[[3,"data"]],template:function(n,e){1&n&&t._UZ(0,"app-admin-folder-artwork-search",0),2&n&&t.Q6J("data",e.data)},dependencies:[Pt]}));class at{constructor(n,e,i,r,l,u){(0,a.Z)(this,"app",void 0),(0,a.Z)(this,"router",void 0),(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"dialogOverlay",void 0),(0,a.Z)(this,"folderService",void 0),(0,a.Z)(this,"hints",void 0),(0,a.Z)(this,"solutions",[]),(0,a.Z)(this,"folderHealth",void 0),(0,a.Z)(this,"unsubscribe",new N.x),this.app=n,this.router=e,this.jam=i,this.notify=r,this.dialogOverlay=l,this.folderService=u}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}trackByFn(n,e){return e.hint.id}searchImages(n){this.dialogOverlay.open({title:"Search Artwork Images",childComponent:mt,data:{folder:n},panelClass:"overlay-panel-large-buttons"})}ngOnChanges(){this.display(this.folderHealth)}static describeImageInvalidHint(n,e){if(!n.details||0===n.details.length)return[];const i=[n.details[0].reason];return n.details[0].expected&&i.push(`Expected: ${n.details[0].expected} Actual: ${n.details[0].actual}`),i}static describeAlbumTracksMissingHint(n,e){if(!n.details||0===n.details.length)return[];const i=[];return n.details[0].expected&&i.push(`Expected: ${n.details[0].expected} Actual: ${n.details[0].actual}`),i}describeImageQualityHint(n,e){if(this.addAlbumImageSearchSolution(e),!n.details||0===n.details.length)return[];const i=[n.details[0].reason];return i.push(`Expected: ${n.details[0].expected} Actual: ${n.details[0].actual}`),i}addArtistImageSearchSolution(n){var r,e=this;if(n.tag&&n.tag.mbArtistID){const i={name:"Search",click:(r=(0,S.Z)(function*(){e.searchImages(n)}),function(){return r.apply(this,arguments)})};this.solutions.push(i)}}addAlbumImageSearchSolution(n){var r,e=this;if(n.tag&&(n.tag.mbReleaseID||n.tag.mbReleaseGroupID)){const i={name:"Search",click:(r=(0,S.Z)(function*(){e.searchImages(n)}),function(){return r.apply(this,arguments)})};this.solutions.push(i)}}addRenameSolution(n,e){var l,i=this;if(!this.solutions.find(r=>"Rename"===r.name)){const r={name:"Rename",click:(l=(0,S.Z)(function*(){if(r.running)return;r.running=!0;const u=yield i.jam.folder.rename({id:n.id,name:e});i.folderService.waitForQueueResult("Renaming Folder",u,[n.id]).pipe((0,F.R)(i.unsubscribe)).subscribe(()=>{r.running=!1})}),function(){return l.apply(this,arguments)})};this.solutions.push(r)}}addEditTagSolution(n){var r,e=this;if(!this.solutions.find(i=>"Edit Tags"===i.name)){const i={name:"Edit Tags",click:(r=(0,S.Z)(function*(){e.router.navigate([`/admin/folder/${n.id}/tags`]).catch(l=>{console.error(l)})}),function(){return r.apply(this,arguments)})};this.solutions.push(i)}}describeMBIDMissingHint(n,e){return this.addEditTagSolution(e),[]}describeAlbumTagMissingHint(n,e){return this.addEditTagSolution(e),n.details?[`Expected: ${n.details.map(i=>i.expected).join(",")}`]:[]}describeNameNonConformHint(n,e){const i=n.details&&n.details.length>0?n.details[0].expected:"";return i?(this.addRenameSolution(e,i),[`Current: ${e.name}`,`Suggested Name: ${i}`]):[]}describeArtistImageMissingHint(n,e){return this.addArtistImageSearchSolution(e),[]}describeAlbumImageMissingHint(n,e){return this.addAlbumImageSearchSolution(e),[]}describeHint(n,e){switch(n.id){case _.Mx.albumMBIDExists:return this.describeMBIDMissingHint(n,e);case _.Mx.albumTagsExists:return this.describeAlbumTagMissingHint(n,e);case _.Mx.albumNameConform:case _.Mx.artistNameConform:return this.describeNameNonConformHint(n,e);case _.Mx.albumImageExists:return this.describeAlbumImageMissingHint(n,e);case _.Mx.albumTracksComplete:return at.describeAlbumTracksMissingHint(n,e);case _.Mx.artistImageExists:return this.describeArtistImageMissingHint(n,e);case _.Mx.artistImageValid:case _.Mx.albumImageValid:return at.describeImageInvalidHint(n,e);case _.Mx.albumImageQuality:return this.describeImageQualityHint(n,e)}return[]}display(n){this.hints=[],this.solutions=[],n?.health&&(this.hints=n.health.map(e=>({hint:e,details:this.describeHint(e,n.folder)})))}}function Fe(o,n){if(1&o&&(t.TgZ(0,"option",11),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function Ue(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"select",9),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.filter=r)})("ngModelChange",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.onFilterChange())}),t.YNc(1,Fe,2,2,"option",10),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("ngModel",e.filter),t.xp6(1),t.Q6J("ngForOf",e.modes)}}function Re(o,n){1&o&&t._UZ(0,"app-loading")}function He(o,n){if(1&o&&(t.ynx(0),t.TgZ(1,"div",20),t._uU(2,"Album"),t.qZA(),t.TgZ(3,"div",21),t._uU(4),t.qZA(),t.TgZ(5,"div",22),t._uU(6),t.qZA(),t.TgZ(7,"div",23),t._uU(8),t.qZA(),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(4),t.Oqu(null==e.folder.tag?null:e.folder.tag.album),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.artist),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.year)}}function qe(o,n){if(1&o&&(t.ynx(0),t.TgZ(1,"div",20),t._uU(2,"Album"),t.qZA(),t.TgZ(3,"div",21),t._uU(4),t.qZA(),t.TgZ(5,"div",22),t._uU(6),t.qZA(),t.TgZ(7,"div",23),t._uU(8),t.qZA(),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(4),t.Oqu(null==e.folder.tag?null:e.folder.tag.album),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.artist),t.xp6(2),t.Oqu(null==e.folder.tag?null:e.folder.tag.year)}}function Je(o,n){if(1&o&&(t.ynx(0),t.TgZ(1,"div",20),t._uU(2,"Artist"),t.qZA(),t.TgZ(3,"div",21),t._uU(4),t.qZA(),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(4),t.Oqu(null==e.folder.tag?null:e.folder.tag.artist)}}function Qe(o,n){if(1&o&&(t.ynx(0),t.TgZ(1,"div",20),t._uU(2,"Collection"),t.qZA(),t.TgZ(3,"div",21),t._uU(4),t.qZA(),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(4),t.Oqu(e.folder.name)}}function De(o,n){if(1&o&&(t.ynx(0),t.TgZ(1,"div",21),t._uU(2),t.qZA(),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(2),t.Oqu(e.folder.name)}}(0,a.Z)(at,"\u0275fac",function(n){return new(n||at)(t.Y36(m.zi),t.Y36(A.F0),t.Y36(_.K4),t.Y36(m.c),t.Y36(Y.SL),t.Y36(m.Cr))}),(0,a.Z)(at,"\u0275cmp",t.Xpm({type:at,selectors:[["app-folder-health"]],inputs:{folderHealth:"folderHealth"},features:[t.TTD],decls:2,vars:2,consts:[["class","hints",4,"ngIf"],[1,"hints"],[1,"hint"],[1,"icon-spin","icon-spinner"],["class","hint",4,"ngIf"],["class","hint",4,"ngFor","ngForOf","ngForTrackBy"],[1,"solutions"],["class","button-on-background",3,"click",4,"ngFor","ngForOf"],[1,"icon-warning"],["class","details",4,"ngFor","ngForOf"],[1,"details"],[1,"button-on-background",3,"click"],["class","icon-spin icon-spinner",4,"ngIf"],[4,"ngIf"]],template:function(n,e){1&n&&(t.YNc(0,we,3,0,"div",0),t.YNc(1,Se,5,4,"div",0)),2&n&&(t.Q6J("ngIf",!e.hints),t.xp6(1),t.Q6J("ngIf",e.hints))},dependencies:[O.sg,O.O5],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .icon-warning[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]{padding-left:28px;font-size:.8em;text-transform:uppercase;min-width:30%;display:inline-block}[_nghost-%COMP%]   .hints[_ngcontent-%COMP%]{padding-top:10px}[_nghost-%COMP%]   .hint[_ngcontent-%COMP%]{padding-bottom:10px}"]}));const Ne=function(o){return["/admin/folder",o,"overview"]};function ze(o,n){if(1&o&&(t.TgZ(0,"div",12)(1,"div",13)(2,"a",14),t.ynx(3,15),t.YNc(4,He,9,3,"ng-container",16),t.YNc(5,qe,9,3,"ng-container",16),t.YNc(6,Je,5,1,"ng-container",16),t.YNc(7,Qe,5,1,"ng-container",16),t.YNc(8,De,3,1,"ng-container",17),t.BQk(),t.qZA()(),t.TgZ(9,"div",18),t._UZ(10,"app-folder-health",19),t.qZA()()),2&o){const e=n.$implicit;t.xp6(2),t.Q6J("routerLink",t.VKq(7,Ne,e.folder.id)),t.xp6(1),t.Q6J("ngSwitch",e.folder.type),t.xp6(1),t.Q6J("ngSwitchCase","multialbum"),t.xp6(1),t.Q6J("ngSwitchCase","album"),t.xp6(1),t.Q6J("ngSwitchCase","artist"),t.xp6(1),t.Q6J("ngSwitchCase","collection"),t.xp6(3),t.Q6J("folderHealth",e)}}class At extends P{constructor(n,e,i,r,l){super(n),(0,a.Z)(this,"app",void 0),(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"folderService",void 0),(0,a.Z)(this,"all",void 0),(0,a.Z)(this,"hints",void 0),(0,a.Z)(this,"filter",void 0),(0,a.Z)(this,"modes",[]),this.app=e,this.jam=i,this.notify=r,this.folderService=l}onFilterChange(){this.reDisplay()}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(n=>{if(n.id===this.id)this.refresh();else if(this.all){const e=this.all.find(i=>i.folder.id===n.id);e&&this.jam.folder.health({ids:[n.id],folderIncTag:!0}).then(i=>{if(this.all){const r=i.find(l=>l.folder.id===e.folder.id);r?this.all[this.all.indexOf(e)]=r:this.all=this.all.filter(l=>l.folder.id!==e.folder.id)}this.reDisplay()}).catch(i=>{this.notify.error(i)})}})}ngOnDestroy(){super.ngOnDestroy()}refresh(){this.hints=void 0,this.jam.folder.health({childOfID:this.id,folderIncTag:!0}).then(n=>{this.display(n)}).catch(n=>{this.notify.error(n)})}reDisplay(){this.hints=this.filter&&this.all?this.all.filter(n=>n.health&&n.health.find(e=>e.name===this.filter)):this.all}display(n){this.all=n,this.modes=[];for(const e of n)if(e.health)for(const i of e.health)this.modes.includes(i.name)||this.modes.push(i.name);this.reDisplay()}}(0,a.Z)(At,"\u0275fac",function(n){return new(n||At)(t.Y36(A.gz),t.Y36(m.zi),t.Y36(_.K4),t.Y36(m.c),t.Y36(m.Cr))}),(0,a.Z)(At,"\u0275cmp",t.Xpm({type:At,selectors:[["app-admin-folder-health"]],features:[t.qOj],decls:9,vars:4,consts:[[1,"health"],[1,"actions"],["title","Refresh List",1,"button-on-control",3,"click"],[1,"icon-reload"],["placeholder","Type of Hints",3,"ngModel","ngModelChange",4,"ngIf"],[1,"health-content"],[4,"ngIf"],["name","Folder Health Issues",3,"list"],["class","folder",4,"ngFor","ngForOf"],["placeholder","Type of Hints",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"folder"],[1,"meta"],[3,"routerLink"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"folder-health"],[3,"folderHealth"],[1,"type"],[1,"name"],[1,"artist"],[1,"year"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t.NdJ("click",function(){return e.refresh()}),t._UZ(3,"i",3),t.qZA(),t.YNc(4,Ue,2,2,"select",4),t.qZA(),t.TgZ(5,"div",5),t.YNc(6,Re,1,0,"app-loading",6),t._UZ(7,"app-background-text-list",7),t.YNc(8,ze,11,9,"div",8),t.qZA()()),2&n&&(t.xp6(4),t.Q6J("ngIf",e.modes.length>0),t.xp6(2),t.Q6J("ngIf",!e.hints),t.xp6(1),t.Q6J("list",e.hints),t.xp6(1),t.Q6J("ngForOf",e.hints))},dependencies:[O.sg,O.O5,O.RF,O.n9,O.ED,D.$,E.N,x.YN,x.Kr,x.EJ,x.JJ,x.On,A.rH,at],styles:["[_nghost-%COMP%]{height:100%;width:100%}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .health-content[_ngcontent-%COMP%]{padding:15px;overflow-y:auto;overflow-x:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]{border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:var(--background-border);padding:15px;display:flex;flex-flow:row wrap;flex-flow:row nowrap}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{width:30%;padding-right:15px;margin-left:15px;display:flex;flex-flow:column wrap;position:relative}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;text-overflow:ellipsis;overflow:hidden}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%]{text-transform:uppercase}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .year[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .state[_ngcontent-%COMP%]{letter-spacing:1px;font-size:.8em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:24px;font-weight:100;color:var(--on-background-active)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-active)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:14px;line-height:1.2em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:5px;margin-right:5px;height:27px;font-weight:500;padding:1px 15px 0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transform:scale(1.3);transform-origin:center}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;border:1px solid transparent;padding:4px 9px 7px;border-radius:50%;display:none;position:absolute;right:1px;bottom:0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:var(--control-hover);color:var(--on-background-hover)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]:hover   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]:hover   app-fav-icon[_ngcontent-%COMP%]{display:inline}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .folder-health[_ngcontent-%COMP%]{display:flex;width:70%}@media (max-width: 400px){[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]{padding-left:0;padding-right:0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-size:.8em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:16px}}"]}));var Ye=v(7111);function Ee(o,n){if(1&o&&(t.TgZ(0,"div")(1,"div"),t._uU(2),t.ALo(3,"stringToggle"),t.qZA(),t._UZ(4,"app-loading"),t.qZA()),2&o){const e=t.oxw();t.xp6(2),t.Oqu(t.Dn7(3,1,e.isUploading,"Uploading","Creating Artwork"))}}function Le(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",2),t.NdJ("drop",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.onDropFile(r))})("dragover",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.onDragOverFile(r))}),t.TgZ(1,"form")(2,"input",3),t.NdJ("change",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.selectFile(r))}),t.qZA()()()}}class kt{constructor(n,e,i){(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"folderService",void 0),(0,a.Z)(this,"folder",void 0),(0,a.Z)(this,"reference",void 0),(0,a.Z)(this,"isIdle",!0),(0,a.Z)(this,"isUploading",!1),(0,a.Z)(this,"unsubscribe",new N.x),this.jam=n,this.notify=e,this.folderService=i}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}dialogInit(n,e){this.reference=n,this.folder=e.data?.folder}waitForCreationEnd(n){if(!this.folder)return;const e=this.folder.id;this.folderService.waitForQueueResult("Creating Artwork",n,[]).pipe((0,F.R)(this.unsubscribe)).subscribe(i=>{this.isIdle=!0,this.folderService.notifyFolderChange(e,m.dw.fsnRefresh),n.error||(this.notify.success("Upload done"),this.reference&&this.reference.close())})}onDropFile(n){n.preventDefault(),this.uploadFile(n.dataTransfer?.files)}onDragOverFile(n){n.stopPropagation(),n.preventDefault()}selectFile(n){this.uploadFile(n.target.files)}uploadFile(n){if(!n||0===n.length||!this.folder)return;const e=n[0];this.isIdle=!1,this.isUploading=!0,this.jam.artwork.createByUpload({folderID:this.folder.id,types:[]},e).pipe((0,F.R)(this.unsubscribe)).subscribe(i=>{if(i.type!==W.dt.UploadProgress&&i instanceof W.Zn){const r=i.body;r&&this.waitForCreationEnd(r)}},i=>{this.isUploading=!1,this.isIdle=!0,this.notify.error(i)},()=>{this.isUploading=!1})}}(0,a.Z)(kt,"\u0275fac",function(n){return new(n||kt)(t.Y36(_.K4),t.Y36(m.c),t.Y36(m.Cr))}),(0,a.Z)(kt,"\u0275cmp",t.Xpm({type:kt,selectors:[["app-dialog-upload-image"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","drop-zone",3,"drop","dragover",4,"ngIf"],[1,"drop-zone",3,"drop","dragover"],["type","file","placeholder","Upload image","accept",".png,.jpeg,.jpg",3,"change"]],template:function(n,e){1&n&&(t.YNc(0,Ee,5,5,"div",0),t.YNc(1,Le,3,0,"div",1)),2&n&&(t.Q6J("ngIf",!e.isIdle),t.xp6(1),t.Q6J("ngIf",e.isIdle))},dependencies:[O.O5,E.N,x._Y,x.JL,x.F,T.C],styles:["[_nghost-%COMP%]   .drop-zone[_ngcontent-%COMP%]{margin:10px 20px;border-width:2px;border-style:dotted;border-color:var(--secondary);height:80%}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}"]}));var Be=v(9743);function je(o,n){1&o&&t._UZ(0,"app-loading")}function Ke(o,n){if(1&o&&t._UZ(0,"app-info-note",21),2&o){const e=t.oxw(2);t.Q6J("info",e.folder.info)}}function Ge(o,n){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=t.oxw(2);t.xp6(1),t.hij(" / ",null==e.folder.tag?null:e.folder.tag.albumType,"")}}function We(o,n){if(1&o&&(t.TgZ(0,"div")(1,"div",13),t._uU(2,"Artist"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(4),t.Oqu(null==e.folder.tag?null:e.folder.tag.artist)}}function $e(o,n){if(1&o&&(t.TgZ(0,"div")(1,"div",13),t._uU(2,"Album"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(4),t.Oqu(null==e.folder.tag?null:e.folder.tag.album)}}function Ve(o,n){if(1&o&&(t.TgZ(0,"div")(1,"div",13),t._uU(2,"Year"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(4),t.hij(" ",null==e.folder.tag?null:e.folder.tag.year,"")}}function Xe(o,n){if(1&o&&(t.TgZ(0,"div")(1,"div",13),t._uU(2,"Genres"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(4),t.hij(" ",null==e.folder.tag?null:e.folder.tag.genres,"")}}function tn(o,n){if(1&o&&(t.TgZ(0,"div")(1,"div",13),t._uU(2,"MB Release Id"),t.qZA(),t.TgZ(3,"div")(4,"a",22),t._uU(5),t.qZA()()()),2&o){const e=t.oxw(2);t.xp6(4),t.MGl("href","https://musicbrainz.org/release/",null==e.folder.tag?null:e.folder.tag.mbReleaseID,"",t.LSH),t.xp6(1),t.Oqu(null==e.folder.tag?null:e.folder.tag.mbReleaseID)}}function en(o,n){if(1&o&&(t.TgZ(0,"div")(1,"div",13),t._uU(2,"MB Artist Id"),t.qZA(),t.TgZ(3,"div")(4,"a",22),t._uU(5),t.qZA()()()),2&o){const e=t.oxw(2);t.xp6(4),t.MGl("href","https://musicbrainz.org/artist/",null==e.folder.tag?null:e.folder.tag.mbArtistID,"",t.LSH),t.xp6(1),t.Oqu(null==e.folder.tag?null:e.folder.tag.mbArtistID)}}const nn=function(o){return["/admin/folder",o]};function on(o,n){if(1&o&&(t.TgZ(0,"div")(1,"div",13),t._uU(2,"Parent Folder Id"),t.qZA(),t.TgZ(3,"div")(4,"a",23),t._uU(5),t.qZA()()()),2&o){const e=t.oxw(2);t.xp6(4),t.Q6J("routerLink",t.VKq(2,nn,e.folder.parentID)),t.xp6(1),t.Oqu(e.folder.parentID)}}function rn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",24),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.searchImages())}),t._UZ(1,"i",25),t._uU(2," Search Artwork "),t.qZA()}}function an(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.searchImages())}),t._UZ(1,"i",25),t._uU(2," Search Art"),t.qZA()}}function sn(o,n){if(1&o&&(t.TgZ(0,"div",27),t._UZ(1,"app-admin-artwork-list",28),t.qZA()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("folderID",e.folder.id)("artworks",e.folder.artworks)}}function cn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",2)(1,"div",3)(2,"button",4),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.refresh())}),t._UZ(3,"i",5),t.qZA(),t.TgZ(4,"button",6),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.moveFolder())}),t._UZ(5,"i",7),t.qZA(),t.TgZ(6,"button",8),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.removeFolder())}),t._UZ(7,"i",9),t.qZA()(),t.TgZ(8,"div",10),t.YNc(9,Ke,1,1,"app-info-note",11),t.TgZ(10,"div",12)(11,"div")(12,"div")(13,"div",13),t._uU(14,"Name"),t.qZA(),t.TgZ(15,"div")(16,"app-inline-edit",14),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.name=r)})("endEditRequest",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.editFolderName())}),t.qZA()()(),t.TgZ(17,"div")(18,"div",13),t._uU(19,"Type"),t.qZA(),t.TgZ(20,"div"),t._uU(21),t.YNc(22,Ge,2,1,"ng-container",0),t.qZA()(),t.TgZ(23,"div")(24,"div",13),t._uU(25,"Track Count"),t.qZA(),t.TgZ(26,"div"),t._uU(27),t.qZA()(),t.TgZ(28,"div")(29,"div",13),t._uU(30,"Folder Count"),t.qZA(),t.TgZ(31,"div"),t._uU(32),t.qZA()(),t.YNc(33,We,5,1,"div",0),t.YNc(34,$e,5,1,"div",0),t.qZA(),t.TgZ(35,"div"),t.YNc(36,Ve,5,1,"div",0),t.YNc(37,Xe,5,1,"div",0),t.YNc(38,tn,6,2,"div",0),t.YNc(39,en,6,2,"div",0),t.YNc(40,on,6,4,"div",0),t.qZA()(),t.TgZ(41,"div",15)(42,"div",3)(43,"button",16),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.uploadImage())}),t._UZ(44,"i",17),t._uU(45," Upload Artwork"),t.qZA(),t.YNc(46,rn,3,0,"button",18),t.YNc(47,an,3,0,"button",19),t.qZA(),t.YNc(48,sn,2,2,"div",20),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(9),t.Q6J("ngIf",null==e.folder.info?null:e.folder.info.description),t.xp6(7),t.Q6J("ngModel",e.name),t.xp6(5),t.hij("",e.folder.type," "),t.xp6(1),t.Q6J("ngIf",e.isAlbum),t.xp6(5),t.Oqu(e.folder.trackCount),t.xp6(5),t.Oqu(e.folder.folderCount),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.artist),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.album),t.xp6(2),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.year),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag||null==e.folder.tag.genres?null:e.folder.tag.genres.length),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.mbReleaseID),t.xp6(1),t.Q6J("ngIf",null==e.folder.tag?null:e.folder.tag.mbArtistID),t.xp6(1),t.Q6J("ngIf",e.folder.parentID),t.xp6(6),t.Q6J("ngIf",e.isAlbum&&e.folder.tag&&(e.folder.tag.mbReleaseID||e.folder.tag.mbReleaseGroupID)),t.xp6(1),t.Q6J("ngIf",e.isArtist&&e.folder.tag&&e.folder.tag.mbArtistID),t.xp6(1),t.Q6J("ngIf",e.folder.artworks&&e.folder.artworks.length>0)}}class Tt extends P{constructor(n,e,i,r,l,u,J,V){super(n),(0,a.Z)(this,"app",void 0),(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"dialogsService",void 0),(0,a.Z)(this,"dialogOverlay",void 0),(0,a.Z)(this,"folderService",void 0),(0,a.Z)(this,"router",void 0),(0,a.Z)(this,"name",""),(0,a.Z)(this,"folder",void 0),(0,a.Z)(this,"isAlbum",!1),(0,a.Z)(this,"isArtist",!1),this.app=e,this.jam=i,this.notify=r,this.dialogsService=l,this.dialogOverlay=u,this.folderService=J,this.router=V}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(n=>{n.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}editFolderName(){if(!this.folder)return;const n=(this.name||"").trim();if(0===n.length||n===this.folder.name)return void(this.name=this.folder.name);const e=this.folder.id;this.jam.folder.rename({id:e,name:n}).then(i=>{this.folderService.waitForQueueResult("Renaming Folder",i,[e])}).catch(i=>{this.notify.error(i)})}refresh(){this.id&&this.jam.folder.id({id:this.id,folderIncTag:!0,folderIncParents:!0,folderIncArtworks:!0,folderIncChildFolderCount:!0,folderIncTrackCount:!0}).then(n=>{this.display(n)}).catch(n=>{404===n.code?this.router.navigate(["/admin/folder/"]).catch(e=>{console.error(e)}):this.notify.error(n)})}uploadImage(){this.dialogOverlay.open({title:"Upload Folder Images",childComponent:kt,data:{folder:this.folder},panelClass:"overlay-panel-large-buttons"})}searchImages(){this.dialogOverlay.open({title:"Search Artwork Images",childComponent:mt,data:{folder:this.folder},panelClass:"overlay-panel-large-buttons"})}removeFolder(){const n=this.folder;n&&this.dialogsService.confirm("Remove Folder?",`Sure to remove Folder "${n.name}"?`,()=>{this.jam.folder.remove({id:n.id}).then(e=>{n.parentID&&this.router.navigate([`/admin/folder/${n.parentID}/overview`]).catch(i=>{console.error(i)}),this.folderService.waitForQueueResult("Removing Folder",e,[n.id],n.parentID?[n.parentID]:[])}).catch(e=>{this.notify.error(e)})})}moveFolder(){var n=this;const e=this.folder;if(!e)return;const i={selectID:e.id,disableIDs:[e.id]};var r;this.dialogOverlay.open({title:"Move Folder to",childComponent:z,data:i,panelClass:"overlay-panel-large-buttons",onOkBtn:(r=(0,S.Z)(function*(){const l=i.folder;if(l)try{n.jam.folder.move({ids:[e.id],newParentID:l.id}).then(u=>{n.folderService.waitForQueueResult("Moving Folder",u,[e.id],(e.parentID?[e.parentID]:[]).concat([l.id]))}).catch(u=>{n.notify.error(u)})}catch(u){return n.notify.error(u),Promise.reject(u)}}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,S.Z)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}display(n){this.name="",this.isAlbum=!1,this.isArtist=!1,this.folder=n,n&&(this.name=n.name,this.isAlbum=Ye.Dz.includes(n.type),this.isArtist=n.type===_.Sr.artist)}}function ln(o,n){1&o&&(t.TgZ(0,"div",2)(1,"div",3),t._UZ(2,"i",4),t.qZA()())}function dn(o,n){1&o&&(t.TgZ(0,"div",3),t._uU(1,"No Hints"),t.qZA())}function gn(o,n){if(1&o&&(t.TgZ(0,"div",3),t._UZ(1,"i",9),t._uU(2),t.TgZ(3,"div",10),t._uU(4),t.qZA()()),2&o){const e=n.$implicit;t.xp6(2),t.hij(" ",e.hint.name," "),t.xp6(2),t.Oqu(e.description)}}function hn(o,n){1&o&&t._UZ(0,"i",4)}function pn(o,n){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.name)}}function _n(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.KtG(l.click())}),t.YNc(1,hn,1,0,"i",12),t.YNc(2,pn,2,1,"ng-container",0),t.qZA()}if(2&o){const e=n.$implicit;t.xp6(1),t.Q6J("ngIf",e.running),t.xp6(1),t.Q6J("ngIf",!e.running)}}function un(o,n){if(1&o&&(t.TgZ(0,"div",2),t.YNc(1,dn,2,0,"div",5),t.YNc(2,gn,5,2,"div",6),t.TgZ(3,"div",7),t.YNc(4,_n,3,2,"button",8),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",0===e.hints.length),t.xp6(1),t.Q6J("ngForOf",e.hints)("ngForTrackBy",e.trackByFn),t.xp6(2),t.Q6J("ngForOf",e.solutions)}}function mn(o,n){if(1&o&&(t.ynx(0),t.YNc(1,ln,3,0,"div",1),t.YNc(2,un,5,4,"div",1),t.BQk()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!(e.trackHealth.health&&e.hints)),t.xp6(1),t.Q6J("ngIf",e.trackHealth.health&&e.hints)}}(0,a.Z)(Tt,"\u0275fac",function(n){return new(n||Tt)(t.Y36(A.gz),t.Y36(m.zi),t.Y36(_.K4),t.Y36(m.c),t.Y36(q.Hr),t.Y36(Y.SL),t.Y36(m.Cr),t.Y36(A.F0))}),(0,a.Z)(Tt,"\u0275cmp",t.Xpm({type:Tt,selectors:[["app-admin-folder"]],features:[t.qOj],decls:2,vars:2,consts:[[4,"ngIf"],["class","folder",4,"ngIf"],[1,"folder"],[1,"actions"],["title","Refresh",1,"button-on-control",3,"click"],[1,"icon-reload"],["title","Move Folder\u2026",1,"button-on-control",3,"click"],[1,"icon-right-bold"],["title","Remove Folder\u2026",1,"button-on-control",3,"click"],[1,"icon-trash"],[1,"content"],[3,"info",4,"ngIf"],[1,"properties"],[1,"label"],["type","text",3,"ngModel","ngModelChange","endEditRequest"],[1,"artworks"],[1,"button-on-control",3,"click"],[1,"icon-upload-cloud"],["class","button-on-control","title","Album Images",3,"click",4,"ngIf"],["class","button-on-control","title","Artist Images",3,"click",4,"ngIf"],["class","artworks-content",4,"ngIf"],[3,"info"],["target","_blank","rel","noopener",3,"href"],[3,"routerLink"],["title","Album Images",1,"button-on-control",3,"click"],[1,"icon-picture"],["title","Artist Images",1,"button-on-control",3,"click"],[1,"artworks-content"],[3,"folderID","artworks"]],template:function(n,e){1&n&&(t.YNc(0,je,1,0,"app-loading",0),t.YNc(1,cn,49,16,"div",1)),2&n&&(t.Q6J("ngIf",!e.folder),t.xp6(1),t.Q6J("ngIf",e.folder))},dependencies:[O.O5,Be.a,E.N,x.JJ,x.On,A.rH,ut,lt],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow:hidden;display:block}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{overflow-y:auto;display:flex;flex-direction:column}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%]{width:100%;display:flex;flex-wrap:wrap;flex-direction:row;padding:15px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:0 0 50%}@media (max-width: 522px){[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:0 0 100%}}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding-top:5px;padding-bottom:5px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{color:var(--on-background-active)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-active)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--on-background);font-size:.7em;text-transform:uppercase;padding-bottom:2px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .artworks[_ngcontent-%COMP%]{border-top:1px solid var(--background-border)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .artworks[_ngcontent-%COMP%]   .artworks-content[_ngcontent-%COMP%]{padding:0 15px 15px}"]}));class dt{constructor(n,e,i,r,l){(0,a.Z)(this,"app",void 0),(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"folderService",void 0),(0,a.Z)(this,"router",void 0),(0,a.Z)(this,"hints",void 0),(0,a.Z)(this,"solutions",[]),(0,a.Z)(this,"trackHealth",void 0),(0,a.Z)(this,"resolvedEvent",new t.vpe),(0,a.Z)(this,"unsubscribe",new N.x),this.app=n,this.jam=e,this.notify=i,this.folderService=r,this.router=l}trackByFn(n,e){return e.hint.id}ngOnChanges(n){this.display(this.trackHealth)}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}ngOnInit(){this.folderService.tracksChange.pipe((0,F.R)(this.unsubscribe)).subscribe(n=>{const e=this.trackHealth;e&&e.track.id===n.id&&(e.health=[],this.jam.track.health({ids:[e.track.id],healthMedia:!0}).then(i=>{const r=i.find(l=>l.track.id===e.track.id);r&&r.health?(e.track=r.track,e.health=r.health):e.health=[],0===e.health.length&&this.resolvedEvent.emit(),this.display(e)}).catch(i=>{this.notify.error(i)}))})}fixAll(){for(const n of this.solutions)n.fixable&&!n.running&&n.click&&n.click()}display(n){this.hints=[],this.solutions=[],n?.health&&(this.hints=n.health.map(e=>({hint:e,description:this.describeHint(e,n.track)})))}describeTagHint(n,e){let i="";return n.id===_.U.tagValuesExists?i=(n.details||[]).map(r=>r.reason.toUpperCase()).join(", "):n.id===_.U.id3v2Garbage?i=(n.details||[]).map(r=>r.reason).join(", "):n.id===_.U.id3v2Valid&&(i=(n.details||[]).map(r=>r.expected&&r.actual?`${r.reason}  (${r.actual} instead of ${r.expected})`:r.reason).join(", ")),this.solutions.find(r=>"Edit Tag"===r.name)||this.solutions.push({name:"Edit Tag",click:()=>{this.router.navigate([`/admin/folder/${e.parentID}/tags`]).catch(l=>{console.error(l)})}}),i}describeMp3GarbageHint(n,e){let i="";if(n.details&&n.details.length>0&&(i=`${n.details[0].reason} (${n.details[0].actual} bytes)`),!this.solutions.find(r=>"Fix MP3"===r.name)){const r={name:"Fix MP3",fixable:!0,click:()=>{r.running||(r.running=!0,this.jam.track.fix({id:e.id,fixID:n.id}).then(l=>{this.folderService.waitForQueueResult("Fixing Track MP3",l,[],[],[e.id])}).catch(l=>{this.notify.error(l)}))}};this.solutions.push(r)}return i}describeMp3ErrorHint(n,e){const i=`Stream Errors: ${(n.details||[]).length}`;if(!this.solutions.find(r=>"Fix Stream"===r.name)){const r={name:"Fix Stream",fixable:!0,click:()=>{r.running||(r.running=!0,this.jam.track.fix({id:e.id,fixID:n.id}).then(l=>{this.folderService.waitForQueueResult("Fixing Track Stream",l,[],[],[e.id])}).catch(l=>{this.notify.error(l)}))}};this.solutions.push(r)}return i}describeID3v1Hint(n,e){if(!this.solutions.find(i=>"Remove ID3v1"===i.name)){const i={name:"Remove ID3v1",fixable:!0,click:()=>{i.running||(i.running=!0,this.jam.track.fix({id:e.id,fixID:n.id}).then(r=>{this.folderService.waitForQueueResult("Remove ID3v1",r,[],[],[e.id])}).catch(r=>{this.notify.error(r)}))}};this.solutions.push(i)}return""}describeMP3HeaderHint(n,e){let i="";if(n.id===_.U.mp3HeaderValid&&(i=(n.details||[]).map(r=>r.expected&&r.actual?`${r.reason}  (${r.actual} instead of ${r.expected})`:r.reason).join(", ")),!this.solutions.find(r=>"Fix Header"===r.name)){const r={name:"Fix Header",fixable:!0,click:()=>{r.running||(r.running=!0,this.jam.track.fix({id:e.id,fixID:n.id}).then(l=>{this.folderService.waitForQueueResult("Fixing Track Header",l,[],[],[e.id])}).catch(l=>{this.notify.error(l)}))}};this.solutions.push(r)}return i}describeHint(n,e){switch(n.id){case _.U.tagValuesExists:case _.U.id3v2Garbage:case _.U.id3v2Exists:case _.U.id3v2Valid:return this.describeTagHint(n,e);case _.U.mp3Garbage:return this.describeMp3GarbageHint(n,e);case _.U.mp3MediaValid:return this.describeMp3ErrorHint(n,e);case _.U.id3v2NoId3v1:return this.describeID3v1Hint(n,e);case _.U.mp3HeaderExists:case _.U.mp3HeaderValid:return this.describeMP3HeaderHint(n,e)}return""}}function fn(o,n){1&o&&t._UZ(0,"app-loading")}function Cn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",9)(1,"div",10),t._uU(2),t.qZA(),t.TgZ(3,"div",11)(4,"app-track-health",12),t.NdJ("resolvedEvent",function(){const l=t.CHM(e).$implicit,u=t.oxw();return t.KtG(u.trackHealthResolved(l))}),t.qZA()()()}if(2&o){const e=n.$implicit;t.xp6(2),t.hij(" ",e.track.name," "),t.xp6(2),t.Q6J("trackHealth",e)}}(0,a.Z)(dt,"\u0275fac",function(n){return new(n||dt)(t.Y36(m.zi),t.Y36(_.K4),t.Y36(m.c),t.Y36(m.Cr),t.Y36(A.F0))}),(0,a.Z)(dt,"\u0275cmp",t.Xpm({type:dt,selectors:[["app-track-health"]],inputs:{trackHealth:"trackHealth"},outputs:{resolvedEvent:"resolvedEvent"},features:[t.TTD],decls:1,vars:1,consts:[[4,"ngIf"],["class","hints",4,"ngIf"],[1,"hints"],[1,"hint"],[1,"icon-spin","icon-spinner"],["class","hint",4,"ngIf"],["class","hint",4,"ngFor","ngForOf","ngForTrackBy"],[1,"solutions"],["class","button-on-background",3,"click",4,"ngFor","ngForOf"],[1,"icon-warning"],[1,"details"],[1,"button-on-background",3,"click"],["class","icon-spin icon-spinner",4,"ngIf"]],template:function(n,e){1&n&&t.YNc(0,mn,3,2,"ng-container",0),2&n&&t.Q6J("ngIf",e.trackHealth)},dependencies:[O.sg,O.O5],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .icon-warning[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]{padding-left:28px;font-size:.8em;display:block;padding-top:5px}[_nghost-%COMP%]   .hint[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .solutions[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .solutions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}[_nghost-%COMP%]   .detail[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1.25px;font-size:11px;min-width:80px;margin-right:10px;display:inline-block}"]}));class It extends P{constructor(n,e,i,r,l){super(n),(0,a.Z)(this,"app",void 0),(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"folderService",void 0),(0,a.Z)(this,"all",void 0),(0,a.Z)(this,"hints",void 0),(0,a.Z)(this,"filter",void 0),(0,a.Z)(this,"modes",[]),(0,a.Z)(this,"mediaCheck",!1),this.app=e,this.jam=i,this.notify=r,this.folderService=l}onFilterChange(){this.reDisplay()}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(n=>{n.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}checkChange(){this.refresh()}trackHealthResolved(n){this.all&&(this.all=this.all.filter(e=>e!==n),this.reDisplay())}refresh(){this.hints=void 0,this.id&&this.jam.track.health({folderIDs:[this.id],healthMedia:this.mediaCheck}).then(n=>{this.display(n)}).catch(n=>{this.notify.error(n)})}reDisplay(){this.hints=this.filter&&this.all?this.all.filter(n=>n.health&&n.health.find(e=>e.name===this.filter)):this.all}display(n){this.all=n,this.modes=[];for(const e of n)if(e.health)for(const i of e.health)this.modes.includes(i.name)||this.modes.push(i.name);this.reDisplay()}}(0,a.Z)(It,"\u0275fac",function(n){return new(n||It)(t.Y36(A.gz),t.Y36(m.zi),t.Y36(_.K4),t.Y36(m.c),t.Y36(m.Cr))}),(0,a.Z)(It,"\u0275cmp",t.Xpm({type:It,selectors:[["app-admin-tracks-health"]],features:[t.qOj],decls:11,vars:5,consts:[[1,"health"],[1,"actions"],["title","Refresh List",1,"button-on-control",3,"click"],[1,"icon-reload"],["type","checkbox",3,"ngModel","checked","ngModelChange","change"],[1,"content"],[4,"ngIf"],["name","Track Health Issues",3,"list"],["class","track",4,"ngFor","ngForOf"],[1,"track"],[1,"meta"],[1,"track-health"],[3,"trackHealth","resolvedEvent"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t.NdJ("click",function(){return e.refresh()}),t._UZ(3,"i",3),t.qZA(),t.TgZ(4,"label")(5,"input",4),t.NdJ("ngModelChange",function(r){return e.mediaCheck=r})("change",function(){return e.checkChange()}),t.qZA(),t._uU(6," Check Media "),t.qZA()(),t.TgZ(7,"div",5),t.YNc(8,fn,1,0,"app-loading",6),t._UZ(9,"app-background-text-list",7),t.YNc(10,Cn,5,2,"div",8),t.qZA()()),2&n&&(t.xp6(5),t.Q6J("ngModel",e.mediaCheck)("checked",e.mediaCheck),t.xp6(3),t.Q6J("ngIf",!e.hints),t.xp6(1),t.Q6J("list",e.hints),t.xp6(1),t.Q6J("ngForOf",e.hints))},dependencies:[O.sg,O.O5,D.$,E.N,x.Wl,x.JJ,x.On,dt],styles:["[_nghost-%COMP%]{height:100%;width:100%}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:15px;overflow-y:auto;overflow-x:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]{flex-flow:row nowrap}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{width:30%;overflow:hidden;padding-right:15px;text-overflow:ellipsis}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{width:70%}"]}));var xn=v(6906);function Mn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"tr",13),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.KtG(l.selected=!l.selected)}),t.TgZ(1,"td",4),t._uU(2),t.qZA(),t.TgZ(3,"td",5),t._uU(4),t.qZA(),t.TgZ(5,"td",6),t._uU(6),t.qZA(),t.TgZ(7,"td",7),t._uU(8),t.qZA(),t.TgZ(9,"td",8),t._uU(10),t.qZA(),t.TgZ(11,"td",9),t._uU(12),t.qZA(),t.TgZ(13,"td",10),t._uU(14),t.qZA(),t.TgZ(15,"td",11),t._uU(16),t.ALo(17,"duration"),t.qZA()()}if(2&o){const e=n.$implicit;t.ekj("selected",e.selected),t.xp6(2),t.Oqu(null==e.track.tag?null:e.track.tag.trackNr),t.xp6(2),t.Oqu(null==e.track.tag?null:e.track.tag.title),t.xp6(2),t.Oqu(null==e.track.tag?null:e.track.tag.artist),t.xp6(2),t.Oqu(null==e.track.tag?null:e.track.tag.album),t.xp6(2),t.Oqu(null==e.track.media?null:e.track.media.format),t.xp6(2),t.Oqu(null==e.track.media?null:e.track.media.bitRate),t.xp6(2),t.Oqu(null==e.track.media?null:e.track.media.sampleRate),t.xp6(2),t.Oqu(t.lcZ(17,10,e.track.duration))}}function vn(o,n){if(1&o&&(t.TgZ(0,"table",2)(1,"tr",3)(2,"td",4),t._uU(3,"Track Nr."),t.qZA(),t.TgZ(4,"td",5),t._uU(5,"Title"),t.qZA(),t.TgZ(6,"td",6),t._uU(7,"Artist"),t.qZA(),t.TgZ(8,"td",7),t._uU(9,"Album"),t.qZA(),t.TgZ(10,"td",8),t._uU(11,"Format"),t.qZA(),t.TgZ(12,"td",9),t._uU(13,"BitRate"),t.qZA(),t.TgZ(14,"td",10),t._uU(15,"SampleRate"),t.qZA(),t.TgZ(16,"td",11),t._uU(17,"Duration"),t.qZA()(),t.YNc(18,Mn,18,12,"tr",12),t.qZA()),2&o){const e=t.oxw();t.xp6(18),t.Q6J("ngForOf",e.trackItems)}}class ft{constructor(n){(0,a.Z)(this,"router",void 0),(0,a.Z)(this,"trackItems",void 0),(0,a.Z)(this,"tracks",[]),this.router=n}getSortValue(n,e){switch(n){case"number":return e.track.tag?.trackNr;case"name":return e.track.name;case"artist":return e.track.tag?.artist;case"album":return e.track.tag?.album;case"duration":return e.track.duration;default:return}}ngOnChanges(n){this.trackItems=(this.tracks||[]).map(e=>({track:e}))}toTrackFolder(n){this.router.navigate([`/admin/folder/${n.parentID}/overview`]).catch(e=>{console.error(e)})}}function On(o,n){1&o&&t._UZ(0,"app-loading")}function bn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",3)(1,"div",4)(2,"button",5),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.refresh())}),t._UZ(3,"i",6),t.qZA(),t.TgZ(4,"button",7),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.moveTracks())}),t._UZ(5,"i",8),t.qZA(),t.TgZ(6,"button",9),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.deleteTracks())}),t._UZ(7,"i",10),t.qZA()(),t._UZ(8,"app-admin-track-list",11),t.qZA()}if(2&o){const e=t.oxw();t.xp6(8),t.Q6J("tracks",e.folder.tracks)}}(0,a.Z)(ft,"\u0275fac",function(n){return new(n||ft)(t.Y36(A.F0))}),(0,a.Z)(ft,"\u0275cmp",t.Xpm({type:ft,selectors:[["app-admin-track-list"]],inputs:{tracks:"tracks"},features:[t.TTD],decls:2,vars:2,consts:[["name","Tracks",3,"list"],["class","tracks",4,"ngIf"],[1,"tracks"],[1,"track","heading"],[1,"number"],[1,"title"],[1,"artist"],[1,"album"],[1,"format"],[1,"bitrate"],[1,"samplerate"],[1,"duration"],["class","track",3,"selected","click",4,"ngFor","ngForOf"],[1,"track",3,"click"]],template:function(n,e){1&n&&(t._UZ(0,"app-background-text-list",0),t.YNc(1,vn,19,1,"table",1)),2&n&&(t.Q6J("list",e.tracks),t.xp6(1),t.Q6J("ngIf",e.tracks&&e.tracks.length>0))},dependencies:[O.sg,O.O5,D.$,xn.u],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]{padding:15px;font-size:.8em;width:100%}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{font-size:.9em}[_nghost-%COMP%]   .track[_ngcontent-%COMP%]{border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .track[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .track[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .track.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}"]}));class St extends P{constructor(n,e,i,r,l,u){super(n),(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"folderService",void 0),(0,a.Z)(this,"dialogsService",void 0),(0,a.Z)(this,"dialogOverlay",void 0),(0,a.Z)(this,"folder",void 0),(0,a.Z)(this,"tracks",void 0),this.jam=e,this.notify=i,this.folderService=r,this.dialogsService=l,this.dialogOverlay=u}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(n=>{n.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}deleteTracks(){const n=this.getTrackIDs();0!==n.length&&this.dialogsService.confirm("Remove Tracks?",`Sure to remove ${n.length} Track${n.length>1?"s":""}?`,()=>{for(const e of n)this.jam.track.remove({id:e}).then(i=>{this.folderService.waitForQueueResult("Removing Track",i,[],[],[e])}).catch(i=>{this.notify.error(i)})})}getTrackIDs(){if(!this.tracks?.trackItems||!this.folder?.tracks)return[];const n=this.tracks.trackItems.filter(e=>e.selected).map(e=>e.track.id);return n.length>0?n:this.folder.tracks.map(e=>e.id)}moveTracks(){var n=this;const e=this.getTrackIDs();if(0===e.length)return;const i={selectID:this.id};var r;this.dialogOverlay.open({title:"Move Tracks to",childComponent:z,data:i,panelClass:"overlay-panel-large-buttons",onOkBtn:(r=(0,S.Z)(function*(){const l=i.folder;if(l)return n.jam.track.move({ids:e,folderID:l.id}).then(u=>{n.folderService.waitForQueueResult("Moving Tracks",u,[],[l.id].concat(n.folder?.parentID?[n.folder.parentID]:[]),e)}).catch(u=>{n.notify.error(u)}),Promise.resolve()}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,S.Z)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}refresh(){this.folder=void 0,this.id&&this.jam.folder.id({id:this.id,folderIncTracks:!0,trackIncTag:!0,trackIncMedia:!0}).then(n=>{this.folder=n}).catch(n=>{this.notify.error(n)})}}(0,a.Z)(St,"\u0275fac",function(n){return new(n||St)(t.Y36(A.gz),t.Y36(_.K4),t.Y36(m.c),t.Y36(m.Cr),t.Y36(q.Hr),t.Y36(Y.SL))}),(0,a.Z)(St,"\u0275cmp",t.Xpm({type:St,selectors:[["app-admin-folder-tracks"]],viewQuery:function(n,e){if(1&n&&t.Gf(ft,5),2&n){let i;t.iGM(i=t.CRH())&&(e.tracks=i.first)}},features:[t.qOj],decls:3,vars:3,consts:[[4,"ngIf"],["name","Tracks",3,"list"],["class","tracks",4,"ngIf"],[1,"tracks"],[1,"actions"],["title","Refresh",1,"button-on-control",3,"click"],[1,"icon-reload"],["title","Move Tracks\u2026",1,"button-on-control",3,"click"],[1,"icon-right-bold"],["title","Delete Tracks\u2026",1,"button-on-control",3,"click"],[1,"icon-trash"],[1,"content",3,"tracks"]],template:function(n,e){1&n&&(t.YNc(0,On,1,0,"app-loading",0),t._UZ(1,"app-background-text-list",1),t.YNc(2,bn,9,1,"div",2)),2&n&&(t.Q6J("ngIf",!e.folder),t.xp6(1),t.Q6J("list",null==e.folder?null:e.folder.tracks),t.xp6(1),t.Q6J("ngIf",e.folder&&e.folder.tracks&&e.folder.tracks.length>0))},dependencies:[O.O5,D.$,E.N,ft],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:block;overflow:hidden}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   app-admin-track-list[_ngcontent-%COMP%]{overflow-y:auto}"]}));var Ft=v(5197);function yn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(3);return t.KtG(r.refresh(r.current.pos,!1))}),t._UZ(1,"i",10),t._uU(2," Refresh"),t.qZA()}}function wn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(3);return t.KtG(r.fixAll())}),t._uU(1,"Fix all fixable"),t.qZA()}}function Zn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",5)(1,"button",6),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.start())}),t._UZ(2,"i",7),t._uU(3," Next"),t.qZA(),t.YNc(4,yn,3,0,"button",8),t.YNc(5,wn,2,0,"button",8),t.qZA()}if(2&o){const e=t.oxw(2);t.xp6(4),t.Q6J("ngIf",e.current),t.xp6(1),t.Q6J("ngIf",e.current&&e.current.health&&e.current.health.length>0)}}function Pn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",5)(1,"button",9),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.stop())}),t._UZ(2,"i",11),t._uU(3," Stop"),t.qZA()()}}function An(o,n){if(1&o&&(t.ynx(0),t.YNc(1,Zn,6,2,"div",4),t.YNc(2,Pn,4,0,"div",4),t.BQk()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.searching),t.xp6(1),t.Q6J("ngIf",e.searching)}}function kn(o,n){1&o&&t._UZ(0,"app-loading")}function Tn(o,n){1&o&&t._UZ(0,"i",16)}function In(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",18)(1,"div",19),t._uU(2),t.qZA(),t.TgZ(3,"div",20)(4,"app-track-health",21),t.NdJ("resolvedEvent",function(){const l=t.CHM(e).$implicit,u=t.oxw(3);return t.KtG(u.trackHealthResolved(l))}),t.qZA()()()}if(2&o){const e=n.$implicit;t.xp6(2),t.hij(" ",e.track.name," "),t.xp6(2),t.Q6J("trackHealth",e)}}function Sn(o,n){if(1&o&&(t.ynx(0),t.YNc(1,In,5,2,"div",17),t.BQk()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.current.health)("ngForTrackBy",e.trackByFn)}}const Fn=function(o){return["/admin/folder",o,"tags"]};function Un(o,n){if(1&o&&(t.TgZ(0,"div")(1,"div",12)(2,"span"),t.YNc(3,Tn,1,0,"i",13),t.qZA(),t.TgZ(4,"span"),t._uU(5),t.qZA(),t.TgZ(6,"a",14),t._UZ(7,"i",15),t._uU(8),t.qZA()(),t.YNc(9,Sn,2,2,"ng-container",2),t.qZA()),2&o){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",e.searching),t.xp6(2),t.AsE("",e.current.pos+1," / ",e.folders.length,""),t.xp6(1),t.Q6J("routerLink",t.VKq(6,Fn,e.current.folder.id)),t.xp6(2),t.hij(" ",e.current.folder.name,""),t.xp6(1),t.Q6J("ngIf",e.current.health)}}class ${constructor(n,e,i,r,l,u){(0,a.Z)(this,"app",void 0),(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"uiState",void 0),(0,a.Z)(this,"folderService",void 0),(0,a.Z)(this,"userStorage",void 0),(0,a.Z)(this,"folders",void 0),(0,a.Z)(this,"current",void 0),(0,a.Z)(this,"searching",!1),(0,a.Z)(this,"trackHealthComponents",void 0),(0,a.Z)(this,"unsubscribe",new N.x),this.app=n,this.jam=e,this.notify=i,this.uiState=r,this.folderService=l,this.userStorage=u,u.userChange.pipe((0,F.R)(this.unsubscribe)).subscribe(J=>{this.loadFromStorage()})}trackHealthResolved(n){this.current&&this.current.health&&(this.current.health=this.current.health.filter(e=>e!==n))}trackByFn(n,e){return e.track.id}stop(){this.searching=!1}start(){this.searching||!this.folders||(this.searching=!0,this.request())}request(){if(!this.searching)return;let n=0;this.current&&(n=this.current.pos+1),this.refresh(n,!0)}fixAll(){this.searching||!this.current||!this.trackHealthComponents||this.trackHealthComponents.forEach(n=>{n.fixAll()})}refresh(n,e){this.current=void 0,this.searching=!0;const i=this.folders&&this.folders[n];if(!i)return void(this.searching=!1);const r={folder:i,pos:n};this.current=r,this.userStorage.set($.localStorageName,{folderID:i.id}),this.jam.track.health({folderIDs:[i.id],healthMedia:!0}).then(l=>{l.length>0?(r.health=l,this.searching=!1):e?this.request():(r.health=[],this.searching=!1)}).catch(l=>{this.current=void 0,this.searching=!1,this.notify.error(l)})}ngOnInit(){const n=this.uiState.data["app-admin-radar"];n&&(this.folders=n.folders,this.current=n.current,this.folders)||this.loadFolders()}ngOnDestroy(){this.uiState.data["app-admin-radar"]={folders:this.folders,current:this.current},this.current=void 0,this.searching=!1,this.folders=void 0,this.unsubscribe.next(),this.unsubscribe.complete()}loadFromStorage(){const n=this.userStorage.get($.localStorageName);if(n?.folderID&&this.folders){const e=this.folders.findIndex(i=>i.id===n.folderID);e>=0&&(this.current={folder:this.folders[e],pos:e},this.refresh(e,!1))}}loadFolders(){this.jam.folder.search({folderTypes:[_.Sr.album,_.Sr.multialbum]}).then(n=>{this.folders=n.items,this.loadFromStorage()}).catch(n=>{this.notify.error(n)})}}(0,a.Z)($,"localStorageName","admin.radar"),(0,a.Z)($,"\u0275fac",function(n){return new(n||$)(t.Y36(m.zi),t.Y36(_.K4),t.Y36(m.c),t.Y36(m.JU),t.Y36(m.Cr),t.Y36(m.TZ))}),(0,a.Z)($,"\u0275cmp",t.Xpm({type:$,selectors:[["app-admin-radar"]],viewQuery:function(n,e){if(1&n&&t.Gf(dt,5),2&n){let i;t.iGM(i=t.CRH())&&(e.trackHealthComponents=i)}},decls:6,vars:3,consts:[[1,"radar"],["section","Health Radar"],[4,"ngIf"],[1,"content"],["class","buttons",4,"ngIf"],[1,"buttons"],[1,"button-primary",3,"click"],[1,"icon-play"],["class","button-on-control",3,"click",4,"ngIf"],[1,"button-on-control",3,"click"],[1,"icon-reload"],[1,"icon-stop"],[1,"current"],["class","icon-spin icon-spinner",4,"ngIf"],[3,"routerLink"],[1,"icon-folder"],[1,"icon-spin","icon-spinner"],["class","track",4,"ngFor","ngForOf","ngForTrackBy"],[1,"track"],[1,"meta"],[1,"track-health"],[3,"trackHealth","resolvedEvent"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"app-view-header-slim",1),t.YNc(2,An,3,2,"ng-container",2),t.qZA(),t.TgZ(3,"div",3),t.YNc(4,kn,1,0,"app-loading",2),t.YNc(5,Un,10,8,"div",2),t.qZA()()),2&n&&(t.xp6(2),t.Q6J("ngIf",e.folders),t.xp6(2),t.Q6J("ngIf",!e.folders),t.xp6(1),t.Q6J("ngIf",e.folders&&e.current))},dependencies:[O.sg,O.O5,Ft.p,E.N,A.rH,dt],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{min-width:130px;display:inline-block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]{padding-top:15px;padding-bottom:15px;border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-right:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]{border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{padding-top:15px;padding-bottom:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{padding-left:15px}@media (max-width: 768px){[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{padding-left:0}}"]}));const ie=function(){return{standalone:!0}};function Rn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"form")(1,"div",1)(2,"label",2),t._uU(3,"Root name"),t.qZA(),t.TgZ(4,"input",3),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.edit.name=r)}),t.qZA()(),t.TgZ(5,"div",1)(6,"label",4),t._uU(7,"Path"),t.qZA(),t.TgZ(8,"input",5),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.edit.path=r)}),t.qZA()(),t.TgZ(9,"div",1)(10,"label",6),t._uU(11,"Scan Strategy"),t.qZA(),t.TgZ(12,"fieldset",7)(13,"label",8)(14,"input",9),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.edit.strategy=r)}),t.qZA(),t._uU(15," Auto"),t.qZA(),t.TgZ(16,"label",8)(17,"input",9),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.edit.strategy=r)}),t.qZA(),t._uU(18," Artist/Album"),t.qZA(),t.TgZ(19,"label",8)(20,"input",9),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.edit.strategy=r)}),t.qZA(),t._uU(21," Compilations"),t.qZA(),t.TgZ(22,"label",8)(23,"input",9),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.edit.strategy=r)}),t.qZA(),t._uU(24," Audiobook"),t.qZA()()()()}if(2&o){const e=t.oxw();t.xp6(4),t.Q6J("ngModel",e.edit.name)("ngModelOptions",t.DdM(12,ie)),t.xp6(4),t.Q6J("ngModel",e.edit.path)("ngModelOptions",t.DdM(13,ie)),t.xp6(6),t.Q6J("ngModel",e.edit.strategy)("value",e.RootScanStrategy.auto),t.xp6(3),t.Q6J("ngModel",e.edit.strategy)("value",e.RootScanStrategy.artistalbum),t.xp6(3),t.Q6J("ngModel",e.edit.strategy)("value",e.RootScanStrategy.compilation),t.xp6(3),t.Q6J("ngModel",e.edit.strategy)("value",e.RootScanStrategy.audiobook)}}class Ct{constructor(){(0,a.Z)(this,"edit",void 0),(0,a.Z)(this,"RootScanStrategy",_.hy)}dialogInit(n,e){this.edit=e.data}}(0,a.Z)(Ct,"\u0275fac",function(n){return new(n||Ct)}),(0,a.Z)(Ct,"\u0275cmp",t.Xpm({type:Ct,selectors:[["app-dialog-root"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"root-form-control"],["for","root-name"],["id","root-name","type","text",3,"ngModel","ngModelOptions","ngModelChange"],["for","root-path"],["id","root-path","type","text",3,"ngModel","ngModelOptions","ngModelChange"],["for","strategy"],["id","strategy"],[1,"select"],["type","radio","name","strategy",3,"ngModel","value","ngModelChange"]],template:function(n,e){1&n&&t.YNc(0,Rn,25,14,"form",0),2&n&&t.Q6J("ngIf",e.edit)},dependencies:[O.O5,x._Y,x.Fj,x._,x.JJ,x.JL,x.On,x.F],styles:["[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%;line-height:1.3em;padding:5px;min-width:300px}[_nghost-%COMP%]   input[type=radio][_ngcontent-%COMP%]{margin-right:5px}[_nghost-%COMP%]   .root-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block}[_nghost-%COMP%]   .select[_ngcontent-%COMP%]{margin-right:15px;display:block;font-size:.8em;line-height:1.5em}"]}));var Hn=v(9178);function qn(o,n){1&o&&(t.TgZ(0,"span"),t._uU(1,"Not scanned"),t.qZA())}function Jn(o,n){if(1&o&&(t.TgZ(0,"span",22),t._uU(1,"Error:"),t._UZ(2,"br"),t._uU(3),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(3),t.Oqu(e.status.error)}}function Qn(o,n){1&o&&(t.ynx(0),t._uU(1,"Working\u2026"),t.BQk())}function Dn(o,n){if(1&o&&(t.ynx(0),t._uU(1,"Last Change:"),t._UZ(2,"br"),t._uU(3),t.ALo(4,"date"),t.BQk()),2&o){const e=t.oxw(2).$implicit;t.xp6(3),t.Oqu(t.xi3(4,1,e.status.lastScan,"medium"))}}function Nn(o,n){if(1&o&&(t.TgZ(0,"span"),t.YNc(1,Qn,2,0,"ng-container",11),t.YNc(2,Dn,5,4,"ng-container",11),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",e.status.scanning),t.xp6(1),t.Q6J("ngIf",!e.status.scanning)}}function zn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"tr",10),t.NdJ("dblclick",function(){const l=t.CHM(e).$implicit,u=t.oxw(2);return t.KtG(u.editRoot(l))})("keydown.enter",function(){const l=t.CHM(e).$implicit,u=t.oxw(2);return t.KtG(u.editRoot(l))}),t.TgZ(1,"td",4),t._uU(2),t.qZA(),t.TgZ(3,"td",5),t._uU(4),t.qZA(),t.TgZ(5,"td",6),t._uU(6),t.qZA(),t.TgZ(7,"td",7),t.YNc(8,qn,2,0,"span",11),t.YNc(9,Jn,4,1,"span",12),t.YNc(10,Nn,3,2,"span",11),t.qZA(),t.TgZ(11,"td",8)(12,"div",13)(13,"button",14),t.NdJ("click",function(){const l=t.CHM(e).$implicit,u=t.oxw(2);return t.KtG(u.refreshRoot(l))}),t._UZ(14,"i",15),t.qZA(),t.TgZ(15,"button",16),t.NdJ("click",function(){const l=t.CHM(e).$implicit,u=t.oxw(2);return t.KtG(u.refreshRootMeta(l))}),t._UZ(16,"i",17),t.qZA(),t.TgZ(17,"button",18),t.NdJ("click",function(){const l=t.CHM(e).$implicit,u=t.oxw(2);return t.KtG(u.editRoot(l))}),t._UZ(18,"i",19),t.qZA(),t.TgZ(19,"button",20),t.NdJ("click",function(){const l=t.CHM(e).$implicit,u=t.oxw(2);return t.KtG(u.deleteRoot(l))}),t._UZ(20,"i",21),t.qZA()()()()}if(2&o){const e=n.$implicit;t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.path),t.xp6(2),t.Oqu(e.strategy),t.xp6(2),t.Q6J("ngIf",!e.status),t.xp6(1),t.Q6J("ngIf",e.status&&e.status.error),t.xp6(1),t.Q6J("ngIf",e.status&&!e.status.error)}}function Yn(o,n){if(1&o&&(t.TgZ(0,"table",2)(1,"tr",3)(2,"td",4),t._uU(3,"Name"),t.qZA(),t.TgZ(4,"td",5),t._uU(5,"Path"),t.qZA(),t.TgZ(6,"td",6),t._uU(7,"Strategy"),t.qZA(),t.TgZ(8,"td",7),t._uU(9,"Status"),t.qZA(),t.TgZ(10,"td",8),t._uU(11,"Actions"),t.qZA()(),t.YNc(12,zn,21,6,"tr",9),t.qZA()),2&o){const e=t.oxw();t.xp6(12),t.Q6J("ngForOf",e.roots)}}class Ut{constructor(n,e,i,r,l,u,J){(0,a.Z)(this,"router",void 0),(0,a.Z)(this,"route",void 0),(0,a.Z)(this,"app",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"dialogs",void 0),(0,a.Z)(this,"rootService",void 0),(0,a.Z)(this,"dialogOverlay",void 0),(0,a.Z)(this,"roots",[]),this.router=n,this.route=e,this.app=i,this.notify=r,this.dialogs=l,this.rootService=u,this.dialogOverlay=J}refreshRoot(n){this.rootService.rescanRoot(n)}refreshRootMeta(n){this.rootService.refreshRootMeta(n)}editRoot(n){var e=this;const i={root:n,name:n.name,path:n.path,strategy:n.strategy};var r;this.dialogOverlay.open({title:"Edit Root",childComponent:Ct,data:i,onOkBtn:(r=(0,S.Z)(function*(){try{yield e.rootService.applyDialogRoot(i)}catch(l){return e.notify.error(l),Promise.reject(l)}}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,S.Z)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}deleteRoot(n){this.dialogs.confirm("Delete Root","Do you want to the delete the root folder?",()=>{this.rootService.removeRoot(n)})}}(0,a.Z)(Ut,"\u0275fac",function(n){return new(n||Ut)(t.Y36(A.F0),t.Y36(A.gz),t.Y36(m.zi),t.Y36(m.c),t.Y36(q.Hr),t.Y36(m.Nb),t.Y36(Y.SL))}),(0,a.Z)(Ut,"\u0275cmp",t.Xpm({type:Ut,selectors:[["app-admin-root-list"]],inputs:{roots:"roots"},decls:2,vars:2,consts:[["name","Roots",3,"list"],["class","roots","appFocusKeyList","",4,"ngIf"],["appFocusKeyList","",1,"roots"],[1,"root","heading"],[1,"title"],[1,"path"],[1,"strategy"],[1,"status"],[1,"actions"],["class","root","appFocusKeyListItem","",3,"dblclick","keydown.enter",4,"ngFor","ngForOf"],["appFocusKeyListItem","",1,"root",3,"dblclick","keydown.enter"],[4,"ngIf"],["class","error",4,"ngIf"],[1,"action-buttons"],["title","Rescan Root","appClickStop","",3,"click"],["aria-hidden","true",1,"icon-rescan"],["title","Refresh Root Meta","appClickStop","",3,"click"],["aria-hidden","true",1,"icon-broom"],["title","Edit Root","appClickStop","",3,"click"],["aria-hidden","true",1,"icon-edit"],["title","Delete Root","appClickStop","",3,"click"],["aria-hidden","true",1,"icon-remove"],[1,"error"]],template:function(n,e){1&n&&(t._UZ(0,"app-background-text-list",0),t.YNc(1,Yn,13,1,"table",1)),2&n&&(t.Q6J("list",e.roots),t.xp6(1),t.Q6J("ngIf",e.roots&&e.roots.length>0))},dependencies:[O.sg,O.O5,D.$,Hn.D,w.j,Z.R,O.uU],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .roots[_ngcontent-%COMP%]{padding:15px;font-size:.9em;width:100%}[_nghost-%COMP%]   .root[_ngcontent-%COMP%]{height:60px;border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .root[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .root[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .root.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}[_nghost-%COMP%]   .error[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{height:40px;font-size:.9em}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{width:100px}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px;flex:50%;margin:0;display:inline-block;color:var(--on-control);border:1px solid transparent}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--on-control-active);border:1px solid var(--control-active)}"]}));class Rt{constructor(n,e,i,r,l,u,J){(0,a.Z)(this,"router",void 0),(0,a.Z)(this,"route",void 0),(0,a.Z)(this,"app",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"dialogs",void 0),(0,a.Z)(this,"rootService",void 0),(0,a.Z)(this,"dialogOverlay",void 0),(0,a.Z)(this,"roots",void 0),(0,a.Z)(this,"unsubscribe",new N.x),this.router=n,this.route=e,this.app=i,this.notify=r,this.dialogs=l,this.rootService=u,this.dialogOverlay=J}static getSortValue(n,e){switch(n){case"name":return e.name;case"path":return e.path;default:return}}ngOnInit(){this.rootService.rootsChange.pipe((0,F.R)(this.unsubscribe)).subscribe(n=>{this.roots=(n||[]).sort((e,i)=>e.name.localeCompare(i.name))},n=>{this.notify.error(n)}),this.rootService.refreshRoots()}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}refresh(){this.rootService.refreshRoots()}newRoot(){var n=this;const e={name:"",path:"",strategy:_.hy.auto};var i;this.dialogOverlay.open({title:"New Root",childComponent:Ct,data:e,onOkBtn:(i=(0,S.Z)(function*(){try{yield n.rootService.applyDialogRoot(e)}catch(r){return n.notify.error(r),Promise.reject(r)}}),function(){return i.apply(this,arguments)}),onCancelBtn:function(){var i=(0,S.Z)(function*(){return Promise.resolve()});return function(){return i.apply(this,arguments)}}()})}refreshRoots(){this.rootService.rescanRoots()}}function En(o,n){1&o&&t._UZ(0,"app-loading")}function Ln(o,n){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"div")(2,"div",6),t._uU(3,"Server"),t.qZA(),t.TgZ(4,"div",7)(5,"label")(6,"input",8),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.settings.library.scanAtStart=r)})("ngModelChange",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.onChange())}),t.qZA(),t._uU(7," Scan all Roots on Server Start "),t.qZA()()(),t.TgZ(8,"div")(9,"div",6),t._uU(10,"External Services"),t.qZA(),t.TgZ(11,"div",7)(12,"label")(13,"input",9),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.settings.externalServices.enabled=r)})("ngModelChange",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.onChange())}),t.qZA(),t._uU(14," Allow Request to External Services "),t.qZA()()(),t.TgZ(15,"div")(16,"div",6),t._uU(17,"Chat"),t.qZA(),t.TgZ(18,"div",7)(19,"label",10),t._uU(20,"Maximum Number of Messages"),t.qZA(),t.TgZ(21,"input",11),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.settings.chat.maxMessages=r)})("ngModelChange",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.onChange())}),t.qZA()(),t.TgZ(22,"div",7)(23,"div",12)(24,"label",13),t._uU(25,"Maximum Age of Message"),t.qZA(),t.TgZ(26,"input",14),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.settings.chat.maxAge.value=r)})("ngModelChange",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.onChange())}),t.qZA()(),t.TgZ(27,"select",15),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.settings.chat.maxAge.unit=r)})("ngModelChange",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.onChange())}),t.TgZ(28,"option",16),t._uU(29,"year"),t.qZA(),t.TgZ(30,"option",16),t._uU(31,"years"),t.qZA(),t.TgZ(32,"option",16),t._uU(33,"month"),t.qZA(),t.TgZ(34,"option",16),t._uU(35,"months"),t.qZA(),t.TgZ(36,"option",16),t._uU(37,"day"),t.qZA(),t.TgZ(38,"option",16),t._uU(39,"days"),t.qZA(),t.TgZ(40,"option",16),t._uU(41,"minute"),t.qZA(),t.TgZ(42,"option",16),t._uU(43,"minutes"),t.qZA(),t.TgZ(44,"option",16),t._uU(45,"second"),t.qZA(),t.TgZ(46,"option",16),t._uU(47,"seconds"),t.qZA()()()(),t.TgZ(48,"div")(49,"div",6),t._uU(50,"Artist Index"),t.qZA(),t.TgZ(51,"div",7)(52,"label",17),t._uU(53,"Ignored Articles in Artist Names"),t.qZA(),t.TgZ(54,"textarea",18),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.ignoreArticles=r)})("ngModelChange",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.onChange())}),t.qZA()()(),t.BQk()}if(2&o){const e=t.oxw();t.xp6(6),t.Q6J("ngModel",e.settings.library.scanAtStart),t.xp6(7),t.Q6J("ngModel",e.settings.externalServices.enabled),t.xp6(8),t.Q6J("ngModel",e.settings.chat.maxMessages),t.xp6(5),t.Q6J("ngModel",e.settings.chat.maxAge.value),t.xp6(1),t.Q6J("ngModel",e.settings.chat.maxAge.unit),t.xp6(1),t.Q6J("value","year"),t.xp6(2),t.Q6J("value","years"),t.xp6(2),t.Q6J("value","month"),t.xp6(2),t.Q6J("value","months"),t.xp6(2),t.Q6J("value","day"),t.xp6(2),t.Q6J("value","days"),t.xp6(2),t.Q6J("value","minute"),t.xp6(2),t.Q6J("value","minutes"),t.xp6(2),t.Q6J("value","second"),t.xp6(2),t.Q6J("value","seconds"),t.xp6(8),t.Q6J("ngModel",e.ignoreArticles)}}(0,a.Z)(Rt,"\u0275fac",function(n){return new(n||Rt)(t.Y36(A.F0),t.Y36(A.gz),t.Y36(m.zi),t.Y36(m.c),t.Y36(q.Hr),t.Y36(m.Nb),t.Y36(Y.SL))}),(0,a.Z)(Rt,"\u0275cmp",t.Xpm({type:Rt,selectors:[["app-admin-root"]],decls:11,vars:1,consts:[[1,"roots"],["section","Roots"],[1,"actions"],["title","Refresh",1,"button-on-control",3,"click"],[1,"icon-reload"],["title","New Root\u2026",1,"button-on-control",3,"click"],[1,"icon-plus"],["title","Rescan all Roots",1,"button-on-control",3,"click"],[1,"icon-rescan"],[1,"content"],[3,"roots"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"app-view-header-slim",1)(2,"div",2)(3,"button",3),t.NdJ("click",function(){return e.refresh()}),t._UZ(4,"i",4),t.qZA(),t.TgZ(5,"button",5),t.NdJ("click",function(){return e.newRoot()}),t._UZ(6,"i",6),t.qZA(),t.TgZ(7,"button",7),t.NdJ("click",function(){return e.refreshRoots()}),t._UZ(8,"i",8),t.qZA()()(),t.TgZ(9,"div",9),t._UZ(10,"app-admin-root-list",10),t.qZA()()),2&n&&(t.xp6(10),t.Q6J("roots",e.roots))},dependencies:[Ft.p,Ut],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .roots[_ngcontent-%COMP%]{height:100%;overflow-y:auto;overflow-x:hidden}[_nghost-%COMP%]   .roots[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}"]}));class Ht{constructor(n,e,i){(0,a.Z)(this,"app",void 0),(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"settings",void 0),(0,a.Z)(this,"ignoreArticles",""),this.app=n,this.jam=e,this.notify=i}ngOnInit(){this.refresh()}onChange(){}refresh(){this.jam.admin.settings().then(n=>{this.display(n)}).catch(n=>{this.notify.error(n)})}save(){const n=this.settings;n&&(n.index.ignoreArticles=this.ignoreArticles.split("\n").map(e=>e.trim()).filter(e=>e.length>0),this.settings=void 0,this.jam.admin.settingsUpdate(n).then(()=>{this.notify.success("Settings updated"),this.settings=n}).catch(e=>{this.notify.error(e),this.settings=n}))}display(n){this.settings=n,this.ignoreArticles=n.index.ignoreArticles.join("\n")}}(0,a.Z)(Ht,"\u0275fac",function(n){return new(n||Ht)(t.Y36(m.zi),t.Y36(_.K4),t.Y36(m.c))}),(0,a.Z)(Ht,"\u0275cmp",t.Xpm({type:Ht,selectors:[["app-admin-settings"]],decls:8,vars:2,consts:[[1,"settings"],["section","Admin Settings"],["title","Save",1,"button-on-control",3,"click"],[1,"icon-floppy"],[1,"content"],[4,"ngIf"],[1,"section-title"],[1,"section-entry"],["type","checkbox","title","Scan all Roots on Server Start",3,"ngModel","ngModelChange"],["type","checkbox","title","Allow Request to External Services",3,"ngModel","ngModelChange"],["for","max_messages"],["id","max_messages","type","number",3,"ngModel","ngModelChange"],[1,"chat-max-age"],["for","max_age"],["id","max_age","type","number",3,"ngModel","ngModelChange"],["placeholder","Unit of Age",3,"ngModel","ngModelChange"],[3,"value"],["for","ignore_articles"],["id","ignore_articles","rows","10","cols","20",3,"ngModel","ngModelChange"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"app-view-header-slim",1)(2,"button",2),t.NdJ("click",function(){return e.save()}),t._UZ(3,"i",3),t._uU(4," Save Settings"),t.qZA()(),t.TgZ(5,"div",4),t.YNc(6,En,1,0,"app-loading",5),t.YNc(7,Ln,55,16,"ng-container",5),t.qZA()()),2&n&&(t.xp6(6),t.Q6J("ngIf",!e.settings),t.xp6(1),t.Q6J("ngIf",e.settings))},dependencies:[O.O5,Ft.p,E.N,x.YN,x.Kr,x.Fj,x.wV,x.Wl,x.EJ,x.JJ,x.On],styles:["[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:hidden;height:100%}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:15px 15px 0}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .chat-max-age[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .section-entry[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:12px;padding-bottom:3px}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-top:-1px;display:inline-block;vertical-align:middle}"]}));class xt{}(0,a.Z)(xt,"\u0275fac",function(n){return new(n||xt)}),(0,a.Z)(xt,"\u0275cmp",t.Xpm({type:xt,selectors:[["app-admin-start"]],decls:4,vars:0,consts:[[1,"start"],["section","Administration"],[1,"content"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0),t._UZ(1,"app-view-header-slim",1),t.TgZ(2,"div",2),t._UZ(3,"app-admin-section-cards"),t.qZA()())},styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .start[_ngcontent-%COMP%]{height:100%;overflow-y:auto;overflow-x:hidden}"]}));const gt=function(){return{standalone:!0}};function Bn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div")(1,"form")(2,"div",1)(3,"label",2),t._uU(4,"Name"),t.qZA(),t.TgZ(5,"input",3),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.edit.edit.name=r)}),t.qZA()(),t.TgZ(6,"div",1)(7,"label",4),t._uU(8,"Email"),t.qZA(),t.TgZ(9,"input",5),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.edit.edit.email=r)}),t.qZA()(),t.TgZ(10,"div",6),t._uU(11,"Roles"),t.qZA(),t.TgZ(12,"div",7)(13,"label")(14,"input",8),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.edit.edit.roleAdmin=r)}),t.qZA(),t._uU(15," Administrator "),t.qZA(),t._UZ(16,"br"),t.TgZ(17,"label")(18,"input",9),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.edit.edit.rolePodcast=r)}),t.qZA(),t._uU(19," Manage Podcasts "),t.qZA(),t._UZ(20,"br"),t.TgZ(21,"label")(22,"input",9),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.edit.edit.roleStream=r)}),t.qZA(),t._uU(23," Can Stream/Download "),t.qZA(),t._UZ(24,"br"),t.TgZ(25,"label")(26,"input",10),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.edit.edit.roleUpload=r)}),t.qZA(),t._uU(27," Can Upload "),t.qZA()(),t._UZ(28,"hr"),t.TgZ(29,"div",1),t._UZ(30,"input",11,12),t.TgZ(32,"label",13),t._uU(33,"Your Admin Password"),t.qZA(),t.TgZ(34,"input",14),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.edit.edit.password=r)}),t.qZA()()()()}if(2&o){const e=t.oxw();t.xp6(5),t.Q6J("ngModel",e.edit.edit.name)("ngModelOptions",t.DdM(14,gt)),t.xp6(4),t.Q6J("ngModel",e.edit.edit.email)("ngModelOptions",t.DdM(15,gt)),t.xp6(5),t.Q6J("ngModel",e.edit.edit.roleAdmin)("ngModelOptions",t.DdM(16,gt)),t.xp6(4),t.Q6J("ngModel",e.edit.edit.rolePodcast)("ngModelOptions",t.DdM(17,gt)),t.xp6(4),t.Q6J("ngModel",e.edit.edit.roleStream)("ngModelOptions",t.DdM(18,gt)),t.xp6(4),t.Q6J("ngModel",e.edit.edit.roleUpload)("ngModelOptions",t.DdM(19,gt)),t.xp6(8),t.Q6J("ngModel",e.edit.edit.password)("ngModelOptions",t.DdM(20,gt))}}class Mt{constructor(){(0,a.Z)(this,"edit",void 0)}dialogInit(n,e){this.edit=e.data}}(0,a.Z)(Mt,"\u0275fac",function(n){return new(n||Mt)}),(0,a.Z)(Mt,"\u0275cmp",t.Xpm({type:Mt,selectors:[["app-dialog-user"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"user-form-control"],["for","user-name"],["id","user-name","type","text","name","username",3,"ngModel","ngModelOptions","ngModelChange"],["for","user-mail"],["id","user-mail","type","email","name","mail",3,"ngModel","ngModelOptions","ngModelChange"],[1,"user-form-section"],[1,"user-form-roles"],["type","checkbox","title","Allow User to administrate",3,"ngModel","ngModelOptions","ngModelChange"],["type","checkbox","title","Allow User to manage podcasts",3,"ngModel","ngModelOptions","ngModelChange"],["type","checkbox","title","Allow User to upload files",3,"ngModel","ngModelOptions","ngModelChange"],["type","text","name","user","autocomplete","username",1,"dummy"],["name",""],["for","admin-pass",1,"label-pass"],["id","admin-pass","name","pass","type","password","autocomplete","password",3,"ngModel","ngModelOptions","ngModelChange"]],template:function(n,e){1&n&&t.YNc(0,Bn,35,21,"div",0),2&n&&t.Q6J("ngIf",e.edit)},dependencies:[O.O5,x._Y,x.Fj,x.Wl,x.JJ,x.JL,x.On,x.F],styles:["[_nghost-%COMP%] > div[_ngcontent-%COMP%]{margin-left:15px;margin-right:15px}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%], [_nghost-%COMP%]   input[type=email][_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{line-height:1.3em;padding:5px}[_nghost-%COMP%]   .label-pass[_ngcontent-%COMP%]{padding-right:15px;font-size:.8em}[_nghost-%COMP%]   .dummy[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .user-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block}[_nghost-%COMP%]   .user-form-roles[_ngcontent-%COMP%]{margin-bottom:10px}[_nghost-%COMP%]   .user-form-roles[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{line-height:1.5em}"]}));var jn=v(9100);class qt{constructor(n,e){(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"user",void 0),(0,a.Z)(this,"userAvatar",void 0),(0,a.Z)(this,"hasChanged",!1),(0,a.Z)(this,"unsubscribe",new N.x),this.jam=n,this.notify=e}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}dialogInit(n,e){this.user=e.data,this.setImageSource()}dialogResult(){return this.hasChanged}setImageSource(){this.userAvatar=this.user?`${this.jam.image.imageUrl({id:this.user.id,size:60,format:_.GU.webp})}?${(0,jn.O)()}`:void 0}onDropFile(n){n.preventDefault(),this.uploadFile(n.dataTransfer?.files)}onDragOverFile(n){n.stopPropagation(),n.preventDefault()}selectFile(n){this.uploadFile(n.target.files)}uploadFile(n){n&&0!==n.length&&this.user&&this.jam.user.uploadUserImage({id:this.user.id},n[0]).pipe((0,F.R)(this.unsubscribe)).subscribe(i=>{i.type===W.dt.UploadProgress||i instanceof W.Zn&&(this.setImageSource(),this.hasChanged=!0)},i=>{this.setImageSource(),this.notify.error(i)},()=>{this.notify.success("Upload done")})}}(0,a.Z)(qt,"\u0275fac",function(n){return new(n||qt)(t.Y36(_.K4),t.Y36(m.c))}),(0,a.Z)(qt,"\u0275cmp",t.Xpm({type:qt,selectors:[["app-dialog-avatar"]],decls:6,vars:1,consts:[[1,"drop-zone",3,"drop","dragover"],[1,"root-form-control"],["alt","User Avatar",3,"src"],["type","file","placeholder","Upload image","accept",".png,.jpeg,.jpg",3,"change"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0),t.NdJ("drop",function(r){return e.onDropFile(r)})("dragover",function(r){return e.onDragOverFile(r)}),t.TgZ(1,"form")(2,"div",1),t._UZ(3,"img",2),t.qZA()(),t.TgZ(4,"form")(5,"input",3),t.NdJ("change",function(r){return e.selectFile(r)}),t.qZA()()()),2&n&&(t.xp6(3),t.Q6J("src",e.userAvatar,t.LSH))},dependencies:[x._Y,x.JL,x.F],styles:["[_nghost-%COMP%]   .drop-zone[_ngcontent-%COMP%]{margin:10px 20px;border-width:2px;border-style:dotted;border-color:var(--secondary)}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .root-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block;text-align:center}"]}));const re=function(){return{standalone:!0}};function Kn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",1)(1,"form"),t._UZ(2,"input",2),t.TgZ(3,"label",3),t._uU(4,"Your Admin Password"),t.qZA(),t.TgZ(5,"input",4),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.data.password=r)}),t.qZA()(),t.TgZ(6,"form"),t._UZ(7,"input",5),t.TgZ(8,"label",6),t._uU(9,"New Password for User "),t.TgZ(10,"span"),t._uU(11),t.qZA()(),t.TgZ(12,"input",7),t.NdJ("ngModelChange",function(r){t.CHM(e);const l=t.oxw();return t.KtG(l.data.newPassword=r)}),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(5),t.Q6J("ngModel",e.data.password)("ngModelOptions",t.DdM(5,re)),t.xp6(6),t.Oqu(e.data.user.name),t.xp6(1),t.Q6J("ngModel",e.data.newPassword)("ngModelOptions",t.DdM(6,re))}}class Jt{constructor(){(0,a.Z)(this,"data",void 0)}dialogInit(n,e){this.data=e.data}dialogResult(){return!0}}(0,a.Z)(Jt,"\u0275fac",function(n){return new(n||Jt)}),(0,a.Z)(Jt,"\u0275cmp",t.Xpm({type:Jt,selectors:[["app-dialog-user-pass"]],decls:1,vars:1,consts:[["class","user-form-control",4,"ngIf"],[1,"user-form-control"],["type","text","name","user","autocomplete","username",1,"dummy"],["for","admin-pass"],["id","admin-pass","name","pass","type","password","autocomplete","current-password",3,"ngModel","ngModelOptions","ngModelChange"],["type","text","name","new_name",1,"dummy"],["for","new-pass"],["id","new-pass","name","new_password","autocomplete","off","type","password","autocomplete","new-password",3,"ngModel","ngModelOptions","ngModelChange"]],template:function(n,e){1&n&&t.YNc(0,Kn,13,7,"div",0),2&n&&t.Q6J("ngIf",e.data)},dependencies:[O.O5,x._Y,x.Fj,x.JJ,x.JL,x.On,x.F],styles:["[_nghost-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:10px}[_nghost-%COMP%]   label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .dummy[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{line-height:1.3em;padding:5px;width:100%;margin-bottom:15px}"]}));var Gn=v(7254);function Wn(o,n){1&o&&t._UZ(0,"i",22)}function $n(o,n){1&o&&(t.TgZ(0,"span",23),t._uU(1,"Is Admin"),t.qZA())}function Vn(o,n){1&o&&t._UZ(0,"i",22)}function Xn(o,n){1&o&&(t.TgZ(0,"span",23),t._uU(1,"Can manage podcast"),t.qZA())}function to(o,n){1&o&&t._UZ(0,"i",22)}function eo(o,n){1&o&&(t.TgZ(0,"span",23),t._uU(1,"Can upload"),t.qZA())}function no(o,n){1&o&&t._UZ(0,"i",22)}function oo(o,n){1&o&&(t.TgZ(0,"span",23),t._uU(1,"Can stream"),t.qZA())}function io(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"tr",9),t.NdJ("dblclick",function(){const l=t.CHM(e).$implicit,u=t.oxw(2);return t.KtG(u.editUser(l))})("keydown.enter",function(){const l=t.CHM(e).$implicit,u=t.oxw(2);return t.KtG(u.editUser(l))}),t.TgZ(1,"td",3),t._UZ(2,"app-coverart-image",10),t.qZA(),t.TgZ(3,"td",4),t._uU(4),t.qZA(),t.TgZ(5,"td",5),t._uU(6),t.qZA(),t.TgZ(7,"td",6),t.YNc(8,Wn,1,0,"i",11),t.YNc(9,$n,2,0,"span",12),t.qZA(),t.TgZ(10,"td",6),t.YNc(11,Vn,1,0,"i",11),t.YNc(12,Xn,2,0,"span",12),t.qZA(),t.TgZ(13,"td",6),t.YNc(14,to,1,0,"i",11),t.YNc(15,eo,2,0,"span",12),t.qZA(),t.TgZ(16,"td",6),t.YNc(17,no,1,0,"i",11),t.YNc(18,oo,2,0,"span",12),t.qZA(),t.TgZ(19,"td",7)(20,"div",13)(21,"button",14),t.NdJ("click",function(){const l=t.CHM(e).$implicit,u=t.oxw(2);return t.KtG(u.editUserAvatar(l))}),t._UZ(22,"i",15),t.qZA(),t.TgZ(23,"button",16),t.NdJ("click",function(){const l=t.CHM(e).$implicit,u=t.oxw(2);return t.KtG(u.setUserPassword(l))}),t._UZ(24,"i",17),t.qZA(),t.TgZ(25,"button",18),t.NdJ("click",function(){const l=t.CHM(e).$implicit,u=t.oxw(2);return t.KtG(u.editUser(l))}),t._UZ(26,"i",19),t.qZA(),t.TgZ(27,"button",20),t.NdJ("click",function(){const l=t.CHM(e).$implicit,u=t.oxw(2);return t.KtG(u.deleteUser(l))}),t._UZ(28,"i",21),t.qZA()()()()}if(2&o){const e=n.$implicit;t.xp6(2),t.Q6J("coverArtObj",e)("alt",e.name)("size",28)("round",!0),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.email),t.xp6(2),t.Q6J("ngIf",e.roles.admin),t.xp6(1),t.Q6J("ngIf",e.roles.admin),t.xp6(2),t.Q6J("ngIf",e.roles.podcast),t.xp6(1),t.Q6J("ngIf",e.roles.admin),t.xp6(2),t.Q6J("ngIf",e.roles.upload),t.xp6(1),t.Q6J("ngIf",e.roles.admin),t.xp6(2),t.Q6J("ngIf",e.roles.stream),t.xp6(1),t.Q6J("ngIf",e.roles.stream)}}function ro(o,n){if(1&o&&(t.TgZ(0,"table",1)(1,"tr",2)(2,"td",3),t._uU(3,"Avatar"),t.qZA(),t.TgZ(4,"td",4),t._uU(5,"Name"),t.qZA(),t.TgZ(6,"td",5),t._uU(7,"Email"),t.qZA(),t.TgZ(8,"td",6),t._uU(9,"Administrator"),t.qZA(),t.TgZ(10,"td",6),t._uU(11,"Manage Podcasts"),t.qZA(),t.TgZ(12,"td",6),t._uU(13,"Can Upload"),t.qZA(),t.TgZ(14,"td",6),t._uU(15,"Can Stream"),t.qZA(),t.TgZ(16,"td",7),t._uU(17,"Actions"),t.qZA()(),t.YNc(18,io,29,14,"tr",8),t.qZA()),2&o){const e=t.oxw();t.xp6(18),t.Q6J("ngForOf",e.users)}}class Qt{constructor(n,e,i,r,l,u,J){(0,a.Z)(this,"router",void 0),(0,a.Z)(this,"route",void 0),(0,a.Z)(this,"app",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"dialogs",void 0),(0,a.Z)(this,"userService",void 0),(0,a.Z)(this,"dialogOverlay",void 0),(0,a.Z)(this,"users",[]),(0,a.Z)(this,"unsubscribe",new N.x),this.router=n,this.route=e,this.app=i,this.notify=r,this.dialogs=l,this.userService=u,this.dialogOverlay=J}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}editUser(n){var e=this;const i={user:n,edit:{password:"",name:n.name,email:n.email||"",roleAdmin:n.roles.admin,rolePodcast:n.roles.podcast,roleStream:n.roles.stream,roleUpload:n.roles.upload}};var r;this.dialogOverlay.open({childComponent:Mt,title:"Edit User",data:i,onOkBtn:(r=(0,S.Z)(function*(){try{yield e.userService.applyDialogUser(i),e.notify.success("User edited")}catch(l){return e.notify.error(l),Promise.reject(l)}}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,S.Z)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}editUserAvatar(n){this.dialogOverlay.open({childComponent:qt,title:"Edit User Avatar",data:n}).afterClosed().pipe((0,F.R)(this.unsubscribe)).subscribe(()=>{this.userService.refreshUser(n.id)})}setUserPassword(n){var e=this;const i={user:n,password:"",newPassword:""};var r;this.dialogOverlay.open({childComponent:Jt,title:"Set User Password",data:i,onOkBtn:(r=(0,S.Z)(function*(){try{yield e.userService.setPassword(n.id,i.password,i.newPassword),e.notify.success("Password changed")}catch(l){return e.notify.error(l),Promise.reject(l)}}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,S.Z)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}deleteUser(n){this.dialogs.confirm("Delete User","Do you want to the delete the user?",()=>{this.userService.removeUser(n).then(()=>{this.notify.success("User deleted")}).catch(e=>{this.notify.error(e)})})}}(0,a.Z)(Qt,"\u0275fac",function(n){return new(n||Qt)(t.Y36(A.F0),t.Y36(A.gz),t.Y36(m.zi),t.Y36(m.c),t.Y36(q.Hr),t.Y36(m.NZ),t.Y36(Y.SL))}),(0,a.Z)(Qt,"\u0275cmp",t.Xpm({type:Qt,selectors:[["app-admin-user-list"]],inputs:{users:"users"},decls:1,vars:1,consts:[["class","users","appFocusKeyList","",4,"ngIf"],["appFocusKeyList","",1,"users"],[1,"user","heading"],[1,"avatar"],[1,"title"],[1,"email"],[1,"role"],[1,"actions"],["class","user","appFocusKeyListItem","",3,"dblclick","keydown.enter",4,"ngFor","ngForOf"],["appFocusKeyListItem","",1,"user",3,"dblclick","keydown.enter"],[3,"coverArtObj","alt","size","round"],["class","icon-checkmark","aria-hidden","true",4,"ngIf"],["class","visually-hidden",4,"ngIf"],[1,"action-buttons"],["title","Change Avatar",3,"click"],["aria-hidden","true",1,"icon-picture"],["title","Set Password",3,"click"],["aria-hidden","true",1,"icon-key"],["title","Edit User",3,"click"],["aria-hidden","true",1,"icon-edit"],["title","Delete User",3,"click"],["aria-hidden","true",1,"icon-remove"],["aria-hidden","true",1,"icon-checkmark"],[1,"visually-hidden"]],template:function(n,e){1&n&&t.YNc(0,ro,19,1,"table",0),2&n&&t.Q6J("ngIf",e.users&&e.users.length>0)},dependencies:[O.sg,O.O5,Gn.A,w.j,Z.R],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]{padding:15px;font-size:.9em;width:100%}[_nghost-%COMP%]   .user[_ngcontent-%COMP%]{height:60px;border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .user[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .user[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .user.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{font-size:.9em;height:40px}[_nghost-%COMP%]   .icon-checkmark[_ngcontent-%COMP%]{color:var(--primary)}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{width:100px}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px;flex:50%;margin:0;display:inline-block;color:var(--on-control);border:1px solid transparent}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--on-control-active);border:1px solid var(--control-active)}"]}));class Dt{constructor(n,e,i,r,l,u){(0,a.Z)(this,"app",void 0),(0,a.Z)(this,"dialogs",void 0),(0,a.Z)(this,"jam",void 0),(0,a.Z)(this,"notify",void 0),(0,a.Z)(this,"userService",void 0),(0,a.Z)(this,"dialogOverlay",void 0),(0,a.Z)(this,"users",void 0),(0,a.Z)(this,"unsubscribe",new N.x),this.app=n,this.dialogs=e,this.jam=i,this.notify=r,this.userService=l,this.dialogOverlay=u}getSortValue(n,e){switch(n){case"name":return e.name;case"email":return e.email;case"roleAdmin":return e.roles.admin?1:0;case"rolePodcast":return e.roles.podcast?1:0;case"roleUpload":return e.roles.upload?1:0;case"roleStream":return e.roles.stream?1:0;default:return}}ngOnInit(){this.userService.usersChange.pipe((0,F.R)(this.unsubscribe)).subscribe(n=>{this.users=(n||[]).sort((e,i)=>e.name.localeCompare(i.name))},n=>{this.notify.error(n)}),this.userService.refreshUsers()}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}refresh(){this.userService.refreshUsers()}newUser(){var n=this;const e={edit:{password:"",name:"",email:"",roleAdmin:!1,rolePodcast:!1,roleStream:!0,roleUpload:!1}};var i;this.dialogOverlay.open({title:"New User",childComponent:Mt,data:e,onOkBtn:(i=(0,S.Z)(function*(){try{yield n.userService.applyDialogUser(e),n.notify.success("User created")}catch(r){return n.notify.error(r),Promise.reject(r)}}),function(){return i.apply(this,arguments)}),onCancelBtn:function(){var i=(0,S.Z)(function*(){return Promise.resolve()});return function(){return i.apply(this,arguments)}}()})}}(0,a.Z)(Dt,"\u0275fac",function(n){return new(n||Dt)(t.Y36(m.zi),t.Y36(q.Hr),t.Y36(_.K4),t.Y36(m.c),t.Y36(m.NZ),t.Y36(Y.SL))}),(0,a.Z)(Dt,"\u0275cmp",t.Xpm({type:Dt,selectors:[["app-admin-users"]],decls:9,vars:1,consts:[[1,"users"],["section","Users"],[1,"actions"],["title","Refresh",1,"button-on-control",3,"click"],[1,"icon-reload"],["title","New User\u2026",1,"button-on-control",3,"click"],[1,"icon-plus"],[1,"content"],[3,"users"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"app-view-header-slim",1)(2,"div",2)(3,"button",3),t.NdJ("click",function(){return e.refresh()}),t._UZ(4,"i",4),t.qZA(),t.TgZ(5,"button",5),t.NdJ("click",function(){return e.newUser()}),t._UZ(6,"i",6),t.qZA()()(),t.TgZ(7,"div",7),t._UZ(8,"app-admin-user-list",8),t.qZA()()),2&n&&(t.xp6(8),t.Q6J("users",e.users))},dependencies:[Ft.p,Qt],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]{height:100%;overflow-y:auto;overflow-x:hidden}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:0 15px 15px}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1.25px;font-size:13.2px;margin-bottom:10px;color:var(--on-control-ambient)}@media (max-width: 522px){[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding-left:10px;padding-right:10px}}"]}));const ne=[{path:"",component:R,children:[{path:"",pathMatch:"full",component:xt,data:{name:"Admin"}},{path:"settings",component:Ht,data:{name:"Admin Settings"}},{path:"root",component:Rt,data:{name:"Roots",icon:"icon-root"}},{path:"user",component:Dt,data:{name:"Users",icon:"icon-user"}},{path:"folder",redirectTo:"folder/"},{path:"folder/:id",component:k,data:{id:"folder",name:"Folders",icon:"icon-folder",link:"folder"},children:[{path:"overview",component:Tt},{path:"health",component:At},{path:"sub-folders",component:ot},{path:"tracks",component:St},{path:"tracks-health",component:It},{path:"tags",loadChildren:(o=(0,S.Z)(function*(){return v.e(867).then(v.bind(v,7867)).then(n=>n.TagEditorModule)}),function(){return o.apply(this,arguments)})}]},{path:"radar",component:$,data:{name:"Health Radar",icon:"icon-health"}}]}],ao=A.Bz.forChild(ne);var o;class $t{constructor(n){(0,a.Z)(this,"route",void 0),(0,a.Z)(this,"id",void 0),(0,a.Z)(this,"unsubscribe",new N.x),this.route=n}ngOnInit(){this.route&&this.route.params.pipe((0,F.R)(this.unsubscribe)).subscribe(n=>{this.resolve(n),this.refresh()})}idChanged(){}refresh(){}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}resolve(n){this.id=n.id,this.idChanged()}}function so(o,n){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=t.oxw(2);t.xp6(1),t.hij("(",e.folderService.current.count,")")}}function co(o,n){if(1&o&&(t.TgZ(0,"div",7)(1,"span",3),t._uU(2,"Other requests in queue:"),t.qZA(),t._uU(3),t.qZA()),2&o){const e=t.oxw(2);t.xp6(3),t.hij(" ",e.folderService.queue.length," ")}}function lo(o,n){if(1&o&&(t.TgZ(0,"div",1)(1,"div",2)(2,"span",3),t._uU(3,"Current:"),t.qZA(),t._UZ(4,"i",4),t._uU(5),t.YNc(6,so,2,1,"ng-container",5),t.qZA(),t.YNc(7,co,4,1,"div",6),t.qZA()),2&o){const e=t.oxw();t.xp6(5),t.hij(" ",e.folderService.current.title," "),t.xp6(1),t.Q6J("ngIf",e.folderService.current.count>1),t.xp6(1),t.Q6J("ngIf",e.folderService.queue.length>0)}}(0,a.Z)($t,"\u0275fac",function(n){return new(n||$t)(t.Y36(A.gz))}),(0,a.Z)($t,"\u0275cmp",t.Xpm({type:$t,selectors:[["app-admin-base-view-id"]],decls:0,vars:0,template:function(n,e){}}));class Nt{constructor(n){(0,a.Z)(this,"folderService",void 0),this.folderService=n}}(0,a.Z)(Nt,"\u0275fac",function(n){return new(n||Nt)(t.Y36(m.Cr))}),(0,a.Z)(Nt,"\u0275cmp",t.Xpm({type:Nt,selectors:[["app-admin-queue-requests"]],decls:1,vars:1,consts:[["class","queue-overlay",4,"ngIf"],[1,"queue-overlay"],[1,"current"],[1,"label"],[1,"icon-spin","icon-spinner"],[4,"ngIf"],["class","other",4,"ngIf"],[1,"other"]],template:function(n,e){1&n&&t.YNc(0,lo,8,3,"div",0),2&n&&t.Q6J("ngIf",e.folderService.current)},dependencies:[O.O5],styles:["[_nghost-%COMP%]   .queue-overlay[_ngcontent-%COMP%]{position:fixed;right:16px;bottom:16px;padding:15px;background-color:var(--control);color:var(--on-control);border:1px solid var(--control-border);z-index:1000}[_nghost-%COMP%]   .queue-overlay[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{text-transform:uppercase;font-size:.8em;letter-spacing:1px;color:var(--on-control-ambient)}[_nghost-%COMP%]   .queue-overlay[_ngcontent-%COMP%]   .other[_ngcontent-%COMP%]{border-top:1px solid var(--background-border)}"]}));var go=v(327);class zt{constructor(){(0,a.Z)(this,"sections",[]);const e=(ne[0].children||[]).filter(i=>i.path&&i.path.length>0&&i.data?.name).map(i=>({link:`/admin/${i.data&&i.data.link?i.data.link:i.path}`,name:i.data?i.data.name:"",icon:i.data&&i.data.icon?i.data.icon:"icon-admin"}));this.sections=[{name:"Administration",entries:e}]}}(0,a.Z)(zt,"\u0275fac",function(n){return new(n||zt)}),(0,a.Z)(zt,"\u0275cmp",t.Xpm({type:zt,selectors:[["app-admin-sidebar"]],decls:1,vars:1,consts:[[3,"sections"]],template:function(n,e){1&n&&t._UZ(0,"app-sidebar",0),2&n&&t.Q6J("sections",e.sections)},dependencies:[go.k],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}"]}));var ho=v(9766);const po=function(o){return["/admin",o]};function _o(o,n){if(1&o&&(t.TgZ(0,"div",1)(1,"div",2),t._UZ(2,"app-iconart-image",3),t.qZA(),t.TgZ(3,"div",4)(4,"a",5),t._uU(5),t.qZA()()()),2&o){const e=n.$implicit;t.Q6J("routerLink",t.VKq(3,po,e.id)),t.xp6(2),t.Q6J("icon",e.icon),t.xp6(3),t.Oqu(e.text)}}class Yt{constructor(){(0,a.Z)(this,"sections",[]),this.sections=(ne[0].children||[]).filter(e=>e.path&&e.path.length>0&&e.data?.name).map(e=>({id:e.data&&e.data.link?e.data.link:e.path,text:e.data?e.data.name:"",icon:e.data&&e.data.icon?e.data.icon:"icon-admin"}))}trackByFn(n,e){return e.id}}(0,a.Z)(Yt,"\u0275fac",function(n){return new(n||Yt)}),(0,a.Z)(Yt,"\u0275cmp",t.Xpm({type:Yt,selectors:[["app-admin-section-cards"]],decls:1,vars:2,consts:[["class","section-card no-hover",3,"routerLink",4,"ngFor","ngForOf","ngForTrackBy"],[1,"section-card","no-hover",3,"routerLink"],[1,"image"],[3,"icon"],[1,"footer"],[1,"footer-content"]],template:function(n,e){1&n&&t.YNc(0,_o,6,5,"div",0),2&n&&t.Q6J("ngForOf",e.sections)("ngForTrackBy",e.trackByFn)},dependencies:[O.sg,ho.B,A.rH],styles:['[_nghost-%COMP%]{display:flex;flex-flow:row wrap}@media (max-width: 768px){[_nghost-%COMP%]{justify-content:space-around}}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{margin:15px;width:calc(25% - 30px);position:relative;overflow:hidden;display:flex;cursor:pointer}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:before{content:"";display:block;margin-top:100%}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{position:absolute;top:1px;padding:5px;transform:translateY(-31px);transition:transform .3s}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]{right:1px;border-bottom-left-radius:3px;cursor:pointer;-webkit-user-select:none;user-select:none}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{left:1px;font-size:.8em;border-bottom-right-radius:3px}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{padding:5px;position:absolute;bottom:1px;left:1px;right:1px;overflow:hidden;height:auto}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:hover   .fav[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:hover   .date[_ngcontent-%COMP%]{transform:translateY(0)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:hover   .footer[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]{background-color:var(--background-transparent);color:var(--on-background-active)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-active)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer-subline[_ngcontent-%COMP%]{display:block;font-size:.8em}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]{height:40px;padding-top:10px;white-space:nowrap}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:5px;margin-right:5px}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{float:right;margin-right:5px}@media (max-width: 1600px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{width:calc(25% - 30px)}}@media (max-width: 1200px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{width:calc(33.3333333333% - 30px)}}@media (max-width: 522px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{width:calc(50% - 30px)}}@media (max-width: 400px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{font-size:.8em}}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{min-height:135px;min-width:135px;display:flex;align-items:center;justify-content:center}']}));class vt{}(0,a.Z)(vt,"\u0275fac",function(n){return new(n||vt)}),(0,a.Z)(vt,"\u0275mod",t.oAB({type:vt})),(0,a.Z)(vt,"\u0275inj",t.cJS({imports:[O.ez,Ot.m,x.u5,tt.t6,st.QG,et.vI,h.Cl,j.In,ao]})),t.B6R(R,function(){return[C.H,A.lC,Nt,zt]},[]),t.B6R(xt,function(){return[Ft.p,Yt]},[])},1687:(Xt,X,v)=>{v.d(X,{VI:()=>R,Cb:()=>F,C6:()=>ht,U_:()=>S,kQ:()=>A,RQ:()=>st,f_:()=>t});var a=v(1180);function O(m,_){if(void 0===m&&void 0===_)throw new Error("Trying to compare two undefined values");if(void 0===m||void 0===_)return 0;const b=String(m),w=String(_),Z=function h(m,_){const b=[];let Z,w=0;for(let T=0;T<=_.length;T++)for(let U=0;U<=m.length;U++)Z=T&&U?m.charAt(U-1)===_.charAt(T-1)?w:Math.min(b[U],b[U-1],w)+1:T+U,w=b[U],b[U]=Z;return b.pop()||0}(b,w);return b.length>w.length?1-Z/b.length:1-Z/w.length}function tt(m,_){const b={};return function x(m,_){const w=_||2,Z=`-${m.toLowerCase().replace(/[^\w, ]+/,"")}-`,T=[];for(let U=0;U<Z.length-w+1;U+=1)T.push(Z.slice(U,U+w));return T}(m,_||2).forEach(Z=>{Z in b?b[Z]+=1:b[Z]=1}),b}function et(m){if("string"!=typeof m)throw new Error("Must use a string as argument to FuzzySet functions");return m.toLowerCase()}class Ot{constructor(_,b,w,Z){(0,a.Z)(this,"version","0.0.1"),(0,a.Z)(this,"arr",void 0),(0,a.Z)(this,"useLevenshtein",void 0),(0,a.Z)(this,"gramSizeLower",void 0),(0,a.Z)(this,"gramSizeUpper",void 0),(0,a.Z)(this,"exactSet",{}),(0,a.Z)(this,"matchDict",{}),(0,a.Z)(this,"items",{}),this.arr=_||[],this.useLevenshtein=b||!0,this.gramSizeLower=w||2,this.gramSizeUpper=Z||3;for(let T=this.gramSizeLower;T<this.gramSizeUpper+1;T+=1)this.items[T]=[];this.arr.forEach(T=>{this.add(T)})}get(_,b){const w=this.getVal(_);return!w&&b?b:w}add(_){if(!(et(_)in this.exactSet))for(let w=this.gramSizeLower;w<this.gramSizeUpper+1;w+=1)this.addVal(_,w)}length(){let _=0;for(const b in this.exactSet)Object.prototype.hasOwnProperty.call(this.exactSet,b)&&(_+=1);return _}isEmpty(){for(const _ in this.exactSet)if(Object.prototype.hasOwnProperty.call(this.exactSet,_))return!1;return!0}values(){const _=[];for(const b in this.exactSet)Object.prototype.hasOwnProperty.call(this.exactSet,b)&&_.push(this.exactSet[b]);return _}getVal(_){const b=et(_),w=this.exactSet[b];if(w)return[[1,w]];for(let Z=this.gramSizeUpper;Z>=this.gramSizeLower;Z-=1){const T=this.getValGram(_,Z);if(T)return T}}getValGram(_,b){const w=et(_),Z={},T=tt(w,b),U=this.items[b];let G,K=0;for(const c in T)if(Object.prototype.hasOwnProperty.call(T,c)){const d=T[c];if(K+=Math.pow(d,2),c in this.matchDict)for(const g of this.matchDict[c]){const p=g[0];G=g[1],p in Z?Z[p]+=d*G:Z[p]=d*G}}if(function j(m){for(const _ in m)if(Object.prototype.hasOwnProperty.call(m,_))return!1;return!0}(Z))return;const L=Math.sqrt(K);let C,H=[];Object.keys(Z).forEach(c=>{C=Z[c];const d=parseInt(c,10);H.push([C/(L*U[d][0]),U[d][1]])});const M=(c,d)=>c[0]<d[0]?1:c[0]>d[0]?-1:0;if(H.sort(M),this.useLevenshtein){const c=[],d=Math.min(50,H.length);for(let g=0;g<d;g+=1)c.push([O(H[g][1],w),H[g][1]]);H=c,H.sort(M)}const s=[];for(const c of H)c[0]===H[0][0]&&s.push([c[0],this.exactSet[c[1]]]);return s}addVal(_,b){const w=et(_),Z=this.items[b]||[],T=Z.length;Z.push(0);const U=tt(w,b);let K=0;for(const L in U)if(Object.prototype.hasOwnProperty.call(U,L)){const H=U[L];K+=Math.pow(H,2),L in this.matchDict?this.matchDict[L].push([T,H]):this.matchDict[L]=[[T,H]]}const G=Math.sqrt(K);Z[T]=[G,w],this.items[b]=Z,this.exactSet[w]=_}}function st(m){return m.split(/[.,\\/ -]/).map(_=>_.trim()).filter(_=>_.length>0)}function t(m){return m.replace(/\.[^/.]+$/,"")}function R(m){return m.substring(m.lastIndexOf(".")+1,m.length)||m}function S(m,_){return _.includes(R(m))}function A(m,_){return m.toString().replace(/:/g," - ").replace(/[?/!\\]/g,_)}function F(m){if(!m)return 0;const b=t(m).split(/[ \-_.:;?!~,`"&|()<>{}[\]\r\n/\\]+/).map(Number).filter(w=>!isNaN(w));return b.length>0?b[0]:0}function ht(m,_){const b=new Ot;b.add(m);const w=b.get(_);return w?w[0][0]:0}},2689:(Xt,X,v)=>{function a(h){let O="";const x=new Uint8Array(h),tt=x.byteLength;for(let j=0;j<tt;j++)O+=String.fromCharCode(x[j]);return window.btoa(O)}v.d(X,{q:()=>a})},1208:(Xt,X,v)=>{v.d(X,{Ll:()=>H,QG:()=>L,ap:()=>G});var a=v(5861),h=v(4650),O=v(1481),x=v(6895);const tt=["wrapper"],j=["sourceImage"];function et(C,M){if(1&C){const s=h.EpF();h.TgZ(0,"img",4,5),h.NdJ("load",function(){h.CHM(s);const d=h.oxw();return h.KtG(d.imageLoadedInView())})("mousedown",function(d){h.CHM(s);const g=h.oxw();return h.KtG(g.startMove(d,g.moveTypes.Drag))})("touchstart",function(d){h.CHM(s);const g=h.oxw();return h.KtG(g.startMove(d,g.moveTypes.Drag))}),h.qZA()}if(2&C){const s=h.oxw();h.Udp("visibility",s.imageVisible?"visible":"hidden")("transform",s.safeTransformStyle),h.ekj("ngx-ic-draggable",!s.disabled&&s.allowMoveImage),h.Q6J("src",s.safeImgDataUrl,h.LSH),h.uIk("alt",s.imageAltText)}}function Ot(C,M){if(1&C){const s=h.EpF();h.ynx(0),h.TgZ(1,"span",9),h.NdJ("mousedown",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"topleft"))})("touchstart",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"topleft"))}),h._UZ(2,"span",10),h.qZA(),h.TgZ(3,"span",11),h._UZ(4,"span",10),h.qZA(),h.TgZ(5,"span",12),h.NdJ("mousedown",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"topright"))})("touchstart",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"topright"))}),h._UZ(6,"span",10),h.qZA(),h.TgZ(7,"span",13),h._UZ(8,"span",10),h.qZA(),h.TgZ(9,"span",14),h.NdJ("mousedown",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"bottomright"))})("touchstart",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"bottomright"))}),h._UZ(10,"span",10),h.qZA(),h.TgZ(11,"span",15),h._UZ(12,"span",10),h.qZA(),h.TgZ(13,"span",16),h.NdJ("mousedown",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"bottomleft"))})("touchstart",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"bottomleft"))}),h._UZ(14,"span",10),h.qZA(),h.TgZ(15,"span",17),h._UZ(16,"span",10),h.qZA(),h.TgZ(17,"span",18),h.NdJ("mousedown",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"top"))})("touchstart",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"top"))}),h.qZA(),h.TgZ(18,"span",19),h.NdJ("mousedown",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"right"))})("touchstart",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"right"))}),h.qZA(),h.TgZ(19,"span",20),h.NdJ("mousedown",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"bottom"))})("touchstart",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"bottom"))}),h.qZA(),h.TgZ(20,"span",21),h.NdJ("mousedown",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"left"))})("touchstart",function(d){h.CHM(s);const g=h.oxw(2);return h.KtG(g.startMove(d,g.moveTypes.Resize,"left"))}),h.qZA(),h.BQk()}}function st(C,M){if(1&C){const s=h.EpF();h.TgZ(0,"div",6),h.NdJ("keydown",function(d){h.CHM(s);const g=h.oxw();return h.KtG(g.keyboardAccess(d))}),h.TgZ(1,"div",7),h.NdJ("mousedown",function(d){h.CHM(s);const g=h.oxw();return h.KtG(g.startMove(d,g.moveTypes.Move))})("touchstart",function(d){h.CHM(s);const g=h.oxw();return h.KtG(g.startMove(d,g.moveTypes.Move))}),h.qZA(),h.YNc(2,Ot,21,0,"ng-container",8),h.qZA()}if(2&C){const s=h.oxw();h.Udp("top",s.cropper.y1,"px")("left",s.cropper.x1,"px")("width",s.cropper.x2-s.cropper.x1,"px")("height",s.cropper.y2-s.cropper.y1,"px")("margin-left","center"===s.alignImage?s.marginLeft:null)("visibility",s.imageVisible?"visible":"hidden"),h.ekj("ngx-ic-round",s.roundCropper),h.xp6(2),h.Q6J("ngIf",!s.hideResizeSquares)}}class t{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(M){Object.keys(M).filter(s=>s in this).forEach(s=>this[s]=M[s]),this.validateOptions()}setOptionsFromChanges(M){Object.keys(M).filter(s=>s in this).forEach(s=>this[s]=M[s].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}var R=(()=>{return(C=R||(R={})).Drag="drag",C.Move="move",C.Resize="resize",C.Pinch="pinch",R;var C})();function ht(C,M){return C/100*M}let m=(()=>{class C{crop(s,c,d,g){const p=this.getImagePosition(s,c,d,g),f=p.x2-p.x1,y=p.y2-p.y1,I=document.createElement("canvas");I.width=f,I.height=y;const k=I.getContext("2d");if(!k)return null;null!=g.backgroundColor&&(k.fillStyle=g.backgroundColor,k.fillRect(0,0,f,y));const P=(g.transform.scale||1)*(g.transform.flipH?-1:1),z=(g.transform.scale||1)*(g.transform.flipV?-1:1),{translateH:nt,translateV:B}=this.getCanvasTranslate(s,c,g),Q=c.transformed;k.setTransform(P,0,0,z,Q.size.width/2+nt,Q.size.height/2+B),k.translate(-p.x1/P,-p.y1/z),k.rotate((g.transform.rotate||0)*Math.PI/180),k.drawImage(Q.image,-Q.size.width/2,-Q.size.height/2);const q={width:f,height:y,imagePosition:p,cropperPosition:{...d}};g.containWithinAspectRatio&&(q.offsetImagePosition=this.getOffsetImagePosition(s,c,d,g));const Y=this.getResizeRatio(f,y,g);return 1!==Y&&(q.width=Math.round(f*Y),q.height=g.maintainAspectRatio?Math.round(q.width/g.aspectRatio):Math.round(y*Y),function F(C,M,s){const c=C.width,d=C.height,g=c/(M=Math.round(M)),p=d/(s=Math.round(s)),f=Math.ceil(g/2),y=Math.ceil(p/2),I=C.getContext("2d");if(I){const k=I.getImageData(0,0,c,d),P=I.createImageData(M,s),z=k.data,nt=P.data;for(let B=0;B<s;B++)for(let Q=0;Q<M;Q++){const q=4*(Q+B*M),Y=B*p;let D=0,E=0,Lt=0,Bt=0,jt=0,Kt=0,Gt=0;const ct=Math.floor(Q*g),te=Math.floor(B*p);let bt=Math.ceil((Q+1)*g),yt=Math.ceil((B+1)*p);bt=Math.min(bt,c),yt=Math.min(yt,d);for(let pt=te;pt<yt;pt++){const ot=Math.abs(Y-pt)/y,ee=Q*g,W=ot*ot;for(let _t=ct;_t<bt;_t++){const Wt=Math.abs(ee-_t)/f,it=Math.sqrt(W+Wt*Wt);if(it>=1)continue;D=2*it*it*it-3*it*it+1;const rt=4*(_t+pt*c);Gt+=D*z[rt+3],Lt+=D,z[rt+3]<255&&(D=D*z[rt+3]/250),Bt+=D*z[rt],jt+=D*z[rt+1],Kt+=D*z[rt+2],E+=D}}nt[q]=Bt/E,nt[q+1]=jt/E,nt[q+2]=Kt/E,nt[q+3]=Gt/Lt}C.width=M,C.height=s,I.putImageData(P,0,0)}}(I,q.width,q.height)),q.base64=I.toDataURL("image/"+g.format,this.getQuality(g)),q}getCanvasTranslate(s,c,d){if("px"===d.transform.translateUnit){const g=this.getRatio(s,c);return{translateH:(d.transform.translateH||0)*g,translateV:(d.transform.translateV||0)*g}}return{translateH:d.transform.translateH?ht(d.transform.translateH,c.transformed.size.width):0,translateV:d.transform.translateV?ht(d.transform.translateV,c.transformed.size.height):0}}getRatio(s,c){return c.transformed.size.width/s.nativeElement.offsetWidth}getImagePosition(s,c,d,g){const p=this.getRatio(s,c),f={x1:Math.round(d.x1*p),y1:Math.round(d.y1*p),x2:Math.round(d.x2*p),y2:Math.round(d.y2*p)};return g.containWithinAspectRatio||(f.x1=Math.max(f.x1,0),f.y1=Math.max(f.y1,0),f.x2=Math.min(f.x2,c.transformed.size.width),f.y2=Math.min(f.y2,c.transformed.size.height)),f}getOffsetImagePosition(s,c,d,g){const y=c.transformed.size.width/s.nativeElement.offsetWidth;let I,k;(g.canvasRotation+c.exifTransform.rotate)%2?(I=(c.transformed.size.width-c.original.size.height)/2,k=(c.transformed.size.height-c.original.size.width)/2):(I=(c.transformed.size.width-c.original.size.width)/2,k=(c.transformed.size.height-c.original.size.height)/2);const P={x1:Math.round(d.x1*y)-I,y1:Math.round(d.y1*y)-k,x2:Math.round(d.x2*y)-I,y2:Math.round(d.y2*y)-k};return g.containWithinAspectRatio||(P.x1=Math.max(P.x1,0),P.y1=Math.max(P.y1,0),P.x2=Math.min(P.x2,c.transformed.size.width),P.y2=Math.min(P.y2,c.transformed.size.height)),P}getResizeRatio(s,c,d){const g=d.resizeToWidth/s,p=d.resizeToHeight/c,f=new Array;d.resizeToWidth>0&&f.push(g),d.resizeToHeight>0&&f.push(p);const y=0===f.length?1:Math.min(...f);return y>1&&!d.onlyScaleDown?y:Math.min(y,1)}getQuality(s){return Math.min(1,Math.max(0,s.imageQuality/100))}}return C.\u0275fac=function(s){return new(s||C)},C.\u0275prov=h.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})(),_=(()=>{class C{resetCropperPosition(s,c,d){if(!s?.nativeElement)return;const g=s.nativeElement;if(d.cropperStaticHeight&&d.cropperStaticWidth)c.x1=0,c.x2=g.offsetWidth>d.cropperStaticWidth?d.cropperStaticWidth:g.offsetWidth,c.y1=0,c.y2=g.offsetHeight>d.cropperStaticHeight?d.cropperStaticHeight:g.offsetHeight;else{const p=Math.min(d.cropperScaledMaxWidth,g.offsetWidth),f=Math.min(d.cropperScaledMaxHeight,g.offsetHeight);if(d.maintainAspectRatio)if(g.offsetWidth/d.aspectRatio<g.offsetHeight){c.x1=0,c.x2=p;const y=p/d.aspectRatio;c.y1=(g.offsetHeight-y)/2,c.y2=c.y1+y}else{c.y1=0,c.y2=f;const y=f*d.aspectRatio;c.x1=(g.offsetWidth-y)/2,c.x2=c.x1+y}else c.x1=0,c.x2=p,c.y1=0,c.y2=f}}move(s,c,d){const g=this.getClientX(s)-c.clientX,p=this.getClientY(s)-c.clientY;d.x1=c.x1+g,d.y1=c.y1+p,d.x2=c.x2+g,d.y2=c.y2+p}resize(s,c,d,g,p){const f=this.getClientX(s)-c.clientX,y=this.getClientY(s)-c.clientY;switch(c.position){case"left":d.x1=Math.min(Math.max(c.x1+f,d.x2-p.cropperScaledMaxWidth),d.x2-p.cropperScaledMinWidth);break;case"topleft":d.x1=Math.min(Math.max(c.x1+f,d.x2-p.cropperScaledMaxWidth),d.x2-p.cropperScaledMinWidth),d.y1=Math.min(Math.max(c.y1+y,d.y2-p.cropperScaledMaxHeight),d.y2-p.cropperScaledMinHeight);break;case"top":d.y1=Math.min(Math.max(c.y1+y,d.y2-p.cropperScaledMaxHeight),d.y2-p.cropperScaledMinHeight);break;case"topright":d.x2=Math.max(Math.min(c.x2+f,d.x1+p.cropperScaledMaxWidth),d.x1+p.cropperScaledMinWidth),d.y1=Math.min(Math.max(c.y1+y,d.y2-p.cropperScaledMaxHeight),d.y2-p.cropperScaledMinHeight);break;case"right":d.x2=Math.max(Math.min(c.x2+f,d.x1+p.cropperScaledMaxWidth),d.x1+p.cropperScaledMinWidth);break;case"bottomright":d.x2=Math.max(Math.min(c.x2+f,d.x1+p.cropperScaledMaxWidth),d.x1+p.cropperScaledMinWidth),d.y2=Math.max(Math.min(c.y2+y,d.y1+p.cropperScaledMaxHeight),d.y1+p.cropperScaledMinHeight);break;case"bottom":d.y2=Math.max(Math.min(c.y2+y,d.y1+p.cropperScaledMaxHeight),d.y1+p.cropperScaledMinHeight);break;case"bottomleft":d.x1=Math.min(Math.max(c.x1+f,d.x2-p.cropperScaledMaxWidth),d.x2-p.cropperScaledMinWidth),d.y2=Math.max(Math.min(c.y2+y,d.y1+p.cropperScaledMaxHeight),d.y1+p.cropperScaledMinHeight);break;case"center":const I=s.scale,k=Math.min(Math.max(p.cropperScaledMinWidth,Math.abs(c.x2-c.x1)*I),p.cropperScaledMaxWidth),P=Math.min(Math.max(p.cropperScaledMinHeight,Math.abs(c.y2-c.y1)*I),p.cropperScaledMaxHeight);d.x1=c.clientX-k/2,d.x2=c.clientX+k/2,d.y1=c.clientY-P/2,d.y2=c.clientY+P/2,d.x1<0?(d.x2-=d.x1,d.x1=0):d.x2>g.width&&(d.x1-=d.x2-g.width,d.x2=g.width),d.y1<0?(d.y2-=d.y1,d.y1=0):d.y2>g.height&&(d.y1-=d.y2-g.height,d.y2=g.height)}p.maintainAspectRatio&&this.checkAspectRatio(c.position,d,g,p)}checkAspectRatio(s,c,d,g){let p=0,f=0;switch(s){case"top":c.x2=c.x1+(c.y2-c.y1)*g.aspectRatio,p=Math.max(c.x2-d.width,0),f=Math.max(0-c.y1,0),(p>0||f>0)&&(c.x2-=f*g.aspectRatio>p?f*g.aspectRatio:p,c.y1+=f*g.aspectRatio>p?f:p/g.aspectRatio);break;case"bottom":c.x2=c.x1+(c.y2-c.y1)*g.aspectRatio,p=Math.max(c.x2-d.width,0),f=Math.max(c.y2-d.height,0),(p>0||f>0)&&(c.x2-=f*g.aspectRatio>p?f*g.aspectRatio:p,c.y2-=f*g.aspectRatio>p?f:p/g.aspectRatio);break;case"topleft":c.y1=c.y2-(c.x2-c.x1)/g.aspectRatio,p=Math.max(0-c.x1,0),f=Math.max(0-c.y1,0),(p>0||f>0)&&(c.x1+=f*g.aspectRatio>p?f*g.aspectRatio:p,c.y1+=f*g.aspectRatio>p?f:p/g.aspectRatio);break;case"topright":c.y1=c.y2-(c.x2-c.x1)/g.aspectRatio,p=Math.max(c.x2-d.width,0),f=Math.max(0-c.y1,0),(p>0||f>0)&&(c.x2-=f*g.aspectRatio>p?f*g.aspectRatio:p,c.y1+=f*g.aspectRatio>p?f:p/g.aspectRatio);break;case"right":case"bottomright":c.y2=c.y1+(c.x2-c.x1)/g.aspectRatio,p=Math.max(c.x2-d.width,0),f=Math.max(c.y2-d.height,0),(p>0||f>0)&&(c.x2-=f*g.aspectRatio>p?f*g.aspectRatio:p,c.y2-=f*g.aspectRatio>p?f:p/g.aspectRatio);break;case"left":case"bottomleft":c.y2=c.y1+(c.x2-c.x1)/g.aspectRatio,p=Math.max(0-c.x1,0),f=Math.max(c.y2-d.height,0),(p>0||f>0)&&(c.x1+=f*g.aspectRatio>p?f*g.aspectRatio:p,c.y2-=f*g.aspectRatio>p?f:p/g.aspectRatio);break;case"center":c.x2=c.x1+(c.y2-c.y1)*g.aspectRatio,c.y2=c.y1+(c.x2-c.x1)/g.aspectRatio;const y=Math.max(0-c.x1,0),I=Math.max(c.x2-d.width,0),k=Math.max(c.y2-d.height,0),P=Math.max(0-c.y1,0);(y>0||I>0||k>0||P>0)&&(c.x1+=k*g.aspectRatio>y?k*g.aspectRatio:y,c.x2-=P*g.aspectRatio>I?P*g.aspectRatio:I,c.y1+=P*g.aspectRatio>I?P:I/g.aspectRatio,c.y2-=k*g.aspectRatio>y?k:y/g.aspectRatio)}}getClientX(s){return s.touches?.[0].clientX||s.clientX||0}getClientY(s){return s.touches?.[0].clientY||s.clientY||0}}return C.\u0275fac=function(s){return new(s||C)},C.\u0275prov=h.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})();let K=(()=>{class C{constructor(){this.autoRotateSupported=function w(){return new Promise(C=>{const M=new Image;M.onload=()=>{C(1===M.width&&2===M.height)},M.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(s,c){return new Promise((d,g)=>{const p=new FileReader;p.onload=f=>{this.loadImage(f.target.result,s.type,c).then(d).catch(g)},p.readAsDataURL(s)})}loadImage(s,c,d){return this.isValidImageType(c)?this.loadBase64Image(s,d):Promise.reject(new Error("Invalid image type"))}isValidImageType(s){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(s)}loadImageFromURL(s,c){return new Promise((d,g)=>{const p=new Image;p.onerror=()=>g,p.onload=()=>{const f=document.createElement("canvas"),y=f.getContext("2d");f.width=p.width,f.height=p.height,y?.drawImage(p,0,0),this.loadBase64Image(f.toDataURL(),c).then(d)},p.crossOrigin="anonymous",p.src=s})}loadBase64Image(s,c){return new Promise((d,g)=>{const p=new Image;p.onload=()=>d({originalImage:p,originalBase64:s}),p.onerror=g,p.src=s}).then(d=>this.transformImageBase64(d,c))}transformImageBase64(s,c){var d=this;return(0,a.Z)(function*(){const g=yield d.autoRotateSupported,p=yield function Z(C){switch("string"==typeof C&&(C=function T(C){const M=new DataView(function U(C){C=C.replace(/^data\:([^\;]+)\;base64,/gim,"");const M=atob(C),s=M.length,c=new Uint8Array(s);for(let d=0;d<s;d++)c[d]=M.charCodeAt(d);return c.buffer}(C));if(65496!==M.getUint16(0,!1))return-2;const s=M.byteLength;let c=2;for(;c<s;){if(M.getUint16(c+2,!1)<=8)return-1;const d=M.getUint16(c,!1);if(c+=2,65505==d){if(1165519206!==M.getUint32(c+=2,!1))return-1;const g=18761==M.getUint16(c+=6,!1);c+=M.getUint32(c+4,g);const p=M.getUint16(c,g);c+=2;for(let f=0;f<p;f++)if(274==M.getUint16(c+12*f,g))return M.getUint16(c+12*f+8,g)}else{if(65280!=(65280&d))break;c+=M.getUint16(c,!1)}}return-1}(C)),C){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(g?-1:s.originalBase64);return s.originalImage&&s.originalImage.complete?d.transformLoadedImage({original:{base64:s.originalBase64,image:s.originalImage,size:{width:s.originalImage.naturalWidth,height:s.originalImage.naturalHeight}},exifTransform:p},c):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(s,c){var d=this;return(0,a.Z)(function*(){const g=c.canvasRotation+s.exifTransform.rotate,p={width:s.original.image.naturalWidth,height:s.original.image.naturalHeight};if(0===g&&!s.exifTransform.flip&&!c.containWithinAspectRatio)return{original:{base64:s.original.base64,image:s.original.image,size:{...p}},transformed:{base64:s.original.base64,image:s.original.image,size:{...p}},exifTransform:s.exifTransform};const f=d.getTransformedSize(p,s.exifTransform,c),y=document.createElement("canvas");y.width=f.width,y.height=f.height;const I=y.getContext("2d");I?.setTransform(s.exifTransform.flip?-1:1,0,0,1,y.width/2,y.height/2),I?.rotate(Math.PI*(g/2)),I?.drawImage(s.original.image,-p.width/2,-p.height/2);const k=y.toDataURL(),P=yield d.loadImageFromBase64(k);return{original:{base64:s.original.base64,image:s.original.image,size:{...p}},transformed:{base64:k,image:P,size:{width:P.width,height:P.height}},exifTransform:s.exifTransform}})()}loadImageFromBase64(s){return new Promise((c,d)=>{const g=new Image;g.onload=()=>c(g),g.onerror=d,g.src=s})}getTransformedSize(s,c,d){const g=d.canvasRotation+c.rotate;if(d.containWithinAspectRatio){if(g%2){const f=s.height/d.aspectRatio;return{width:Math.max(s.height,s.width*d.aspectRatio),height:Math.max(s.width,f)}}{const f=s.width/d.aspectRatio;return{width:Math.max(s.width,s.height*d.aspectRatio),height:Math.max(s.height,f)}}}return g%2?{height:s.width,width:s.height}:{width:s.width,height:s.height}}}return C.\u0275fac=function(s){return new(s||C)},C.\u0275prov=h.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})(),G=(()=>{class C{constructor(s,c,d,g,p){this.cropService=s,this.cropperPositionService=c,this.loadImageService=d,this.sanitizer=g,this.cd=p,this.Hammer=window?.Hammer||null,this.settings=new t,this.setImageMaxSizeRetries=0,this.resizedWhileHidden=!1,this.marginLeft="0px",this.maxSize={width:0,height:0},this.moveTypes=R,this.imageVisible=!1,this.format=this.settings.format,this.transform={},this.maintainAspectRatio=this.settings.maintainAspectRatio,this.aspectRatio=this.settings.aspectRatio,this.resetCropOnAspectRatioChange=this.settings.resetCropOnAspectRatioChange,this.resizeToWidth=this.settings.resizeToWidth,this.resizeToHeight=this.settings.resizeToHeight,this.cropperMinWidth=this.settings.cropperMinWidth,this.cropperMinHeight=this.settings.cropperMinHeight,this.cropperMaxHeight=this.settings.cropperMaxHeight,this.cropperMaxWidth=this.settings.cropperMaxWidth,this.cropperStaticWidth=this.settings.cropperStaticWidth,this.cropperStaticHeight=this.settings.cropperStaticHeight,this.canvasRotation=this.settings.canvasRotation,this.initialStepSize=this.settings.initialStepSize,this.roundCropper=this.settings.roundCropper,this.onlyScaleDown=this.settings.onlyScaleDown,this.imageQuality=this.settings.imageQuality,this.autoCrop=this.settings.autoCrop,this.backgroundColor=this.settings.backgroundColor,this.containWithinAspectRatio=this.settings.containWithinAspectRatio,this.hideResizeSquares=this.settings.hideResizeSquares,this.allowMoveImage=!1,this.cropper={x1:-100,y1:-100,x2:1e4,y2:1e4},this.alignImage=this.settings.alignImage,this.disabled=!1,this.hidden=!1,this.imageCropped=new h.vpe,this.startCropImage=new h.vpe,this.imageLoaded=new h.vpe,this.cropperReady=new h.vpe,this.loadImageFailed=new h.vpe,this.transformChange=new h.vpe,this.reset()}ngOnChanges(s){this.onChangesUpdateSettings(s),this.onChangesInputImage(s),this.loadedImage?.original.image.complete&&(s.containWithinAspectRatio||s.canvasRotation)&&this.loadImageService.transformLoadedImage(this.loadedImage,this.settings).then(c=>this.setLoadedImage(c)).catch(c=>this.loadImageError(c)),(s.cropper||s.maintainAspectRatio||s.aspectRatio)&&(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),!this.maintainAspectRatio||!this.resetCropOnAspectRatioChange&&this.aspectRatioIsCorrect()||!s.maintainAspectRatio&&!s.aspectRatio?s.cropper&&(this.checkCropperPosition(!1),this.doAutoCrop()):this.resetCropperPosition(),this.cd.markForCheck()),s.transform&&(this.transform=this.transform||{},this.setCssTransform(),this.doAutoCrop(),this.cd.markForCheck()),s.hidden&&this.resizedWhileHidden&&!this.hidden&&setTimeout(()=>{this.onResize(),this.resizedWhileHidden=!1})}onChangesUpdateSettings(s){this.settings.setOptionsFromChanges(s),this.settings.cropperStaticHeight&&this.settings.cropperStaticWidth&&this.settings.setOptions({hideResizeSquares:!0,cropperMinWidth:this.settings.cropperStaticWidth,cropperMinHeight:this.settings.cropperStaticHeight,cropperMaxHeight:this.settings.cropperStaticHeight,cropperMaxWidth:this.settings.cropperStaticWidth,maintainAspectRatio:!1})}onChangesInputImage(s){(s.imageChangedEvent||s.imageURL||s.imageBase64||s.imageFile)&&this.reset(),s.imageChangedEvent&&this.isValidImageChangedEvent()&&this.loadImageFile(this.imageChangedEvent.target.files[0]),s.imageURL&&this.imageURL&&this.loadImageFromURL(this.imageURL),s.imageBase64&&this.imageBase64&&this.loadBase64Image(this.imageBase64),s.imageFile&&this.imageFile&&this.loadImageFile(this.imageFile)}isValidImageChangedEvent(){return this.imageChangedEvent?.target?.files?.length>0}setCssTransform(){const s=this.transform?.translateUnit||"%";this.safeTransformStyle=this.sanitizer.bypassSecurityTrustStyle(`translate(${this.transform.translateH||0}${s}, ${this.transform.translateV||0}${s}) scaleX(`+(this.transform.scale||1)*(this.transform.flipH?-1:1)+") scaleY("+(this.transform.scale||1)*(this.transform.flipV?-1:1)+") rotate("+(this.transform.rotate||0)+"deg)")}ngOnInit(){this.settings.stepSize=this.initialStepSize,this.activatePinchGesture()}reset(){this.imageVisible=!1,this.loadedImage=void 0,this.safeImgDataUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",this.moveStart={active:!1,type:null,position:null,x1:0,y1:0,x2:0,y2:0,clientX:0,clientY:0},this.maxSize={width:0,height:0},this.cropper.x1=-100,this.cropper.y1=-100,this.cropper.x2=1e4,this.cropper.y2=1e4}loadImageFile(s){this.loadImageService.loadImageFile(s,this.settings).then(c=>this.setLoadedImage(c)).catch(c=>this.loadImageError(c))}loadBase64Image(s){this.loadImageService.loadBase64Image(s,this.settings).then(c=>this.setLoadedImage(c)).catch(c=>this.loadImageError(c))}loadImageFromURL(s){this.loadImageService.loadImageFromURL(s,this.settings).then(c=>this.setLoadedImage(c)).catch(c=>this.loadImageError(c))}setLoadedImage(s){this.loadedImage=s,this.safeImgDataUrl=this.sanitizer.bypassSecurityTrustResourceUrl(s.transformed.base64),this.cd.markForCheck()}loadImageError(s){console.error(s),this.loadImageFailed.emit()}imageLoadedInView(){null!=this.loadedImage&&(this.imageLoaded.emit(this.loadedImage),this.setImageMaxSizeRetries=0,setTimeout(()=>this.checkImageMaxSizeRecursively()))}checkImageMaxSizeRecursively(){this.setImageMaxSizeRetries>40?this.loadImageFailed.emit():this.sourceImageLoaded()?(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),this.resetCropperPosition(),this.cropperReady.emit({...this.maxSize}),this.cd.markForCheck()):(this.setImageMaxSizeRetries++,setTimeout(()=>this.checkImageMaxSizeRecursively(),50))}sourceImageLoaded(){return this.sourceImage?.nativeElement?.offsetWidth>0}onResize(){this.loadedImage&&(this.hidden?this.resizedWhileHidden=!0:(this.resizeCropperPosition(),this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize()))}activatePinchGesture(){if(this.Hammer){const s=new this.Hammer(this.wrapper.nativeElement);s.get("pinch").set({enable:!0}),s.on("pinchmove",this.onPinch.bind(this)),s.on("pinchend",this.pinchStop.bind(this)),s.on("pinchstart",this.startPinch.bind(this))}else(0,h.X6Q)()&&console.warn("[NgxImageCropper] Could not find HammerJS - Pinch Gesture won't work")}resizeCropperPosition(){const s=this.sourceImage.nativeElement;(this.maxSize.width!==s.offsetWidth||this.maxSize.height!==s.offsetHeight)&&(this.cropper.x1=this.cropper.x1*s.offsetWidth/this.maxSize.width,this.cropper.x2=this.cropper.x2*s.offsetWidth/this.maxSize.width,this.cropper.y1=this.cropper.y1*s.offsetHeight/this.maxSize.height,this.cropper.y2=this.cropper.y2*s.offsetHeight/this.maxSize.height)}resetCropperPosition(){this.cropperPositionService.resetCropperPosition(this.sourceImage,this.cropper,this.settings),this.doAutoCrop(),this.imageVisible=!0}keyboardAccess(s){this.changeKeyboardStepSize(s),this.keyboardMoveCropper(s)}changeKeyboardStepSize(s){const c=+s.key;c>=1&&c<=9&&(this.settings.stepSize=c)}keyboardMoveCropper(s){if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(s.key))return;const d=s.shiftKey?R.Resize:R.Move,g=s.altKey?function A(C){switch(C){case"ArrowUp":return"bottom";case"ArrowRight":return"left";case"ArrowDown":return"top";default:return"right"}}(s.key):function S(C){switch(C){case"ArrowUp":return"top";case"ArrowRight":return"right";case"ArrowDown":return"bottom";default:return"left"}}(s.key),p=function N(C,M){switch(C){case"ArrowUp":return{clientX:0,clientY:-1*M};case"ArrowRight":return{clientX:M,clientY:0};case"ArrowDown":return{clientX:0,clientY:M};default:return{clientX:-1*M,clientY:0}}}(s.key,this.settings.stepSize);s.preventDefault(),s.stopPropagation(),this.startMove({clientX:0,clientY:0},d,g),this.moveImg(p),this.moveStop()}startMove(s,c,d=null){this.disabled||this.moveStart?.active&&this.moveStart?.type===R.Pinch||c===R.Drag&&!this.allowMoveImage||(s.preventDefault&&s.preventDefault(),this.moveStart={active:!0,type:c,position:d,transform:{...this.transform},clientX:this.cropperPositionService.getClientX(s),clientY:this.cropperPositionService.getClientY(s),...this.cropper})}startPinch(s){this.safeImgDataUrl&&(s.preventDefault&&s.preventDefault(),this.moveStart={active:!0,type:R.Pinch,position:"center",clientX:this.cropper.x1+(this.cropper.x2-this.cropper.x1)/2,clientY:this.cropper.y1+(this.cropper.y2-this.cropper.y1)/2,...this.cropper})}moveImg(s){if(this.moveStart.active){if(s.stopPropagation&&s.stopPropagation(),s.preventDefault&&s.preventDefault(),this.moveStart.type===R.Move)this.cropperPositionService.move(s,this.moveStart,this.cropper),this.checkCropperPosition(!0);else if(this.moveStart.type===R.Resize)!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.cropperPositionService.resize(s,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1);else if(this.moveStart.type===R.Drag){const c=this.cropperPositionService.getClientX(s)-this.moveStart.clientX,d=this.cropperPositionService.getClientY(s)-this.moveStart.clientY;this.transform={...this.transform,translateH:(this.moveStart.transform?.translateH||0)+c,translateV:(this.moveStart.transform?.translateV||0)+d},this.setCssTransform()}this.cd.detectChanges()}}onPinch(s){this.moveStart.active&&(s.stopPropagation&&s.stopPropagation(),s.preventDefault&&s.preventDefault(),this.moveStart.type===R.Pinch&&(this.cropperPositionService.resize(s,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1)),this.cd.detectChanges())}setMaxSize(){if(this.sourceImage){const s=this.sourceImage.nativeElement;this.maxSize.width=s.offsetWidth,this.maxSize.height=s.offsetHeight,this.marginLeft=this.sanitizer.bypassSecurityTrustStyle("calc(50% - "+this.maxSize.width/2+"px)")}}setCropperScaledMinSize(){this.loadedImage?.transformed?.image?(this.setCropperScaledMinWidth(),this.setCropperScaledMinHeight()):(this.settings.cropperScaledMinWidth=20,this.settings.cropperScaledMinHeight=20)}setCropperScaledMinWidth(){this.settings.cropperScaledMinWidth=this.cropperMinWidth>0?Math.max(20,this.cropperMinWidth/this.loadedImage.transformed.image.width*this.maxSize.width):20}setCropperScaledMinHeight(){this.settings.cropperScaledMinHeight=this.maintainAspectRatio?Math.max(20,this.settings.cropperScaledMinWidth/this.aspectRatio):this.cropperMinHeight>0?Math.max(20,this.cropperMinHeight/this.loadedImage.transformed.image.height*this.maxSize.height):20}setCropperScaledMaxSize(){if(this.loadedImage?.transformed?.image){const s=this.loadedImage.transformed.size.width/this.maxSize.width;this.settings.cropperScaledMaxWidth=this.cropperMaxWidth>20?this.cropperMaxWidth/s:this.maxSize.width,this.settings.cropperScaledMaxHeight=this.cropperMaxHeight>20?this.cropperMaxHeight/s:this.maxSize.height,this.maintainAspectRatio&&(this.settings.cropperScaledMaxWidth>this.settings.cropperScaledMaxHeight*this.aspectRatio?this.settings.cropperScaledMaxWidth=this.settings.cropperScaledMaxHeight*this.aspectRatio:this.settings.cropperScaledMaxWidth<this.settings.cropperScaledMaxHeight*this.aspectRatio&&(this.settings.cropperScaledMaxHeight=this.settings.cropperScaledMaxWidth/this.aspectRatio))}else this.settings.cropperScaledMaxWidth=this.maxSize.width,this.settings.cropperScaledMaxHeight=this.maxSize.height}checkCropperPosition(s=!1){this.cropper.x1<0&&(this.cropper.x2-=s?this.cropper.x1:0,this.cropper.x1=0),this.cropper.y1<0&&(this.cropper.y2-=s?this.cropper.y1:0,this.cropper.y1=0),this.cropper.x2>this.maxSize.width&&(this.cropper.x1-=s?this.cropper.x2-this.maxSize.width:0,this.cropper.x2=this.maxSize.width),this.cropper.y2>this.maxSize.height&&(this.cropper.y1-=s?this.cropper.y2-this.maxSize.height:0,this.cropper.y2=this.maxSize.height)}moveStop(){this.moveStart.active&&(this.moveStart.active=!1,this.moveStart?.type===R.Drag?this.transformChange.emit(this.transform):this.doAutoCrop())}pinchStop(){this.moveStart.active&&(this.moveStart.active=!1,this.doAutoCrop())}doAutoCrop(){this.autoCrop&&this.crop()}crop(){if(null!=this.loadedImage?.transformed?.image){this.startCropImage.emit();const s=this.cropService.crop(this.sourceImage,this.loadedImage,this.cropper,this.settings);return null!=s&&this.imageCropped.emit(s),s}return null}aspectRatioIsCorrect(){return(this.cropper.x2-this.cropper.x1)/(this.cropper.y2-this.cropper.y1)===this.aspectRatio}}return C.\u0275fac=function(s){return new(s||C)(h.Y36(m),h.Y36(_),h.Y36(K),h.Y36(O.H7),h.Y36(h.sBO))},C.\u0275cmp=h.Xpm({type:C,selectors:[["image-cropper"]],viewQuery:function(s,c){if(1&s&&(h.Gf(tt,7),h.Gf(j,5)),2&s){let d;h.iGM(d=h.CRH())&&(c.wrapper=d.first),h.iGM(d=h.CRH())&&(c.sourceImage=d.first)}},hostVars:6,hostBindings:function(s,c){1&s&&h.NdJ("resize",function(){return c.onResize()},!1,h.Jf7)("mousemove",function(g){return c.moveImg(g)},!1,h.evT)("touchmove",function(g){return c.moveImg(g)},!1,h.evT)("mouseup",function(){return c.moveStop()},!1,h.evT)("touchend",function(){return c.moveStop()},!1,h.evT),2&s&&(h.Udp("text-align",c.alignImage),h.ekj("disabled",c.disabled)("ngx-ix-hidden",c.hidden))},inputs:{imageChangedEvent:"imageChangedEvent",imageURL:"imageURL",imageBase64:"imageBase64",imageFile:"imageFile",imageAltText:"imageAltText",format:"format",transform:"transform",maintainAspectRatio:"maintainAspectRatio",aspectRatio:"aspectRatio",resetCropOnAspectRatioChange:"resetCropOnAspectRatioChange",resizeToWidth:"resizeToWidth",resizeToHeight:"resizeToHeight",cropperMinWidth:"cropperMinWidth",cropperMinHeight:"cropperMinHeight",cropperMaxHeight:"cropperMaxHeight",cropperMaxWidth:"cropperMaxWidth",cropperStaticWidth:"cropperStaticWidth",cropperStaticHeight:"cropperStaticHeight",canvasRotation:"canvasRotation",initialStepSize:"initialStepSize",roundCropper:"roundCropper",onlyScaleDown:"onlyScaleDown",imageQuality:"imageQuality",autoCrop:"autoCrop",backgroundColor:"backgroundColor",containWithinAspectRatio:"containWithinAspectRatio",hideResizeSquares:"hideResizeSquares",allowMoveImage:"allowMoveImage",cropper:"cropper",alignImage:"alignImage",disabled:"disabled",hidden:"hidden"},outputs:{imageCropped:"imageCropped",startCropImage:"startCropImage",imageLoaded:"imageLoaded",cropperReady:"cropperReady",loadImageFailed:"loadImageFailed",transformChange:"transformChange"},features:[h.TTD],decls:5,vars:10,consts:[["wrapper",""],["class","ngx-ic-source-image",3,"src","visibility","transform","ngx-ic-draggable","load","mousedown","touchstart",4,"ngIf"],[1,"ngx-ic-overlay"],["class","ngx-ic-cropper","tabindex","0",3,"ngx-ic-round","top","left","width","height","margin-left","visibility","keydown",4,"ngIf"],[1,"ngx-ic-source-image",3,"src","load","mousedown","touchstart"],["sourceImage",""],["tabindex","0",1,"ngx-ic-cropper",3,"keydown"],[1,"ngx-ic-move",3,"mousedown","touchstart"],[4,"ngIf"],[1,"ngx-ic-resize","ngx-ic-topleft",3,"mousedown","touchstart"],[1,"ngx-ic-square"],[1,"ngx-ic-resize","ngx-ic-top"],[1,"ngx-ic-resize","ngx-ic-topright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-right"],[1,"ngx-ic-resize","ngx-ic-bottomright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-bottom"],[1,"ngx-ic-resize","ngx-ic-bottomleft",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-left"],[1,"ngx-ic-resize-bar","ngx-ic-top",3,"mousedown","touchstart"],[1,"ngx-ic-resize-bar","ngx-ic-right",3,"mousedown","touchstart"],[1,"ngx-ic-resize-bar","ngx-ic-bottom",3,"mousedown","touchstart"],[1,"ngx-ic-resize-bar","ngx-ic-left",3,"mousedown","touchstart"]],template:function(s,c){1&s&&(h.TgZ(0,"div",null,0),h.YNc(2,et,2,8,"img",1),h._UZ(3,"div",2),h.YNc(4,st,3,15,"div",3),h.qZA()),2&s&&(h.Udp("background",c.imageVisible&&c.backgroundColor),h.xp6(2),h.Q6J("ngIf",c.safeImgDataUrl),h.xp6(1),h.Udp("width",c.maxSize.width,"px")("height",c.maxSize.height,"px")("margin-left","center"===c.alignImage?c.marginLeft:null),h.xp6(1),h.Q6J("ngIf",c.imageVisible))},dependencies:[x.O5],styles:['[_nghost-%COMP%]{display:flex;position:relative;width:100%;max-width:100%;max-height:100%;overflow:hidden;padding:5px;text-align:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{width:100%;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image[_ngcontent-%COMP%]{max-width:100%;max-height:100%;transform-origin:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image.ngx-ic-draggable[_ngcontent-%COMP%]{user-drag:none;-webkit-user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;cursor:grab}[_nghost-%COMP%]   .ngx-ic-overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;touch-action:none;outline:var(--cropper-overlay-color, white) solid 100vw;top:0;left:0}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{position:absolute;display:flex;color:#53535c;background:transparent;outline:rgba(255,255,255,.3) solid 100vw;outline:var(--cropper-outline-color, rgba(255, 255, 255, .3)) solid 100vw;touch-action:none}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{outline-width:100vh}}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:after{position:absolute;content:"";inset:0;pointer-events:none;border:dashed 1px;opacity:.75;color:inherit;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{width:100%;cursor:move;border:1px solid rgba(255,255,255,.5)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-move[_ngcontent-%COMP%]{border-color:#1e90ff;border-width:2px}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]{position:absolute;display:inline-block;line-height:6px;padding:8px;opacity:.85;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{display:inline-block;background:#53535C;width:6px;height:6px;border:1px solid rgba(255,255,255,.5);box-sizing:content-box}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topleft[_ngcontent-%COMP%]{top:-12px;left:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-top[_ngcontent-%COMP%]{top:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topright[_ngcontent-%COMP%]{top:-12px;right:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-right[_ngcontent-%COMP%]{top:calc(50% - 12px);right:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomright[_ngcontent-%COMP%]{bottom:-12px;right:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomleft[_ngcontent-%COMP%]{bottom:-12px;left:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-left[_ngcontent-%COMP%]{top:calc(50% - 12px);left:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%]{position:absolute;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-top[_ngcontent-%COMP%]{top:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-right[_ngcontent-%COMP%]{top:11px;right:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-left[_ngcontent-%COMP%]{top:11px;left:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]{outline-color:transparent}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{border-radius:100%;box-shadow:0 0 0 100vw #ffffff4d;box-shadow:0 0 0 100vw var(--cropper-outline-color, rgba(255, 255, 255, .3))}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{box-shadow:0 0 0 100vh #ffffff4d;box-shadow:0 0 0 100vh var(--cropper-outline-color, rgba(255, 255, 255, .3))}}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{border-radius:100%}.disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{display:none}.ngx-ix-hidden[_nghost-%COMP%]{display:none}'],changeDetection:0}),C})(),L=(()=>{class C{}return C.\u0275fac=function(s){return new(s||C)},C.\u0275mod=h.oAB({type:C}),C.\u0275inj=h.cJS({imports:[[x.ez]]}),C})();function H(C){const M=C.split(","),s=M[0].replace("data:","").replace(";base64",""),c=atob(M[1]),d=new ArrayBuffer(c.length),g=new Uint8Array(d);for(let p=0;p<c.length;p+=1)g[p]=c.charCodeAt(p);return new Blob([d],{type:s})}}}]);