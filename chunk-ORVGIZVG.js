import{a as q}from"./chunk-K7RVMPTP.js";import{a as K}from"./chunk-DYCPZPVS.js";import{k as X}from"./chunk-AQDYGNZB.js";import{G as C}from"./chunk-ZVKVGF76.js";import{$d as v,Aa as E,Hb as T,Ib as F,Ic as V,Jb as R,Lb as w,Lc as U,Ld as r,Mb as k,Nb as D,Ob as S,Pb as x,Rb as I,Sb as P,Tb as j,Ub as N,Uc as z,Vb as A,Vc as H,_b as u,_c as J,ab as f,ac as L,da as p,dc as $,e as s,ec as b,fc as h,ia as c,na as m,nb as d,oa as g,sc as y,tc as G,ub as M,vc as B}from"./chunk-H2EXZDP6.js";function Y(n,i){if(n&1){let l=u();I(0,"i",2),b("click",function(){let e=m(l).$index,a=h();return g(a.mark(e))}),P()}if(n&2){let l=i.$implicit;y(l)}}var Q=(()=>{let i=class i{constructor(){this.rating=J(0),this.hasRated=z(),this.maxScore=5,this.range=[],this.marked=-1,this.allowHalf=!1}ngOnInit(){this.updateUI()}updateUI(){this.range=[];for(let t=0;t<this.maxScore;t++)this.range.push(this.markerClass(t))}mark(t){let e=t;this.marked===t?e=t-(this.allowHalf?.5:1):this.allowHalf&&this.marked===t-.5&&(e=t-1),this.marked=e,this.rating.set(this.marked+1),this.updateUI(),this.hasRated.emit(this.rating()??0)}markerClass(t){return t<=this.marked?"icon-star-full":t<this.marked+1?"icon-star-half":"icon-star-empty"}ngOnChanges(){this.marked=(this.rating()??0)-1,this.updateUI()}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=d({type:i,selectors:[["app-rate"]],inputs:{rating:[1,"rating"]},outputs:{rating:"ratingChange",hasRated:"hasRated"},features:[E],decls:3,vars:0,consts:[[1,"star-rating"],[3,"class"],[3,"click"]],template:function(e,a){e&1&&(I(0,"span",0),w(1,Y,1,2,"i",1,R),P()),e&2&&(f(),k(a.range))},styles:["[_nghost-%COMP%]   .star-rating[_ngcontent-%COMP%]{cursor:pointer;padding:0 3px}[_nghost-%COMP%]   .star-rating[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.3em;color:orange;margin-left:2px;margin-right:2px}"]});let n=i;return n})();function Z(n,i){if(n&1){let l=u();S(0,"app-rate",1),$("hasRated",function(e){m(l);let a=h();return g(a.onRated(e))}),x(),N(1),L(2,0),A(),G(3)}if(n&2){let l=h();D("rating",l.data.rating),f(3),B(" ",l.data.rating,`
`)}}var W=(()=>{let i=class i{dialogInit(t,e){this.data=e.data}onRated(t){this.data&&(this.data.rating=t)}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=d({type:i,selectors:[["app-dialog-rate"]],decls:1,vars:1,consts:()=>{let t;return t=$localize`:␟758496ccd0c37659b18828f3234eac3915c1a32f␟5087122090521808199:Rating:`,[t,[3,"hasRated","rating"]]},template:function(e,a){e&1&&T(0,Z,4,2),e&2&&F(a.data?0:-1)},dependencies:[Q],styles:["[_nghost-%COMP%]   .star-rating[_ngcontent-%COMP%]{cursor:pointer;padding:0 3px}[_nghost-%COMP%]   .star-rating[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.3em;color:orange}"]});let n=i;return n})();var ht=(()=>{let i=class i{constructor(){this.jam=c(v),this.notify=c(C),this.dialogOverlay=c(X)}rateTrack(t){this.rate(r.track,t)}rateAlbum(t){this.rate(r.album,t)}rateArtist(t){this.rate(r.artist,t)}rateSeries(t){this.rate(r.series,t)}rateFolder(t){this.rate(r.folder,t)}rateEpisode(t){this.rate(r.episode,t)}ratePodcast(t){this.rate(r.podcast,t)}rate(t,e){let a={rating:e.state?.rated??0,id:e.id};this.dialogOverlay.open({childComponent:W,data:a,onOkBtn:()=>s(this,null,function*(){try{let o=a.rating;if(o===void 0)return;yield this.jam.state.rate({id:e.id,rating:o});let O=e.state??{};O.rated=o,e.state=O,this.notify.success(`Rated ${t}`)}catch(o){return this.notify.error(o),Promise.reject(o)}})})}toggleFav(t,e){return s(this,null,function*(){e.state=e.state??{};let a=!!e.state.faved;try{yield this.jam.state.fav({id:e.id,remove:a}),e.state.faved=a?void 0:Date.now(),this.notify.success(`Favorite ${t} ${a?"removed":"added"}`)}catch(o){this.notify.error(o)}})}toggleFolderFav(t){return s(this,null,function*(){return this.toggleFav(r.folder,t)})}toggleMediaBaseFav(t){return s(this,null,function*(){return this.toggleFav(t.objType,t)})}toggleAlbumFav(t){return s(this,null,function*(){return this.toggleFav(r.album,t)})}toggleGenreFav(t){return s(this,null,function*(){return this.toggleFav(r.genre,t)})}toggleArtistFav(t){return s(this,null,function*(){return this.toggleFav(r.artist,t)})}toggleSeriesFav(t){return s(this,null,function*(){return this.toggleFav(r.series,t)})}togglePlaylistFav(t){return s(this,null,function*(){return this.toggleFav(r.playlist,t)})}togglePodcastFav(t){return s(this,null,function*(){return this.toggleFav(r.podcast,t)})}download(t){t&&(globalThis.location.href=this.jam.download.downloadUrl({id:t.id}))}};i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=p({token:i,factory:i.\u0275fac});let n=i;return n})();var Ct=(()=>{let i=class i{constructor(){this.playlistsChange=new M,this.playlistChange=new K,this.jam=c(v),this.notify=c(C),this.playlists=[]}remove(t){return s(this,null,function*(){yield this.jam.playlist.remove({id:t.id}),this.playlists=this.playlists.filter(e=>e.id!==t.id),this.playlistsChange.emit(this.playlists),this.playlistChange.emit(t.id,void 0)})}savePlaylist(t,e){this.jam.playlist.update({id:t.id,name:t.name,isPublic:t.isPublic,mediaIDs:e}).then(()=>{this.notify.success("Playlist updated"),this.refreshPlaylist(t.id)}).catch(a=>{this.notify.error(a)})}getPlaylistEntriesIDs(t){return s(this,null,function*(){let e=[];return t?.entriesIDs?e=t.entriesIDs:t?.entries?e=t.entries.map(a=>a.id):t&&(e=(yield this.jam.playlist.id({id:t.id,playlistIncEntriesIDs:!0})).entriesIDs),e})}addToPlaylist(t,e){this.getPlaylistEntriesIDs(t).then(a=>{this.savePlaylist(t,[...a,...e])}).catch(a=>{this.notify.error(a)})}removeFromPlaylist(t,e){let a=(t.entries??[]).map(o=>o.id).filter(o=>e.includes(o));this.savePlaylist(t,a)}refreshPlaylist(t){this.jam.playlist.id({id:t,playlistIncEntries:!0,playlistIncState:!0,trackIncTag:!0,trackIncState:!0,episodeIncTag:!0,episodeIncState:!0}).then(e=>{let a=this.playlists.findIndex(o=>o.id===t);a===-1?this.playlists.push(e):this.playlists[a]=e,this.playlistsChange.emit(this.playlists),this.playlistChange.emit(t,e)}).catch(e=>{this.notify.error(e)})}getTracks(t){return s(this,null,function*(){return(yield this.jam.playlist.id({id:t,playlistIncEntries:!0})).entries??[]})}getLists(){return s(this,null,function*(){let t=yield this.jam.playlist.search({playlistIncState:!0});return this.playlists=t.items,this.playlistsChange.emit(this.playlists),t.items})}refreshLists(){this.getLists().catch(t=>{this.notify.error(t)})}};i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();var Mt=(()=>{let i=class i{constructor(){this.faved=H()}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=d({type:i,selectors:[["app-fav-icon"]],inputs:{faved:[1,"faved"]},decls:2,vars:6,template:function(e,a){e&1&&(j(0,"i"),V(1,"stringToggle")),e&2&&y(U(1,2,a.faved(),"icon-heart-full","icon-heart-empty"))},dependencies:[q],encapsulation:2});let n=i;return n})();export{Mt as a,Q as b,ht as c,Ct as d};
