import{c as se}from"./chunk-U7BHTOCB.js";import"./chunk-KO722XW6.js";import{a as re}from"./chunk-VRIKBGWX.js";import{b as y}from"./chunk-MWWVWNOX.js";import"./chunk-XMJ6YDII.js";import{a as le}from"./chunk-UO5UMZSC.js";import"./chunk-JP4K5MFN.js";import"./chunk-4UFWK3HC.js";import"./chunk-24DMSAFT.js";import{d as J,g as U,k as q,l as K,m as Y,o as Z}from"./chunk-SCY3FOMN.js";import"./chunk-RJHPSDKR.js";import"./chunk-MTB5HHEE.js";import"./chunk-TT7XXVKE.js";import{k as ee}from"./chunk-6SWJ3F4P.js";import"./chunk-FQC6PRY2.js";import{a as ae}from"./chunk-ITVL4IJL.js";import"./chunk-JI2YWTPQ.js";import{G as oe}from"./chunk-3LOKQP2Q.js";import{h as te,i as ne,k as ie}from"./chunk-MFAW4R34.js";import{$b as D,Cc as Q,Db as C,Eb as p,Gb as I,Hb as f,Hd as m,Ib as u,Jb as T,Kb as r,Lb as l,Mb as S,Nb as h,Ob as M,Pb as v,Pc as W,U as H,Wb as L,Wd as F,Yb as O,_a as a,ac as z,bc as _,e as A,fa as g,j as w,ka as b,la as x,nb as N,pc as s,qc as d,rb as B,rc as R,uc as X,vc as V,wc as j,ya as k,za as G}from"./chunk-XLNNDSL4.js";var ce=(n,o)=>o.hint.id,me=(n,o)=>o.name;function ge(n,o){if(n&1&&(h(0,"div",6),s(1),M()),n&2){let e=o.$implicit;a(),d(e)}}function he(n,o){if(n&1&&(h(0,"div",2),v(1,"i",5),s(2),f(3,ge,2,1,"div",6,I),M()),n&2){let e=o.$implicit;a(2),R(" ",e.hint.name," "),a(),u(e.details)}}function Ce(n,o){n&1&&(h(0,"div",2),O(1,0),M())}function pe(n,o){n&1&&v(0,"i",8)}function fe(n,o){if(n&1&&s(0),n&2){let e=_().$implicit;R(" ",e.name," ")}}function ue(n,o){if(n&1){let e=L();h(0,"button",7),z("click",function(){let i=b(e).$implicit;return x(i.click())}),C(1,pe,1,0,"i",8)(2,fe,1,1),M()}if(n&2){let e=o.$implicit;a(),p(e.running?1:2)}}function Me(n,o){if(n&1&&(h(0,"div",1),f(1,he,5,1,"div",2,ce,!1,Ce,2,0,"div",2),h(4,"div",3),f(5,ue,3,1,"button",4,me),M()()),n&2){let e=_();a(),u(e.hints),a(4),u(e.solutions)}}function Oe(n,o){n&1&&(h(0,"div",1)(1,"div",2),v(2,"i",8),M()())}var de=(()=>{class n{constructor(){this.folderHealth=W(),this.solutions=[],this.unsubscribe=new w,this.router=g(te),this.jam=g(F),this.dialogOverlay=g(ee),this.folderService=g(y)}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}searchImages(e){this.dialogOverlay.open({childComponent:se,title:"Search Artwork Images",data:{folder:e,artworks:[]},panelClass:"overlay-panel-large-buttons"})}ngOnChanges(){this.display(this.folderHealth())}static describeImageInvalidHint(e){if(!e.details||e.details.length===0)return[];let t=[e.details[0].reason];return e.details[0].expected&&t.push(`Expected: ${e.details[0].expected} Actual: ${e.details[0].actual}`),t}static describeAlbumTracksMissingHint(e){if(!e.details||e.details.length===0)return[];let t=[];return e.details[0].expected&&t.push(`Expected: ${e.details[0].expected} Actual: ${e.details[0].actual}`),t}describeImageQualityHint(e,t){return this.addAlbumImageSearchSolution(t),!e.details||e.details.length===0?[]:[e.details[0].reason,`Expected: ${e.details[0].expected} Actual: ${e.details[0].actual}`]}addArtistImageSearchSolution(e){if(e.tag?.mbArtistID){let t={name:"Search",click:()=>A(this,null,function*(){this.searchImages(e)})};this.solutions.push(t)}}addAlbumImageSearchSolution(e){if(e.tag&&(e.tag.mbReleaseID||e.tag.mbReleaseGroupID)){let t={name:"Search",click:()=>A(this,null,function*(){this.searchImages(e)})};this.solutions.push(t)}}addRenameSolution(e,t){if(!this.solutions.some(i=>i.name==="Rename")){let i={name:"Rename",click:()=>A(this,null,function*(){if(i.running)return;i.running=!0;let c=yield this.jam.folder.rename({id:e.id,name:t});this.folderService.waitForQueueResult("Renaming Folder",c,[e.id]).pipe(H(this.unsubscribe)).subscribe(()=>{i.running=!1})})};this.solutions.push(i)}}addEditTagSolution(e){if(!this.solutions.some(t=>t.name==="Edit Tags")){let t={name:"Edit Tags",click:()=>A(this,null,function*(){this.router.navigate([`/admin/folder/${e.id}/tags`]).catch(i=>{console.error(i)})})};this.solutions.push(t)}}describeMBIDMissingHint(e,t){return this.addEditTagSolution(t),[]}describeAlbumTagMissingHint(e,t){return this.addEditTagSolution(t),e.details?[`Expected: ${e.details.map(i=>i.expected).join(",")}`]:[]}describeNameNonConformHint(e,t){let i=e.details&&e.details.length>0?e.details[0].expected:"";return i?(this.addRenameSolution(t,i),[`Current: ${t.name}`,`Suggested Name: ${i}`]):[]}describeArtistImageMissingHint(e,t){return this.addArtistImageSearchSolution(t),[]}describeAlbumImageMissingHint(e,t){return this.addAlbumImageSearchSolution(t),[]}describeHint(e,t){switch(e.id){case m.albumMBIDExists:return this.describeMBIDMissingHint(e,t);case m.albumTagsExists:return this.describeAlbumTagMissingHint(e,t);case m.albumNameConform:case m.artistNameConform:return this.describeNameNonConformHint(e,t);case m.albumImageExists:return this.describeAlbumImageMissingHint(e,t);case m.albumTracksComplete:return n.describeAlbumTracksMissingHint(e);case m.artistImageExists:return this.describeArtistImageMissingHint(e,t);case m.artistImageValid:case m.albumImageValid:return n.describeImageInvalidHint(e);case m.albumImageQuality:return this.describeImageQualityHint(e,t);default:break}return[]}display(e){this.hints=[],this.solutions=[],e?.health&&(this.hints=e.health.map(t=>{let i=this.describeHint(t,e.folder);return{hint:t,details:i}}))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=N({type:n,selectors:[["app-folder-health"]],inputs:{folderHealth:[1,"folderHealth"]},features:[k],decls:2,vars:1,consts:()=>{let e;return e=$localize`:␟baa5a59fd701bf37b30140cf2080f8987db6c2e9␟4786331182153457864:No Hints`,[e,[1,"hints"],[1,"hint"],[1,"solutions"],[1,"button-on-background"],[1,"icon-warning"],[1,"details"],[1,"button-on-background",3,"click"],[1,"icon-spin","icon-spinner"]]},template:function(t,i){t&1&&C(0,Me,7,1,"div",1)(1,Oe,3,0,"div",1),t&2&&p(i.hints?0:1)},styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .icon-warning[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]{padding-left:28px;font-size:.8em;text-transform:uppercase;min-width:30%;display:inline-block}[_nghost-%COMP%]   .hints[_ngcontent-%COMP%]{padding-top:10px}[_nghost-%COMP%]   .hint[_ngcontent-%COMP%]{padding-bottom:10px}"]})}}return n})();var Pe=n=>["/admin/folder",n,"overview"],Ee=(n,o)=>o.folder.id;function Ae(n,o){if(n&1&&(r(0,"option",13),s(1),l()),n&2){let e=o.$implicit;T("value",e),a(),d(e)}}function be(n,o){if(n&1){let e=L();r(0,"select",12),j("ngModelChange",function(i){b(e);let c=_();return V(c.filter,i)||(c.filter=i),x(i)}),D("ngModelChange",function(){b(e);let i=_();return x(i.onFilterChange())}),f(1,Ae,2,2,"option",13,I),l()}if(n&2){let e=_();X("ngModel",e.filter),a(),u(e.modes)}}function xe(n,o){n&1&&S(0,"app-loading")}function Te(n,o){if(n&1&&(r(0,"div",19),O(1,0),l(),r(2,"div",16),s(3),l(),r(4,"div",20),s(5),l(),r(6,"div",21),s(7),l()),n&2){let e=_().$implicit;a(3),d(e.folder.tag==null?null:e.folder.tag.album),a(2),d(e.folder.tag==null?null:e.folder.tag.artist),a(2),d(e.folder.tag==null?null:e.folder.tag.year)}}function Se(n,o){if(n&1&&(r(0,"div",19),O(1,1),l(),r(2,"div",16),s(3),l(),r(4,"div",20),s(5),l(),r(6,"div",21),s(7),l()),n&2){let e=_().$implicit;a(3),d(e.folder.tag==null?null:e.folder.tag.album),a(2),d(e.folder.tag==null?null:e.folder.tag.artist),a(2),d(e.folder.tag==null?null:e.folder.tag.year)}}function He(n,o){if(n&1&&(r(0,"div",19),O(1,2),l(),r(2,"div",16),s(3),l()),n&2){let e=_().$implicit;a(3),d(e.folder.tag==null?null:e.folder.tag.artist)}}function Ne(n,o){if(n&1&&(r(0,"div",19),O(1,3),l(),r(2,"div",16),s(3),l()),n&2){let e=_().$implicit;a(3),d(e.folder.name)}}function Ie(n,o){if(n&1&&(r(0,"div",16),s(1),l()),n&2){let e=_().$implicit;a(),d(e.folder.name)}}function ve(n,o){if(n&1&&(r(0,"div",11)(1,"div",14)(2,"a",15),C(3,Te,8,3)(4,Se,8,3)(5,He,4,1)(6,Ne,4,1)(7,Ie,2,1,"div",16),l()(),r(8,"div",17),S(9,"app-folder-health",18),l()()),n&2){let e,t=o.$implicit;a(2),T("routerLink",Q(3,Pe,t.folder.id)),a(),p((e=t.folder.type)==="multialbum"?3:e==="album"?4:e==="artist"?5:e==="collection"?6:7),a(6),T("folderHealth",t)}}var nt=(()=>{class n extends re{constructor(){super(...arguments),this.modes=[],this.jam=g(F),this.notify=g(oe),this.folderService=g(y)}onFilterChange(){this.reDisplay()}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe(H(this.unsubscribe)).subscribe(e=>{this.processChange(e.id)})}ngOnDestroy(){super.ngOnDestroy()}processChange(e){if(e===this.id)this.refresh();else if(this.all){let t=this.all.find(i=>i.folder.id===e);t&&this.jam.folder.health({ids:[e],folderIncTag:!0}).then(i=>{if(this.all){let c=i.find(P=>P.folder.id===t.folder.id);c?this.all[this.all.indexOf(t)]=c:this.all=this.all.filter(P=>P.folder.id!==t.folder.id)}this.reDisplay()}).catch(i=>{this.notify.error(i)})}}refresh(){this.hints=void 0,this.jam.folder.health({childOfID:this.id,folderIncTag:!0}).then(e=>{this.display(e)}).catch(e=>{this.notify.error(e)})}reDisplay(){this.hints=!this.filter||!this.all?this.all:this.all.filter(e=>e.health.find(t=>t.name===this.filter))}display(e){this.all=e,this.modes=[];for(let t of e)for(let i of t.health)this.modes.includes(i.name)||this.modes.push(i.name);this.reDisplay()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=G(n)))(i||n)}})()}static{this.\u0275cmp=N({type:n,selectors:[["app-admin-folder-health"]],features:[B],decls:10,vars:3,consts:()=>{let e;e=$localize`:␟e9e69aab6530b06f07d62019e95496e5c974a35d␟4008496035123032607:Refresh List`;let t;t=$localize`:␟bb787b6c8e8a25e976f65cadc66c66c8a7d81a8a␟8891977878457079212:Type of Hints`;let i;i=$localize`:␟842a4fcf548e0c52ebab1cb5362f47ab2ca83e12␟1393837337557373364:Album`;let c;c=$localize`:␟842a4fcf548e0c52ebab1cb5362f47ab2ca83e12␟1393837337557373364:Album`;let P;P=$localize`:␟378660a509ecaa4d2dd3b4b0b8975760cfe3576d␟2492300395471245755:Artist`;let $;return $=$localize`:␟40cf215f61708390d3aba0212e49596e0d3d981c␟16823705783062999:Collection`,[i,c,P,$,[1,"health"],[1,"actions"],["title",e,1,"button-on-control",3,"click"],[1,"icon-reload"],["placeholder",t,3,"ngModel"],[1,"health-content"],["name","Folder Health Issues",3,"list"],[1,"folder"],["placeholder",t,3,"ngModelChange","ngModel"],[3,"value"],[1,"meta"],[3,"routerLink"],[1,"name"],[1,"folder-health"],[3,"folderHealth"],[1,"type"],[1,"artist"],[1,"year"]]},template:function(t,i){t&1&&(r(0,"div",4)(1,"div",5)(2,"button",6),D("click",function(){return i.refresh()}),S(3,"i",7),l(),C(4,be,3,1,"select",8),l(),r(5,"div",9),C(6,xe,1,0,"app-loading"),S(7,"app-background-text-list",10),f(8,ve,10,5,"div",11,Ee),l()()),t&2&&(a(4),p(i.modes.length>0?4:-1),a(2),p(i.hints?-1:6),a(),T("list",i.hints),a(),u(i.hints))},dependencies:[ie,ne,Z,K,Y,q,J,U,de,le,ae],styles:["[_nghost-%COMP%]{height:100%;width:100%}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .health-content[_ngcontent-%COMP%]{padding:15px;overflow-y:auto;overflow-x:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]{border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:var(--background-border);padding:15px;display:flex;flex-flow:row wrap;flex-flow:row nowrap}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{width:30%;padding-right:15px;margin-left:15px;display:flex;flex-flow:column wrap;position:relative}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;text-overflow:ellipsis;overflow:hidden}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%]{text-transform:uppercase}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .year[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .state[_ngcontent-%COMP%]{letter-spacing:1px;font-size:.8em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:24px;font-weight:100;color:var(--on-background-highlight)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-highlight)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:14px;line-height:1.2em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:5px;margin-right:5px;height:27px;font-weight:500;padding:1px 15px 0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transform:scale(1.3);transform-origin:center}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;border:1px solid transparent;padding:4px 9px 7px;border-radius:50%;display:none;position:absolute;right:1px;bottom:0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:var(--control-hover);color:var(--on-background-hover)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]:hover   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]:hover   app-fav-icon[_ngcontent-%COMP%]{display:inline}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .folder-health[_ngcontent-%COMP%]{display:flex;width:70%}@media(max-width:400px){[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]{padding-left:0;padding-right:0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-size:.8em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:16px}}"]})}}return n})();export{nt as AdminFolderHealthComponent};
