import{a as f}from"./chunk-N2K5OS3Y.js";import{a as h}from"./chunk-24DMSAFT.js";import{a as m}from"./chunk-DYCPZPVS.js";import{G as l}from"./chunk-ZVKVGF76.js";import{$d as p,Td as r,da as n,e as d,ia as o,ub as c}from"./chunk-H2EXZDP6.js";var S=(()=>{let i=class i{constructor(){this.podcastsChange=new c,this.podcastChange=new m,this.episodeChange=new c,this.jam=o(p),this.notify=o(l),this.dialogsService=o(f),this.episodePoll=new h((t,s)=>{this.jam.episode.status({id:t.id}).then(e=>{e.status==="downloading"?s(!0):(t.status=e.status,t.error=e.error,this.episodeChange.emit(t.id),s(!1))}).catch(e=>{console.error("error while polling episode download status",e)})}),this.podcastPoll=new h((t,s)=>{this.jam.podcast.status({id:t.id}).then(e=>{e.status==="downloading"?s(!0):(t.status=e.status,t.error=e.error,t.lastCheck=e.lastCheck,this.refreshPodcast(t.id),s(!1))}).catch(e=>{console.error("error while polling podcast download status",e)})}),this.podcasts=[]}removePodcast(t){this.dialogsService.confirm("Remove Podcast","Do you want to remove the podcast?",()=>{this.remove(t).then(()=>{this.notify.success("Podcast removed")}).catch(s=>{this.notify.error(s)})})}remove(t){return d(this,null,function*(){yield this.jam.podcast.remove({id:t.id}),this.podcasts=this.podcasts.filter(s=>s.id!==t.id),this.podcastsChange.emit(this.podcasts),this.podcastChange.emit(t.id)})}checkPodcasts(){this.jam.podcast.refresh({}).then(()=>{this.notify.success("Podcasts are updating"),this.refresh()}).catch(t=>{this.notify.error(t)})}checkPodcast(t){this.jam.podcast.refresh({id:t.id}).then(()=>{this.notify.success("Podcast is updating"),this.refreshPodcast(t.id)}).catch(s=>{this.notify.error(s)})}refreshPodcast(t){this.jam.podcast.id({id:t,podcastIncState:!0,podcastIncEpisodes:!0,episodeIncState:!0,episodeIncTag:!0,episodeIncMedia:!0}).then(s=>{let e=this.podcasts.findIndex(u=>u.id===t);e===-1?this.podcasts.push(s):this.podcasts[e]=s,this.podcastsChange.emit(this.podcasts),this.podcastChange.emit(t,s),s.status===r.downloading&&this.podcastPoll.poll(s)}).catch(s=>{this.notify.error(s)})}getTracks(t,s){this.jam.podcast.id({id:t,podcastIncEpisodes:!0,episodeIncState:!0,episodeIncTag:!0,episodeIncMedia:!0}).then(e=>{s(e.episodes??[])}).catch(e=>{this.notify.error(e)})}refresh(){this.jam.podcast.search({podcastIncState:!0}).then(t=>{this.podcasts=t.items,this.podcastsChange.emit(this.podcasts);for(let s of t.items)s.status===r.downloading&&this.podcastPoll.poll(s)}).catch(t=>{this.notify.error(t)})}retrieveEpisode(t){this.jam.episode.retrieve({id:t.id}).then(()=>{t.status=r.downloading,this.episodePoll.poll(t)}).catch(s=>{this.notify.error(s)})}};i.\u0275fac=function(s){return new(s||i)},i.\u0275prov=n({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();export{S as a};
