import{a as me,b as pe,c as Ne}from"./chunk-4Z6F2ZFH.js";import"./chunk-7LPD4TRQ.js";import{a as Ie}from"./chunk-6RJC4GG3.js";import"./chunk-HFNTQIPJ.js";import{a as Me}from"./chunk-LUUJI5GI.js";import{a as ge,b as h}from"./chunk-CERT6F7Z.js";import"./chunk-3I6TICGI.js";import{a as fe}from"./chunk-OEKZQI6C.js";import"./chunk-LXRIBXQ3.js";import"./chunk-3KEFNAKY.js";import{a as Ce}from"./chunk-UVO2NCSB.js";import"./chunk-24DMSAFT.js";import{d as oe,g as _e,o as re}from"./chunk-XTLMNK2P.js";import"./chunk-J5MSA5AP.js";import"./chunk-5EJKCVNW.js";import"./chunk-CQEFCIFT.js";import"./chunk-TT7XXVKE.js";import{g as Oe}from"./chunk-LV2G3RH6.js";import{k as de}from"./chunk-5NZQP5GA.js";import"./chunk-CTEOCYOX.js";import{a as L}from"./chunk-EPPWFHNT.js";import"./chunk-K64Q6LJ6.js";import{E as Ee,G as v}from"./chunk-ZMFSGBQT.js";import{h as ae,i as ce,k as se}from"./chunk-B4HPT77T.js";import{Bc as ne,Cb as E,Db as O,Ib as u,Jb as _,Kb as o,Lb as g,Pb as N,Qb as P,Sd as le,U as R,Va as b,Vb as A,Xb as c,Xd as T,Za as r,_b as p,ac as d,e as F,fa as m,j as Y,ka as C,la as f,mb as D,oc as M,pc as I,qb as K,qc as S,tc as Z,uc as ee,vc as te,xc as x,ya as H,zd as ie}from"./chunk-S3YUDFSI.js";function Ae(t,s){if(t&1){let e=A();_(0,"div",3),p("drop",function(n){C(e);let l=d();return f(l.onDropFile(n))})("dragover",function(n){C(e);let l=d();return f(l.onDragOverFile(n))}),_(1,"form")(2,"input",4),p("change",function(n){C(e);let l=d();return f(l.selectFile(n))}),o()()()}}function Re(t,s){t&1&&(N(0),c(1,0),P())}function Se(t,s){t&1&&(N(0),c(1,1),P())}function De(t,s){if(t&1&&(_(0,"div")(1,"div"),E(2,Re,2,0,"ng-container")(3,Se,2,0,"ng-container"),o(),g(4,"app-loading"),o()),t&2){let e=d();r(2),O(e.isUploading?2:3)}}var Pe=(()=>{class t{constructor(){this.isIdle=!0,this.isUploading=!1,this.unsubscribe=new Y,this.jam=m(T),this.notify=m(v),this.folderService=m(h)}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}dialogInit(e,i){this.reference=e,this.folder=i.data?.folder}waitForCreationEnd(e){if(!this.folder)return;let i=this.folder.id;this.folderService.waitForQueueResult("Creating Artwork",e,[]).pipe(R(this.unsubscribe)).subscribe(()=>{this.isIdle=!0,this.folderService.notifyFolderChange(i,ge.fsnRefresh),e.error||(this.notify.success("Upload done"),this.reference&&this.reference.close())})}onDropFile(e){e.preventDefault(),this.uploadFile(e.dataTransfer?.files)}onDragOverFile(e){e.stopPropagation(),e.preventDefault()}selectFile(e){let i=e.target;this.uploadFile(i.files??void 0)}uploadFile(e){if(!e||e.length===0||!this.folder)return;let i=e[0];this.isIdle=!1,this.isUploading=!0,this.jam.artwork.createByUpload({folderID:this.folder.id,types:[]},i).pipe(R(this.unsubscribe)).subscribe({next:n=>{if(n instanceof ie){let l=n.body;l&&this.waitForCreationEnd(l)}},error:n=>{this.isUploading=!1,this.isIdle=!0,this.notify.error(n)},complete:()=>{this.isUploading=!1}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=D({type:t,selectors:[["app-dialog-upload-image"]],decls:2,vars:1,consts:()=>{let e;e=$localize`:␟d833321cc90a0b0a52714c6d5ec97fbe6c7cfa5c␟2501989539336327542:Upload image`;let i;i=$localize`:␟f54acc637f2d1ea81cf76322b0c3f381b868baa1␟7636862518745301168:Uploading`;let n;return n=$localize`:␟71969bbb4eedcf48235202c3146043ad48adc542␟1227384069952544114:Creating Artwork`,[i,n,[1,"drop-zone"],[1,"drop-zone",3,"drop","dragover"],["type","file","placeholder",e,"accept",".png,.jpeg,.jpg",3,"change"]]},template:function(i,n){i&1&&E(0,Ae,3,0,"div",2)(1,De,5,1,"div"),i&2&&O(n.isIdle?0:1)},dependencies:[L],styles:["[_nghost-%COMP%]   .drop-zone[_ngcontent-%COMP%]{margin:10px 20px;border-width:2px;border-style:dotted;border-color:var(--secondary);height:80%}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}"]})}}return t})();var Te=t=>["/admin/folder",t];function ve(t,s){if(t&1&&g(0,"app-info-note",23),t&2){let e=d(2);u("info",e.folder.info)}}function Le(t,s){if(t&1&&M(0),t&2){let e=d(2);S(" / ",e.folder.tag==null?null:e.folder.tag.albumType," ")}}function he(t,s){if(t&1&&(_(0,"div")(1,"div",25),c(2,5),o(),_(3,"div"),M(4),o()()),t&2){let e=d(2);r(4),I(e.folder.tag==null?null:e.folder.tag.artist)}}function Ve(t,s){if(t&1&&(_(0,"div")(1,"div",25),c(2,6),o(),_(3,"div"),M(4),o()()),t&2){let e=d(2);r(4),I(e.folder.tag==null?null:e.folder.tag.album)}}function Fe(t,s){if(t&1&&(_(0,"div")(1,"div",25),c(2,7),o(),_(3,"div"),M(4),o()()),t&2){let e=d(2);r(4),S(" ",e.folder.tag==null?null:e.folder.tag.year)}}function be(t,s){if(t&1&&(_(0,"div")(1,"div",25),c(2,8),o(),_(3,"div"),M(4),o()()),t&2){let e=d(2);r(4),S(" ",e.folder.tag==null?null:e.folder.tag.genres)}}function xe(t,s){if(t&1&&(_(0,"div")(1,"div",25),c(2,9),o(),_(3,"div")(4,"a",33),M(5),o()()()),t&2){let e=d(2);r(4),u("href",x("https://musicbrainz.org/release/",e.folder.tag==null?null:e.folder.tag.mbReleaseID),b),r(),I(e.folder.tag==null?null:e.folder.tag.mbReleaseID)}}function $e(t,s){if(t&1&&(_(0,"div")(1,"div",25),c(2,10),o(),_(3,"div")(4,"a",33),M(5),o()()()),t&2){let e=d(2);r(4),u("href",x("https://musicbrainz.org/artist/",e.folder.tag==null?null:e.folder.tag.mbArtistID),b),r(),I(e.folder.tag==null?null:e.folder.tag.mbArtistID)}}function Ge(t,s){if(t&1&&(_(0,"div")(1,"div",25),c(2,11),o(),_(3,"div")(4,"a",34),M(5),o()()()),t&2){let e=d(2);r(4),u("routerLink",ne(2,Te,e.folder.parentID)),r(),I(e.folder.parentID)}}function we(t,s){if(t&1){let e=A();_(0,"button",35),p("click",function(){C(e);let n=d(2);return f(n.searchImages())}),g(1,"i",36),N(2),c(3,12),P(),o()}}function ye(t,s){if(t&1){let e=A();_(0,"button",37),p("click",function(){C(e);let n=d(2);return f(n.searchImages())}),g(1,"i",36),N(2),c(3,13),P(),o()}}function We(t,s){if(t&1&&(_(0,"div",32),g(1,"app-admin-artwork-list",38),o()),t&2){let e=d(2);r(),u("folderID",e.folder.id)("artworks",e.folder.artworks)}}function ke(t,s){if(t&1){let e=A();_(0,"div",14)(1,"div",15)(2,"button",16),p("click",function(){C(e);let n=d();return f(n.refresh())}),g(3,"i",17),o(),_(4,"button",18),p("click",function(){C(e);let n=d();return f(n.moveFolder())}),g(5,"i",19),o(),_(6,"button",20),p("click",function(){C(e);let n=d();return f(n.removeFolder())}),g(7,"i",21),o()(),_(8,"div",22),E(9,ve,1,1,"app-info-note",23),_(10,"div",24)(11,"div")(12,"div")(13,"div",25),c(14,0),o(),_(15,"div")(16,"app-inline-edit",26),te("ngModelChange",function(n){C(e);let l=d();return ee(l.name,n)||(l.name=n),f(n)}),p("endEditRequest",function(){C(e);let n=d();return f(n.editFolderName())}),o()()(),_(17,"div")(18,"div",25),c(19,1),o(),_(20,"div"),M(21),E(22,Le,1,1),o()(),_(23,"div")(24,"div",25),c(25,2),o(),_(26,"div"),M(27),o()(),_(28,"div")(29,"div",25),c(30,3),o(),_(31,"div"),M(32),o()(),E(33,he,5,1,"div"),E(34,Ve,5,1,"div"),o(),_(35,"div"),E(36,Fe,5,1,"div"),E(37,be,5,1,"div"),E(38,xe,6,3,"div"),E(39,$e,6,3,"div"),E(40,Ge,6,4,"div"),o()(),_(41,"div",27)(42,"div",15)(43,"button",28),p("click",function(){C(e);let n=d();return f(n.uploadImage())}),g(44,"i",29),N(45),c(46,4),P(),o(),E(47,we,4,0,"button",30),E(48,ye,4,0,"button",31),o(),E(49,We,2,2,"div",32),o()()()}if(t&2){let e=d();r(9),O(e.folder.info!=null&&e.folder.info.description?9:-1),r(7),Z("ngModel",e.name),r(5),S("",e.folder.type," "),r(),O(e.isAlbum?22:-1),r(5),I(e.folder.trackCount),r(5),I(e.folder.folderCount),r(),O(e.folder.tag!=null&&e.folder.tag.artist?33:-1),r(),O(e.folder.tag!=null&&e.folder.tag.album?34:-1),r(2),O(e.folder.tag!=null&&e.folder.tag.year?36:-1),r(),O(!(e.folder.tag==null||e.folder.tag.genres==null)&&e.folder.tag.genres.length?37:-1),r(),O(e.folder.tag!=null&&e.folder.tag.mbReleaseID?38:-1),r(),O(e.folder.tag!=null&&e.folder.tag.mbArtistID?39:-1),r(),O(e.folder.parentID?40:-1),r(7),O(e.isAlbum&&e.folder.tag&&(e.folder.tag.mbReleaseID||e.folder.tag.mbReleaseGroupID)?47:-1),r(),O(e.isArtist&&e.folder.tag&&e.folder.tag.mbArtistID?48:-1),r(),O(e.folder.artworks&&e.folder.artworks.length>0?49:-1)}}function Be(t,s){t&1&&g(0,"app-loading")}var It=(()=>{class t extends Me{constructor(){super(...arguments),this.name="",this.isAlbum=!1,this.isArtist=!1,this.jam=m(T),this.notify=m(v),this.dialogsService=m(Ce),this.dialogOverlay=m(de),this.folderService=m(h),this.router=m(ae)}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe(R(this.unsubscribe)).subscribe(e=>{e.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}editFolderName(){if(!this.folder)return;let e=(this.name||"").trim();if(e.length===0||e===this.folder.name){this.name=this.folder.name;return}let i=this.folder.id;this.jam.folder.rename({id:i,name:e}).then(n=>{this.folderService.waitForQueueResult("Renaming Folder",n,[i])}).catch(n=>{this.notify.error(n)})}refresh(){this.id&&this.jam.folder.id({id:this.id,folderIncTag:!0,folderIncParents:!0,folderIncArtworks:!0,folderIncChildFolderCount:!0,folderIncTrackCount:!0}).then(e=>{this.display(e)}).catch(e=>{Ee(e)&&e.code===404?this.router.navigate(["/admin/folder/"]).catch(i=>{console.error(i)}):this.notify.error(e)})}uploadImage(){this.dialogOverlay.open({childComponent:Pe,title:"Upload Folder Images",data:{folder:this.folder},panelClass:"overlay-panel-large-buttons"})}searchImages(){this.dialogOverlay.open({childComponent:Ne,title:"Search Artwork Images",data:{folder:this.folder,artworks:[]},panelClass:"overlay-panel-large-buttons"})}removeFolder(){let e=this.folder;e&&this.dialogsService.confirm("Remove Folder?",`Sure to remove Folder "${e.name}"?`,()=>{this.jam.folder.remove({id:e.id}).then(i=>{e.parentID&&this.router.navigate([`/admin/folder/${e.parentID}/overview`]).catch(n=>{console.error(n)}),this.folderService.waitForQueueResult("Removing Folder",i,[e.id],e.parentID?[e.parentID]:[])}).catch(i=>{this.notify.error(i)})})}moveFolder(){let e=this.folder;if(!e)return;let i={selectID:e.id,disableIDs:[e.id]};this.dialogOverlay.open({childComponent:Ie,title:"Move Folder to",data:i,panelClass:"overlay-panel-large-buttons",onOkBtn:()=>F(this,null,function*(){let n=i.folder;if(n)try{this.jam.folder.move({ids:[e.id],newParentID:n.id}).then(l=>{this.folderService.waitForQueueResult("Moving Folder",l,[e.id],[...e.parentID?[e.parentID]:[],n.id])}).catch(l=>{this.notify.error(l)})}catch(l){return this.notify.error(l),Promise.reject(l)}}),onCancelBtn:()=>F(this,null,function*(){return Promise.resolve()})})}display(e){this.name="",this.isAlbum=!1,this.isArtist=!1,this.folder=e,e&&(this.name=e.name,this.isAlbum=Oe.includes(e.type),this.isArtist=e.type===le.artist)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=H(t)))(n||t)}})()}static{this.\u0275cmp=D({type:t,selectors:[["app-admin-folder"]],features:[K],decls:2,vars:1,consts:()=>{let e;e=$localize`:␟c8d1785038d461ec66b5799db21864182b35900a␟1102717806459547726:Refresh`;let i;i=$localize`:␟ee0ffaa4b2ef70f3847c0dc2126aff7ed0034519␟4836856351090546342:Move Folder…`;let n;n=$localize`:␟605381a1ba67135149effc1e2382241d379fcc9a␟5344042372404898499:Remove Folder…`;let l;l=$localize`:␟cb1068a2a1e809104667e887d276b18b2fb9d8fa␟7832824131624341508:Album Images`;let V;V=$localize`:␟12a54d1bad2243f676c829e885461ff819d55f4f␟2477517217585375703:Artist Images`;let $;$=$localize`:␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`;let G;G=$localize`:␟f61c6867295f3b53d23557021f2f4e0aa1d0b8fc␟8650499415827640724:Type`;let w;w=$localize`:␟261caf3111a423a99f27e839571512f371bd0212␟167155511337505993:Track Count`;let y;y=$localize`:␟36b472d60e30275eec0f90dc492c06c990621178␟506719405556868592:Folder Count`;let W;W=$localize`:␟faecc81b39c34e94a8f009af7d8c233d3a3dceaa␟8890037837123071423:Upload Artwork`;let k;k=$localize`:␟378660a509ecaa4d2dd3b4b0b8975760cfe3576d␟2492300395471245755:Artist`;let B;B=$localize`:␟842a4fcf548e0c52ebab1cb5362f47ab2ca83e12␟1393837337557373364:Album`;let X;X=$localize`:␟f6e04edea3bb3a59d5904725bfbc2c440e793001␟1464072562214937907:Year`;let U;U=$localize`:␟33c750c68c3e29d7fee57a180f508d8d202bdd04␟1790640569414740156:Genres`;let z;z=$localize`:␟e25c6080fad93286376b6a4103ff2889588879b5␟6137832517756203418:MB Release Id`;let j;j=$localize`:␟5b6e5696b55d1dbdcc67e6bb408952c49221060e␟7022245527426162907:MB Artist Id`;let Q;Q=$localize`:␟e17ab51fb5646579e7073ed25f240117d5f5169e␟4232003024146825817:Parent Folder Id`;let q;q=$localize`:␟045d07de1f817f18c61b2660126d1edcac7b5bd0␟2134391710559060062:Search Artwork`;let J;return J=$localize`:␟85804de0cdf6b27537be7f0d11158dbe7b1dc5c2␟7505878720705236779:Search Art`,[$,G,w,y,W,k,B,X,U,z,j,Q,q,J,[1,"folder"],[1,"actions"],["title",e,1,"button-on-control",3,"click"],[1,"icon-reload"],["title",i,1,"button-on-control",3,"click"],[1,"icon-right-bold"],["title",n,1,"button-on-control",3,"click"],[1,"icon-trash"],[1,"content"],[3,"info"],[1,"properties"],[1,"label"],["type","text",3,"ngModelChange","endEditRequest","ngModel"],[1,"artworks"],[1,"button-on-control",3,"click"],[1,"icon-upload-cloud"],["title",l,1,"button-on-control"],["title",V,1,"button-on-control"],[1,"artworks-content"],["target","_blank","rel","noopener",3,"href"],[3,"routerLink"],["title",l,1,"button-on-control",3,"click"],[1,"icon-picture"],["title",V,1,"button-on-control",3,"click"],[3,"folderID","artworks"]]},template:function(i,n){i&1&&E(0,ke,50,16,"div",14)(1,Be,1,0,"app-loading"),i&2&&O(n.folder?0:1)},dependencies:[se,ce,re,oe,_e,pe,me,L,fe],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow:hidden;display:block}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{overflow-y:auto;display:flex;flex-direction:column}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%]{width:100%;display:flex;flex-wrap:wrap;flex-direction:row;padding:15px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:0 0 50%}@media(max-width:522px){[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:0 0 100%}}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding-top:5px;padding-bottom:5px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{color:var(--on-background-highlight)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-highlight)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--on-background);font-size:.7em;text-transform:uppercase;padding-bottom:2px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .artworks[_ngcontent-%COMP%]{border-top:1px solid var(--background-border)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .artworks[_ngcontent-%COMP%]   .artworks-content[_ngcontent-%COMP%]{padding:0 15px 15px}"]})}}return t})();export{It as AdminFolderOverviewComponent};
