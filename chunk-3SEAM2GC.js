import{c as g}from"./chunk-AOWKIYEI.js";import{d as b}from"./chunk-ALNDELZX.js";import{G as h}from"./chunk-SR2DRA4F.js";import{Gd as n,Nd as d,Wd as f,aa as p,e as l,fa as o,ra as c}from"./chunk-MRX5UB2X.js";function x(r,s,a,e){if(r)return{type:n.album,name:a,groups:r.groups.map(t=>({name:t.name,expanded:s,entries:t.items.map(i=>({id:i.id,link:`/library/albums/id/${i.id}`,extraLink:`/library/artists/id/${i.artistID}`,name:i.name,extra:i.artist,visible:!1,trackCount:i.trackCount,image:e.image.imageUrl({id:i.id,size:200,format:d.webp})}))}))}}function k(r,s,a,e){if(r)return{name:a,type:n.folder,groups:r.groups.map(t=>({name:t.name,expanded:s,entries:t.items.map(i=>({id:i.id,link:`/library/folders/id/${i.id}`,name:i.name,visible:!1,trackCount:i.trackCount,image:e.image.imageUrl({id:i.id,size:200,format:d.webp})}))}))}}function I(r,s,a,e){if(r)return{name:a,type:n.artist,groups:r.groups.map(t=>({name:t.name,expanded:s,entries:t.items.map(i=>({id:i.id,link:`/library/artists/id/${i.id}`,name:i.name,visible:!1,trackCount:i.trackCount,image:e.image.imageUrl({id:i.id,size:200,format:d.webp})}))}))}}function w(r,s,a,e){if(r)return{name:a,type:n.series,groups:r.groups.map(t=>({name:t.name,expanded:s,entries:t.items.map(i=>({id:i.id,link:`/library/series/id/${i.id}`,name:i.name,visible:!1,trackCount:i.trackCount,image:e.image.imageUrl({id:i.id,size:200,format:d.webp})}))}))}}function j(r,s,a,e){if(r)return{name:a,type:n.genre,groups:r.groups.map(t=>({name:t.name,expanded:s,entries:t.items.map(i=>({id:i.id,link:`/library/genres/id/${i.id}`,name:i.name,visible:!1,trackCount:i.trackCount,image:e.image.imageUrl({id:i.id,size:200,format:d.webp})}))}))}}var u=class{constructor(s,a){this.type=s,this.query=a}isQuery(s){return JSON.stringify(s)===JSON.stringify(this.query)}matches(s,a){return s===this.type&&this.isQuery(a)}},N=(()=>{class r{constructor(){this.indexNotify=new c,this.app=o(g),this.jam=o(f),this.notify=o(h),this.indexes=[]}findIndexCache(a,e){return this.indexes.find(t=>t.matches(a,e))}getIndex(a,e){return l(this,null,function*(){switch(a){case n.folder:return k(yield this.jam.folder.index(e),!this.app.smallscreen,"Folders",this.jam);case n.artist:return I(yield this.jam.artist.index(e),!this.app.smallscreen,"Artists",this.jam);case n.series:return w(yield this.jam.series.index(e),!this.app.smallscreen,"Series",this.jam);case n.genre:return j(yield this.jam.genre.index(e),!this.app.smallscreen,"Genres",this.jam);case n.album:{let t=e,i=t.albumTypes?.at(0),m=i?b(i):void 0;return x(yield this.jam.album.index(t),!this.app.smallscreen,m?m.text:"Albums",this.jam)}default:return}})}requestIndex(a,e){let t=this.findIndexCache(a,e);if(t?.index)return t.index;if(t)return;let i=new u(a,e);this.indexes.push(i),this.getIndex(a,e).then(m=>{i.index=m,i.index&&this.indexNotify.emit(i)}).catch(m=>{this.notify.error(m)})}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{N as a};
