"use strict";(self.webpackChunkjamberry=self.webpackChunkjamberry||[]).push([[187],{5187:($e,le,E)=>{E.r(le),E.d(le,{AdminModule:()=>jo});var H=E(4150),c=E(177),u=E(4341),ae=E(345),fe=E(207),te=E(9193),ce=E(5015),de=E(6156),e=E(4438);let Oe=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin"]],decls:6,vars:0,consts:[[1,"left"],["role","main",1,"middle"]],template:function(n,o){1&n&&(e.j41(0,"aside",0),e.nrm(1,"app-admin-sidebar"),e.k0s(),e.nrm(2,"app-splitter"),e.j41(3,"main",1),e.nrm(4,"router-outlet"),e.k0s(),e.nrm(5,"app-admin-queue-requests"))},styles:["[_nghost-%COMP%]{width:100%;height:100%;flex:1;display:flex;flex-flow:row nowrap;overflow:hidden;align-items:flex-start;align-content:flex-start}[_nghost-%COMP%]   .left[_ngcontent-%COMP%]{width:15%;height:100%;min-width:140px}[_nghost-%COMP%]   .middle[_ngcontent-%COMP%]{width:85%;flex-grow:1;height:100%}@media (max-width: 1400px){[_nghost-%COMP%]   .left[_ngcontent-%COMP%]{width:20%}[_nghost-%COMP%]   .middle[_ngcontent-%COMP%]{width:80%}}@media (max-width: 768px){[_nghost-%COMP%]{min-height:100%;position:absolute;display:block;flex:none;flex-flow:inherit}[_nghost-%COMP%]   app-splitter[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .left[_ngcontent-%COMP%]{width:100%!important;height:auto}[_nghost-%COMP%]   .middle[_ngcontent-%COMP%]{width:100%;min-height:100%}}"]})}return i})();var L=E(467),D=E(6499),q=E(1413),G=E(6977);const J=["overview","tags","health","tracks","tracks-health"];var f=E(1312),M=E(6879),N=E(7514),P=E(2223),A=E(1361),v=E(3631);function w(i,d){1&i&&e.nrm(0,"i",10)}function se(i,d){if(1&i&&(e.nrm(0,"i"),e.nI1(1,"stringToggle")),2&i){const t=e.XpG().$implicit;e.HbH(e.brH(1,2,t.expanded,"icon-minus","icon-plus"))}}function _e(i,d){if(1&i){const t=e.RV6();e.qex(0),e.j41(1,"div",8),e.bIt("click",function(){const o=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.selectNode(o))})("keydown.enter",function(){const o=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.selectNode(o))})("keydown.arrowRight",function(){const o=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.toggleNode(o))})("keydown.arrowLeft",function(){const o=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.toggleNode(o))}),e.j41(2,"span",9),e.bIt("clickenter",function(){const o=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.toggleNode(o))}),e.DNE(3,w,1,0,"i",10)(4,se,2,6,"i",11),e.k0s(),e.j41(5,"span",12),e.bIt("clickenter",function(){const o=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.toggleNode(o))}),e.nrm(6,"i"),e.nI1(7,"stringToggle"),e.k0s(),e.j41(8,"span",13),e.EFF(9),e.k0s(),e.j41(10,"span",14),e.EFF(11),e.k0s()(),e.bVm()}if(2&i){const t=d.$implicit,n=e.XpG();e.R7$(),e.xc7("padding-left",12*t.level,"px"),e.AVh("active",t===n.selected),e.R7$(),e.Mz_("title","Subfolders: ",t.folder.folderCount,""),e.R7$(),e.vxM(3,t.isLoading?3:-1),e.R7$(),e.vxM(4,!t.isLoading&&t.hasChildren?4:-1),e.R7$(),e.xc7("color",t.color),e.Y8G("title",t.folder.type),e.R7$(),e.HbH(e.brH(7,16,t.expanded,"icon-folder-open","icon-folder")),e.R7$(2),e.Y8G("title",t.folder.name),e.R7$(),e.JRh(t.folder.name),e.R7$(2),e.SpI("| ",t.folder.type,"")}}function oe(i,d){if(i.children)for(const t of i.children)d(t),oe(t,d)}let W=(()=>{class i{app;jam;notify;folderService;selected;nodes=[];expandIDs=[];autoSelect=!1;selectionChange=new e.bkB;viewport;unsubscribe=new q.B;constructor(t,n,o,r){this.app=t,this.jam=n,this.notify=o,this.folderService=r}ngOnInit(){this.folderService.foldersChange.pipe((0,G.Q)(this.unsubscribe)).subscribe(t=>{const n=this.nodes.find(o=>o.folder.id===t.id);n&&this.jam.folder.id({id:t.id,folderIncTrackCount:!0,folderIncChildFolderCount:!0}).then(o=>{n.folder=o,t.mode===f.lE.fsnRefreshChilds&&n.expanded&&(this.collapseNode(n),n.hasChildren=(o.folderCount||0)>0,n.children=void 0,n.isLoading=!1,n.hasChildren&&(n.expanded=!0,this.checkLoadExpanded(n)))}).catch(o=>{console.error(o)})})}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}selectNode(t){this.selectionChange.emit(t.folder),this.autoSelect&&(this.selected=t)}toggleNode(t){t.expanded?this.collapseNode(t):this.expandNode(t)}refresh(){this.jam.auth.isLoggedIn()&&this.jam.folder.search({level:0,folderIncChildFolderCount:!0,folderIncTrackCount:!0}).then(t=>{this.nodes=t.items.map(n=>({folder:n,hasChildren:(n.folderCount||0)>0,level:0,color:this.typeToColor(n),expanded:this.expandIDs.includes(n.id),isLoading:!1}));for(const n of this.nodes)this.checkLoadExpanded(n)}).catch(t=>{this.notify.error(t)})}typeToColor(t){switch(t.type){case M.DZ.unknown:return"#ff9fAA";case M.DZ.artist:return"#6f806e";case M.DZ.collection:return"#adbced";case M.DZ.album:return"#bdbd9c";case M.DZ.multialbum:return"#bdaaae";case M.DZ.extras:return"#bdbdbd";default:return""}}onFolderUpdate(t){const n=this.nodes.find(o=>o.folder.id===t.id);n&&(n.folder=t)}selectFolderByID(t){const n=this.nodes.find(o=>o.folder.id===t);n?this.selected=n:this.jam.folder.id({id:t,folderIncParents:!0}).then(o=>{if(o.parents){for(const r of o.parents)this.expandIDs.includes(r.id)||this.expandIDs.push(r.id);for(const r of this.nodes)r.expanded=this.expandIDs.includes(r.folder.id),this.checkLoadExpanded(r,t)}}).catch(o=>{this.notify.error(o)})}checkLoadExpanded(t,n){t.expanded&&!t.isLoading&&this.loadChildren(t,o=>{for(const r of o)this.checkLoadExpanded(r,n)}),t.folder.id===n&&(this.selected=t,this.viewport&&this.viewport.scrollToIndex(this.nodes.indexOf(t)))}loadChildren(t,n){t.isLoading||(t.isLoading=!0,this.jam.folder.search({parentIDs:[t.folder.id],folderIncChildFolderCount:!0,folderIncTrackCount:!0}).then(o=>{const r=o.items.sort((C,T)=>C.name.localeCompare(T.name)).map(C=>({folder:C,hasChildren:(C.folderCount||0)>0,level:t.level+1,color:this.typeToColor(C),expanded:this.expandIDs.includes(C.id),isLoading:!1})),g=this.nodes.indexOf(t);g>=0&&(this.nodes=this.nodes.slice(0,g+1).concat(r).concat(this.nodes.slice(g+1))),t.children=r,t.isLoading=!1,n&&n(r)}).catch(o=>{this.notify.error(o)}))}collapseNode(t){if(t.expanded){const n=[];oe(t,o=>n.push(o.folder.id)),this.nodes=this.nodes.filter(o=>!n.includes(o.folder.id)),t.expanded=!1,t.children=void 0,this.expandIDs=(this.expandIDs||[]).filter(o=>o!==t.folder.id)}}expandNode(t){if(!t.expanded){if(t.children){const n=this.nodes.indexOf(t);this.nodes=this.nodes.slice(0,n+1).concat(t.children).concat(this.nodes.slice(n+1))}else this.loadChildren(t);this.expandIDs.push(t.folder.id),t.expanded=!0}}static \u0275fac=function(n){return new(n||i)(e.rXU(f.d3),e.rXU(M.UA),e.rXU(f.FL),e.rXU(f.pp))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-folder-tree"]],viewQuery:function(n,o){if(1&n&&e.GBs(H.d6,7),2&n){let r;e.mGM(r=e.lsd())&&(o.viewport=r.first)}},inputs:{autoSelect:"autoSelect"},outputs:{selectionChange:"selectionChange"},decls:8,vars:2,consts:()=>{let t,n;return t=$localize`:␟21e3799e2b1bfef3056c82909b88edfbd65ee66c␟1467125554926319902:Refresh Folder Tree`,n=$localize`:␟3fde556358b58d910adc30abaaff2433f0bb5f6c␟1205037876874222931:Folders`,[n,[1,"actions"],[1,"name"],["title",t,1,"button-on-control",3,"click"],["aria-hidden","true",1,"icon-reload"],["appFocusKeyList","",1,"tree"],[1,"list-container","list-group",2,"height","100%",3,"itemSize"],[4,"cdkVirtualFor","cdkVirtualForOf"],["appFocusKeyListItem","",1,"node",3,"click","keydown.enter","keydown.arrowRight","keydown.arrowLeft"],[1,"node-toggle",3,"clickenter","title"],[1,"icon-spin","icon-spinner"],[3,"class"],[1,"node-icon",3,"clickenter","title"],[3,"title"],[1,"node-type"]]},template:function(n,o){1&n&&(e.j41(0,"div",1)(1,"span",2),e.pXf(2,0),e.k0s(),e.j41(3,"button",3),e.bIt("click",function(){return o.refresh()}),e.nrm(4,"i",4),e.k0s()(),e.j41(5,"div",5)(6,"cdk-virtual-scroll-viewport",6),e.DNE(7,_e,12,20,"ng-container",7),e.k0s()()),2&n&&(e.R7$(6),e.Y8G("itemSize",22),e.R7$(),e.Y8G("cdkVirtualForOf",o.nodes))},dependencies:[N.Z,P.S,A.b,H.yg,H.E$,H.d6,v.W],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{padding:15px 15px 10px;background-color:var(--background-transparent);color:var(--on-control)}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{padding-right:10px;vertical-align:middle;color:var(--on-control-active);font-size:20px;font-weight:100}[_nghost-%COMP%]   .tree[_ngcontent-%COMP%]{margin-top:10px;flex:1}[_nghost-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{width:100%;height:100%;min-height:100%;overflow-x:hidden}[_nghost-%COMP%]   cdk-virtual-scroll-viewport[_ngcontent-%COMP%]     .cdk-virtual-scroll-content-wrapper{width:100%}[_nghost-%COMP%]   .node[_ngcontent-%COMP%]{width:100%;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-decoration:none;vertical-align:middle;height:22px;cursor:pointer;-webkit-user-select:none;user-select:none;font-size:.9em}[_nghost-%COMP%]   .node[_ngcontent-%COMP%]   .node-toggle[_ngcontent-%COMP%]{display:inline-block;min-width:20px}[_nghost-%COMP%]   .node[_ngcontent-%COMP%]   .node-type[_ngcontent-%COMP%]{padding-left:5px;font-size:.7em;text-transform:uppercase}[_nghost-%COMP%]   .node.active[_ngcontent-%COMP%]{color:var(--on-control-hover)}"]})}return i})();var Ce=E(7311);const me=i=>["/admin/folder",i,"overview"],Ee=i=>["/admin/folder",i,"tracks"],X=i=>["/admin/folder",i,"sub-folders"],O=i=>["/admin/folder",i,"tags"],m=i=>["/admin/folder",i,"health"],a=i=>["/admin/folder",i,"tracks-health"];function s(i,d){1&i&&(e.j41(0,"a"),e.nrm(1,"i",15),e.qex(2),e.pXf(3,0),e.bVm(),e.k0s())}function _(i,d){1&i&&(e.j41(0,"a"),e.nrm(1,"i",16),e.qex(2),e.pXf(3,1),e.bVm(),e.k0s())}function l(i,d){if(1&i&&(e.j41(0,"nav",13)(1,"ul",17)(2,"li",18)(3,"a"),e.pXf(4,2),e.k0s()(),e.j41(5,"li",18)(6,"a"),e.pXf(7,3),e.k0s()(),e.j41(8,"li",18)(9,"a"),e.pXf(10,4),e.k0s()(),e.j41(11,"li",18)(12,"a"),e.pXf(13,5),e.k0s()(),e.j41(14,"li",18)(15,"a"),e.pXf(16,6),e.k0s()(),e.j41(17,"li",18)(18,"a"),e.pXf(19,7),e.k0s()()()()),2&i){const t=e.XpG();e.R7$(2),e.Y8G("routerLink",e.eq3(6,me,t.id)),e.R7$(3),e.Y8G("routerLink",e.eq3(8,Ee,t.id)),e.R7$(3),e.Y8G("routerLink",e.eq3(10,X,t.id)),e.R7$(3),e.Y8G("routerLink",e.eq3(12,O,t.id)),e.R7$(3),e.Y8G("routerLink",e.eq3(14,m,t.id)),e.R7$(3),e.Y8G("routerLink",e.eq3(16,a,t.id))}}let p=(()=>{class i{route;router;uiState;id="";tree;rightActive=!1;unsubscribe=new q.B;mode="overview";constructor(t,n,o){this.route=t,this.router=n,this.uiState=o}refresh(){this.tree&&this.tree.refresh()}selectionChange(t){this.router.navigate([`/admin/folder/${t.id}/${this.mode}`]).catch(n=>{console.error(n)})}onFolderUpdate(t){this.tree&&this.tree.onFolderUpdate(t)}ngOnInit(){this.router.events.pipe((0,G.Q)(this.unsubscribe)).subscribe(t=>{if(t instanceof D.wF&&this.route.firstChild&&this.route.firstChild.snapshot.url[0]){const n=this.route.firstChild.snapshot.url[0].path;J.includes(n)&&(this.mode=n)}}),this.route&&this.route.params.pipe((0,G.Q)(this.unsubscribe)).subscribe(t=>{const n=t.id;this.id=n,this.tree&&n&&setTimeout(()=>{this.tree&&this.tree.selectFolderByID(n)})}),this.tree&&(this.tree.expandIDs=this.uiState.data["app-admin-folders"]||[]),this.refresh()}ngOnDestroy(){this.tree&&(this.uiState.data["app-admin-folders"]=this.tree.expandIDs),this.unsubscribe.next(),this.unsubscribe.complete()}static \u0275fac=function(n){return new(n||i)(e.rXU(D.nX),e.rXU(D.Ix),e.rXU(f.z_))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-folder"]],viewQuery:function(n,o){if(1&n&&e.GBs(W,7),2&n){let r;e.mGM(r=e.lsd())&&(o.tree=r.first)}},hostVars:2,hostBindings:function(n,o){2&n&&e.AVh("right-active",o.rightActive)},decls:11,vars:3,consts:()=>{let t,n,o,r,g,C,T,b;return t=$localize`:␟7ec7b22d8039675be42abd55ef2b6adad32ba322␟6821898315173685664:Show Folder Tools`,n=$localize`:␟916b83c8c6c89e399186184c2198e5b4a760361b␟3376465991526605180:Show Folder Tree`,o=$localize`:␟e95ae009d0bdb45fcc656e8b65248cf7396080d5␟2614607010577950577:Overview`,r=$localize`:␟cb98522066062d775f3b81f29c898a7cc76292c0␟1575810254412583888:Tracks`,g=$localize`:␟3fde556358b58d910adc30abaaff2433f0bb5f6c␟1205037876874222931:Folders`,C=$localize`:␟cafc87479686947e2590b9f588a88040aeaf660b␟7886570921510760899:Tags`,T=$localize`:␟d2bcd3296d2850de762fb943060b7e086a893181␟2041675390931385838:Health`,b=$localize`:␟a12d1012d8918ce2725b84077784140cb3381cd7␟4537451926022625647:Track Health`,[t,n,o,r,g,C,T,b,[1,"toggle",3,"click"],[1,"content"],[1,"left-content"],[3,"selectionChange"],[1,"right-content"],[1,"navigation"],[1,"router-content"],[1,"icon-right"],[1,"icon-left"],[1,"tabs"],["routerLinkActive","active",3,"routerLink"]]},template:function(n,o){1&n&&(e.j41(0,"button",8),e.bIt("click",function(){return o.rightActive=!o.rightActive}),e.DNE(1,s,4,0,"a")(2,_,4,0,"a"),e.k0s(),e.j41(3,"div",9)(4,"div",10)(5,"app-admin-folder-tree",11),e.bIt("selectionChange",function(g){return o.selectionChange(g)}),e.k0s()(),e.nrm(6,"app-splitter"),e.j41(7,"div",12),e.DNE(8,l,20,18,"nav",13),e.j41(9,"div",14),e.nrm(10,"router-outlet"),e.k0s()()()),2&n&&(e.R7$(),e.vxM(1,o.rightActive?-1:1),e.R7$(),e.vxM(2,o.rightActive?2:-1),e.R7$(6),e.vxM(8,o.id?8:-1))},dependencies:[Ce.H,D.n3,D.Wk,D.wQ,W],styles:["[_nghost-%COMP%]{overflow-y:auto;overflow-x:hidden;height:100%;width:100%;min-height:100%;flex:1 1 auto;position:relative;display:flex;flex-direction:column;overflow:hidden}[_nghost-%COMP%]   .toggle[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]{width:100%;z-index:1;display:flex;flex-flow:row wrap;justify-content:space-between;align-items:center;background-color:var(--background-transparent);color:var(--on-control)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%]{padding-left:0;margin-top:0;margin-bottom:0;list-style:none;border:none;display:flex;flex-flow:row wrap;width:100%}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{position:relative;display:block;margin-bottom:-1px;flex:1;align-self:stretch;border-top-width:4px;border-top-style:solid;border-top-color:transparent;border-bottom-width:4px;border-bottom-style:solid;border-bottom-color:transparent;padding:0}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]:hover{background-color:var(--control-hover);transition:all .4s ease;border-bottom-width:4px;border-bottom-style:solid;border-bottom-color:transparent}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{padding:10px 0;text-align:center;align-items:center;align-content:center;justify-content:center;margin-right:2px;line-height:1.42857143;border-radius:4px 4px 0 0;position:relative;display:flex;cursor:pointer;border:none;font-size:14px;text-transform:uppercase;letter-spacing:.5px;height:100%;color:var(--on-control);-webkit-user-select:none;user-select:none}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:focus, [_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:hover{background-color:unset;border:none;color:var(--on-control-hover)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]{cursor:default;border-bottom-color:var(--primary)!important}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{cursor:default;background-color:unset;color:var(--on-control-hover)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]:focus, [_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.active[_ngcontent-%COMP%]:hover{border-bottom-color:var(--primary)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.disabled[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{color:var(--on-control-ambient-disabled)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.disabled[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:focus, [_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li.disabled[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:hover{color:var(--on-control-ambient-disabled);text-decoration:none;cursor:not-allowed;background-color:transparent}@media (max-width: 768px){[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%]{align-items:center;align-content:center;justify-content:center}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{padding:5px;min-width:33%}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{font-size:.8em}}@media (max-width: 400px){[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{padding:0 5px}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%] > li[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{font-size:.7em}}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs.mini[_ngcontent-%COMP%]{padding-left:15px;padding-right:15px}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs.mini[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{flex:0}@media (max-width: 768px){[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .tabs.mini[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{min-width:20px}}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;height:100%;flex:1;display:flex;flex-flow:row nowrap;overflow:hidden;align-items:flex-start;align-content:flex-start;padding:0;min-height:100%}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .left-content[_ngcontent-%COMP%]{height:100%;width:20%;display:block;border-right:1px solid var(--background-border);min-width:240px}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]{width:80%;flex-shrink:1;flex-grow:1;height:100%;display:flex;flex-flow:column nowrap;position:relative;overflow:hidden}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]   .router-content[_ngcontent-%COMP%]{width:100%;height:100%;display:block;overflow:hidden}@media (max-width: 522px){[_nghost-%COMP%]{height:100%;width:100%;min-height:100%;overflow:hidden}[_nghost-%COMP%]   .toggle[_ngcontent-%COMP%]{display:block;position:relative;width:100%;height:33px;text-align:center;padding-top:5px;border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;height:calc(100% - 33px);min-height:calc(100% - 33px);overflow:hidden;display:block;flex:none;position:relative}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-splitter[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .left-content[_ngcontent-%COMP%]{display:flex;height:100%;width:100%}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]{display:none;height:100%;width:100%}.right-active[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .left-content[_ngcontent-%COMP%]{display:none}.right-active[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .right-content[_ngcontent-%COMP%]{display:flex}}"]})}return i})(),h=(()=>{class i{route;id;unsubscribe=new q.B;constructor(t){this.route=t}ngOnInit(){this.route&&this.route.parent&&this.route.parent.params.pipe((0,G.Q)(this.unsubscribe)).subscribe(t=>{this.resolve(t),this.refresh()})}idChanged(){}refresh(){}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}resolve(t){this.id=t.id,this.idChanged()}static \u0275fac=function(n){return new(n||i)(e.rXU(D.nX))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-base-parent-view-id"]],decls:0,vars:0,template:function(n,o){}})}return i})(),S=(()=>{class i{data;tree;selectionChange(t){this.data&&(this.data.folder=t)}dialogInit(t,n){this.data=n.data,this.tree&&(this.tree.refresh(),this.data?.selectID&&this.tree.selectFolderByID(this.data.selectID))}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-dialog-choose-folder"]],viewQuery:function(n,o){if(1&n&&e.GBs(W,7),2&n){let r;e.mGM(r=e.lsd())&&(o.tree=r.first)}},decls:1,vars:1,consts:[[3,"selectionChange","autoSelect"]],template:function(n,o){1&n&&(e.j41(0,"app-admin-folder-tree",0),e.bIt("selectionChange",function(g){return o.selectionChange(g)}),e.k0s()),2&n&&e.Y8G("autoSelect",!0)},dependencies:[W],styles:["[_nghost-%COMP%]{flex:1}"]})}return i})();const R=()=>({standalone:!0});function I(i,d){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"form")(2,"div",1)(3,"label",2),e.pXf(4,0),e.k0s(),e.j41(5,"input",3),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.edit.name,o)||(r.edit.name=o),e.Njj(o)}),e.k0s()()()()}if(2&i){const t=e.XpG();e.R7$(5),e.Y8G("ngModelOptions",e.lJ4(2,R)),e.R50("ngModel",t.edit.name)}}let k=(()=>{class i{edit;dialogInit(t,n){this.edit=n.data}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-dialog-folder"]],decls:1,vars:1,consts:()=>{let t;return t=$localize`:␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,[t,[1,"user-form-control"],["for","dialog-folder-edit"],["id","dialog-folder-edit","type","text","name","folder-name",3,"ngModelChange","ngModelOptions","ngModel"]]},template:function(n,o){1&n&&e.DNE(0,I,6,3,"div"),2&n&&e.vxM(0,o.edit?0:-1)},dependencies:[u.qT,u.me,u.BC,u.cb,u.vS,u.cV],styles:["[_nghost-%COMP%] > div[_ngcontent-%COMP%]{margin-left:20px;margin-right:20px}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{font-size:1.3em;line-height:1.3em}[_nghost-%COMP%]   .user-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block}"]})}return i})();var $=E(8707),F=E(3048),j=E(3903),Y=E(8723);const ie=(i,d)=>d.folder.id,ne=i=>["/admin/folder",i,"overview"];function ee(i,d){if(1&i&&e.EFF(0),2&i){const t=e.XpG().$implicit;e.SpI(" / ",null==t.folder.tag?null:t.folder.tag.albumType," ")}}function Se(i,d){if(1&i){const t=e.RV6();e.j41(0,"tr",14),e.bIt("click",function(){const o=e.eBV(t).$implicit;return e.Njj(o.selected=!o.selected)}),e.j41(1,"td",8)(2,"a",15),e.EFF(3),e.k0s()(),e.j41(4,"td",9),e.EFF(5),e.k0s(),e.j41(6,"td",10),e.EFF(7),e.k0s(),e.j41(8,"td",11),e.EFF(9),e.k0s(),e.j41(10,"td",12),e.EFF(11),e.DNE(12,ee,1,1),e.k0s()()}if(2&i){const t=d.$implicit;e.AVh("selected",t.selected),e.R7$(2),e.Y8G("routerLink",e.eq3(9,ne,t.folder.id)),e.R7$(),e.JRh(t.folder.name),e.R7$(2),e.JRh(null==t.folder.tag?null:t.folder.tag.artist),e.R7$(2),e.JRh(null==t.folder.tag?null:t.folder.tag.album),e.R7$(2),e.JRh(null==t.folder.tag?null:t.folder.tag.year),e.R7$(2),e.SpI(" ",t.folder.type," "),e.R7$(),e.vxM(12,null!=t.folder.tag&&t.folder.tag.albumType?12:-1)}}function be(i,d){if(1&i&&(e.j41(0,"table",6)(1,"tr",7)(2,"td",8),e.pXf(3,0),e.k0s(),e.j41(4,"td",9),e.pXf(5,1),e.k0s(),e.j41(6,"td",10),e.pXf(7,2),e.k0s(),e.j41(8,"td",11),e.pXf(9,3),e.k0s(),e.j41(10,"td",12),e.pXf(11,4),e.k0s()(),e.Z7z(12,Se,13,11,"tr",13,ie),e.k0s()),2&i){const t=e.XpG();e.R7$(12),e.Dyx(t.folderItems)}}class De{folder;selected;constructor(d){this.folder=d}}let xe=(()=>{class i{folders=[];folderItems=[];getSortValue(t,n){switch(t){case"name":return n.name;case"artist":return n.tag?.artist;case"album":return n.tag?.album;case"type":return n.type;default:return}}ngOnChanges(){this.folderItems=(this.folders||[]).map(t=>new De(t))}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-folder-list"]],inputs:{folders:"folders"},features:[e.OA$],decls:2,vars:2,consts:()=>{let t,n,o,r,g;return t=$localize`:␟fdf7cbdc140d0aab0f0b6c06065a0fd448ed6a2e␟5701618810648052610:Title`,n=$localize`:␟378660a509ecaa4d2dd3b4b0b8975760cfe3576d␟2492300395471245755:Artist`,o=$localize`:␟842a4fcf548e0c52ebab1cb5362f47ab2ca83e12␟1393837337557373364:Album`,r=$localize`:␟f6e04edea3bb3a59d5904725bfbc2c440e793001␟1464072562214937907:Year`,g=$localize`:␟f61c6867295f3b53d23557021f2f4e0aa1d0b8fc␟8650499415827640724:Type`,[t,n,o,r,g,["name","Folders",3,"list"],[1,"folders"],[1,"folder","heading"],[1,"title"],[1,"artist"],[1,"album"],[1,"year"],[1,"type"],[1,"folder",3,"selected"],[1,"folder",3,"click"],[3,"routerLink"]]},template:function(n,o){1&n&&(e.nrm(0,"app-background-text-list",5),e.DNE(1,be,14,0,"table",6)),2&n&&(e.Y8G("list",o.folderItems),e.R7$(),e.vxM(1,o.folderItems&&o.folderItems.length>0?1:-1))},dependencies:[j.F,D.Wk],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]{padding:15px;font-size:.8em;width:100%}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{font-size:.9em}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]{border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .folder.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}"]})}return i})();function Le(i,d){1&i&&e.nrm(0,"app-loading")}function ve(i,d){if(1&i){const t=e.RV6();e.j41(0,"button",9),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.moveSubfolders())}),e.nrm(1,"i",10),e.k0s()}}function Ge(i,d){if(1&i&&e.nrm(0,"app-admin-folder-list",8),2&i){const t=e.XpG(2);e.Y8G("folders",t.folder.folders)}}function we(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",0)(1,"div",1)(2,"button",2),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.refresh())}),e.nrm(3,"i",3),e.k0s(),e.j41(4,"button",4),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.newFolder())}),e.nrm(5,"i",5),e.k0s(),e.DNE(6,ve,2,0,"button",6),e.k0s(),e.nrm(7,"app-background-text-list",7),e.DNE(8,Ge,1,1,"app-admin-folder-list",8),e.k0s()}if(2&i){const t=e.XpG();e.R7$(6),e.vxM(6,t.folder.folders&&t.folder.folders.length?6:-1),e.R7$(),e.Y8G("list",t.folder.folders),e.R7$(),e.vxM(8,t.folder.folders&&t.folder.folders.length?8:-1)}}let Ne=(()=>{class i extends h{jam;notify;folderService;dialogsService;dialogOverlay;folder;constructor(t,n,o,r,g,C){super(t),this.jam=n,this.notify=o,this.folderService=r,this.dialogsService=g,this.dialogOverlay=C}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,G.Q)(this.unsubscribe)).subscribe(t=>{t.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}refresh(){this.folder=void 0,this.id&&this.jam.folder.id({id:this.id,folderIncFolders:!0,folderIncTag:!0}).then(t=>{this.folder=t}).catch(t=>{this.notify.error(t)})}newFolder(){var t=this;if(!this.folder)return;const n=this.folder,o={folder:n,name:""};var r;this.dialogOverlay.open({childComponent:k,title:"New Folder",data:o,onOkBtn:(r=(0,L.A)(function*(){try{t.jam.folder.create({id:n.id,name:o.name}).then(g=>{t.folderService.waitForQueueResult("Creating Folder",g,[],[n.id])}).catch(g=>{t.notify.error(g)})}catch(g){return t.notify.error(g),Promise.reject(g)}}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,L.A)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}moveSubfolders(){var t=this;if(!this.id||!this.folder?.folders)return;const n=this.id,o=this.folder.folders.map(C=>C.id),r=[n].concat(o),g={selectID:n,disableIDs:r};var C;this.dialogOverlay.open({title:"Move Subfolders to",childComponent:S,data:g,panelClass:"overlay-panel-large-buttons",onOkBtn:(C=(0,L.A)(function*(){try{const T=g.folder;if(!T)return;r.push(T.id),t.jam.folder.move({ids:o,newParentID:T.id}).then(b=>{t.folderService.waitForQueueResult("Moving Folders",b,[],r)}).catch(b=>{t.notify.error(b)})}catch(T){return t.notify.error(T),Promise.reject(T)}}),function(){return C.apply(this,arguments)}),onCancelBtn:function(){var C=(0,L.A)(function*(){return Promise.resolve()});return function(){return C.apply(this,arguments)}}()})}static \u0275fac=function(n){return new(n||i)(e.rXU(D.nX),e.rXU(M.UA),e.rXU(f.FL),e.rXU(f.pp),e.rXU($.JQ),e.rXU(F.iD))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-folder-folders"]],features:[e.Vt3],decls:2,vars:1,consts:()=>{let t,n,o;return t=$localize`:␟c8d1785038d461ec66b5799db21864182b35900a␟1102717806459547726:Refresh`,n=$localize`:␟65ab0e571a2c4b74cf959aa0fecf26f78fae4b9f␟5184355384536429227:New Folder…`,o=$localize`:␟defb5986728ca6ef16d61914a5b0642c36084245␟4062236829893650390:Move Subfolders…`,[[1,"folders"],[1,"actions"],["title",t,1,"button-on-control",3,"click"],[1,"icon-reload"],["title",n,1,"button-on-control",3,"click"],[1,"icon-plus"],["title",o,1,"button-on-control"],["name","Folders",3,"list"],[3,"folders"],["title",o,1,"button-on-control",3,"click"],[1,"icon-right-bold"]]},template:function(n,o){1&n&&e.DNE(0,Le,1,0,"app-loading")(1,we,9,3),2&n&&e.vxM(0,o.folder?o.folder.folders?1:-1:0)},dependencies:[j.F,Y.q,xe],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:block;overflow:hidden}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .folders[_ngcontent-%COMP%]   app-admin-folder-list[_ngcontent-%COMP%]{overflow-y:auto}"]})}return i})();var Pe=E(2702),re=E(1626),ye=E(3564),Ue=E(1893);function Fe(i,d){if(1&i){const t=e.RV6();e.j41(0,"image-cropper",8),e.bIt("imageCropped",function(o){e.eBV(t);const r=e.XpG();return e.Njj(r.imageCropped(o))})("imageLoaded",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.imageLoaded())})("cropperReady",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.cropperReady())})("loadImageFailed",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.loadImageFailed())}),e.k0s()}if(2&i){const t=e.XpG();e.Y8G("imageBase64",t.imageBase64)("format","jpeg")("maintainAspectRatio",t.maintainAspectRatio)}}function Te(i,d){if(1&i&&(e.j41(0,"div",5),e.nrm(1,"img",9),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("src",t.croppedImage,e.B4B)}}let ke=(()=>{class i{app;jam;folderService;notify;data;imageBase64="";croppedImage;croppedImageFile;mimeType="image/jpeg";maintainAspectRatio=!0;imageEdited=new e.bkB;unsubscribe=new q.B;constructor(t,n,o,r){this.app=t,this.jam=n,this.folderService=o,this.notify=r}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}load(){this.data&&this.jam.image.imageBinary({id:this.data.artwork.id}).then(t=>{this.imageBase64=`data:${t.contentType||"image/jpeg"};base64,${(0,Ue.J)(t.buffer)}`}).catch(t=>{this.notify.error(t)})}imageCropped(t){t.base64&&(this.croppedImage=t.base64,this.croppedImageFile=(0,de.Z)(t.base64))}imageLoaded(){}cropperReady(){}loadImageFailed(){}ngOnChanges(){this.load()}upload(){if(!this.croppedImageFile||!this.data)return;const t=this.data.folderID,n=new File([this.croppedImageFile],this.data.artwork.name,{type:this.croppedImageFile.type});this.jam.artwork.update({id:this.data.artwork.id},n).pipe((0,G.Q)(this.unsubscribe)).subscribe(o=>{o.type===re.hv.Response&&(this.folderService.waitForQueueResult("Updating Folder Artwork",o.body,[t]),this.imageEdited.emit())},o=>{this.notify.error(o)},()=>{this.notify.success("Upload done")})}static \u0275fac=function(n){return new(n||i)(e.rXU(f.d3),e.rXU(M.UA),e.rXU(f.pp),e.rXU(f.FL))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-artwork-edit"]],inputs:{data:"data"},outputs:{imageEdited:"imageEdited"},features:[e.OA$],decls:10,vars:4,consts:()=>{let t,n,o;return t=$localize`:␟9adf24384bd663ce0cf256940aae864e83991330␟6234579371454134968:Maintain Aspect Ratio`,n=$localize`:␟f8c2b6ea1dd59afb3f3f555afbd132af40653bba␟1396820513327307838:Use Cropped Artwork`,o=$localize`:␟4fc4437088a4fa1764a26dd6b3552dbca6b64541␟777253553934937544:Cropped Image`,[t,n,[1,"image-crop"],["type","checkbox",3,"ngModelChange","checked","ngModel"],[3,"imageBase64","format","maintainAspectRatio"],[1,"image-preview"],[1,"buttons"],[1,"button-on-control",3,"click"],[3,"imageCropped","imageLoaded","cropperReady","loadImageFailed","imageBase64","format","maintainAspectRatio"],["alt",o,3,"src"]]},template:function(n,o){1&n&&(e.j41(0,"div",2)(1,"label")(2,"input",3),e.mxI("ngModelChange",function(g){return e.DH7(o.maintainAspectRatio,g)||(o.maintainAspectRatio=g),g}),e.k0s(),e.qex(3),e.pXf(4,0),e.bVm(),e.k0s(),e.DNE(5,Fe,1,3,"image-cropper",4),e.k0s(),e.DNE(6,Te,2,1,"div",5),e.j41(7,"div",6)(8,"button",7),e.bIt("click",function(){return o.upload()}),e.pXf(9,1),e.k0s()()),2&n&&(e.R7$(2),e.Y8G("checked",o.maintainAspectRatio),e.R50("ngModel",o.maintainAspectRatio),e.R7$(3),e.vxM(5,o.imageBase64?5:-1),e.R7$(),e.vxM(6,o.croppedImage?6:-1))},dependencies:[u.Zm,u.BC,u.vS,de._D],styles:["[_nghost-%COMP%]{width:100%;display:block;text-align:center}[_nghost-%COMP%]   image-cropper[_ngcontent-%COMP%]{width:300px;display:block}[_nghost-%COMP%]   .image-crop[_ngcontent-%COMP%]{display:inline-block;text-align:center;margin-left:10px;margin-right:10px}[_nghost-%COMP%]   .image-preview[_ngcontent-%COMP%]{margin-left:10px;margin-right:10px;display:inline-block}[_nghost-%COMP%]   .image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:300px}"]})}return i})();function ge(i,d){if(1&i){const t=e.RV6();e.j41(0,"app-admin-artwork-edit",1),e.bIt("imageEdited",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.onImageEdited())}),e.k0s()}if(2&i){const t=e.XpG();e.Y8G("data",t.data)}}let pe=(()=>{class i{data;reference;loading=!0;dialogInit(t,n){this.data=n.data,this.reference=t}onImageEdited(){this.reference&&this.reference.close()}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-image-edit-overlay-content"]],decls:1,vars:1,consts:[[3,"data"],[3,"imageEdited","data"]],template:function(n,o){1&n&&e.DNE(0,ge,1,1,"app-admin-artwork-edit",0),2&n&&e.vxM(0,o.data?0:-1)},dependencies:[ke]})}return i})();const ot=["inlineEditControl"];function it(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",1)(1,"input",2,0),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.value,o)||(r.value=o),e.Njj(o)}),e.bIt("blur",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.onBlur())})("keydown.enter",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.apply())}),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(),e.Y8G("required",t.required)("name",t.value)("type",t.type)("placeholder",t.placeholder),e.R50("ngModel",t.value)}}function rt(i,d){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"div",3),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.edit(o.value))})("focus",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.edit(o.value))}),e.EFF(2),e.nrm(3,"i",4),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(2),e.SpI("",t.value,"\xa0")}}let Ve=(()=>{class i{inlineEditControl;placeholder="";type="text";required=!1;disabled=!1;endEditRequest=new e.bkB;editing=!1;editValue="";preValue="";onChange=Function.prototype;onTouched=Function.prototype;get value(){return this.editValue}set value(t){t!==this.editValue&&(this.editValue=t,this.onChange(t))}writeValue(t){this.editValue=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}onBlur(){this.editing=!1,this.preValue!==this.editValue&&this.endEditRequest.emit()}apply(){this.editing=!1,this.endEditRequest.emit()}edit(t){this.disabled||(this.preValue=t,this.editing=!0,setTimeout(()=>{this.inlineEditControl?.nativeElement&&this.inlineEditControl.nativeElement.focus()}))}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-inline-edit"]],viewQuery:function(n,o){if(1&n&&e.GBs(ot,5),2&n){let r;e.mGM(r=e.lsd())&&(o.inlineEditControl=r.first)}},inputs:{placeholder:"placeholder",type:"type",required:"required",disabled:"disabled"},outputs:{endEditRequest:"endEditRequest"},features:[e.Jv_([{provide:u.kq,useExisting:i,multi:!0}])],decls:2,vars:2,consts:()=>{let t;return t=$localize`:␟32dfa3de9f35ea40a3c19960ab339727b437791f␟2350070440008093526:Click to edit`,[["inlineEditControl",""],[1,"inline-edit-edit"],[3,"ngModelChange","blur","keydown.enter","required","name","type","placeholder","ngModel"],["title",t,"tabindex","0",1,"inline-edit",3,"click","focus"],[1,"icon-edit"]]},template:function(n,o){1&n&&e.DNE(0,it,3,5,"div",1)(1,rt,4,1,"div"),2&n&&(e.vxM(0,o.editing?0:-1),e.R7$(),e.vxM(1,o.editing?-1:1))},dependencies:[u.me,u.BC,u.YS,u.vS],styles:[".inline-edit{cursor:pointer}.inline-edit i{font-size:.7em}.inline-edit-edit{width:100%;display:block}.inline-edit-edit input{width:100%}\n"],encapsulation:2})}return i})();var at=E(7893);const st=(i,d)=>d.artwork.id;function _t(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",3),e.bIt("keydown.enter",function(){const o=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.editArtwork(o.artwork))}),e.j41(1,"div",4)(2,"img",5),e.bIt("clickenter",function(){const o=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.editArtwork(o.artwork))}),e.k0s(),e.j41(3,"div",6),e.EFF(4),e.k0s(),e.j41(5,"div",7),e.EFF(6),e.k0s(),e.j41(7,"div",8),e.pXf(8,0),e.k0s(),e.j41(9,"div",9),e.EFF(10),e.nI1(11,"filesize"),e.k0s()(),e.j41(12,"div",10)(13,"app-inline-edit",11),e.mxI("ngModelChange",function(o){const r=e.eBV(t).$implicit;return e.DH7(r.name,o)||(r.name=o),e.Njj(o)}),e.bIt("endEditRequest",function(){const o=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.editArtworkName(o))}),e.k0s(),e.j41(14,"a",12),e.bIt("clickenter",function(){const o=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.removeArtwork(o))}),e.nrm(15,"i",13),e.k0s()()()}if(2&i){const t=d.$implicit;e.R7$(2),e.Y8G("src",t.thumbnail,e.B4B),e.R7$(2),e.JRh(t.artwork.types),e.R7$(2),e.JRh(t.artwork.format),e.R7$(2),e.uP7(t.artwork.width)(t.artwork.height),e.nnv(8),e.R7$(2),e.JRh(e.bMT(11,7,t.artwork.size)),e.R7$(3),e.R50("ngModel",t.name)}}function lt(i){const d=i.split(".");return d.pop(),d.join(".")}function ct(i){const d=i.split(".");return d[d.length-1]}let ze=(()=>{class i{app;jam;notify;folderService;dialogs;dialogOverlay;artworks;folderID;nodes;constructor(t,n,o,r,g,C){this.app=t,this.jam=n,this.notify=o,this.folderService=r,this.dialogs=g,this.dialogOverlay=C}ngOnChanges(){this.displayArtworks()}editArtworkName(t){this.jam.artwork.rename({id:t.artwork.id,newName:t.name}).then(n=>{this.folderService.waitForQueueResult("Renaming Artwork",n,this.folderID?[this.folderID]:[],[])}).catch(n=>{this.notify.error(n)})}editArtwork(t){this.dialogOverlay.open({childComponent:pe,title:"Edit Image",data:{artwork:t,folderID:this.folderID},panelClass:""})}showArtwork(t){const n=t.types.join(", ");this.dialogOverlay.open({title:n,childComponent:ye.G3,data:{name:n,url:this.jam.image.imageUrl({id:t.id})}})}removeArtwork(t){this.dialogs.confirm("Remove Artworks?",`Do you want to delete "${t.artwork.name}"?`,()=>{this.jam.artwork.remove({id:t.artwork.id}).then(n=>{this.nodes&&(this.nodes=this.nodes.filter(o=>o!==t)),this.folderService.waitForQueueResult("Removing Artwork",n,this.folderID?[this.folderID]:[])}).catch(n=>{this.notify.error(n)})})}displayArtworks(){this.nodes=[],this.artworks&&(this.nodes=this.artworks.map(t=>({name:lt(t.name),type:ct(t.name),artwork:t,thumbnail:this.jam.image.imageUrl({id:t.id,size:128,format:M.Nc.webp})})))}static \u0275fac=function(n){return new(n||i)(e.rXU(f.d3),e.rXU(M.UA),e.rXU(f.FL),e.rXU(f.pp),e.rXU($.JQ),e.rXU(F.iD))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-artwork-list"]],inputs:{artworks:"artworks",folderID:"folderID"},features:[e.OA$],decls:3,vars:0,consts:()=>{let t,n,o;return t=$localize`:␟787e502e73191d41bb2ee8adb258a7435c94f5af␟7553271888893131195:Artwork`,n=$localize`:␟4098fa43889421ae01e1548d8123ac604d0a741b␟365085234255662021:Delete Image`,o=$localize`:␟ffd1e79a49c10e27b981744032779234f6d86724␟8914490256741079776:${"\ufffd0\ufffd"}:INTERPOLATION:x${"\ufffd1\ufffd"}:INTERPOLATION_1:`,[o,["appFocusKeyList",""],["appFocusKeyListItem","",1,"artwork"],["appFocusKeyListItem","",1,"artwork",3,"keydown.enter"],[1,"artwork-img"],["alt",t,3,"clickenter","src"],[1,"mode"],[1,"format"],[1,"dims"],[1,"size"],[1,"artwork-types"],["type","text",3,"ngModelChange","endEditRequest","ngModel"],["title",n,1,"delete-button",3,"clickenter"],["aria-hidden","true",1,"icon-trash"]]},template:function(n,o){1&n&&(e.j41(0,"div",1),e.Z7z(1,_t,16,9,"div",2,st),e.k0s()),2&n&&(e.R7$(),e.Dyx(o.nodes))},dependencies:[N.Z,P.S,A.b,u.BC,u.vS,Ve,at.Q],styles:["[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]{display:inline-block;padding-top:15px;padding-right:15px;font-size:.8em;text-align:center;width:200px}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]{position:relative;overflow:hidden}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .dims[_ngcontent-%COMP%], [_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%], [_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .format[_ngcontent-%COMP%], [_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .mode[_ngcontent-%COMP%]{position:absolute;padding:5px;background-color:var(--background-transparent);color:var(--on-background-highlight)}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .mode[_ngcontent-%COMP%]{top:0;left:0}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .format[_ngcontent-%COMP%]{bottom:0;left:0}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .dims[_ngcontent-%COMP%]{top:0;right:0}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]   .artwork-img[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{bottom:0;right:0}[_nghost-%COMP%]   .artwork-types[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;overflow:hidden}[_nghost-%COMP%]   .artwork-types[_ngcontent-%COMP%]   app-inline-edit[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .artwork-types[_ngcontent-%COMP%]   .delete-button[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}"]})}return i})();const dt=(i,d)=>d.image;function gt(i,d){1&i&&e.nrm(0,"app-loading")}function pt(i,d){1&i&&e.nrm(0,"i",18)}function Mt(i,d){if(1&i){const t=e.RV6();e.j41(0,"input",20),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG().$implicit;return e.DH7(r.checked,o)||(r.checked=o),e.Njj(o)}),e.k0s()}if(2&i){const t=e.XpG().$implicit;e.Y8G("checked",t.checked),e.R50("ngModel",t.checked)}}function ht(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",12),e.bIt("keydown.enter",function(){const o=e.eBV(t).$implicit;return e.Njj(o.checked=!o.checked)}),e.j41(1,"div",13),e.bIt("clickenter",function(){const o=e.eBV(t).$implicit;return e.Njj(o.checked=!o.checked)}),e.nrm(2,"img",14),e.k0s(),e.j41(3,"div",15)(4,"div",16)(5,"form")(6,"span",17),e.DNE(7,pt,1,0,"i",18)(8,Mt,1,2,"input",19),e.EFF(9),e.k0s()()()()()}if(2&i){const t=d.$implicit;e.R7$(2),e.FS9("alt",t.name),e.Y8G("src",t.thumbnail,e.B4B),e.R7$(5),e.vxM(7,t.storing?7:-1),e.R7$(),e.vxM(8,t.storing?-1:8),e.R7$(),e.SpI(" ",t.name," ")}}function ft(i,d){if(1&i&&(e.j41(0,"div"),e.nrm(1,"app-background-text-list",9),e.j41(2,"div",10),e.Z7z(3,ht,10,5,"div",11,dt),e.k0s()()),2&i){const t=e.XpG();e.R7$(),e.Y8G("list",t.nodes),e.R7$(2),e.Dyx(t.nodes)}}function Ot(i,d){if(1&i&&e.nrm(0,"app-admin-artwork-list",21),2&i){const t=e.XpG(2);e.Y8G("folderID",t.data.folder.id)("artworks",t.artworks)}}function Ct(i,d){if(1&i&&(e.j41(0,"div",7)(1,"div",4),e.pXf(2,0),e.k0s(),e.DNE(3,Ot,1,2,"app-admin-artwork-list",21),e.k0s()),2&i){const t=e.XpG();e.R7$(3),e.vxM(3,t.isArtRefreshing?-1:3)}}function ut(i,d){1&i&&(e.j41(0,"button",22),e.nrm(1,"i",18),e.k0s())}function mt(i,d){if(1&i){const t=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.use())}),e.pXf(1,1),e.k0s()}}function Et(i,d){if(1&i&&(e.j41(0,"div"),e.DNE(1,ut,2,0,"button",22)(2,mt,2,0,"button",22),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.vxM(1,t.isWorking?1:-1),e.R7$(),e.vxM(2,t.isWorking?-1:2)}}let St=(()=>{class i{jam;notify;folderService;http;data;artworks;nodes;isWorking=!1;isArtRefreshing=!1;searchSource={name:"",url:""};unsubscribe=new q.B;constructor(t,n,o,r){this.jam=t,this.notify=n,this.folderService=o,this.http=r}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}ngOnChanges(){this.search(),this.data&&this.data.folder&&(this.data.folder.artworks?this.artworks=this.data.folder.artworks:this.refreshArtworks())}refreshArtworks(){this.data&&(this.isArtRefreshing=!0,this.jam.artwork.search({folderIDs:[this.data.folder.id]}).then(t=>{this.isArtRefreshing=!1,this.artworks=t.items}).catch(t=>{this.isArtRefreshing=!1,console.error(t)}))}loadWikiDataID(t){var n=this;return(0,L.A)(function*(){const o=yield n.jam.metadata.musicbrainzLookup({type:M.kv.artist,mbID:t});if(o?.data?.artist?.relations){const r=o.data.artist.relations.find(g=>"wikidata"===g.type);if(r?.url)return r.url.resource.split("/").pop()}})()}loadWikiCommonImage(t){var n=this;return(0,L.A)(function*(){const o=yield n.loadWikiDataID(t);if(!o)return;const g=(yield n.jam.metadata.wikidataLookup({wikiDataID:o}))?.data?.entity?.claims;if(!g)return;const C=Object.keys(g);for(const T of C){let b=g[T];b=b.filter(K=>"string"==typeof K.mainsnak.datavalue.value&&(0,Pe.QQ)(K.mainsnak.datavalue.value.toLowerCase(),["jpg","jpeg","png"]));const x=b[0];if(x){const Z=`https://en.wikipedia.org/w/api.php?format=json&action=query&origin=*&titles=File:${x.mainsnak.datavalue.value}&prop=imageinfo&iiprop=extmetadata|url&iiextmetadatafilter=LicenseShortName`,Q=yield n.http.get(Z).toPromise();if(Q&&Q.query.pages){const y=Q.query.pages[Object.keys(Q.query.pages)[0]];if(y&&y.imageinfo[0])return{name:M.w1.artist,thumbnail:y.imageinfo[0].url,image:y.imageinfo[0].url,licence:y.imageinfo[0].extmetadata.LicenseShortName.value,checked:!0,storing:!1,types:[M.w1.artist]}}}}})()}loadWikiCommon(t){this.loadWikiCommonImage(t).then(n=>{this.nodes=[],n&&(n.checked=!0,this.nodes.push(n))}).catch(n=>{this.nodes=[],this.notify.error(n)})}use(){const t=(this.nodes||[]).find(o=>o.checked&&!o.storing),n=this.data?.folder;t&&n?(this.isWorking=!0,t.storing=!0,this.jam.artwork.createByUrl({folderID:n.id,url:t.image,types:t.types}).then(o=>{this.folderService.waitForQueueResult("Creating Artwork",o,[n.id]).pipe((0,G.Q)(this.unsubscribe)).subscribe(()=>{t.storing=!1,t.checked=!1}),this.use()}).catch(o=>{t.storing=!1,this.notify.error(o)})):this.isWorking=!1}ngOnInit(){this.folderService.foldersChange.pipe((0,G.Q)(this.unsubscribe)).subscribe(t=>{t.id===this.data?.folder.id&&this.refreshArtworks()})}loadReleaseGroupAndRelease(t,n){this.jam.metadata.coverartarchiveLookup({type:M.vM.releaseGroup,mbID:n}).then(o=>{let r=this.coverArtResponseToNodes(o.data);this.jam.metadata.coverartarchiveLookup({type:M.vM.release,mbID:t}).then(g=>{r=r.concat(this.coverArtResponseToNodes(g.data)),this.display(r)}).catch(g=>{this.notify.error(g)})}).catch(o=>{this.notify.error(o)})}loadReleaseGroup(t){this.jam.metadata.coverartarchiveLookup({type:M.vM.releaseGroup,mbID:t}).then(n=>{const o=this.coverArtResponseToNodes(n.data);this.display(o)}).catch(n=>{this.notify.error(n)})}loadRelease(t){t&&this.jam.metadata.coverartarchiveLookup({type:M.vM.release,mbID:t}).then(n=>{const o=this.coverArtResponseToNodes(n.data);this.display(o),0===o.length&&this.data&&this.data.folder&&this.data.folder.tag&&this.data.folder.tag.mbReleaseGroupID&&(this.nodes=void 0,this.loadReleaseGroup(this.data.folder.tag.mbReleaseGroupID))}).catch(n=>{this.notify.error(n)})}coverArtResponseToNodes(t){return t.images?t.images.map(n=>(0===n.types.length&&n.types.push("Other"),{name:(n.types||[]).join("/").toLowerCase(),thumbnail:this.jam.metadata.coverartarchiveImageUrl({url:n.thumbnails.small}),licence:"",image:n.image,types:(n.types||[]).map(o=>o.toLowerCase()),checked:!1,storing:!1,stored:!1})):[]}search(){this.data&&this.data.folder&&this.data.folder.tag&&(this.data.folder.type===M.DZ.artist?this.data.folder.tag.mbArtistID&&(this.searchSource={name:"Wiki Commons",url:"https://commons.wikimedia.org"},this.loadWikiCommon(this.data.folder.tag.mbArtistID)):this.data&&this.data.folder&&this.data.folder.tag&&(this.searchSource={name:"Coverart Archive",url:"https://coverartarchive.org"},this.data.folder.tag.mbReleaseID&&this.data.folder.tag.mbReleaseGroupID?this.loadReleaseGroupAndRelease(this.data.folder.tag.mbReleaseID,this.data.folder.tag.mbReleaseGroupID):this.data.folder.tag.mbReleaseID?this.loadRelease(this.data.folder.tag.mbReleaseID):this.data.folder.tag.mbReleaseGroupID&&this.loadReleaseGroup(this.data.folder.tag.mbReleaseGroupID)))}display(t){this.nodes=t;let n=t.find(o=>1===o.types.length&&o.types[0]===M.w1.front);n||(n=t.find(o=>o.types.includes(M.w1.front))),n&&this.nodes.forEach(o=>o.checked=o===n)}static \u0275fac=function(n){return new(n||i)(e.rXU(M.UA),e.rXU(f.FL),e.rXU(f.pp),e.rXU(re.Qq))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-folder-artwork-search"]],inputs:{data:"data"},features:[e.OA$],decls:11,vars:6,consts:()=>{let t,n;return t=$localize`:␟7e7b22a71a4180b0fe37ddd31720efbd93a51ce7␟8668694612879894228:Current Images`,n=$localize`:␟317c5efadc941d938c6171d4890c06afbd8a8db3␟826482080541471028:Use Checked Artwork`,[t,n,[1,"image-selector"],[1,"art-source"],[1,"section"],["rel","noopener","target","_blank",3,"href"],[1,"artwork"],[1,"current"],[1,"buttons"],["name","Images",3,"list"],["appFocusKeyList","",1,"images"],["appFocusKeyListItem",""],["appFocusKeyListItem","",3,"keydown.enter"],[1,"image",3,"clickenter"],[3,"src","alt"],[1,"footer"],[1,"footer-content"],[1,"label"],[1,"icon-spin","icon-spinner"],["type","checkbox",3,"checked","ngModel"],["type","checkbox",3,"ngModelChange","checked","ngModel"],[3,"folderID","artworks"],[1,"button-on-control"],[1,"button-on-control",3,"click"]]},template:function(n,o){1&n&&(e.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"a",5),e.EFF(4),e.k0s()(),e.DNE(5,gt,1,0,"app-loading")(6,ft,5,1,"div"),e.k0s(),e.j41(7,"div",6),e.DNE(8,Ct,4,1,"div",7),e.k0s()(),e.j41(9,"div",8),e.DNE(10,Et,3,2,"div"),e.k0s()),2&n&&(e.R7$(3),e.Y8G("href",o.searchSource.url,e.B4B),e.R7$(),e.JRh(o.searchSource.name),e.R7$(),e.vxM(5,o.nodes?-1:5),e.R7$(),e.vxM(6,o.nodes?6:-1),e.R7$(2),e.vxM(8,o.data&&o.artworks?8:-1),e.R7$(2),e.vxM(10,o.nodes&&o.nodes.length>0?10:-1))},dependencies:[j.F,Y.q,N.Z,P.S,A.b,u.qT,u.Zm,u.BC,u.cb,u.vS,u.cV,ze],styles:["[_nghost-%COMP%]   .image-selector[_ngcontent-%COMP%]{display:flex;flex-flow:column wrap;height:calc(100% - 40px)}[_nghost-%COMP%]   .image-buttons[_ngcontent-%COMP%]{height:40px}[_nghost-%COMP%]   .artwork[_ngcontent-%COMP%]{overflow-y:auto;width:50%;height:100%;padding-left:15px}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]{padding-right:15px;overflow-y:auto;width:50%;height:100%;border-right:1px solid var(--background-border)}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{display:inline-block;padding-top:15px;padding-right:15px;font-size:.8em}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:185px;min-width:185px;min-height:185px;height:auto}[_nghost-%COMP%]   .art-source[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{font-size:.8em}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]{border-bottom:1px solid var(--background-border);padding-bottom:5px}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-highlight)}[_nghost-%COMP%]   .section[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}"]})}return i})(),Be=(()=>{class i{data;dialogInit(t,n){this.data=n.data}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-dialog-folder-artwork-search"]],decls:1,vars:1,consts:[[3,"data"]],template:function(n,o){1&n&&e.nrm(0,"app-admin-folder-artwork-search",0),2&n&&e.Y8G("data",o.data)},dependencies:[St]})}return i})();const Tt=(i,d)=>d.hint.id,Nt=(i,d)=>d.name;function Pt(i,d){1&i&&(e.j41(0,"div",1)(1,"div",2),e.nrm(2,"i",3),e.k0s()())}function At(i,d){1&i&&(e.j41(0,"div",2),e.pXf(1,0),e.k0s())}function Rt(i,d){if(1&i&&(e.j41(0,"div",7),e.EFF(1),e.k0s()),2&i){const t=d.$implicit;e.R7$(),e.JRh(t)}}function It(i,d){if(1&i&&(e.j41(0,"div",2),e.nrm(1,"i",6),e.EFF(2),e.Z7z(3,Rt,2,1,"div",7,e.fX1),e.k0s()),2&i){const t=d.$implicit;e.R7$(2),e.SpI(" ",t.hint.name," "),e.R7$(),e.Dyx(t.details)}}function bt(i,d){1&i&&e.nrm(0,"i",3)}function Dt(i,d){if(1&i&&e.EFF(0),2&i){const t=e.XpG().$implicit;e.SpI(" ",t.name," ")}}function xt(i,d){if(1&i){const t=e.RV6();e.j41(0,"button",8),e.bIt("click",function(){const o=e.eBV(t).$implicit;return e.Njj(o.click())}),e.DNE(1,bt,1,0,"i",3)(2,Dt,1,1),e.k0s()}if(2&i){const t=d.$implicit;e.R7$(),e.vxM(1,t.running?1:-1),e.R7$(),e.vxM(2,t.running?-1:2)}}function Lt(i,d){if(1&i&&(e.j41(0,"div",1),e.DNE(1,At,2,0,"div",2),e.Z7z(2,It,5,1,"div",2,Tt),e.j41(4,"div",4),e.Z7z(5,xt,3,2,"button",5,Nt),e.k0s()()),2&i){const t=e.XpG();e.R7$(),e.vxM(1,0===t.hints.length?1:-1),e.R7$(),e.Dyx(t.hints),e.R7$(3),e.Dyx(t.solutions)}}let vt=(()=>{class i{app;router;jam;notify;dialogOverlay;folderService;hints;solutions=[];folderHealth;unsubscribe=new q.B;constructor(t,n,o,r,g,C){this.app=t,this.router=n,this.jam=o,this.notify=r,this.dialogOverlay=g,this.folderService=C}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}searchImages(t){this.dialogOverlay.open({title:"Search Artwork Images",childComponent:Be,data:{folder:t},panelClass:"overlay-panel-large-buttons"})}ngOnChanges(){this.display(this.folderHealth)}static describeImageInvalidHint(t){if(!t.details||0===t.details.length)return[];const n=[t.details[0].reason];return t.details[0].expected&&n.push(`Expected: ${t.details[0].expected} Actual: ${t.details[0].actual}`),n}static describeAlbumTracksMissingHint(t){if(!t.details||0===t.details.length)return[];const n=[];return t.details[0].expected&&n.push(`Expected: ${t.details[0].expected} Actual: ${t.details[0].actual}`),n}describeImageQualityHint(t,n){if(this.addAlbumImageSearchSolution(n),!t.details||0===t.details.length)return[];const o=[t.details[0].reason];return o.push(`Expected: ${t.details[0].expected} Actual: ${t.details[0].actual}`),o}addArtistImageSearchSolution(t){var r,n=this;if(t.tag&&t.tag.mbArtistID){const o={name:"Search",click:(r=(0,L.A)(function*(){n.searchImages(t)}),function(){return r.apply(this,arguments)})};this.solutions.push(o)}}addAlbumImageSearchSolution(t){var r,n=this;if(t.tag&&(t.tag.mbReleaseID||t.tag.mbReleaseGroupID)){const o={name:"Search",click:(r=(0,L.A)(function*(){n.searchImages(t)}),function(){return r.apply(this,arguments)})};this.solutions.push(o)}}addRenameSolution(t,n){var g,o=this;if(!this.solutions.find(r=>"Rename"===r.name)){const r={name:"Rename",click:(g=(0,L.A)(function*(){if(r.running)return;r.running=!0;const C=yield o.jam.folder.rename({id:t.id,name:n});o.folderService.waitForQueueResult("Renaming Folder",C,[t.id]).pipe((0,G.Q)(o.unsubscribe)).subscribe(()=>{r.running=!1})}),function(){return g.apply(this,arguments)})};this.solutions.push(r)}}addEditTagSolution(t){var r,n=this;if(!this.solutions.find(o=>"Edit Tags"===o.name)){const o={name:"Edit Tags",click:(r=(0,L.A)(function*(){n.router.navigate([`/admin/folder/${t.id}/tags`]).catch(g=>{console.error(g)})}),function(){return r.apply(this,arguments)})};this.solutions.push(o)}}describeMBIDMissingHint(t,n){return this.addEditTagSolution(n),[]}describeAlbumTagMissingHint(t,n){return this.addEditTagSolution(n),t.details?[`Expected: ${t.details.map(o=>o.expected).join(",")}`]:[]}describeNameNonConformHint(t,n){const o=t.details&&t.details.length>0?t.details[0].expected:"";return o?(this.addRenameSolution(n,o),[`Current: ${n.name}`,`Suggested Name: ${o}`]):[]}describeArtistImageMissingHint(t,n){return this.addArtistImageSearchSolution(n),[]}describeAlbumImageMissingHint(t,n){return this.addAlbumImageSearchSolution(n),[]}describeHint(t,n){switch(t.id){case M.kE.albumMBIDExists:return this.describeMBIDMissingHint(t,n);case M.kE.albumTagsExists:return this.describeAlbumTagMissingHint(t,n);case M.kE.albumNameConform:case M.kE.artistNameConform:return this.describeNameNonConformHint(t,n);case M.kE.albumImageExists:return this.describeAlbumImageMissingHint(t,n);case M.kE.albumTracksComplete:return i.describeAlbumTracksMissingHint(t);case M.kE.artistImageExists:return this.describeArtistImageMissingHint(t,n);case M.kE.artistImageValid:case M.kE.albumImageValid:return i.describeImageInvalidHint(t);case M.kE.albumImageQuality:return this.describeImageQualityHint(t,n)}return[]}display(t){this.hints=[],this.solutions=[],t?.health&&(this.hints=t.health.map(n=>({hint:n,details:this.describeHint(n,t.folder)})))}static \u0275fac=function(n){return new(n||i)(e.rXU(f.d3),e.rXU(D.Ix),e.rXU(M.UA),e.rXU(f.FL),e.rXU(F.iD),e.rXU(f.pp))};static \u0275cmp=e.VBU({type:i,selectors:[["app-folder-health"]],inputs:{folderHealth:"folderHealth"},features:[e.OA$],decls:2,vars:2,consts:()=>{let t;return t=$localize`:␟baa5a59fd701bf37b30140cf2080f8987db6c2e9␟4786331182153457864:No Hints`,[t,[1,"hints"],[1,"hint"],[1,"icon-spin","icon-spinner"],[1,"solutions"],[1,"button-on-background"],[1,"icon-warning"],[1,"details"],[1,"button-on-background",3,"click"]]},template:function(n,o){1&n&&e.DNE(0,Pt,3,0,"div",1)(1,Lt,7,1,"div",1),2&n&&(e.vxM(0,o.hints?-1:0),e.R7$(),e.vxM(1,o.hints?1:-1))},styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .icon-warning[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]{padding-left:28px;font-size:.8em;text-transform:uppercase;min-width:30%;display:inline-block}[_nghost-%COMP%]   .hints[_ngcontent-%COMP%]{padding-top:10px}[_nghost-%COMP%]   .hint[_ngcontent-%COMP%]{padding-bottom:10px}"]})}return i})();const yt=(i,d)=>d.folder.id,kt=i=>["/admin/folder",i,"overview"];function $t(i,d){if(1&i&&(e.j41(0,"option",13),e.EFF(1),e.k0s()),2&i){const t=d.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function Gt(i,d){if(1&i){const t=e.RV6();e.j41(0,"select",12),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.filter,o)||(r.filter=o),e.Njj(o)}),e.bIt("ngModelChange",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.onFilterChange())}),e.Z7z(1,$t,2,2,"option",13,e.fX1),e.k0s()}if(2&i){const t=e.XpG();e.R50("ngModel",t.filter),e.R7$(),e.Dyx(t.modes)}}function wt(i,d){1&i&&e.nrm(0,"app-loading")}function Ut(i,d){if(1&i&&(e.j41(0,"div",18),e.pXf(1,0),e.k0s(),e.j41(2,"div",19),e.EFF(3),e.k0s(),e.j41(4,"div",20),e.EFF(5),e.k0s(),e.j41(6,"div",21),e.EFF(7),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(3),e.JRh(null==t.folder.tag?null:t.folder.tag.album),e.R7$(2),e.JRh(null==t.folder.tag?null:t.folder.tag.artist),e.R7$(2),e.JRh(null==t.folder.tag?null:t.folder.tag.year)}}function Ft(i,d){if(1&i&&(e.j41(0,"div",18),e.pXf(1,1),e.k0s(),e.j41(2,"div",19),e.EFF(3),e.k0s(),e.j41(4,"div",20),e.EFF(5),e.k0s(),e.j41(6,"div",21),e.EFF(7),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(3),e.JRh(null==t.folder.tag?null:t.folder.tag.album),e.R7$(2),e.JRh(null==t.folder.tag?null:t.folder.tag.artist),e.R7$(2),e.JRh(null==t.folder.tag?null:t.folder.tag.year)}}function Xt(i,d){if(1&i&&(e.j41(0,"div",18),e.pXf(1,2),e.k0s(),e.j41(2,"div",19),e.EFF(3),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(3),e.JRh(null==t.folder.tag?null:t.folder.tag.artist)}}function jt(i,d){if(1&i&&(e.j41(0,"div",18),e.pXf(1,3),e.k0s(),e.j41(2,"div",19),e.EFF(3),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(3),e.JRh(t.folder.name)}}function Vt(i,d){if(1&i&&(e.j41(0,"div",19),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.folder.name)}}function zt(i,d){if(1&i&&(e.j41(0,"div",11)(1,"div",14)(2,"a",15),e.DNE(3,Ut,8,3)(4,Ft,8,3)(5,Xt,4,1)(6,jt,4,1)(7,Vt,2,1),e.k0s()(),e.j41(8,"div",16),e.nrm(9,"app-folder-health",17),e.k0s()()),2&i){let t;const n=d.$implicit;e.R7$(2),e.Y8G("routerLink",e.eq3(3,kt,n.folder.id)),e.R7$(),e.vxM(3,"multialbum"===(t=n.folder.type)?3:"album"===t?4:"artist"===t?5:"collection"===t?6:7),e.R7$(6),e.Y8G("folderHealth",n)}}let Bt=(()=>{class i extends h{app;jam;notify;folderService;all;hints;filter;modes=[];public;constructor(t,n,o,r,g){super(t),this.app=n,this.jam=o,this.notify=r,this.folderService=g}onFilterChange(){this.reDisplay()}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,G.Q)(this.unsubscribe)).subscribe(t=>{if(t.id===this.id)this.refresh();else if(this.all){const n=this.all.find(o=>o.folder.id===t.id);n&&this.jam.folder.health({ids:[t.id],folderIncTag:!0}).then(o=>{if(this.all){const r=o.find(g=>g.folder.id===n.folder.id);r?this.all[this.all.indexOf(n)]=r:this.all=this.all.filter(g=>g.folder.id!==n.folder.id)}this.reDisplay()}).catch(o=>{this.notify.error(o)})}})}ngOnDestroy(){super.ngOnDestroy()}refresh(){this.hints=void 0,this.jam.folder.health({childOfID:this.id,folderIncTag:!0}).then(t=>{this.display(t)}).catch(t=>{this.notify.error(t)})}reDisplay(){this.hints=this.filter&&this.all?this.all.filter(t=>t.health&&t.health.find(n=>n.name===this.filter)):this.all}display(t){this.all=t,this.modes=[];for(const n of t)if(n.health)for(const o of n.health)this.modes.includes(o.name)||this.modes.push(o.name);this.reDisplay()}static \u0275fac=function(n){return new(n||i)(e.rXU(D.nX),e.rXU(f.d3),e.rXU(M.UA),e.rXU(f.FL),e.rXU(f.pp))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-folder-health"]],features:[e.Vt3],decls:10,vars:3,consts:()=>{let t,n,o,r,g,C;return t=$localize`:␟e9e69aab6530b06f07d62019e95496e5c974a35d␟4008496035123032607:Refresh List`,n=$localize`:␟bb787b6c8e8a25e976f65cadc66c66c8a7d81a8a␟8891977878457079212:Type of Hints`,o=$localize`:␟842a4fcf548e0c52ebab1cb5362f47ab2ca83e12␟1393837337557373364:Album`,r=$localize`:␟842a4fcf548e0c52ebab1cb5362f47ab2ca83e12␟1393837337557373364:Album`,g=$localize`:␟378660a509ecaa4d2dd3b4b0b8975760cfe3576d␟2492300395471245755:Artist`,C=$localize`:␟40cf215f61708390d3aba0212e49596e0d3d981c␟16823705783062999:Collection`,[o,r,g,C,[1,"health"],[1,"actions"],["title",t,1,"button-on-control",3,"click"],[1,"icon-reload"],["placeholder",n,3,"ngModel"],[1,"health-content"],["name","Folder Health Issues",3,"list"],[1,"folder"],["placeholder",n,3,"ngModelChange","ngModel"],[3,"value"],[1,"meta"],[3,"routerLink"],[1,"folder-health"],[3,"folderHealth"],[1,"type"],[1,"name"],[1,"artist"],[1,"year"]]},template:function(n,o){1&n&&(e.j41(0,"div",4)(1,"div",5)(2,"button",6),e.bIt("click",function(){return o.refresh()}),e.nrm(3,"i",7),e.k0s(),e.DNE(4,Gt,3,1,"select",8),e.k0s(),e.j41(5,"div",9),e.DNE(6,wt,1,0,"app-loading"),e.nrm(7,"app-background-text-list",10),e.Z7z(8,zt,10,5,"div",11,yt),e.k0s()()),2&n&&(e.R7$(4),e.vxM(4,o.modes.length>0?4:-1),e.R7$(2),e.vxM(6,o.hints?-1:6),e.R7$(),e.Y8G("list",o.hints),e.R7$(),e.Dyx(o.hints))},dependencies:[j.F,Y.q,u.xH,u.y7,u.wz,u.BC,u.vS,D.Wk,vt],styles:["[_nghost-%COMP%]{height:100%;width:100%}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .health-content[_ngcontent-%COMP%]{padding:15px;overflow-y:auto;overflow-x:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]{border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:var(--background-border);padding:15px;display:flex;flex-flow:row wrap;flex-flow:row nowrap}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{width:30%;padding-right:15px;margin-left:15px;display:flex;flex-flow:column wrap;position:relative}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;text-overflow:ellipsis;overflow:hidden}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%]{text-transform:uppercase}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .year[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .state[_ngcontent-%COMP%]{letter-spacing:1px;font-size:.8em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:24px;font-weight:100;color:var(--on-background-highlight)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-highlight)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:14px;line-height:1.2em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:5px;margin-right:5px;height:27px;font-weight:500;padding:1px 15px 0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transform:scale(1.3);transform-origin:center}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;border:1px solid transparent;padding:4px 9px 7px;border-radius:50%;display:none;position:absolute;right:1px;bottom:0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:var(--control-hover);color:var(--on-background-hover)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]:hover   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]:hover   app-fav-icon[_ngcontent-%COMP%]{display:inline}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .folder-health[_ngcontent-%COMP%]{display:flex;width:70%}@media (max-width: 400px){[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]{padding-left:0;padding-right:0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-size:.8em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:16px}}"]})}return i})();var Ht=E(3132);function Wt(i,d){1&i&&(e.qex(0),e.pXf(1,0),e.bVm())}function Qt(i,d){1&i&&(e.qex(0),e.pXf(1,1),e.bVm())}function Yt(i,d){if(1&i&&(e.j41(0,"div")(1,"div"),e.DNE(2,Wt,2,0,"ng-container")(3,Qt,2,0,"ng-container"),e.k0s(),e.nrm(4,"app-loading"),e.k0s()),2&i){const t=e.XpG();e.R7$(2),e.vxM(2,t.isUploading?2:-1),e.R7$(),e.vxM(3,t.isUploading?-1:3)}}function Kt(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",3),e.bIt("drop",function(o){e.eBV(t);const r=e.XpG();return e.Njj(r.onDropFile(o))})("dragover",function(o){e.eBV(t);const r=e.XpG();return e.Njj(r.onDragOverFile(o))}),e.j41(1,"form")(2,"input",4),e.bIt("change",function(o){e.eBV(t);const r=e.XpG();return e.Njj(r.selectFile(o))}),e.k0s()()()}}let qt=(()=>{class i{jam;notify;folderService;folder;reference;isIdle=!0;isUploading=!1;unsubscribe=new q.B;constructor(t,n,o){this.jam=t,this.notify=n,this.folderService=o}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}dialogInit(t,n){this.reference=t,this.folder=n.data?.folder}waitForCreationEnd(t){if(!this.folder)return;const n=this.folder.id;this.folderService.waitForQueueResult("Creating Artwork",t,[]).pipe((0,G.Q)(this.unsubscribe)).subscribe(()=>{this.isIdle=!0,this.folderService.notifyFolderChange(n,f.lE.fsnRefresh),t.error||(this.notify.success("Upload done"),this.reference&&this.reference.close())})}onDropFile(t){t.preventDefault(),this.uploadFile(t.dataTransfer?.files)}onDragOverFile(t){t.stopPropagation(),t.preventDefault()}selectFile(t){this.uploadFile(t.target.files)}uploadFile(t){if(!t||0===t.length||!this.folder)return;const n=t[0];this.isIdle=!1,this.isUploading=!0,this.jam.artwork.createByUpload({folderID:this.folder.id,types:[]},n).pipe((0,G.Q)(this.unsubscribe)).subscribe(o=>{if(o.type!==re.hv.UploadProgress&&o instanceof re.cS){const r=o.body;r&&this.waitForCreationEnd(r)}},o=>{this.isUploading=!1,this.isIdle=!0,this.notify.error(o)},()=>{this.isUploading=!1})}static \u0275fac=function(n){return new(n||i)(e.rXU(M.UA),e.rXU(f.FL),e.rXU(f.pp))};static \u0275cmp=e.VBU({type:i,selectors:[["app-dialog-upload-image"]],decls:2,vars:2,consts:()=>{let t,n,o;return t=$localize`:␟f54acc637f2d1ea81cf76322b0c3f381b868baa1␟7636862518745301168:Uploading`,n=$localize`:␟71969bbb4eedcf48235202c3146043ad48adc542␟1227384069952544114:Creating Artwork`,o=$localize`:␟d833321cc90a0b0a52714c6d5ec97fbe6c7cfa5c␟2501989539336327542:Upload image`,[t,n,[1,"drop-zone"],[1,"drop-zone",3,"drop","dragover"],["type","file","placeholder",o,"accept",".png,.jpeg,.jpg",3,"change"]]},template:function(n,o){1&n&&e.DNE(0,Yt,5,2,"div")(1,Kt,3,0,"div",2),2&n&&(e.vxM(0,o.isIdle?-1:0),e.R7$(),e.vxM(1,o.isIdle?1:-1))},dependencies:[Y.q,u.qT,u.cb,u.cV],styles:["[_nghost-%COMP%]   .drop-zone[_ngcontent-%COMP%]{margin:10px 20px;border-width:2px;border-style:dotted;border-color:var(--secondary);height:80%}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}"]})}return i})();var Jt=E(4471);const Zt=i=>["/admin/folder",i];function en(i,d){1&i&&e.nrm(0,"app-loading")}function tn(i,d){if(1&i&&e.nrm(0,"app-info-note",23),2&i){const t=e.XpG(2);e.Y8G("info",t.folder.info)}}function nn(i,d){if(1&i&&e.EFF(0),2&i){const t=e.XpG(2);e.SpI(" / ",null==t.folder.tag?null:t.folder.tag.albumType," ")}}function on(i,d){if(1&i&&(e.j41(0,"div")(1,"div",25),e.pXf(2,5),e.k0s(),e.j41(3,"div"),e.EFF(4),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(4),e.JRh(null==t.folder.tag?null:t.folder.tag.artist)}}function rn(i,d){if(1&i&&(e.j41(0,"div")(1,"div",25),e.pXf(2,6),e.k0s(),e.j41(3,"div"),e.EFF(4),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(4),e.JRh(null==t.folder.tag?null:t.folder.tag.album)}}function an(i,d){if(1&i&&(e.j41(0,"div")(1,"div",25),e.pXf(2,7),e.k0s(),e.j41(3,"div"),e.EFF(4),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(4),e.SpI(" ",null==t.folder.tag?null:t.folder.tag.year,"")}}function sn(i,d){if(1&i&&(e.j41(0,"div")(1,"div",25),e.pXf(2,8),e.k0s(),e.j41(3,"div"),e.EFF(4),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(4),e.SpI(" ",null==t.folder.tag?null:t.folder.tag.genres,"")}}function _n(i,d){if(1&i&&(e.j41(0,"div")(1,"div",25),e.pXf(2,9),e.k0s(),e.j41(3,"div")(4,"a",33),e.EFF(5),e.k0s()()()),2&i){const t=e.XpG(2);e.R7$(4),e.Mz_("href","https://musicbrainz.org/release/",null==t.folder.tag?null:t.folder.tag.mbReleaseID,"",e.B4B),e.R7$(),e.JRh(null==t.folder.tag?null:t.folder.tag.mbReleaseID)}}function ln(i,d){if(1&i&&(e.j41(0,"div")(1,"div",25),e.pXf(2,10),e.k0s(),e.j41(3,"div")(4,"a",33),e.EFF(5),e.k0s()()()),2&i){const t=e.XpG(2);e.R7$(4),e.Mz_("href","https://musicbrainz.org/artist/",null==t.folder.tag?null:t.folder.tag.mbArtistID,"",e.B4B),e.R7$(),e.JRh(null==t.folder.tag?null:t.folder.tag.mbArtistID)}}function cn(i,d){if(1&i&&(e.j41(0,"div")(1,"div",25),e.pXf(2,11),e.k0s(),e.j41(3,"div")(4,"a",34),e.EFF(5),e.k0s()()()),2&i){const t=e.XpG(2);e.R7$(4),e.Y8G("routerLink",e.eq3(2,Zt,t.folder.parentID)),e.R7$(),e.JRh(t.folder.parentID)}}function dn(i,d){if(1&i){const t=e.RV6();e.j41(0,"button",35),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.searchImages())}),e.nrm(1,"i",36),e.qex(2),e.pXf(3,12),e.bVm(),e.k0s()}}function gn(i,d){if(1&i){const t=e.RV6();e.j41(0,"button",37),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.searchImages())}),e.nrm(1,"i",36),e.qex(2),e.pXf(3,13),e.bVm(),e.k0s()}}function pn(i,d){if(1&i&&(e.j41(0,"div",32),e.nrm(1,"app-admin-artwork-list",38),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.Y8G("folderID",t.folder.id)("artworks",t.folder.artworks)}}function Mn(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",14)(1,"div",15)(2,"button",16),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.refresh())}),e.nrm(3,"i",17),e.k0s(),e.j41(4,"button",18),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.moveFolder())}),e.nrm(5,"i",19),e.k0s(),e.j41(6,"button",20),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.removeFolder())}),e.nrm(7,"i",21),e.k0s()(),e.j41(8,"div",22),e.DNE(9,tn,1,1,"app-info-note",23),e.j41(10,"div",24)(11,"div")(12,"div")(13,"div",25),e.pXf(14,0),e.k0s(),e.j41(15,"div")(16,"app-inline-edit",26),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.name,o)||(r.name=o),e.Njj(o)}),e.bIt("endEditRequest",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.editFolderName())}),e.k0s()()(),e.j41(17,"div")(18,"div",25),e.pXf(19,1),e.k0s(),e.j41(20,"div"),e.EFF(21),e.DNE(22,nn,1,1),e.k0s()(),e.j41(23,"div")(24,"div",25),e.pXf(25,2),e.k0s(),e.j41(26,"div"),e.EFF(27),e.k0s()(),e.j41(28,"div")(29,"div",25),e.pXf(30,3),e.k0s(),e.j41(31,"div"),e.EFF(32),e.k0s()(),e.DNE(33,on,5,1,"div")(34,rn,5,1,"div"),e.k0s(),e.j41(35,"div"),e.DNE(36,an,5,1,"div")(37,sn,5,1,"div")(38,_n,6,3,"div")(39,ln,6,3,"div")(40,cn,6,4,"div"),e.k0s()(),e.j41(41,"div",27)(42,"div",15)(43,"button",28),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.uploadImage())}),e.nrm(44,"i",29),e.qex(45),e.pXf(46,4),e.bVm(),e.k0s(),e.DNE(47,dn,4,0,"button",30)(48,gn,4,0,"button",31),e.k0s(),e.DNE(49,pn,2,2,"div",32),e.k0s()()()}if(2&i){const t=e.XpG();e.R7$(9),e.vxM(9,null!=t.folder.info&&t.folder.info.description?9:-1),e.R7$(7),e.R50("ngModel",t.name),e.R7$(5),e.SpI("",t.folder.type," "),e.R7$(),e.vxM(22,t.isAlbum?22:-1),e.R7$(5),e.JRh(t.folder.trackCount),e.R7$(5),e.JRh(t.folder.folderCount),e.R7$(),e.vxM(33,null!=t.folder.tag&&t.folder.tag.artist?33:-1),e.R7$(),e.vxM(34,null!=t.folder.tag&&t.folder.tag.album?34:-1),e.R7$(2),e.vxM(36,null!=t.folder.tag&&t.folder.tag.year?36:-1),e.R7$(),e.vxM(37,null!=t.folder.tag&&null!=t.folder.tag.genres&&t.folder.tag.genres.length?37:-1),e.R7$(),e.vxM(38,null!=t.folder.tag&&t.folder.tag.mbReleaseID?38:-1),e.R7$(),e.vxM(39,null!=t.folder.tag&&t.folder.tag.mbArtistID?39:-1),e.R7$(),e.vxM(40,t.folder.parentID?40:-1),e.R7$(7),e.vxM(47,t.isAlbum&&t.folder.tag&&(t.folder.tag.mbReleaseID||t.folder.tag.mbReleaseGroupID)?47:-1),e.R7$(),e.vxM(48,t.isArtist&&t.folder.tag&&t.folder.tag.mbArtistID?48:-1),e.R7$(),e.vxM(49,t.folder.artworks&&t.folder.artworks.length>0?49:-1)}}let hn=(()=>{class i extends h{app;jam;notify;dialogsService;dialogOverlay;folderService;router;name="";folder;isAlbum=!1;isArtist=!1;constructor(t,n,o,r,g,C,T,b){super(t),this.app=n,this.jam=o,this.notify=r,this.dialogsService=g,this.dialogOverlay=C,this.folderService=T,this.router=b}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,G.Q)(this.unsubscribe)).subscribe(t=>{t.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}editFolderName(){if(!this.folder)return;const t=(this.name||"").trim();if(0===t.length||t===this.folder.name)return void(this.name=this.folder.name);const n=this.folder.id;this.jam.folder.rename({id:n,name:t}).then(o=>{this.folderService.waitForQueueResult("Renaming Folder",o,[n])}).catch(o=>{this.notify.error(o)})}refresh(){this.id&&this.jam.folder.id({id:this.id,folderIncTag:!0,folderIncParents:!0,folderIncArtworks:!0,folderIncChildFolderCount:!0,folderIncTrackCount:!0}).then(t=>{this.display(t)}).catch(t=>{404===t.code?this.router.navigate(["/admin/folder/"]).catch(n=>{console.error(n)}):this.notify.error(t)})}uploadImage(){this.dialogOverlay.open({title:"Upload Folder Images",childComponent:qt,data:{folder:this.folder},panelClass:"overlay-panel-large-buttons"})}searchImages(){this.dialogOverlay.open({title:"Search Artwork Images",childComponent:Be,data:{folder:this.folder},panelClass:"overlay-panel-large-buttons"})}removeFolder(){const t=this.folder;t&&this.dialogsService.confirm("Remove Folder?",`Sure to remove Folder "${t.name}"?`,()=>{this.jam.folder.remove({id:t.id}).then(n=>{t.parentID&&this.router.navigate([`/admin/folder/${t.parentID}/overview`]).catch(o=>{console.error(o)}),this.folderService.waitForQueueResult("Removing Folder",n,[t.id],t.parentID?[t.parentID]:[])}).catch(n=>{this.notify.error(n)})})}moveFolder(){var t=this;const n=this.folder;if(!n)return;const o={selectID:n.id,disableIDs:[n.id]};var r;this.dialogOverlay.open({title:"Move Folder to",childComponent:S,data:o,panelClass:"overlay-panel-large-buttons",onOkBtn:(r=(0,L.A)(function*(){const g=o.folder;if(g)try{t.jam.folder.move({ids:[n.id],newParentID:g.id}).then(C=>{t.folderService.waitForQueueResult("Moving Folder",C,[n.id],(n.parentID?[n.parentID]:[]).concat([g.id]))}).catch(C=>{t.notify.error(C)})}catch(C){return t.notify.error(C),Promise.reject(C)}}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,L.A)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}display(t){this.name="",this.isAlbum=!1,this.isArtist=!1,this.folder=t,t&&(this.name=t.name,this.isAlbum=Ht.fn.includes(t.type),this.isArtist=t.type===M.DZ.artist)}static \u0275fac=function(n){return new(n||i)(e.rXU(D.nX),e.rXU(f.d3),e.rXU(M.UA),e.rXU(f.FL),e.rXU($.JQ),e.rXU(F.iD),e.rXU(f.pp),e.rXU(D.Ix))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-folder"]],features:[e.Vt3],decls:2,vars:2,consts:()=>{let t,n,o,r,g,C,T,b,x,K,Z,Q,y,V,Me,he,z,Re,Ie;return t=$localize`:␟c8d1785038d461ec66b5799db21864182b35900a␟1102717806459547726:Refresh`,n=$localize`:␟ee0ffaa4b2ef70f3847c0dc2126aff7ed0034519␟4836856351090546342:Move Folder…`,o=$localize`:␟605381a1ba67135149effc1e2382241d379fcc9a␟5344042372404898499:Remove Folder…`,r=$localize`:␟cb1068a2a1e809104667e887d276b18b2fb9d8fa␟7832824131624341508:Album Images`,g=$localize`:␟12a54d1bad2243f676c829e885461ff819d55f4f␟2477517217585375703:Artist Images`,C=$localize`:␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,T=$localize`:␟f61c6867295f3b53d23557021f2f4e0aa1d0b8fc␟8650499415827640724:Type`,b=$localize`:␟261caf3111a423a99f27e839571512f371bd0212␟167155511337505993:Track Count`,x=$localize`:␟36b472d60e30275eec0f90dc492c06c990621178␟506719405556868592:Folder Count`,K=$localize`:␟faecc81b39c34e94a8f009af7d8c233d3a3dceaa␟8890037837123071423:Upload Artwork`,Z=$localize`:␟378660a509ecaa4d2dd3b4b0b8975760cfe3576d␟2492300395471245755:Artist`,Q=$localize`:␟842a4fcf548e0c52ebab1cb5362f47ab2ca83e12␟1393837337557373364:Album`,y=$localize`:␟f6e04edea3bb3a59d5904725bfbc2c440e793001␟1464072562214937907:Year`,V=$localize`:␟33c750c68c3e29d7fee57a180f508d8d202bdd04␟1790640569414740156:Genres`,Me=$localize`:␟e25c6080fad93286376b6a4103ff2889588879b5␟6137832517756203418:MB Release Id`,he=$localize`:␟5b6e5696b55d1dbdcc67e6bb408952c49221060e␟7022245527426162907:MB Artist Id`,z=$localize`:␟e17ab51fb5646579e7073ed25f240117d5f5169e␟4232003024146825817:Parent Folder Id`,Re=$localize`:␟045d07de1f817f18c61b2660126d1edcac7b5bd0␟2134391710559060062:Search Artwork`,Ie=$localize`:␟85804de0cdf6b27537be7f0d11158dbe7b1dc5c2␟7505878720705236779:Search Art`,[C,T,b,x,K,Z,Q,y,V,Me,he,z,Re,Ie,[1,"folder"],[1,"actions"],["title",t,1,"button-on-control",3,"click"],[1,"icon-reload"],["title",n,1,"button-on-control",3,"click"],[1,"icon-right-bold"],["title",o,1,"button-on-control",3,"click"],[1,"icon-trash"],[1,"content"],[3,"info"],[1,"properties"],[1,"label"],["type","text",3,"ngModelChange","endEditRequest","ngModel"],[1,"artworks"],[1,"button-on-control",3,"click"],[1,"icon-upload-cloud"],["title",r,1,"button-on-control"],["title",g,1,"button-on-control"],[1,"artworks-content"],["target","_blank","rel","noopener",3,"href"],[3,"routerLink"],["title",r,1,"button-on-control",3,"click"],[1,"icon-picture"],["title",g,1,"button-on-control",3,"click"],[3,"folderID","artworks"]]},template:function(n,o){1&n&&e.DNE(0,en,1,0,"app-loading")(1,Mn,50,16,"div",14),2&n&&(e.vxM(0,o.folder?-1:0),e.R7$(),e.vxM(1,o.folder?1:-1))},dependencies:[Jt.M,Y.q,u.BC,u.vS,D.Wk,ze,Ve],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow:hidden;display:block}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{overflow-y:auto;display:flex;flex-direction:column}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%]{width:100%;display:flex;flex-wrap:wrap;flex-direction:row;padding:15px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:0 0 50%}@media (max-width: 522px){[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:0 0 100%}}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding-top:5px;padding-bottom:5px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{color:var(--on-background-highlight)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-highlight)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .properties[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--on-background);font-size:.7em;text-transform:uppercase;padding-bottom:2px}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .artworks[_ngcontent-%COMP%]{border-top:1px solid var(--background-border)}[_nghost-%COMP%]   .folder[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .artworks[_ngcontent-%COMP%]   .artworks-content[_ngcontent-%COMP%]{padding:0 15px 15px}"]})}return i})();const fn=(i,d)=>d.hint.id,On=(i,d)=>d.name;function Cn(i,d){1&i&&(e.j41(0,"div",1)(1,"div",2),e.nrm(2,"i",3),e.k0s()())}function un(i,d){1&i&&(e.j41(0,"div",2),e.pXf(1,0),e.k0s())}function mn(i,d){if(1&i&&(e.j41(0,"div",2),e.nrm(1,"i",6),e.EFF(2),e.j41(3,"div",7),e.EFF(4),e.k0s()()),2&i){const t=d.$implicit;e.R7$(2),e.SpI(" ",t.hint.name," "),e.R7$(2),e.JRh(t.description)}}function En(i,d){1&i&&e.nrm(0,"i",3)}function Sn(i,d){if(1&i&&e.EFF(0),2&i){const t=e.XpG().$implicit;e.SpI(" ",t.name," ")}}function Tn(i,d){if(1&i){const t=e.RV6();e.j41(0,"button",8),e.bIt("click",function(){const o=e.eBV(t).$implicit;return e.Njj(o.click())}),e.DNE(1,En,1,0,"i",3)(2,Sn,1,1),e.k0s()}if(2&i){const t=d.$implicit;e.R7$(),e.vxM(1,t.running?1:-1),e.R7$(),e.vxM(2,t.running?-1:2)}}function Nn(i,d){if(1&i&&(e.j41(0,"div",1),e.DNE(1,un,2,0,"div",2),e.Z7z(2,mn,5,2,"div",2,fn),e.j41(4,"div",4),e.Z7z(5,Tn,3,2,"button",5,On),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(),e.vxM(1,0===t.hints.length?1:-1),e.R7$(),e.Dyx(t.hints),e.R7$(3),e.Dyx(t.solutions)}}function Pn(i,d){if(1&i&&e.DNE(0,Cn,3,0,"div",1)(1,Nn,7,1,"div",1),2&i){const t=e.XpG();e.vxM(0,t.trackHealth.health&&t.hints?-1:0),e.R7$(),e.vxM(1,t.trackHealth.health&&t.hints?1:-1)}}let Xe=(()=>{class i{app;jam;notify;folderService;router;hints;solutions=[];trackHealth;resolvedEvent=new e.bkB;unsubscribe=new q.B;constructor(t,n,o,r,g){this.app=t,this.jam=n,this.notify=o,this.folderService=r,this.router=g}ngOnChanges(){this.display(this.trackHealth)}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}ngOnInit(){this.folderService.tracksChange.pipe((0,G.Q)(this.unsubscribe)).subscribe(t=>{const n=this.trackHealth;n&&n.track.id===t.id&&(n.health=[],this.jam.track.health({ids:[n.track.id],healthMedia:!0}).then(o=>{const r=o.find(g=>g.track.id===n.track.id);r&&r.health?(n.track=r.track,n.health=r.health):n.health=[],0===n.health.length&&this.resolvedEvent.emit(),this.display(n)}).catch(o=>{this.notify.error(o)}))})}fixAll(){for(const t of this.solutions)t.fixable&&!t.running&&t.click&&t.click()}display(t){this.hints=[],this.solutions=[],t?.health&&(this.hints=t.health.map(n=>({hint:n,description:this.describeHint(n,t.track)})))}describeTagHint(t,n){let o="";return t.id===M.vO.tagValuesExists?o=(t.details||[]).map(r=>r.reason.toUpperCase()).join(", "):t.id===M.vO.id3v2Garbage?o=(t.details||[]).map(r=>r.reason).join(", "):t.id===M.vO.id3v2Valid&&(o=(t.details||[]).map(r=>r.expected&&r.actual?`${r.reason}  (${r.actual} instead of ${r.expected})`:r.reason).join(", ")),this.solutions.find(r=>"Edit Tag"===r.name)||this.solutions.push({name:"Edit Tag",click:()=>{this.router.navigate([`/admin/folder/${n.parentID}/tags`]).catch(g=>{console.error(g)})}}),o}describeMp3GarbageHint(t,n){let o="";if(t.details&&t.details.length>0&&(o=`${t.details[0].reason} (${t.details[0].actual} bytes)`),!this.solutions.find(r=>"Fix MP3"===r.name)){const r={name:"Fix MP3",fixable:!0,click:()=>{r.running||(r.running=!0,this.jam.track.fix({id:n.id,fixID:t.id}).then(g=>{this.folderService.waitForQueueResult("Fixing Track MP3",g,[],[],[n.id])}).catch(g=>{this.notify.error(g)}))}};this.solutions.push(r)}return o}describeMp3ErrorHint(t,n){const o=`Stream Errors: ${(t.details||[]).length}`;if(!this.solutions.find(r=>"Fix Stream"===r.name)){const r={name:"Fix Stream",fixable:!0,click:()=>{r.running||(r.running=!0,this.jam.track.fix({id:n.id,fixID:t.id}).then(g=>{this.folderService.waitForQueueResult("Fixing Track Stream",g,[],[],[n.id])}).catch(g=>{this.notify.error(g)}))}};this.solutions.push(r)}return o}describeID3v1Hint(t,n){if(!this.solutions.find(o=>"Remove ID3v1"===o.name)){const o={name:"Remove ID3v1",fixable:!0,click:()=>{o.running||(o.running=!0,this.jam.track.fix({id:n.id,fixID:t.id}).then(r=>{this.folderService.waitForQueueResult("Remove ID3v1",r,[],[],[n.id])}).catch(r=>{this.notify.error(r)}))}};this.solutions.push(o)}return""}describeMP3HeaderHint(t,n){let o="";if(t.id===M.vO.mp3HeaderValid&&(o=(t.details||[]).map(r=>r.expected&&r.actual?`${r.reason}  (${r.actual} instead of ${r.expected})`:r.reason).join(", ")),!this.solutions.find(r=>"Fix Header"===r.name)){const r={name:"Fix Header",fixable:!0,click:()=>{r.running||(r.running=!0,this.jam.track.fix({id:n.id,fixID:t.id}).then(g=>{this.folderService.waitForQueueResult("Fixing Track Header",g,[],[],[n.id])}).catch(g=>{this.notify.error(g)}))}};this.solutions.push(r)}return o}describeHint(t,n){switch(t.id){case M.vO.tagValuesExists:case M.vO.id3v2Garbage:case M.vO.id3v2Exists:case M.vO.id3v2Valid:return this.describeTagHint(t,n);case M.vO.mp3Garbage:return this.describeMp3GarbageHint(t,n);case M.vO.mp3MediaValid:return this.describeMp3ErrorHint(t,n);case M.vO.id3v2NoId3v1:return this.describeID3v1Hint(t,n);case M.vO.mp3HeaderExists:case M.vO.mp3HeaderValid:return this.describeMP3HeaderHint(t,n)}return""}static \u0275fac=function(n){return new(n||i)(e.rXU(f.d3),e.rXU(M.UA),e.rXU(f.FL),e.rXU(f.pp),e.rXU(D.Ix))};static \u0275cmp=e.VBU({type:i,selectors:[["app-track-health"]],inputs:{trackHealth:"trackHealth"},outputs:{resolvedEvent:"resolvedEvent"},features:[e.OA$],decls:1,vars:1,consts:()=>{let t;return t=$localize`:␟baa5a59fd701bf37b30140cf2080f8987db6c2e9␟4786331182153457864:No Hints`,[t,[1,"hints"],[1,"hint"],[1,"icon-spin","icon-spinner"],[1,"solutions"],[1,"button-on-background"],[1,"icon-warning"],[1,"details"],[1,"button-on-background",3,"click"]]},template:function(n,o){1&n&&e.DNE(0,Pn,2,2),2&n&&e.vxM(0,o.trackHealth?0:-1)},styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .icon-warning[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]{padding-left:28px;font-size:.8em;display:block;padding-top:5px}[_nghost-%COMP%]   .hint[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .solutions[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .solutions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}[_nghost-%COMP%]   .detail[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1.25px;font-size:11px;min-width:80px;margin-right:10px;display:inline-block}"]})}return i})();const An=(i,d)=>d.track.id;function Rn(i,d){1&i&&e.nrm(0,"app-loading")}function In(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",8)(1,"div",9),e.EFF(2),e.k0s(),e.j41(3,"div",10)(4,"app-track-health",11),e.bIt("resolvedEvent",function(){const o=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.trackHealthResolved(o))}),e.k0s()()()}if(2&i){const t=d.$implicit;e.R7$(2),e.SpI(" ",t.track.name," "),e.R7$(2),e.Y8G("trackHealth",t)}}let bn=(()=>{class i extends h{app;jam;notify;folderService;all;hints;filter;modes=[];mediaCheck=!1;constructor(t,n,o,r,g){super(t),this.app=n,this.jam=o,this.notify=r,this.folderService=g}onFilterChange(){this.reDisplay()}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,G.Q)(this.unsubscribe)).subscribe(t=>{t.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}checkChange(){this.refresh()}trackHealthResolved(t){this.all&&(this.all=this.all.filter(n=>n!==t),this.reDisplay())}refresh(){this.hints=void 0,this.id&&this.jam.track.health({folderIDs:[this.id],healthMedia:this.mediaCheck}).then(t=>{this.display(t)}).catch(t=>{this.notify.error(t)})}reDisplay(){this.hints=this.filter&&this.all?this.all.filter(t=>t.health&&t.health.find(n=>n.name===this.filter)):this.all}display(t){this.all=t,this.modes=[];for(const n of t)if(n.health)for(const o of n.health)this.modes.includes(o.name)||this.modes.push(o.name);this.reDisplay()}static \u0275fac=function(n){return new(n||i)(e.rXU(D.nX),e.rXU(f.d3),e.rXU(M.UA),e.rXU(f.FL),e.rXU(f.pp))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-tracks-health"]],features:[e.Vt3],decls:13,vars:4,consts:()=>{let t,n;return t=$localize`:␟e9e69aab6530b06f07d62019e95496e5c974a35d␟4008496035123032607:Refresh List`,n=$localize`:␟fc25452275680509933bd62f7ff2f4f14a5949d8␟79910036711821960:Check Media`,[n,[1,"health"],[1,"actions"],["title",t,1,"button-on-control",3,"click"],[1,"icon-reload"],["type","checkbox",3,"ngModelChange","change","checked","ngModel"],[1,"content"],["name","Track Health Issues",3,"list"],[1,"track"],[1,"meta"],[1,"track-health"],[3,"resolvedEvent","trackHealth"]]},template:function(n,o){1&n&&(e.j41(0,"div",1)(1,"div",2)(2,"button",3),e.bIt("click",function(){return o.refresh()}),e.nrm(3,"i",4),e.k0s(),e.j41(4,"label")(5,"input",5),e.mxI("ngModelChange",function(g){return e.DH7(o.mediaCheck,g)||(o.mediaCheck=g),g}),e.bIt("change",function(){return o.checkChange()}),e.k0s(),e.qex(6),e.pXf(7,0),e.bVm(),e.k0s()(),e.j41(8,"div",6),e.DNE(9,Rn,1,0,"app-loading"),e.nrm(10,"app-background-text-list",7),e.Z7z(11,In,5,2,"div",8,An),e.k0s()()),2&n&&(e.R7$(5),e.Y8G("checked",o.mediaCheck),e.R50("ngModel",o.mediaCheck),e.R7$(4),e.vxM(9,o.hints?-1:9),e.R7$(),e.Y8G("list",o.hints),e.R7$(),e.Dyx(o.hints))},dependencies:[j.F,Y.q,u.Zm,u.BC,u.vS,Xe],styles:["[_nghost-%COMP%]{height:100%;width:100%}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:15px;overflow-y:auto;overflow-x:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]{flex-flow:row nowrap}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{width:30%;overflow:hidden;padding-right:15px;text-overflow:ellipsis}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{width:70%}"]})}return i})();var Dn=E(4416);const xn=(i,d)=>d.track.id;function Ln(i,d){if(1&i){const t=e.RV6();e.j41(0,"tr",20),e.bIt("click",function(){const o=e.eBV(t).$implicit;return e.Njj(o.selected=!o.selected)}),e.j41(1,"td",11),e.EFF(2),e.k0s(),e.j41(3,"td",12),e.EFF(4),e.k0s(),e.j41(5,"td",13),e.EFF(6),e.k0s(),e.j41(7,"td",14),e.EFF(8),e.k0s(),e.j41(9,"td",15),e.EFF(10),e.k0s(),e.j41(11,"td",16),e.EFF(12),e.k0s(),e.j41(13,"td",17),e.EFF(14),e.k0s(),e.j41(15,"td",18),e.EFF(16),e.nI1(17,"duration"),e.k0s()()}if(2&i){const t=d.$implicit;e.AVh("selected",t.selected),e.R7$(2),e.JRh(null==t.track.tag?null:t.track.tag.trackNr),e.R7$(2),e.JRh(null==t.track.tag?null:t.track.tag.title),e.R7$(2),e.JRh(null==t.track.tag?null:t.track.tag.artist),e.R7$(2),e.JRh(null==t.track.tag?null:t.track.tag.album),e.R7$(2),e.JRh(null==t.track.media?null:t.track.media.format),e.R7$(2),e.JRh(null==t.track.media?null:t.track.media.bitRate),e.R7$(2),e.JRh(null==t.track.media?null:t.track.media.sampleRate),e.R7$(2),e.JRh(e.bMT(17,10,t.track.duration))}}function vn(i,d){if(1&i&&(e.j41(0,"table",9)(1,"tr",10)(2,"td",11),e.pXf(3,0),e.k0s(),e.j41(4,"td",12),e.pXf(5,1),e.k0s(),e.j41(6,"td",13),e.pXf(7,2),e.k0s(),e.j41(8,"td",14),e.pXf(9,3),e.k0s(),e.j41(10,"td",15),e.pXf(11,4),e.k0s(),e.j41(12,"td",16),e.pXf(13,5),e.k0s(),e.j41(14,"td",17),e.pXf(15,6),e.k0s(),e.j41(16,"td",18),e.pXf(17,7),e.k0s()(),e.Z7z(18,Ln,18,12,"tr",19,xn),e.k0s()),2&i){const t=e.XpG();e.R7$(18),e.Dyx(t.trackItems)}}let He=(()=>{class i{router;trackItems;tracks=[];constructor(t){this.router=t}getSortValue(t,n){switch(t){case"number":return n.track.tag?.trackNr;case"name":return n.track.name;case"artist":return n.track.tag?.artist;case"album":return n.track.tag?.album;case"duration":return n.track.duration;default:return}}ngOnChanges(){this.trackItems=(this.tracks||[]).map(t=>({track:t}))}toTrackFolder(t){this.router.navigate([`/admin/folder/${t.parentID}/overview`]).catch(n=>{console.error(n)})}static \u0275fac=function(n){return new(n||i)(e.rXU(D.Ix))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-track-list"]],inputs:{tracks:"tracks"},features:[e.OA$],decls:2,vars:2,consts:()=>{let t,n,o,r,g,C,T,b;return t=$localize`:␟be498c96e976cb06e12d105d3174b0d47460886f␟8381503740832172353:Track Nr.`,n=$localize`:␟fdf7cbdc140d0aab0f0b6c06065a0fd448ed6a2e␟5701618810648052610:Title`,o=$localize`:␟378660a509ecaa4d2dd3b4b0b8975760cfe3576d␟2492300395471245755:Artist`,r=$localize`:␟842a4fcf548e0c52ebab1cb5362f47ab2ca83e12␟1393837337557373364:Album`,g=$localize`:␟7722a92a1fc887570b4f4d8a7bb916f067f32028␟7513076467032912668:Format`,C=$localize`:␟1e4b5c71ea539e7ba3415dbf4b15a6b684cf892a␟3813020320794017449:BitRate`,T=$localize`:␟d256d70c89c6d6a1d085e7bac659374528239056␟3186270570067508524:SampleRate`,b=$localize`:␟a02ea1d4e7424ca989929da5e598f379940fdbf2␟7410432243549869948:Duration`,[t,n,o,r,g,C,T,b,["name","Tracks",3,"list"],[1,"tracks"],[1,"track","heading"],[1,"number"],[1,"title"],[1,"artist"],[1,"album"],[1,"format"],[1,"bitrate"],[1,"samplerate"],[1,"duration"],[1,"track",3,"selected"],[1,"track",3,"click"]]},template:function(n,o){1&n&&(e.nrm(0,"app-background-text-list",8),e.DNE(1,vn,20,0,"table",9)),2&n&&(e.Y8G("list",o.tracks),e.R7$(),e.vxM(1,o.tracks&&o.tracks.length>0?1:-1))},dependencies:[j.F,Dn.b],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]{padding:15px;font-size:.8em;width:100%}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{font-size:.9em}[_nghost-%COMP%]   .track[_ngcontent-%COMP%]{border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .track[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .track[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .track.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}"]})}return i})();function yn(i,d){1&i&&e.nrm(0,"app-loading")}function kn(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"button",3),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.refresh())}),e.nrm(3,"i",4),e.k0s(),e.j41(4,"button",5),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.moveTracks())}),e.nrm(5,"i",6),e.k0s(),e.j41(6,"button",7),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.deleteTracks())}),e.nrm(7,"i",8),e.k0s()(),e.nrm(8,"app-admin-track-list",9),e.k0s()}if(2&i){const t=e.XpG();e.R7$(8),e.Y8G("tracks",t.folder.tracks)}}let $n=(()=>{class i extends h{jam;notify;folderService;dialogsService;dialogOverlay;folder;tracks;constructor(t,n,o,r,g,C){super(t),this.jam=n,this.notify=o,this.folderService=r,this.dialogsService=g,this.dialogOverlay=C}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe((0,G.Q)(this.unsubscribe)).subscribe(t=>{t.id===this.id&&this.refresh()})}ngOnDestroy(){super.ngOnDestroy()}deleteTracks(){const t=this.getTrackIDs();0!==t.length&&this.dialogsService.confirm("Remove Tracks?",`Sure to remove ${t.length} Track${t.length>1?"s":""}?`,()=>{for(const n of t)this.jam.track.remove({id:n}).then(o=>{this.folderService.waitForQueueResult("Removing Track",o,[],[],[n])}).catch(o=>{this.notify.error(o)})})}getTrackIDs(){if(!this.tracks?.trackItems||!this.folder?.tracks)return[];const t=this.tracks.trackItems.filter(n=>n.selected).map(n=>n.track.id);return t.length>0?t:this.folder.tracks.map(n=>n.id)}moveTracks(){var t=this;const n=this.getTrackIDs();if(0===n.length)return;const o={selectID:this.id};var r;this.dialogOverlay.open({title:"Move Tracks to",childComponent:S,data:o,panelClass:"overlay-panel-large-buttons",onOkBtn:(r=(0,L.A)(function*(){const g=o.folder;if(g)return t.jam.track.move({ids:n,folderID:g.id}).then(C=>{t.folderService.waitForQueueResult("Moving Tracks",C,[],[g.id].concat(t.folder?.parentID?[t.folder.parentID]:[]),n)}).catch(C=>{t.notify.error(C)}),Promise.resolve()}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,L.A)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}refresh(){this.folder=void 0,this.id&&this.jam.folder.id({id:this.id,folderIncTracks:!0,trackIncTag:!0,trackIncMedia:!0}).then(t=>{this.folder=t}).catch(t=>{this.notify.error(t)})}static \u0275fac=function(n){return new(n||i)(e.rXU(D.nX),e.rXU(M.UA),e.rXU(f.FL),e.rXU(f.pp),e.rXU($.JQ),e.rXU(F.iD))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-folder-tracks"]],viewQuery:function(n,o){if(1&n&&e.GBs(He,5),2&n){let r;e.mGM(r=e.lsd())&&(o.tracks=r.first)}},features:[e.Vt3],decls:3,vars:3,consts:()=>{let t,n,o;return t=$localize`:␟c8d1785038d461ec66b5799db21864182b35900a␟1102717806459547726:Refresh`,n=$localize`:␟5599dad966c719b3feae9735c1c2555c63945d62␟5954283971273891723:Move Tracks…`,o=$localize`:␟d01e8b8bbe3093f1bfe3f7849f8856d20862aa60␟3929773193703989963:Delete Tracks…`,[["name","Tracks",3,"list"],[1,"tracks"],[1,"actions"],["title",t,1,"button-on-control",3,"click"],[1,"icon-reload"],["title",n,1,"button-on-control",3,"click"],[1,"icon-right-bold"],["title",o,1,"button-on-control",3,"click"],[1,"icon-trash"],[1,"content",3,"tracks"]]},template:function(n,o){1&n&&(e.DNE(0,yn,1,0,"app-loading"),e.nrm(1,"app-background-text-list",0),e.DNE(2,kn,9,1,"div",1)),2&n&&(e.vxM(0,o.folder?-1:0),e.R7$(),e.Y8G("list",null==o.folder?null:o.folder.tracks),e.R7$(),e.vxM(2,o.folder&&o.folder.tracks&&o.folder.tracks.length>0?2:-1))},dependencies:[j.F,Y.q,He],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:block;overflow:hidden}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .tracks[_ngcontent-%COMP%]   app-admin-track-list[_ngcontent-%COMP%]{overflow-y:auto}"]})}return i})();var Ae=E(9359);const Gn=(i,d)=>d.track.id,wn=i=>["/admin/folder",i,"tags"];function Un(i,d){if(1&i){const t=e.RV6();e.j41(0,"button",11),e.bIt("click",function(){e.eBV(t);const o=e.XpG(3);return e.Njj(o.refresh(o.current.pos,!1))}),e.nrm(1,"i",12),e.qex(2),e.pXf(3,1),e.bVm(),e.k0s()}}function Fn(i,d){if(1&i){const t=e.RV6();e.j41(0,"button",11),e.bIt("click",function(){e.eBV(t);const o=e.XpG(3);return e.Njj(o.fixAll())}),e.pXf(1,2),e.k0s()}}function Xn(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",7)(1,"button",8),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.start())}),e.nrm(2,"i",9),e.qex(3),e.pXf(4,0),e.bVm(),e.k0s(),e.DNE(5,Un,4,0,"button",10)(6,Fn,2,0,"button",10),e.k0s()}if(2&i){const t=e.XpG(2);e.R7$(5),e.vxM(5,t.current?5:-1),e.R7$(),e.vxM(6,t.current&&t.current.health&&t.current.health.length>0?6:-1)}}function jn(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",7)(1,"button",11),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.stop())}),e.nrm(2,"i",13),e.j41(3,"span"),e.pXf(4,3),e.k0s()()()}}function Vn(i,d){if(1&i&&e.DNE(0,Xn,7,2,"div",7)(1,jn,5,0,"div",7),2&i){const t=e.XpG();e.vxM(0,t.searching?-1:0),e.R7$(),e.vxM(1,t.searching?1:-1)}}function zn(i,d){1&i&&e.nrm(0,"app-loading")}function Bn(i,d){1&i&&e.nrm(0,"i",15)}function Hn(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",18)(1,"div",19),e.EFF(2),e.k0s(),e.j41(3,"div",20)(4,"app-track-health",21),e.bIt("resolvedEvent",function(){const o=e.eBV(t).$implicit,r=e.XpG(3);return e.Njj(r.trackHealthResolved(o))}),e.k0s()()()}if(2&i){const t=d.$implicit;e.R7$(2),e.SpI(" ",t.track.name," "),e.R7$(2),e.Y8G("trackHealth",t)}}function Wn(i,d){if(1&i&&e.Z7z(0,Hn,5,2,"div",18,Gn),2&i){const t=e.XpG(2);e.Dyx(t.current.health)}}function Qn(i,d){if(1&i&&(e.j41(0,"div")(1,"div",14)(2,"span"),e.DNE(3,Bn,1,0,"i",15),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s(),e.j41(6,"a",16),e.nrm(7,"i",17),e.EFF(8),e.k0s()(),e.DNE(9,Wn,2,0),e.k0s()),2&i){const t=e.XpG();e.R7$(3),e.vxM(3,t.searching?3:-1),e.R7$(2),e.Lme("",t.current.pos+1," / ",t.folders.length,""),e.R7$(),e.Y8G("routerLink",e.eq3(6,wn,t.current.folder.id)),e.R7$(2),e.SpI(" ",t.current.folder.name,""),e.R7$(),e.vxM(9,t.current.health?9:-1)}}let Yn=(()=>{class i{app;jam;notify;uiState;folderService;userStorage;static localStorageName="admin.radar";folders;current;searching=!1;trackHealthComponents;unsubscribe=new q.B;constructor(t,n,o,r,g,C){this.app=t,this.jam=n,this.notify=o,this.uiState=r,this.folderService=g,this.userStorage=C,C.userChange.pipe((0,G.Q)(this.unsubscribe)).subscribe(()=>this.loadFromStorage())}trackHealthResolved(t){this.current&&this.current.health&&(this.current.health=this.current.health.filter(n=>n!==t))}stop(){this.searching=!1}start(){this.searching||!this.folders||(this.searching=!0,this.request())}request(){if(!this.searching)return;let t=0;this.current&&(t=this.current.pos+1),this.refresh(t,!0)}fixAll(){this.searching||!this.current||!this.trackHealthComponents||this.trackHealthComponents.forEach(t=>{t.fixAll()})}refresh(t,n){this.current=void 0,this.searching=!0;const o=this.folders&&this.folders[t];if(!o)return void(this.searching=!1);const r={folder:o,pos:t};this.current=r,this.userStorage.set(i.localStorageName,{folderID:o.id}),this.jam.track.health({folderIDs:[o.id],healthMedia:!0}).then(g=>{g.length>0?(r.health=g,this.searching=!1):n?this.request():(r.health=[],this.searching=!1)}).catch(g=>{this.current=void 0,this.searching=!1,this.notify.error(g)})}ngOnInit(){const t=this.uiState.data["app-admin-radar"];t&&(this.folders=t.folders,this.current=t.current,this.folders)||this.loadFolders()}ngOnDestroy(){this.uiState.data["app-admin-radar"]={folders:this.folders,current:this.current},this.current=void 0,this.searching=!1,this.folders=void 0,this.unsubscribe.next(),this.unsubscribe.complete()}loadFromStorage(){const t=this.userStorage.get(i.localStorageName);if(t?.folderID&&this.folders){const n=this.folders.findIndex(o=>o.id===t.folderID);n>=0&&(this.current={folder:this.folders[n],pos:n},this.refresh(n,!1))}}loadFolders(){this.jam.folder.search({folderTypes:[M.DZ.album,M.DZ.multialbum]}).then(t=>{this.folders=t.items,this.loadFromStorage()}).catch(t=>{this.notify.error(t)})}static \u0275fac=function(n){return new(n||i)(e.rXU(f.d3),e.rXU(M.UA),e.rXU(f.FL),e.rXU(f.z_),e.rXU(f.pp),e.rXU(f.c6))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-radar"]],viewQuery:function(n,o){if(1&n&&e.GBs(Xe,5),2&n){let r;e.mGM(r=e.lsd())&&(o.trackHealthComponents=r)}},decls:6,vars:3,consts:()=>{let t,n,o,r,g;return t=$localize`:␟2b67115641c17c9e2d3e94fd920f48fefdfdc25b␟1962047135999875061:Health Radar`,n=$localize`:␟f732c304c7433e5a83ffcd862c3dce709a0f4982␟3885497195825665706:Next`,o=$localize`:␟c8d1785038d461ec66b5799db21864182b35900a␟1102717806459547726:Refresh`,r=$localize`:␟71697936bf93aa7b37f938e213eaf990aaa0715c␟6587306545685043964:Fix all fixable`,g=$localize`:␟1d0d5c9a36e72bd9643ff1ede69736ae063d652b␟3133539296286953705:Stop`,[n,o,r,g,[1,"radar"],["section",t],[1,"content"],[1,"buttons"],[1,"button-primary",3,"click"],[1,"icon-play"],[1,"button-on-control"],[1,"button-on-control",3,"click"],[1,"icon-reload"],[1,"icon-stop"],[1,"current"],[1,"icon-spin","icon-spinner"],[3,"routerLink"],[1,"icon-folder"],[1,"track"],[1,"meta"],[1,"track-health"],[3,"resolvedEvent","trackHealth"]]},template:function(n,o){1&n&&(e.j41(0,"div",4)(1,"app-view-header-slim",5),e.DNE(2,Vn,2,2),e.k0s(),e.j41(3,"div",6),e.DNE(4,zn,1,0,"app-loading")(5,Qn,10,8,"div"),e.k0s()()),2&n&&(e.R7$(2),e.vxM(2,o.folders?2:-1),e.R7$(2),e.vxM(4,o.folders?-1:4),e.R7$(),e.vxM(5,o.folders&&o.current?5:-1))},dependencies:[Ae.w,Y.q,D.Wk,Xe],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{min-width:130px;display:inline-block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]{padding-top:15px;padding-bottom:15px;border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-right:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]{border-bottom:1px solid var(--background-border)}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{padding-top:15px;padding-bottom:15px}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{padding-left:15px}@media (max-width: 768px){[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .radar[_ngcontent-%COMP%]   .track[_ngcontent-%COMP%]   .track-health[_ngcontent-%COMP%]{padding-left:0}}"]})}return i})();const We=()=>({standalone:!0});function Kn(i,d){if(1&i){const t=e.RV6();e.j41(0,"form")(1,"div",7)(2,"label",8),e.pXf(3,0),e.k0s(),e.j41(4,"input",9),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.edit.name,o)||(r.edit.name=o),e.Njj(o)}),e.k0s()(),e.j41(5,"div",7)(6,"label",10),e.pXf(7,1),e.k0s(),e.j41(8,"input",11),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.edit.path,o)||(r.edit.path=o),e.Njj(o)}),e.k0s()(),e.j41(9,"div",7)(10,"label",12),e.pXf(11,2),e.k0s(),e.j41(12,"fieldset",13)(13,"label",14)(14,"input",15),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.edit.strategy,o)||(r.edit.strategy=o),e.Njj(o)}),e.k0s(),e.qex(15),e.pXf(16,3),e.bVm(),e.k0s(),e.j41(17,"label",14)(18,"input",15),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.edit.strategy,o)||(r.edit.strategy=o),e.Njj(o)}),e.k0s(),e.qex(19),e.pXf(20,4),e.bVm(),e.k0s(),e.j41(21,"label",14)(22,"input",15),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.edit.strategy,o)||(r.edit.strategy=o),e.Njj(o)}),e.k0s(),e.qex(23),e.pXf(24,5),e.bVm(),e.k0s(),e.j41(25,"label",14)(26,"input",15),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.edit.strategy,o)||(r.edit.strategy=o),e.Njj(o)}),e.k0s(),e.qex(27),e.pXf(28,6),e.bVm(),e.k0s()()()()}if(2&i){const t=e.XpG();e.R7$(4),e.Y8G("ngModelOptions",e.lJ4(12,We)),e.R50("ngModel",t.edit.name),e.R7$(4),e.Y8G("ngModelOptions",e.lJ4(13,We)),e.R50("ngModel",t.edit.path),e.R7$(6),e.Y8G("value",t.RootScanStrategy.auto),e.R50("ngModel",t.edit.strategy),e.R7$(4),e.Y8G("value",t.RootScanStrategy.artistalbum),e.R50("ngModel",t.edit.strategy),e.R7$(4),e.Y8G("value",t.RootScanStrategy.compilation),e.R50("ngModel",t.edit.strategy),e.R7$(4),e.Y8G("value",t.RootScanStrategy.audiobook),e.R50("ngModel",t.edit.strategy)}}let Qe=(()=>{class i{edit;RootScanStrategy=M.dE;dialogInit(t,n){this.edit=n.data}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-dialog-root"]],decls:1,vars:1,consts:()=>{let t,n,o,r,g,C,T;return t=$localize`:␟ddfade2974824bcfebc98d94ccca4f02a52a5e65␟2965783636506266611:Root name`,n=$localize`:␟766c66ad5cc981c531aaf3fe3a2a7a346ddc8d83␟8911059720204770105:Path`,o=$localize`:␟1236bc5dce6e5821e26178cec6dc8d6994036e10␟1620750203195539416:Scan Strategy`,r=$localize`:␟5fb13fb4a8447e59cdf05dc196ade39c02a6f8aa␟616064537937996961:Auto`,g=$localize`:␟88f9a766c7fa0449925eb62ba3acba24e86312f3␟9062842966881378285:Artist/Album`,C=$localize`:␟1120f45b24301f0a6a137929f189c3b51e4038ae␟5240807861057959896:Compilations`,T=$localize`:␟ec1bae0fe9a2b7e56d8f8473a9ffced030abc60b␟7565550399152163566:Audiobook`,[t,n,o,r,g,C,T,[1,"root-form-control"],["for","root-name"],["id","root-name","type","text",3,"ngModelChange","ngModelOptions","ngModel"],["for","root-path"],["id","root-path","type","text",3,"ngModelChange","ngModelOptions","ngModel"],["for","strategy"],["id","strategy"],[1,"select"],["type","radio","name","strategy",3,"ngModelChange","value","ngModel"]]},template:function(n,o){1&n&&e.DNE(0,Kn,29,14,"form"),2&n&&e.vxM(0,o.edit?0:-1)},dependencies:[u.qT,u.me,u.Fm,u.BC,u.cb,u.vS,u.cV],styles:["[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%;line-height:1.3em;padding:5px;min-width:300px}[_nghost-%COMP%]   input[type=radio][_ngcontent-%COMP%]{margin-right:5px}[_nghost-%COMP%]   .root-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block}[_nghost-%COMP%]   .select[_ngcontent-%COMP%]{margin-right:15px;display:block;font-size:.8em;line-height:1.5em}"]})}return i})();var qn=E(2847);const Jn=(i,d)=>d.id;function Zn(i,d){1&i&&(e.j41(0,"span"),e.pXf(1,5),e.k0s())}function eo(i,d){if(1&i&&(e.j41(0,"span",19),e.qex(1),e.pXf(2,6),e.bVm(),e.nrm(3,"br"),e.EFF(4),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(4),e.JRh(t.status.error)}}function to(i,d){1&i&&(e.qex(0),e.pXf(1,7),e.bVm())}function no(i,d){if(1&i&&(e.qex(0),e.pXf(1,8),e.bVm(),e.nrm(2,"br"),e.EFF(3),e.nI1(4,"date")),2&i){const t=e.XpG(2).$implicit;e.R7$(3),e.SpI("",e.i5U(4,1,t.status.lastScan,"medium")," ")}}function oo(i,d){if(1&i&&(e.j41(0,"span"),e.DNE(1,to,2,0,"ng-container")(2,no,5,4),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.vxM(1,t.status.scanning?1:-1),e.R7$(),e.vxM(2,t.status.scanning?-1:2)}}function io(i,d){if(1&i){const t=e.RV6();e.j41(0,"tr",18),e.bIt("dblclick",function(){const o=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.editRoot(o))})("keydown.enter",function(){const o=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.editRoot(o))}),e.j41(1,"td",12),e.EFF(2),e.k0s(),e.j41(3,"td",13),e.EFF(4),e.k0s(),e.j41(5,"td",14),e.EFF(6),e.k0s(),e.j41(7,"td",15),e.DNE(8,Zn,2,0,"span")(9,eo,5,1,"span",19)(10,oo,3,2,"span"),e.k0s(),e.j41(11,"td",16)(12,"div",20)(13,"button",21),e.bIt("click",function(){const o=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.refreshRoot(o))}),e.nrm(14,"i",22),e.k0s(),e.j41(15,"button",23),e.bIt("click",function(){const o=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.refreshRootMeta(o))}),e.nrm(16,"i",24),e.k0s(),e.j41(17,"button",25),e.bIt("click",function(){const o=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.editRoot(o))}),e.nrm(18,"i",26),e.k0s(),e.j41(19,"button",27),e.bIt("click",function(){const o=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.deleteRoot(o))}),e.nrm(20,"i",28),e.k0s()()()()}if(2&i){const t=d.$implicit;e.R7$(2),e.JRh(t.name),e.R7$(2),e.JRh(t.path),e.R7$(2),e.JRh(t.strategy),e.R7$(2),e.vxM(8,t.status?-1:8),e.R7$(),e.vxM(9,t.status&&t.status.error?9:-1),e.R7$(),e.vxM(10,t.status&&!t.status.error?10:-1)}}function ro(i,d){if(1&i&&(e.j41(0,"table",10)(1,"tr",11)(2,"td",12),e.pXf(3,0),e.k0s(),e.j41(4,"td",13),e.pXf(5,1),e.k0s(),e.j41(6,"td",14),e.pXf(7,2),e.k0s(),e.j41(8,"td",15),e.pXf(9,3),e.k0s(),e.j41(10,"td",16),e.pXf(11,4),e.k0s()(),e.Z7z(12,io,21,6,"tr",17,Jn),e.k0s()),2&i){const t=e.XpG();e.R7$(12),e.Dyx(t.roots)}}let ao=(()=>{class i{router;route;app;notify;dialogs;rootService;dialogOverlay;roots=[];constructor(t,n,o,r,g,C,T){this.router=t,this.route=n,this.app=o,this.notify=r,this.dialogs=g,this.rootService=C,this.dialogOverlay=T}refreshRoot(t){this.rootService.rescanRoot(t)}refreshRootMeta(t){this.rootService.refreshRootMeta(t)}editRoot(t){var n=this;const o={root:t,name:t.name,path:t.path,strategy:t.strategy};var r;this.dialogOverlay.open({title:"Edit Root",childComponent:Qe,data:o,onOkBtn:(r=(0,L.A)(function*(){try{yield n.rootService.applyDialogRoot(o)}catch(g){return n.notify.error(g),Promise.reject(g)}}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,L.A)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}deleteRoot(t){this.dialogs.confirm("Delete Root","Do you want to the delete the root folder?",()=>{this.rootService.removeRoot(t)})}static \u0275fac=function(n){return new(n||i)(e.rXU(D.Ix),e.rXU(D.nX),e.rXU(f.d3),e.rXU(f.FL),e.rXU($.JQ),e.rXU(f.ZB),e.rXU(F.iD))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-root-list"]],inputs:{roots:"roots"},decls:2,vars:2,consts:()=>{let t,n,o,r,g,C,T,b,x,K,Z,Q,y;return t=$localize`:␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,n=$localize`:␟766c66ad5cc981c531aaf3fe3a2a7a346ddc8d83␟8911059720204770105:Path`,o=$localize`:␟05f5612d42b02be4d6d9e0a99585ae7e30a91780␟1617785425462022303:Strategy`,r=$localize`:␟81b97b8ea996ad1e4f9fca8415021850214884b1␟5611592591303869712:Status`,g=$localize`:␟030b4423b92167200e39519599f9b863b4f7c62c␟3193976279273491157:Actions`,C=$localize`:␟96613e9bbc5b95316e56df72d323766b54c4964e␟1020564942829121638:Rescan Root`,T=$localize`:␟046a16565d1a08a0b5c251255c63e873f64c4f61␟1228008259662169871:Refresh Root Meta`,b=$localize`:␟b9bf82da3451056e15340d89a4bcbf22fe45752b␟5936613369747810049:Edit Root`,x=$localize`:␟b2fb8fb0d8eda1e65e01bfe666f42b8d4a853caa␟4674133541672494865:Delete Root`,K=$localize`:␟ff46a8749717b5199040c5eed9fe1e4c3ecc5624␟3875750134082688342:Not scanned`,Z=$localize`:␟45dd81fcbde051783b05fe60c8d0bab8e7e097a9␟4606091236515013460:Error:`,Q=$localize`:␟4fc06dce435cdd51107afcf0ca206bbbba026b0c␟1188193109474903303:Working…`,y=$localize`:␟8ba85460d8f8515d276c46a9a1876a2ee143482e␟5743221119363707616:Last Change:`,[t,n,o,r,g,K,Z,Q,y,["name","Roots",3,"list"],["appFocusKeyList","",1,"roots"],[1,"root","heading"],[1,"title"],[1,"path"],[1,"strategy"],[1,"status"],[1,"actions"],["appFocusKeyListItem","",1,"root"],["appFocusKeyListItem","",1,"root",3,"dblclick","keydown.enter"],[1,"error"],[1,"action-buttons"],["title",C,"appClickStop","",3,"click"],["aria-hidden","true",1,"icon-rescan"],["title",T,"appClickStop","",3,"click"],["aria-hidden","true",1,"icon-broom"],["title",b,"appClickStop","",3,"click"],["aria-hidden","true",1,"icon-edit"],["title",x,"appClickStop","",3,"click"],["aria-hidden","true",1,"icon-remove"]]},template:function(n,o){1&n&&(e.nrm(0,"app-background-text-list",9),e.DNE(1,ro,14,0,"table",10)),2&n&&(e.Y8G("list",o.roots),e.R7$(),e.vxM(1,o.roots&&o.roots.length>0?1:-1))},dependencies:[j.F,qn.o,P.S,A.b,c.vh],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .roots[_ngcontent-%COMP%]{padding:15px;font-size:.9em;width:100%}[_nghost-%COMP%]   .root[_ngcontent-%COMP%]{height:60px;border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .root[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .root[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .root.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}[_nghost-%COMP%]   .error[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{height:40px;font-size:.9em}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{width:100px}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px;flex:50%;margin:0;display:inline-block;color:var(--on-control);border:1px solid transparent}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--on-control-active);border:1px solid var(--control-active)}"]})}return i})(),so=(()=>{class i{router;route;app;notify;dialogs;rootService;dialogOverlay;roots;unsubscribe=new q.B;constructor(t,n,o,r,g,C,T){this.router=t,this.route=n,this.app=o,this.notify=r,this.dialogs=g,this.rootService=C,this.dialogOverlay=T}static getSortValue(t,n){switch(t){case"name":return n.name;case"path":return n.path;default:return}}ngOnInit(){this.rootService.rootsChange.pipe((0,G.Q)(this.unsubscribe)).subscribe(t=>{this.roots=(t||[]).sort((n,o)=>n.name.localeCompare(o.name))},t=>{this.notify.error(t)}),this.rootService.refreshRoots()}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}refresh(){this.rootService.refreshRoots()}newRoot(){var t=this;const n={name:"",path:"",strategy:M.dE.auto};var o;this.dialogOverlay.open({title:"New Root",childComponent:Qe,data:n,onOkBtn:(o=(0,L.A)(function*(){try{yield t.rootService.applyDialogRoot(n)}catch(r){return t.notify.error(r),Promise.reject(r)}}),function(){return o.apply(this,arguments)}),onCancelBtn:function(){var o=(0,L.A)(function*(){return Promise.resolve()});return function(){return o.apply(this,arguments)}}()})}refreshRoots(){this.rootService.rescanRoots()}static \u0275fac=function(n){return new(n||i)(e.rXU(D.Ix),e.rXU(D.nX),e.rXU(f.d3),e.rXU(f.FL),e.rXU($.JQ),e.rXU(f.ZB),e.rXU(F.iD))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-root"]],decls:11,vars:1,consts:()=>{let t,n,o,r;return t=$localize`:␟2f248600386a30236db69832ef4f910600ec943b␟7732274825567857654:Roots`,n=$localize`:␟c8d1785038d461ec66b5799db21864182b35900a␟1102717806459547726:Refresh`,o=$localize`:␟e13ccbc99042ea4870ebde4a4038672a4298adaf␟3093922570235029600:New Root…`,r=$localize`:␟c45553c26a8d0a2887def846473f015706ceb1c2␟4238145957469001439:Rescan all Roots`,[[1,"roots"],["section",t],[1,"actions"],["title",n,1,"button-on-control",3,"click"],[1,"icon-reload"],["title",o,1,"button-on-control",3,"click"],[1,"icon-plus"],["title",r,1,"button-on-control",3,"click"],[1,"icon-rescan"],[1,"content"],[3,"roots"]]},template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"app-view-header-slim",1)(2,"div",2)(3,"button",3),e.bIt("click",function(){return o.refresh()}),e.nrm(4,"i",4),e.k0s(),e.j41(5,"button",5),e.bIt("click",function(){return o.newRoot()}),e.nrm(6,"i",6),e.k0s(),e.j41(7,"button",7),e.bIt("click",function(){return o.refreshRoots()}),e.nrm(8,"i",8),e.k0s()()(),e.j41(9,"div",9),e.nrm(10,"app-admin-root-list",10),e.k0s()()),2&n&&(e.R7$(10),e.Y8G("roots",o.roots))},dependencies:[Ae.w,ao],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .roots[_ngcontent-%COMP%]{height:100%;overflow-y:auto;overflow-x:hidden}[_nghost-%COMP%]   .roots[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}"]})}return i})();function _o(i,d){1&i&&e.nrm(0,"app-loading")}function lo(i,d){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"div",25),e.pXf(2,1),e.k0s(),e.j41(3,"div",26)(4,"label")(5,"input",27),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.settings.library.scanAtStart,o)||(r.settings.library.scanAtStart=o),e.Njj(o)}),e.bIt("ngModelChange",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.onChange())}),e.k0s(),e.qex(6),e.pXf(7,2),e.bVm(),e.k0s()()(),e.j41(8,"div")(9,"div",25),e.pXf(10,3),e.k0s(),e.j41(11,"div",26)(12,"label")(13,"input",28),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.settings.externalServices.enabled,o)||(r.settings.externalServices.enabled=o),e.Njj(o)}),e.bIt("ngModelChange",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.onChange())}),e.k0s(),e.qex(14),e.pXf(15,4),e.bVm(),e.k0s()()(),e.j41(16,"div")(17,"div",25),e.pXf(18,5),e.k0s(),e.j41(19,"div",26)(20,"label",29),e.pXf(21,6),e.k0s(),e.j41(22,"input",30),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.settings.chat.maxMessages,o)||(r.settings.chat.maxMessages=o),e.Njj(o)}),e.bIt("ngModelChange",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.onChange())}),e.k0s()(),e.j41(23,"div",26)(24,"div",31)(25,"label",32),e.pXf(26,7),e.k0s(),e.j41(27,"input",33),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.settings.chat.maxAge.value,o)||(r.settings.chat.maxAge.value=o),e.Njj(o)}),e.bIt("ngModelChange",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.onChange())}),e.k0s()(),e.j41(28,"select",34),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.settings.chat.maxAge.unit,o)||(r.settings.chat.maxAge.unit=o),e.Njj(o)}),e.bIt("ngModelChange",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.onChange())}),e.j41(29,"option",35),e.pXf(30,8),e.k0s(),e.j41(31,"option",35),e.pXf(32,9),e.k0s(),e.j41(33,"option",35),e.pXf(34,10),e.k0s(),e.j41(35,"option",35),e.pXf(36,11),e.k0s(),e.j41(37,"option",35),e.pXf(38,12),e.k0s(),e.j41(39,"option",35),e.pXf(40,13),e.k0s(),e.j41(41,"option",35),e.pXf(42,14),e.k0s(),e.j41(43,"option",35),e.pXf(44,15),e.k0s(),e.j41(45,"option",35),e.pXf(46,16),e.k0s(),e.j41(47,"option",35),e.pXf(48,17),e.k0s()()()(),e.j41(49,"div")(50,"div",25),e.pXf(51,18),e.k0s(),e.j41(52,"div",26)(53,"label",36),e.pXf(54,19),e.k0s(),e.j41(55,"textarea",37),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.ignoreArticles,o)||(r.ignoreArticles=o),e.Njj(o)}),e.bIt("ngModelChange",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.onChange())}),e.k0s()()()}if(2&i){const t=e.XpG();e.R7$(5),e.R50("ngModel",t.settings.library.scanAtStart),e.R7$(8),e.R50("ngModel",t.settings.externalServices.enabled),e.R7$(9),e.R50("ngModel",t.settings.chat.maxMessages),e.R7$(5),e.R50("ngModel",t.settings.chat.maxAge.value),e.R7$(),e.R50("ngModel",t.settings.chat.maxAge.unit),e.R7$(),e.Y8G("value","year"),e.R7$(2),e.Y8G("value","years"),e.R7$(2),e.Y8G("value","month"),e.R7$(2),e.Y8G("value","months"),e.R7$(2),e.Y8G("value","day"),e.R7$(2),e.Y8G("value","days"),e.R7$(2),e.Y8G("value","minute"),e.R7$(2),e.Y8G("value","minutes"),e.R7$(2),e.Y8G("value","second"),e.R7$(2),e.Y8G("value","seconds"),e.R7$(8),e.R50("ngModel",t.ignoreArticles)}}let co=(()=>{class i{app;jam;notify;settings;ignoreArticles="";constructor(t,n,o){this.app=t,this.jam=n,this.notify=o}ngOnInit(){this.refresh()}onChange(){}refresh(){this.jam.admin.settings().then(t=>{this.display(t)}).catch(t=>{this.notify.error(t)})}save(){const t=this.settings;t&&(t.index.ignoreArticles=this.ignoreArticles.split("\n").map(n=>n.trim()).filter(n=>n.length>0),this.settings=void 0,this.jam.admin.settingsUpdate(t).then(()=>{this.notify.success("Settings updated"),this.settings=t}).catch(n=>{this.notify.error(n),this.settings=t}))}display(t){this.settings=t,this.ignoreArticles=t.index.ignoreArticles.join("\n")}static \u0275fac=function(n){return new(n||i)(e.rXU(f.d3),e.rXU(M.UA),e.rXU(f.FL))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-settings"]],decls:9,vars:2,consts:()=>{let t,n,o,r,g,C,T,b,x,K,Z,Q,y,V,Me,he,z,Re,Ie,B,Je,Ze,et,tt,nt;return t=$localize`:␟05cd06e631edc939a19ce22d609504b7f570723d␟8116289374261643531:Admin Settings`,n=$localize`:␟52c9a103b812f258bcddc3d90a6e3f46871d25fe␟3768927257183755959:Save`,o=$localize`:␟32e65202f89b91a77d0239f6387009535f18c004␟263473846992399517:Save Settings`,r=$localize`:␟a0e8cc93872a4a7c74ebd4fd165751ad9bb55bc0␟7635936183047857561:Scan all Roots on Server Start`,g=$localize`:␟e47c0675b7122c899137fd211528f276baefa9f3␟8918946905429464030:Allow Request to External Services`,C=$localize`:␟f0f78754451cc705b4bc6aafa1b733b8219c383a␟4950570181842731349:Unit of Age`,T=$localize`:␟905882c0fe09eee755ee6730ecf10e3b85cb6d9c␟2188854519574316630:Server`,b=$localize`:␟a0e8cc93872a4a7c74ebd4fd165751ad9bb55bc0␟7635936183047857561:Scan all Roots on Server Start`,x=$localize`:␟d813ec2b4e4dbb4f1a3f2596a34bb94b324dd64b␟5721522774620057803:External Services`,K=$localize`:␟e47c0675b7122c899137fd211528f276baefa9f3␟8918946905429464030:Allow Request to External Services`,Z=$localize`:␟5adf337be1ad12c915ae18012f1bfa1f2ca4628b␟2299187798995800780:Chat`,Q=$localize`:␟52318b5079ce3bda0877053b52a550fbde67130a␟6088560830023353456:Maximum Number of Messages`,y=$localize`:␟3391bd7ac225b712137a44a47653ba5912ba6e14␟845892119032308787:Maximum Age of Message`,V=$localize`:␟752daa6baad0f8b4684b5c6775345b02bed6746e␟6479044529603381727:year`,Me=$localize`:␟e6bbe25e83a1e135e8e1d3e2ceddadb8529c45e9␟7658073495909471632:years`,he=$localize`:␟2790ad2c08306240a508576e942fcfdf271f5a79␟7178101913251976451:month`,z=$localize`:␟0fcdd5427274550312ee512bcd5b61ec077e0b5f␟6169402792391433667:months`,Re=$localize`:␟f64c76c7c7c71baddef3dc6a93e4394b8fdb69f4␟6320319413541466015:day`,Ie=$localize`:␟fc34f2683c4cb526ed7095c5b1cdd66d672ba932␟7036284206110282007:days`,B=$localize`:␟cff3ed26f8073fa2fe757d97880662060c39a1fa␟5405071297219936776:minute`,Je=$localize`:␟cd25ef11e2d8843297caf4202937023dc02d0ba8␟982745398054129955:minutes`,Ze=$localize`:␟c40875920fa824ba8029cf99315da474625354f9␟7479425239631237410:second`,et=$localize`:␟38bd5794dbe84081cfa7867e876245e1ddae93e7␟227749613426254192:seconds`,tt=$localize`:␟38484614389a6a41930e95b82c891780a99be9ce␟225617230946350058:Artist Index`,nt=$localize`:␟cb8e8c81accbef16924070ba1c4e2e28f7bae96a␟3077366211526620849:Ignored Articles in Artist Names`,[o,T,b,x,K,Z,Q,y,V,Me,he,z,Re,Ie,B,Je,Ze,et,tt,nt,[1,"settings"],["section",t],["title",n,1,"button-on-control",3,"click"],[1,"icon-floppy"],[1,"content"],[1,"section-title"],[1,"section-entry"],["type","checkbox","title",r,3,"ngModelChange","ngModel"],["type","checkbox","title",g,3,"ngModelChange","ngModel"],["for","max_messages"],["id","max_messages","type","number",3,"ngModelChange","ngModel"],[1,"chat-max-age"],["for","max_age"],["id","max_age","type","number",3,"ngModelChange","ngModel"],["title",C,3,"ngModelChange","ngModel"],[3,"value"],["for","ignore_articles"],["id","ignore_articles","rows","10","cols","20",3,"ngModelChange","ngModel"]]},template:function(n,o){1&n&&(e.j41(0,"div",20)(1,"app-view-header-slim",21)(2,"button",22),e.bIt("click",function(){return o.save()}),e.nrm(3,"i",23),e.qex(4),e.pXf(5,0),e.bVm(),e.k0s()(),e.j41(6,"div",24),e.DNE(7,_o,1,0,"app-loading")(8,lo,56,16),e.k0s()()),2&n&&(e.R7$(7),e.vxM(7,o.settings?-1:7),e.R7$(),e.vxM(8,o.settings?8:-1))},dependencies:[Ae.w,Y.q,u.xH,u.y7,u.me,u.Q0,u.Zm,u.wz,u.BC,u.vS],styles:["[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:hidden;height:100%}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:15px 15px 0}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .chat-max-age[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .section-entry[_ngcontent-%COMP%]{padding-bottom:15px}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:12px;padding-bottom:3px}[_nghost-%COMP%]   .settings[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-top:-1px;display:inline-block;vertical-align:middle}"]})}return i})(),Ye=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-start"]],decls:4,vars:0,consts:()=>{let t;return t=$localize`:␟b7648e7aced164498aa843b5c4e8f2f1c36a7919␟7844706011418789951:Administration`,[[1,"start"],["section",t],[1,"content"]]},template:function(n,o){1&n&&(e.j41(0,"div",0),e.nrm(1,"app-view-header-slim",1),e.j41(2,"div",2),e.nrm(3,"app-admin-section-cards"),e.k0s()())},styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .start[_ngcontent-%COMP%]{height:100%;overflow-y:auto;overflow-x:hidden}"]})}return i})();const ue=()=>({standalone:!0});function go(i,d){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"form")(2,"div",9)(3,"label",10),e.pXf(4,1),e.k0s(),e.j41(5,"input",11),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.edit.edit.name,o)||(r.edit.edit.name=o),e.Njj(o)}),e.k0s()(),e.j41(6,"div",9)(7,"label",12),e.pXf(8,2),e.k0s(),e.j41(9,"input",13),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.edit.edit.email,o)||(r.edit.edit.email=o),e.Njj(o)}),e.k0s()(),e.j41(10,"div",14),e.pXf(11,3),e.k0s(),e.j41(12,"div",15)(13,"label")(14,"input",16),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.edit.edit.roleAdmin,o)||(r.edit.edit.roleAdmin=o),e.Njj(o)}),e.k0s(),e.qex(15),e.pXf(16,4),e.bVm(),e.k0s(),e.nrm(17,"br"),e.j41(18,"label")(19,"input",17),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.edit.edit.rolePodcast,o)||(r.edit.edit.rolePodcast=o),e.Njj(o)}),e.k0s(),e.qex(20),e.pXf(21,5),e.bVm(),e.k0s(),e.nrm(22,"br"),e.j41(23,"label")(24,"input",18),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.edit.edit.roleStream,o)||(r.edit.edit.roleStream=o),e.Njj(o)}),e.k0s(),e.qex(25),e.pXf(26,6),e.bVm(),e.k0s(),e.nrm(27,"br"),e.j41(28,"label")(29,"input",19),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.edit.edit.roleUpload,o)||(r.edit.edit.roleUpload=o),e.Njj(o)}),e.k0s(),e.qex(30),e.pXf(31,7),e.bVm(),e.k0s()(),e.nrm(32,"hr"),e.j41(33,"div",9),e.nrm(34,"input",20,0),e.j41(36,"label",21),e.pXf(37,8),e.k0s(),e.j41(38,"input",22),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.edit.edit.password,o)||(r.edit.edit.password=o),e.Njj(o)}),e.k0s()()()()}if(2&i){const t=e.XpG();e.R7$(5),e.Y8G("ngModelOptions",e.lJ4(14,ue)),e.R50("ngModel",t.edit.edit.name),e.R7$(4),e.Y8G("ngModelOptions",e.lJ4(15,ue)),e.R50("ngModel",t.edit.edit.email),e.R7$(5),e.Y8G("ngModelOptions",e.lJ4(16,ue)),e.R50("ngModel",t.edit.edit.roleAdmin),e.R7$(5),e.Y8G("ngModelOptions",e.lJ4(17,ue)),e.R50("ngModel",t.edit.edit.rolePodcast),e.R7$(5),e.Y8G("ngModelOptions",e.lJ4(18,ue)),e.R50("ngModel",t.edit.edit.roleStream),e.R7$(5),e.Y8G("ngModelOptions",e.lJ4(19,ue)),e.R50("ngModel",t.edit.edit.roleUpload),e.R7$(9),e.Y8G("ngModelOptions",e.lJ4(20,ue)),e.R50("ngModel",t.edit.edit.password)}}let Ke=(()=>{class i{edit;dialogInit(t,n){this.edit=n.data}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-dialog-user"]],decls:1,vars:1,consts:()=>{let t,n,o,r,g,C,T,b,x,K,Z,Q;return t=$localize`:␟15e872ff022f06bc8851c7d491bbdc4f97622005␟993404206539036614:Allow User to administrate`,n=$localize`:␟92671fcb207c6fb5c91ef0ac4e61a1887af6e469␟7533742878403628379:Allow User to manage podcasts`,o=$localize`:␟92671fcb207c6fb5c91ef0ac4e61a1887af6e469␟7533742878403628379:Allow User to manage podcasts`,r=$localize`:␟c6a4ec52976cdbecfd1fa4f71a1d02244d341a8e␟9108342311725516140:Allow User to upload files`,g=$localize`:␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,C=$localize`:␟244aae9346da82b0922506c2d2581373a15641cc␟4768749765465246664:Email`,T=$localize`:␟9610487cbeb5796d34d8601b5ac0c0a65f9e1d19␟795890916060309463:Roles`,b=$localize`:␟ca2283fc765b9f44b69f0175d685dc2443da6011␟2149300564474427551:Administrator`,x=$localize`:␟f47ba1cd01c3dfd801fe7f66c3d28d698dcc0479␟1291164613191345064:Manage Podcasts`,K=$localize`:␟c51fa359cb05f03964328ee48e72f6e3cba741ae␟9044866363915823667:Can Stream/Download`,Z=$localize`:␟1e9e022fd3deee0b16ced58938f6e2575909d144␟5645792403509214710:Can Upload`,Q=$localize`:␟8df9ea304725ea9dc29de1e23673cbdf81f83d1b␟416924249936013759:Your Admin Password`,[["name",""],g,C,T,b,x,K,Z,Q,[1,"user-form-control"],["for","user-name"],["id","user-name","type","text","name","username",3,"ngModelChange","ngModelOptions","ngModel"],["for","user-mail"],["id","user-mail","type","email","name","mail",3,"ngModelChange","ngModelOptions","ngModel"],[1,"user-form-section"],[1,"user-form-roles"],["type","checkbox","title",t,3,"ngModelChange","ngModelOptions","ngModel"],["type","checkbox","title",n,3,"ngModelChange","ngModelOptions","ngModel"],["type","checkbox","title",o,3,"ngModelChange","ngModelOptions","ngModel"],["type","checkbox","title",r,3,"ngModelChange","ngModelOptions","ngModel"],["type","text","name","user","autocomplete","username",1,"dummy"],["for","admin-pass",1,"label-pass"],["id","admin-pass","name","pass","type","password","autocomplete","password",3,"ngModelChange","ngModelOptions","ngModel"]]},template:function(n,o){1&n&&e.DNE(0,go,39,21,"div"),2&n&&e.vxM(0,o.edit?0:-1)},dependencies:[u.qT,u.me,u.Zm,u.BC,u.cb,u.vS,u.cV],styles:["[_nghost-%COMP%] > div[_ngcontent-%COMP%]{margin-left:15px;margin-right:15px}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%], [_nghost-%COMP%]   input[type=email][_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{line-height:1.3em;padding:5px}[_nghost-%COMP%]   .label-pass[_ngcontent-%COMP%]{padding-right:15px;font-size:.8em}[_nghost-%COMP%]   .dummy[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .user-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block}[_nghost-%COMP%]   .user-form-roles[_ngcontent-%COMP%]{margin-bottom:10px}[_nghost-%COMP%]   .user-form-roles[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{line-height:1.5em}"]})}return i})();var po=E(9589);let Mo=(()=>{class i{jam;notify;user;userAvatar;hasChanged=!1;unsubscribe=new q.B;constructor(t,n){this.jam=t,this.notify=n}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}dialogInit(t,n){this.user=n.data,this.setImageSource()}dialogResult(){return this.hasChanged}setImageSource(){this.userAvatar=this.user?`${this.jam.image.imageUrl({id:this.user.id,size:60,format:M.Nc.webp})}?${(0,po.D)()}`:void 0}onDropFile(t){t.preventDefault(),this.uploadFile(t.dataTransfer?.files)}onDragOverFile(t){t.stopPropagation(),t.preventDefault()}selectFile(t){this.uploadFile(t.target.files)}uploadFile(t){t&&0!==t.length&&this.user&&this.jam.user.uploadUserImage({id:this.user.id},t[0]).pipe((0,G.Q)(this.unsubscribe)).subscribe(o=>{o.type===re.hv.UploadProgress||o instanceof re.cS&&(this.setImageSource(),this.hasChanged=!0)},o=>{this.setImageSource(),this.notify.error(o)},()=>{this.notify.success("Upload done")})}static \u0275fac=function(n){return new(n||i)(e.rXU(M.UA),e.rXU(f.FL))};static \u0275cmp=e.VBU({type:i,selectors:[["app-dialog-avatar"]],decls:6,vars:1,consts:()=>{let t,n;return t=$localize`:␟f6317c7ab4911427c272a59e837eed9a4cffae0d␟1388903157408573617:User Avatar`,n=$localize`:␟d833321cc90a0b0a52714c6d5ec97fbe6c7cfa5c␟2501989539336327542:Upload image`,[[1,"drop-zone",3,"drop","dragover"],[1,"root-form-control"],["alt",t,3,"src"],["type","file","placeholder",n,"accept",".png,.jpeg,.jpg",3,"change"]]},template:function(n,o){1&n&&(e.j41(0,"div",0),e.bIt("drop",function(g){return o.onDropFile(g)})("dragover",function(g){return o.onDragOverFile(g)}),e.j41(1,"form")(2,"div",1),e.nrm(3,"img",2),e.k0s()(),e.j41(4,"form")(5,"input",3),e.bIt("change",function(g){return o.selectFile(g)}),e.k0s()()()),2&n&&(e.R7$(3),e.Y8G("src",o.userAvatar,e.B4B))},dependencies:[u.qT,u.cb,u.cV],styles:["[_nghost-%COMP%]   .drop-zone[_ngcontent-%COMP%]{margin:10px 20px;border-width:2px;border-style:dotted;border-color:var(--secondary)}[_nghost-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .root-form-control[_ngcontent-%COMP%]{margin-bottom:8px;display:block;text-align:center}"]})}return i})();const qe=()=>({standalone:!0});function ho(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",2)(1,"form"),e.nrm(2,"input",3),e.j41(3,"label",4),e.pXf(4,0),e.k0s(),e.j41(5,"input",5),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.data.password,o)||(r.data.password=o),e.Njj(o)}),e.k0s()(),e.j41(6,"form"),e.nrm(7,"input",6),e.j41(8,"label",7),e.qex(9),e.pXf(10,1),e.bVm(),e.j41(11,"span"),e.EFF(12),e.k0s()(),e.j41(13,"input",8),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG();return e.DH7(r.data.newPassword,o)||(r.data.newPassword=o),e.Njj(o)}),e.k0s()()()}if(2&i){const t=e.XpG();e.R7$(5),e.Y8G("ngModelOptions",e.lJ4(5,qe)),e.R50("ngModel",t.data.password),e.R7$(7),e.JRh(t.data.user.name),e.R7$(),e.Y8G("ngModelOptions",e.lJ4(6,qe)),e.R50("ngModel",t.data.newPassword)}}let fo=(()=>{class i{data;dialogInit(t,n){this.data=n.data}dialogResult(){return!0}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-dialog-user-pass"]],decls:1,vars:1,consts:()=>{let t,n;return t=$localize`:␟8df9ea304725ea9dc29de1e23673cbdf81f83d1b␟416924249936013759:Your Admin Password`,n=$localize`:␟4775d5cec61d0551fdf66e8e117c3c5a92ff9d2c␟1578289766881417376:New Password for User`,[t,n,[1,"user-form-control"],["type","text","name","user","autocomplete","username",1,"dummy"],["for","admin-pass"],["id","admin-pass","name","pass","type","password","autocomplete","current-password",3,"ngModelChange","ngModelOptions","ngModel"],["type","text","name","new_name",1,"dummy"],["for","new-pass"],["id","new-pass","name","new_password","type","password","autocomplete","new-password",3,"ngModelChange","ngModelOptions","ngModel"]]},template:function(n,o){1&n&&e.DNE(0,ho,14,7,"div",2),2&n&&e.vxM(0,o.data?0:-1)},dependencies:[u.qT,u.me,u.BC,u.cb,u.vS,u.cV],styles:["[_nghost-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:10px}[_nghost-%COMP%]   label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .dummy[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   input[_ngcontent-%COMP%]{line-height:1.3em;padding:5px;width:100%;margin-bottom:15px}"]})}return i})();var Oo=E(801);const Co=(i,d)=>d.id;function uo(i,d){1&i&&e.nrm(0,"i",22)}function mo(i,d){1&i&&(e.j41(0,"span",23),e.pXf(1,8),e.k0s())}function Eo(i,d){1&i&&e.nrm(0,"i",22)}function So(i,d){1&i&&(e.j41(0,"span",23),e.pXf(1,9),e.k0s())}function To(i,d){1&i&&e.nrm(0,"i",22)}function No(i,d){1&i&&(e.j41(0,"span",23),e.pXf(1,10),e.k0s())}function Po(i,d){1&i&&e.nrm(0,"i",22)}function Ao(i,d){1&i&&(e.j41(0,"span",23),e.pXf(1,11),e.k0s())}function Ro(i,d){if(1&i){const t=e.RV6();e.j41(0,"tr",20),e.bIt("dblclick",function(){const o=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.editUser(o))})("keydown.enter",function(){const o=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.editUser(o))}),e.j41(1,"td",14),e.nrm(2,"app-coverart-image",21),e.k0s(),e.j41(3,"td",15),e.EFF(4),e.k0s(),e.j41(5,"td",16),e.EFF(6),e.k0s(),e.j41(7,"td",17),e.DNE(8,uo,1,0,"i",22)(9,mo,2,0,"span",23),e.k0s(),e.j41(10,"td",17),e.DNE(11,Eo,1,0,"i",22)(12,So,2,0,"span",23),e.k0s(),e.j41(13,"td",17),e.DNE(14,To,1,0,"i",22)(15,No,2,0,"span",23),e.k0s(),e.j41(16,"td",17),e.DNE(17,Po,1,0,"i",22)(18,Ao,2,0,"span",23),e.k0s(),e.j41(19,"td",18)(20,"div",24)(21,"button",25),e.bIt("click",function(){const o=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.editUserAvatar(o))}),e.nrm(22,"i",26),e.k0s(),e.j41(23,"button",27),e.bIt("click",function(){const o=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.setUserPassword(o))}),e.nrm(24,"i",28),e.k0s(),e.j41(25,"button",29),e.bIt("click",function(){const o=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.editUser(o))}),e.nrm(26,"i",30),e.k0s(),e.j41(27,"button",31),e.bIt("click",function(){const o=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.deleteUser(o))}),e.nrm(28,"i",32),e.k0s()()()()}if(2&i){const t=d.$implicit;e.R7$(2),e.Y8G("coverArtObj",t)("alt",t.name)("size",28)("round",!0),e.R7$(2),e.JRh(t.name),e.R7$(2),e.JRh(t.email),e.R7$(2),e.vxM(8,t.roles.admin?8:-1),e.R7$(),e.vxM(9,t.roles.admin?9:-1),e.R7$(2),e.vxM(11,t.roles.podcast?11:-1),e.R7$(),e.vxM(12,t.roles.admin?12:-1),e.R7$(2),e.vxM(14,t.roles.upload?14:-1),e.R7$(),e.vxM(15,t.roles.admin?15:-1),e.R7$(2),e.vxM(17,t.roles.stream?17:-1),e.R7$(),e.vxM(18,t.roles.stream?18:-1)}}function Io(i,d){if(1&i&&(e.j41(0,"table",12)(1,"tr",13)(2,"td",14),e.pXf(3,0),e.k0s(),e.j41(4,"td",15),e.pXf(5,1),e.k0s(),e.j41(6,"td",16),e.pXf(7,2),e.k0s(),e.j41(8,"td",17),e.pXf(9,3),e.k0s(),e.j41(10,"td",17),e.pXf(11,4),e.k0s(),e.j41(12,"td",17),e.pXf(13,5),e.k0s(),e.j41(14,"td",17),e.pXf(15,6),e.k0s(),e.j41(16,"td",18),e.pXf(17,7),e.k0s()(),e.Z7z(18,Ro,29,14,"tr",19,Co),e.k0s()),2&i){const t=e.XpG();e.R7$(18),e.Dyx(t.users)}}let bo=(()=>{class i{router;route;app;notify;dialogs;userService;dialogOverlay;users=[];unsubscribe=new q.B;constructor(t,n,o,r,g,C,T){this.router=t,this.route=n,this.app=o,this.notify=r,this.dialogs=g,this.userService=C,this.dialogOverlay=T}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}editUser(t){var n=this;const o={user:t,edit:{password:"",name:t.name,email:t.email||"",roleAdmin:t.roles.admin,rolePodcast:t.roles.podcast,roleStream:t.roles.stream,roleUpload:t.roles.upload}};var r;this.dialogOverlay.open({childComponent:Ke,title:"Edit User",data:o,onOkBtn:(r=(0,L.A)(function*(){try{yield n.userService.applyDialogUser(o),n.notify.success("User edited")}catch(g){return n.notify.error(g),Promise.reject(g)}}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,L.A)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}editUserAvatar(t){this.dialogOverlay.open({childComponent:Mo,title:"Edit User Avatar",data:t}).afterClosed().pipe((0,G.Q)(this.unsubscribe)).subscribe(()=>{this.userService.refreshUser(t.id)})}setUserPassword(t){var n=this;const o={user:t,password:"",newPassword:""};var r;this.dialogOverlay.open({childComponent:fo,title:"Set User Password",data:o,onOkBtn:(r=(0,L.A)(function*(){try{yield n.userService.setPassword(t.id,o.password,o.newPassword),n.notify.success("Password changed")}catch(g){return n.notify.error(g),Promise.reject(g)}}),function(){return r.apply(this,arguments)}),onCancelBtn:function(){var r=(0,L.A)(function*(){return Promise.resolve()});return function(){return r.apply(this,arguments)}}()})}deleteUser(t){this.dialogs.confirm("Delete User","Do you want to the delete the user?",()=>{this.userService.removeUser(t).then(()=>{this.notify.success("User deleted")}).catch(n=>{this.notify.error(n)})})}static \u0275fac=function(n){return new(n||i)(e.rXU(D.Ix),e.rXU(D.nX),e.rXU(f.d3),e.rXU(f.FL),e.rXU($.JQ),e.rXU(f.uV),e.rXU(F.iD))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-user-list"]],inputs:{users:"users"},decls:1,vars:1,consts:()=>{let t,n,o,r,g,C,T,b,x,K,Z,Q,y,V,Me,he;return t=$localize`:␟cebb7f27b5028c62b4426da3bb3e3bd3f4a3443b␟6525109356951792180:Avatar`,n=$localize`:␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,o=$localize`:␟244aae9346da82b0922506c2d2581373a15641cc␟4768749765465246664:Email`,r=$localize`:␟ca2283fc765b9f44b69f0175d685dc2443da6011␟2149300564474427551:Administrator`,g=$localize`:␟f47ba1cd01c3dfd801fe7f66c3d28d698dcc0479␟1291164613191345064:Manage Podcasts`,C=$localize`:␟1e9e022fd3deee0b16ced58938f6e2575909d144␟5645792403509214710:Can Upload`,T=$localize`:␟b928aec28578d70da7964d4344fd08467bedeaae␟9217475344633494369:Can Stream`,b=$localize`:␟030b4423b92167200e39519599f9b863b4f7c62c␟3193976279273491157:Actions`,x=$localize`:␟2258a8b85cfda587286e36f3236420a15bf9ba29␟5503535973615409737:Change Avatar`,K=$localize`:␟4c27b7f16a6fc9c3f0ebd4a29a2b090ef72af63b␟6500919799852395758:Set Password`,Z=$localize`:␟2aa7c4367baad2832cb32bc21ba3b01ef2f278b9␟1211169124143348857:Edit User`,Q=$localize`:␟3c32a07710e402b2c056bd346e7c42f6015334a6␟4839682406703705780:Delete User`,y=$localize`:␟ef9d1d5acce5a10059867bc0883438ebfdbef96f␟6284119778725231733:Is Admin`,V=$localize`:␟8692ede58c19b2905ab9a276b61f8dc9d57e56c9␟1051345811582274933:Can manage podcast`,Me=$localize`:␟f51031955310593a68faf0820901072da7927c40␟970639177109356572:Can upload`,he=$localize`:␟33a9303f180a8e10778a031df3d0178786fd9280␟1869799973955909088:Can stream`,[t,n,o,r,g,C,T,b,y,V,Me,he,["appFocusKeyList","",1,"users"],[1,"user","heading"],[1,"avatar"],[1,"title"],[1,"email"],[1,"role"],[1,"actions"],["appFocusKeyListItem","",1,"user"],["appFocusKeyListItem","",1,"user",3,"dblclick","keydown.enter"],[3,"coverArtObj","alt","size","round"],["aria-hidden","true",1,"icon-checkmark"],[1,"visually-hidden"],[1,"action-buttons"],["title",x,3,"click"],["aria-hidden","true",1,"icon-picture"],["title",K,3,"click"],["aria-hidden","true",1,"icon-key"],["title",Z,3,"click"],["aria-hidden","true",1,"icon-edit"],["title",Q,3,"click"],["aria-hidden","true",1,"icon-remove"]]},template:function(n,o){1&n&&e.DNE(0,Io,20,0,"table",12),2&n&&e.vxM(0,o.users&&o.users.length>0?0:-1)},dependencies:[Oo.P,P.S,A.b],styles:["[_nghost-%COMP%]{width:100%;overflow:auto;display:block}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]{padding:15px;font-size:.9em;width:100%}[_nghost-%COMP%]   .user[_ngcontent-%COMP%]{height:60px;border-bottom:1px solid var(--control-border)}[_nghost-%COMP%]   .user[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px 10px}[_nghost-%COMP%]   .user[_ngcontent-%COMP%]:hover{background-color:var(--background-hover)}[_nghost-%COMP%]   .user.selected[_ngcontent-%COMP%]{background-color:var(--background-active)}[_nghost-%COMP%]   .heading[_ngcontent-%COMP%]{font-size:.9em;height:40px}[_nghost-%COMP%]   .icon-checkmark[_ngcontent-%COMP%]{color:var(--primary)}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{width:100px}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px;flex:50%;margin:0;display:inline-block;color:var(--on-control);border:1px solid transparent}[_nghost-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--on-control-active);border:1px solid var(--control-active)}"]})}return i})();const je=[{path:"",component:Oe,children:[{path:"",pathMatch:"full",component:Ye,data:{name:"Admin"}},{path:"settings",component:co,data:{name:"Admin Settings"}},{path:"root",component:so,data:{name:"Roots",icon:"icon-root"}},{path:"user",component:(()=>{class i{app;dialogs;jam;notify;userService;dialogOverlay;users;unsubscribe=new q.B;constructor(t,n,o,r,g,C){this.app=t,this.dialogs=n,this.jam=o,this.notify=r,this.userService=g,this.dialogOverlay=C}getSortValue(t,n){switch(t){case"name":return n.name;case"email":return n.email;case"roleAdmin":return n.roles.admin?1:0;case"rolePodcast":return n.roles.podcast?1:0;case"roleUpload":return n.roles.upload?1:0;case"roleStream":return n.roles.stream?1:0;default:return}}ngOnInit(){this.userService.usersChange.pipe((0,G.Q)(this.unsubscribe)).subscribe(t=>{this.users=(t||[]).sort((n,o)=>n.name.localeCompare(o.name))},t=>{this.notify.error(t)}),this.userService.refreshUsers()}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}refresh(){this.userService.refreshUsers()}newUser(){var t=this;const n={edit:{password:"",name:"",email:"",roleAdmin:!1,rolePodcast:!1,roleStream:!0,roleUpload:!1}};var o;this.dialogOverlay.open({title:"New User",childComponent:Ke,data:n,onOkBtn:(o=(0,L.A)(function*(){try{yield t.userService.applyDialogUser(n),t.notify.success("User created")}catch(r){return t.notify.error(r),Promise.reject(r)}}),function(){return o.apply(this,arguments)}),onCancelBtn:function(){var o=(0,L.A)(function*(){return Promise.resolve()});return function(){return o.apply(this,arguments)}}()})}static \u0275fac=function(n){return new(n||i)(e.rXU(f.d3),e.rXU($.JQ),e.rXU(M.UA),e.rXU(f.FL),e.rXU(f.uV),e.rXU(F.iD))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-users"]],decls:9,vars:1,consts:()=>{let t,n,o;return t=$localize`:␟4d13a9cd5ed3dcee0eab22cb25198d43886942be␟4555457172864212828:Users`,n=$localize`:␟c8d1785038d461ec66b5799db21864182b35900a␟1102717806459547726:Refresh`,o=$localize`:␟cd26ab47241f58b1af5990ff41f7f5dd0b9d297c␟4125725649492874522:New User…`,[[1,"users"],["section",t],[1,"actions"],["title",n,1,"button-on-control",3,"click"],[1,"icon-reload"],["title",o,1,"button-on-control",3,"click"],[1,"icon-plus"],[1,"content"],[3,"users"]]},template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"app-view-header-slim",1)(2,"div",2)(3,"button",3),e.bIt("click",function(){return o.refresh()}),e.nrm(4,"i",4),e.k0s(),e.j41(5,"button",5),e.bIt("click",function(){return o.newUser()}),e.nrm(6,"i",6),e.k0s()()(),e.j41(7,"div",7),e.nrm(8,"app-admin-user-list",8),e.k0s()()),2&n&&(e.R7$(8),e.Y8G("users",o.users))},dependencies:[Ae.w,bo],styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]{height:100%;overflow-y:auto;overflow-x:hidden}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:0 5px 5px}[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1.25px;font-size:13.2px;margin-bottom:10px;color:var(--on-control-ambient)}@media (max-width: 522px){[_nghost-%COMP%]   .users[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding-left:10px;padding-right:10px}}"]})}return i})(),data:{name:"Users",icon:"icon-user"}},{path:"folder",redirectTo:"folder/"},{path:"folder/:id",component:p,data:{id:"folder",name:"Folders",icon:"icon-folder",link:"folder"},children:[{path:"overview",component:hn},{path:"health",component:Bt},{path:"sub-folders",component:Ne},{path:"tracks",component:$n},{path:"tracks-health",component:bn},{path:"tags",loadChildren:(i=(0,L.A)(function*(){return Promise.all([E.e(76),E.e(91)]).then(E.bind(E,6091)).then(d=>d.TagEditorModule)}),function(){return i.apply(this,arguments)})}]},{path:"radar",component:Yn,data:{name:"Health Radar",icon:"icon-health"}}]}],Do=D.iI.forChild(je);var i;function xo(i,d){if(1&i&&e.EFF(0),2&i){const t=e.XpG(2);e.SpI(" (",t.folderService.current.count,") ")}}function Lo(i,d){if(1&i&&(e.j41(0,"div",6)(1,"span",4),e.pXf(2,1),e.k0s(),e.EFF(3),e.k0s()),2&i){const t=e.XpG(2);e.R7$(3),e.SpI(" ",t.folderService.queue.length," ")}}function vo(i,d){if(1&i&&(e.j41(0,"div",2)(1,"div",3)(2,"span",4),e.pXf(3,0),e.k0s(),e.nrm(4,"i",5),e.EFF(5),e.DNE(6,xo,1,1),e.k0s(),e.DNE(7,Lo,4,1,"div",6),e.k0s()),2&i){const t=e.XpG();e.R7$(5),e.SpI(" ",t.folderService.current.title," "),e.R7$(),e.vxM(6,t.folderService.current.count>1?6:-1),e.R7$(),e.vxM(7,t.folderService.queue.length>0?7:-1)}}let yo=(()=>{class i{folderService;constructor(t){this.folderService=t}static \u0275fac=function(n){return new(n||i)(e.rXU(f.pp))};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-queue-requests"]],decls:1,vars:1,consts:()=>{let t,n;return t=$localize`:␟7fdc8522031bbeba05f9d0a020e0b18002243f03␟7531465938860815822:Current:`,n=$localize`:␟417f965faad1daa7b24b82f6a6940676e9caf278␟1235332800071827748:Other requests in queue:`,[t,n,[1,"queue-overlay"],[1,"current"],[1,"label"],[1,"icon-spin","icon-spinner"],[1,"other"]]},template:function(n,o){1&n&&e.DNE(0,vo,8,3,"div",2),2&n&&e.vxM(0,o.folderService.current?0:-1)},styles:["[_nghost-%COMP%]   .queue-overlay[_ngcontent-%COMP%]{position:fixed;right:16px;bottom:16px;padding:15px;background-color:var(--control);color:var(--on-control);border:1px solid var(--control-border);z-index:1000}[_nghost-%COMP%]   .queue-overlay[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{text-transform:uppercase;font-size:.8em;letter-spacing:1px;color:var(--on-control-ambient)}[_nghost-%COMP%]   .queue-overlay[_ngcontent-%COMP%]   .other[_ngcontent-%COMP%]{border-top:1px solid var(--background-border)}"]})}return i})();var ko=E(3539);let $o=(()=>{class i{sections=[];constructor(){const n=(je[0].children||[]).filter(o=>o.path&&o.path.length>0&&o.data?.name).map(o=>({link:`/admin/${o.data&&o.data.link?o.data.link:o.path}`,name:o.data?o.data.name:"",icon:o.data&&o.data.icon?o.data.icon:"icon-admin"}));this.sections=[{name:"Administration",entries:n}]}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-sidebar"]],decls:1,vars:1,consts:[[3,"sections"]],template:function(n,o){1&n&&e.nrm(0,"app-sidebar",0),2&n&&e.Y8G("sections",o.sections)},dependencies:[ko.k],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block}"]})}return i})();var Go=E(3899);const wo=(i,d)=>d.id,Uo=i=>["/admin",i];function Fo(i,d){if(1&i&&(e.j41(0,"div",0)(1,"div",1),e.nrm(2,"app-iconart-image",2),e.k0s(),e.j41(3,"div",3)(4,"div",4),e.EFF(5),e.k0s()()()),2&i){const t=d.$implicit;e.Y8G("routerLink",e.eq3(3,Uo,t.id)),e.R7$(2),e.Y8G("icon",t.icon),e.R7$(3),e.JRh(t.text)}}let Xo=(()=>{class i{sections=[];constructor(){this.sections=(je[0].children||[]).filter(n=>n.path&&n.path.length>0&&n.data?.name).map(n=>({id:n.data&&n.data.link?n.data.link:n.path,text:n.data?n.data.name:"",icon:n.data&&n.data.icon?n.data.icon:"icon-admin"}))}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-admin-section-cards"]],decls:2,vars:0,consts:[[1,"section-card","no-hover",3,"routerLink"],[1,"image"],[3,"icon"],[1,"footer"],[1,"footer-content"]],template:function(n,o){1&n&&e.Z7z(0,Fo,6,5,"div",0,wo),2&n&&e.Dyx(o.sections)},dependencies:[Go.l,D.Wk],styles:['[_nghost-%COMP%]{display:flex;flex-flow:row wrap}@media (max-width: 768px){[_nghost-%COMP%]{justify-content:space-around}}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{margin:15px;width:calc(25% - 30px);position:relative;overflow:hidden;display:flex;cursor:pointer;tab-index:0}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:before{content:"";display:block;margin-top:100%}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .more[_ngcontent-%COMP%]{position:absolute;top:1px;padding:5px;transform:translateY(-31px);transition:transform .3s;-webkit-user-select:none;user-select:none;border-bottom-left-radius:3px}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .play[_ngcontent-%COMP%]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);visibility:hidden;opacity:0;transition-property:opacity,visibility;transition-duration:.3s}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{left:50%;transform:translate(-50%,-31px);font-size:.8em}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]{left:1px;cursor:pointer}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .more[_ngcontent-%COMP%]{right:3px;cursor:pointer}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{padding:10px;position:absolute;bottom:1px;left:1px;right:1px;overflow:hidden;height:auto;transition:all .3s}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]   .footer-buttons[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:hover   .fav[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:hover   .more[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:focus-within   .fav[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:focus-within   .more[_ngcontent-%COMP%]{transform:translateY(0)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:hover   .date[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:focus-within   .date[_ngcontent-%COMP%]{transform:translate(-50%)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:hover   .play[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]:focus-within   .play[_ngcontent-%COMP%]{visibility:unset;opacity:1}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .more[_ngcontent-%COMP%]{background-color:var(--background-transparent);color:var(--on-background-highlight)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .more[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-highlight)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .more[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .fav[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer-subline[_ngcontent-%COMP%]{display:block;font-size:.8em}@media (max-width: 1600px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{width:calc(25% - 30px)}}@media (max-width: 1200px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{width:calc(33.3333333333% - 30px)}}@media (max-width: 522px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{width:calc(50% - 30px)}}@media (max-width: 400px){[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]{margin:10px}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{font-size:.8em}}[_nghost-%COMP%]   .section-card[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{min-height:135px;min-width:135px;display:flex;align-items:center;justify-content:center}']})}return i})(),jo=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=e.$C({type:i});static \u0275inj=e.G2t({imports:[c.MD,ce.G,u.YN,ae.fM,de.xv,te.rc,H.E9,fe.rL,Do]})}return i})();e.wjB(Oe,function(){return[Ce.H,D.n3,yo,$o]},[]),e.wjB(Ye,function(){return[Ae.w,Xo]},[])},2702:($e,le,E)=>{function c(f,M){if(void 0===f&&void 0===M)throw new Error("Trying to compare two undefined values");if(void 0===f||void 0===M)return 0;const N=String(f),P=String(M),A=function H(f,M){const N=[];let A,P=0;for(let v=0;v<=M.length;v++)for(let w=0;w<=f.length;w++)A=v&&w?f.charAt(w-1)===M.charAt(v-1)?P:Math.min(N[w],N[w-1],P)+1:v+w,P=N[w],N[w]=A;return N.pop()||0}(N,P);return N.length>P.length?1-A/N.length:1-A/P.length}function ae(f,M){const N={};return function u(f,M){const P=M||2,A=`-${f.toLowerCase().replace(/[^\w, ]+/,"")}-`,v=[];for(let w=0;w<A.length-P+1;w+=1)v.push(A.slice(w,w+P));return v}(f,M||2).forEach(A=>{A in N?N[A]+=1:N[A]=1}),N}function te(f){if("string"!=typeof f)throw new Error("Must use a string as argument to FuzzySet functions");return f.toLowerCase()}E.d(le,{lg:()=>Oe,Ne:()=>G,It:()=>J,QQ:()=>L,X$:()=>D,GV:()=>de,ur:()=>e});class ce{version="0.0.1";arr;useLevenshtein;gramSizeLower;gramSizeUpper;exactSet={};matchDict={};items={};constructor(M,N,P,A){this.arr=M||[],this.useLevenshtein=N||!0,this.gramSizeLower=P||2,this.gramSizeUpper=A||3;for(let v=this.gramSizeLower;v<this.gramSizeUpper+1;v+=1)this.items[v]=[];this.arr.forEach(v=>{this.add(v)})}get(M,N){const P=this.getVal(M);return!P&&N?N:P}add(M){if(!(te(M)in this.exactSet))for(let P=this.gramSizeLower;P<this.gramSizeUpper+1;P+=1)this.addVal(M,P)}length(){let M=0;for(const N in this.exactSet)Object.prototype.hasOwnProperty.call(this.exactSet,N)&&(M+=1);return M}isEmpty(){for(const M in this.exactSet)if(Object.prototype.hasOwnProperty.call(this.exactSet,M))return!1;return!0}values(){const M=[];for(const N in this.exactSet)Object.prototype.hasOwnProperty.call(this.exactSet,N)&&M.push(this.exactSet[N]);return M}getVal(M){const N=te(M),P=this.exactSet[N];if(P)return[[1,P]];for(let A=this.gramSizeUpper;A>=this.gramSizeLower;A-=1){const v=this.getValGram(M,A);if(v)return v}}getValGram(M,N){const P=te(M),A={},v=ae(P,N),w=this.items[N];let _e,se=0;for(const X in v)if(Object.prototype.hasOwnProperty.call(v,X)){const O=v[X];if(se+=Math.pow(O,2),X in this.matchDict)for(const m of this.matchDict[X]){const a=m[0];_e=m[1],a in A?A[a]+=O*_e:A[a]=O*_e}}if(function fe(f){for(const M in f)if(Object.prototype.hasOwnProperty.call(f,M))return!1;return!0}(A))return;const oe=Math.sqrt(se);let Ce,W=[];Object.keys(A).forEach(X=>{Ce=A[X];const O=parseInt(X,10);W.push([Ce/(oe*w[O][0]),w[O][1]])});const me=(X,O)=>X[0]<O[0]?1:X[0]>O[0]?-1:0;if(W.sort(me),this.useLevenshtein){const X=[],O=Math.min(50,W.length);for(let m=0;m<O;m+=1)X.push([c(W[m][1],P),W[m][1]]);W=X,W.sort(me)}const Ee=[];for(const X of W)X[0]===W[0][0]&&Ee.push([X[0],this.exactSet[X[1]]]);return Ee}addVal(M,N){const P=te(M),A=this.items[N]||[],v=A.length;A.push(0);const w=ae(P,N);let se=0;for(const oe in w)if(Object.prototype.hasOwnProperty.call(w,oe)){const W=w[oe];se+=Math.pow(W,2),oe in this.matchDict?this.matchDict[oe].push([v,W]):this.matchDict[oe]=[[v,W]]}const _e=Math.sqrt(se);A[v]=[_e,P],this.items[N]=A,this.exactSet[P]=M}}function de(f){return f.split(/[.,\\/ -]/).map(M=>M.trim()).filter(M=>M.length>0)}function e(f){return f.replace(/\.[^/.]+$/,"")}function Oe(f){return f.substring(f.lastIndexOf(".")+1,f.length)||f}function L(f,M){return M.includes(Oe(f))}function D(f,M){return f.toString().replace(/:/g," - ").replace(/[?/!\\]/g,M)}function G(f){if(!f)return 0;const N=e(f).split(/[ \-_.:;?!~,`"&|()<>{}[\]\r\n/\\]+/).map(Number).filter(P=>!isNaN(P));return N.length>0?N[0]:0}function J(f,M){const N=new ce;N.add(f);const P=N.get(M);return P?P[0][0]:0}},1893:($e,le,E)=>{function H(c){let u="";const ae=new Uint8Array(c),fe=ae.byteLength;for(let te=0;te<fe;te++)u+=String.fromCharCode(ae[te]);return window.btoa(u)}E.d(le,{J:()=>H})},6156:($e,le,E)=>{E.d(le,{Z:()=>X,_D:()=>me,xv:()=>Ee});var H=E(467),c=E(4438),u=E(345),ae=E(6977),fe=E(1594),te=E(7786),ce=E(3726),de=E(177);const e=["wrapper"],Oe=["sourceImage"];function L(O,m){if(1&O){const a=c.RV6();c.j41(0,"img",5,1),c.bIt("load",function(){c.eBV(a);const _=c.XpG();return c.Njj(_.imageLoadedInView())})("mousedown",function(_){c.eBV(a);const l=c.XpG();return c.Njj(l.startMove(_,l.moveTypes.Drag))})("touchstart",function(_){c.eBV(a);const l=c.XpG();return c.Njj(l.startMove(_,l.moveTypes.Drag))})("error",function(_){c.eBV(a);const l=c.XpG();return c.Njj(l.loadImageError(_))}),c.k0s()}if(2&O){const a=c.XpG();c.xc7("visibility",a.imageVisible?"visible":"hidden")("transform",a.safeTransformStyle),c.AVh("ngx-ic-draggable",!a.disabled&&a.allowMoveImage),c.Y8G("src",a.safeImgDataUrl,c.B4B),c.BMQ("alt",a.imageAltText)}}function D(O,m){if(1&O){const a=c.RV6();c.qex(0),c.j41(1,"span",9),c.bIt("mousedown",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"topleft"))})("touchstart",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"topleft"))}),c.nrm(2,"span",10),c.k0s(),c.j41(3,"span",11),c.nrm(4,"span",10),c.k0s(),c.j41(5,"span",12),c.bIt("mousedown",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"topright"))})("touchstart",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"topright"))}),c.nrm(6,"span",10),c.k0s(),c.j41(7,"span",13),c.nrm(8,"span",10),c.k0s(),c.j41(9,"span",14),c.bIt("mousedown",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"bottomright"))})("touchstart",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"bottomright"))}),c.nrm(10,"span",10),c.k0s(),c.j41(11,"span",15),c.nrm(12,"span",10),c.k0s(),c.j41(13,"span",16),c.bIt("mousedown",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"bottomleft"))})("touchstart",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"bottomleft"))}),c.nrm(14,"span",10),c.k0s(),c.j41(15,"span",17),c.nrm(16,"span",10),c.k0s(),c.j41(17,"span",18),c.bIt("mousedown",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"top"))})("touchstart",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"top"))}),c.k0s(),c.j41(18,"span",19),c.bIt("mousedown",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"right"))})("touchstart",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"right"))}),c.k0s(),c.j41(19,"span",20),c.bIt("mousedown",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"bottom"))})("touchstart",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"bottom"))}),c.k0s(),c.j41(20,"span",21),c.bIt("mousedown",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"left"))})("touchstart",function(_){c.eBV(a);const l=c.XpG(2);return c.Njj(l.startMove(_,l.moveTypes.Resize,"left"))}),c.k0s(),c.bVm()}}function q(O,m){if(1&O){const a=c.RV6();c.j41(0,"div",6),c.bIt("keydown",function(_){c.eBV(a);const l=c.XpG();return c.Njj(l.keyboardAccess(_))}),c.j41(1,"div",7),c.bIt("mousedown",function(_){c.eBV(a);const l=c.XpG();return c.Njj(l.startMove(_,l.moveTypes.Move))})("touchstart",function(_){c.eBV(a);const l=c.XpG();return c.Njj(l.startMove(_,l.moveTypes.Move))}),c.k0s(),c.DNE(2,D,21,0,"ng-container",8),c.k0s()}if(2&O){const a=c.XpG();c.xc7("top",a.cropper.y1,"px")("left",a.cropper.x1,"px")("width",a.cropper.x2-a.cropper.x1,"px")("height",a.cropper.y2-a.cropper.y1,"px")("margin-left","center"===a.alignImage?a.marginLeft:null)("visibility",a.imageVisible?"visible":"hidden"),c.AVh("ngx-ic-round",a.roundCropper),c.BMQ("aria-label",a.cropperFrameAriaLabel),c.R7$(2),c.Y8G("ngIf",!a.hideResizeSquares)}}class G{constructor(){this.format="png",this.output="blob",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperFrameAriaLabel="Crop photo",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(m){Object.keys(m).filter(a=>a in this).forEach(a=>this[a]=m[a]),this.validateOptions()}setOptionsFromChanges(m){Object.keys(m).filter(a=>a in this).forEach(a=>this[a]=m[a].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}var J=function(O){return O.Drag="drag",O.Move="move",O.Resize="resize",O.Pinch="pinch",O}(J||{});function A(O,m){return O/100*m}let v=(()=>{class O{crop(a,s,_,l,p){const h=this.getImagePosition(a,s,_,p),S=h.x2-h.x1,R=h.y2-h.y1,I=document.createElement("canvas");I.width=S,I.height=R;const k=I.getContext("2d");if(!k)return null;null!=_.backgroundColor&&(k.fillStyle=_.backgroundColor,k.fillRect(0,0,S,R));const $=(_.transform.scale||1)*(_.transform.flipH?-1:1),F=(_.transform.scale||1)*(_.transform.flipV?-1:1),{translateH:j,translateV:Y}=this.getCanvasTranslate(a,_,p),ie=a.transformed;k.setTransform($,0,0,F,ie.size.width/2+j,ie.size.height/2+Y),k.translate(-h.x1/$,-h.y1/F),k.rotate((_.transform.rotate||0)*Math.PI/180),k.drawImage(ie.image,-ie.size.width/2,-ie.size.height/2);const ne={width:S,height:R,imagePosition:h,cropperPosition:{...s}};_.containWithinAspectRatio&&(ne.offsetImagePosition=this.getOffsetImagePosition(a,s,_,p));const ee=this.getResizeRatio(S,R,_);return 1!==ee&&(ne.width=Math.round(S*ee),ne.height=_.maintainAspectRatio?Math.round(ne.width/_.aspectRatio):Math.round(R*ee),function P(O,m,a){const s=O.width,_=O.height,l=s/(m=Math.round(m)),p=_/(a=Math.round(a)),h=Math.ceil(l/2),S=Math.ceil(p/2),R=O.getContext("2d");if(R){const I=R.getImageData(0,0,s,_),k=R.createImageData(m,a),$=I.data,F=k.data;for(let j=0;j<a;j++)for(let Y=0;Y<m;Y++){const ie=4*(Y+j*m),ne=j*p;let ee=0,Se=0,be=0,De=0,xe=0,Le=0,ve=0;const Ge=Math.floor(Y*l),we=Math.floor(j*p);let Ne=Math.ceil((Y+1)*l),Pe=Math.ceil((j+1)*p);Ne=Math.min(Ne,s),Pe=Math.min(Pe,_);for(let re=we;re<Pe;re++){const ye=Math.abs(ne-re)/S,Ue=Y*l,Fe=ye*ye;for(let Te=Ge;Te<Ne;Te++){const ke=Math.abs(Ue-Te)/h,ge=Math.sqrt(Fe+ke*ke);if(ge>=1)continue;ee=2*ge*ge*ge-3*ge*ge+1;const pe=4*(Te+re*s);ve+=ee*$[pe+3],be+=ee,$[pe+3]<255&&(ee=ee*$[pe+3]/250),De+=ee*$[pe],xe+=ee*$[pe+1],Le+=ee*$[pe+2],Se+=ee}}F[ie]=De/Se,F[ie+1]=xe/Se,F[ie+2]=Le/Se,F[ie+3]=ve/be}O.width=m,O.height=a,R.putImageData(k,0,0)}}(I,ne.width,ne.height)),"blob"===l?this.cropToBlob(ne,I,_):(ne.base64=I.toDataURL("image/"+_.format,this.getQuality(_)),ne)}cropToBlob(a,s,_){var l=this;return(0,H.A)(function*(){return a.blob=yield new Promise(p=>s.toBlob(p,"image/"+_.format,l.getQuality(_))),a.blob&&(a.objectUrl=URL.createObjectURL(a.blob)),a})()}getCanvasTranslate(a,s,_){if("px"===s.transform.translateUnit){const l=this.getRatio(a,_);return{translateH:(s.transform.translateH||0)*l,translateV:(s.transform.translateV||0)*l}}return{translateH:s.transform.translateH?A(s.transform.translateH,a.transformed.size.width):0,translateV:s.transform.translateV?A(s.transform.translateV,a.transformed.size.height):0}}getRatio(a,s){return a.transformed.size.width/s.width}getImagePosition(a,s,_,l){const p=this.getRatio(a,l),h={x1:Math.round(s.x1*p),y1:Math.round(s.y1*p),x2:Math.round(s.x2*p),y2:Math.round(s.y2*p)};return _.containWithinAspectRatio||(h.x1=Math.max(h.x1,0),h.y1=Math.max(h.y1,0),h.x2=Math.min(h.x2,a.transformed.size.width),h.y2=Math.min(h.y2,a.transformed.size.height)),h}getOffsetImagePosition(a,s,_,l){const p=_.canvasRotation+a.exifTransform.rotate,h=this.getRatio(a,l);let S,R;p%2?(S=(a.transformed.size.width-a.original.size.height)/2,R=(a.transformed.size.height-a.original.size.width)/2):(S=(a.transformed.size.width-a.original.size.width)/2,R=(a.transformed.size.height-a.original.size.height)/2);const I={x1:Math.round(s.x1*h)-S,y1:Math.round(s.y1*h)-R,x2:Math.round(s.x2*h)-S,y2:Math.round(s.y2*h)-R};return _.containWithinAspectRatio||(I.x1=Math.max(I.x1,0),I.y1=Math.max(I.y1,0),I.x2=Math.min(I.x2,a.transformed.size.width),I.y2=Math.min(I.y2,a.transformed.size.height)),I}getResizeRatio(a,s,_){const l=_.resizeToWidth/a,p=_.resizeToHeight/s,h=new Array;_.resizeToWidth>0&&h.push(l),_.resizeToHeight>0&&h.push(p);const S=0===h.length?1:Math.min(...h);return S>1&&!_.onlyScaleDown?S:Math.min(S,1)}getQuality(a){return Math.min(1,Math.max(0,a.imageQuality/100))}}return O.\u0275fac=function(a){return new(a||O)},O.\u0275prov=c.jDH({token:O,factory:O.\u0275fac,providedIn:"root"}),O})(),w=(()=>{class O{resetCropperPosition(a,s,_,l){if(a?.nativeElement)if(_.cropperStaticHeight&&_.cropperStaticWidth)s.x1=0,s.x2=l.width>_.cropperStaticWidth?_.cropperStaticWidth:l.width,s.y1=0,s.y2=l.height>_.cropperStaticHeight?_.cropperStaticHeight:l.height;else{const p=Math.min(_.cropperScaledMaxWidth,l.width),h=Math.min(_.cropperScaledMaxHeight,l.height);if(_.maintainAspectRatio)if(l.width/_.aspectRatio<l.height){s.x1=0,s.x2=p;const S=p/_.aspectRatio;s.y1=(l.height-S)/2,s.y2=s.y1+S}else{s.y1=0,s.y2=h;const S=h*_.aspectRatio;s.x1=(l.width-S)/2,s.x2=s.x1+S}else s.x1=0,s.x2=p,s.y1=0,s.y2=h}}move(a,s,_){const l=this.getClientX(a)-s.clientX,p=this.getClientY(a)-s.clientY;_.x1=s.x1+l,_.y1=s.y1+p,_.x2=s.x2+l,_.y2=s.y2+p}resize(a,s,_,l,p){const h=this.getClientX(a)-s.clientX,S=this.getClientY(a)-s.clientY;switch(s.position){case"left":_.x1=Math.min(Math.max(s.x1+h,_.x2-p.cropperScaledMaxWidth),_.x2-p.cropperScaledMinWidth);break;case"topleft":_.x1=Math.min(Math.max(s.x1+h,_.x2-p.cropperScaledMaxWidth),_.x2-p.cropperScaledMinWidth),_.y1=Math.min(Math.max(s.y1+S,_.y2-p.cropperScaledMaxHeight),_.y2-p.cropperScaledMinHeight);break;case"top":_.y1=Math.min(Math.max(s.y1+S,_.y2-p.cropperScaledMaxHeight),_.y2-p.cropperScaledMinHeight);break;case"topright":_.x2=Math.max(Math.min(s.x2+h,_.x1+p.cropperScaledMaxWidth),_.x1+p.cropperScaledMinWidth),_.y1=Math.min(Math.max(s.y1+S,_.y2-p.cropperScaledMaxHeight),_.y2-p.cropperScaledMinHeight);break;case"right":_.x2=Math.max(Math.min(s.x2+h,_.x1+p.cropperScaledMaxWidth),_.x1+p.cropperScaledMinWidth);break;case"bottomright":_.x2=Math.max(Math.min(s.x2+h,_.x1+p.cropperScaledMaxWidth),_.x1+p.cropperScaledMinWidth),_.y2=Math.max(Math.min(s.y2+S,_.y1+p.cropperScaledMaxHeight),_.y1+p.cropperScaledMinHeight);break;case"bottom":_.y2=Math.max(Math.min(s.y2+S,_.y1+p.cropperScaledMaxHeight),_.y1+p.cropperScaledMinHeight);break;case"bottomleft":_.x1=Math.min(Math.max(s.x1+h,_.x2-p.cropperScaledMaxWidth),_.x2-p.cropperScaledMinWidth),_.y2=Math.max(Math.min(s.y2+S,_.y1+p.cropperScaledMaxHeight),_.y1+p.cropperScaledMinHeight);break;case"center":const R=a.scale,I=Math.min(Math.max(p.cropperScaledMinWidth,Math.abs(s.x2-s.x1)*R),p.cropperScaledMaxWidth),k=Math.min(Math.max(p.cropperScaledMinHeight,Math.abs(s.y2-s.y1)*R),p.cropperScaledMaxHeight);_.x1=s.clientX-I/2,_.x2=s.clientX+I/2,_.y1=s.clientY-k/2,_.y2=s.clientY+k/2,_.x1<0?(_.x2-=_.x1,_.x1=0):_.x2>l.width&&(_.x1-=_.x2-l.width,_.x2=l.width),_.y1<0?(_.y2-=_.y1,_.y1=0):_.y2>l.height&&(_.y1-=_.y2-l.height,_.y2=l.height)}p.maintainAspectRatio&&this.checkAspectRatio(s.position,_,l,p)}checkAspectRatio(a,s,_,l){let p=0,h=0;switch(a){case"top":s.x2=s.x1+(s.y2-s.y1)*l.aspectRatio,p=Math.max(s.x2-_.width,0),h=Math.max(0-s.y1,0),(p>0||h>0)&&(s.x2-=h*l.aspectRatio>p?h*l.aspectRatio:p,s.y1+=h*l.aspectRatio>p?h:p/l.aspectRatio);break;case"bottom":s.x2=s.x1+(s.y2-s.y1)*l.aspectRatio,p=Math.max(s.x2-_.width,0),h=Math.max(s.y2-_.height,0),(p>0||h>0)&&(s.x2-=h*l.aspectRatio>p?h*l.aspectRatio:p,s.y2-=h*l.aspectRatio>p?h:p/l.aspectRatio);break;case"topleft":s.y1=s.y2-(s.x2-s.x1)/l.aspectRatio,p=Math.max(0-s.x1,0),h=Math.max(0-s.y1,0),(p>0||h>0)&&(s.x1+=h*l.aspectRatio>p?h*l.aspectRatio:p,s.y1+=h*l.aspectRatio>p?h:p/l.aspectRatio);break;case"topright":s.y1=s.y2-(s.x2-s.x1)/l.aspectRatio,p=Math.max(s.x2-_.width,0),h=Math.max(0-s.y1,0),(p>0||h>0)&&(s.x2-=h*l.aspectRatio>p?h*l.aspectRatio:p,s.y1+=h*l.aspectRatio>p?h:p/l.aspectRatio);break;case"right":case"bottomright":s.y2=s.y1+(s.x2-s.x1)/l.aspectRatio,p=Math.max(s.x2-_.width,0),h=Math.max(s.y2-_.height,0),(p>0||h>0)&&(s.x2-=h*l.aspectRatio>p?h*l.aspectRatio:p,s.y2-=h*l.aspectRatio>p?h:p/l.aspectRatio);break;case"left":case"bottomleft":s.y2=s.y1+(s.x2-s.x1)/l.aspectRatio,p=Math.max(0-s.x1,0),h=Math.max(s.y2-_.height,0),(p>0||h>0)&&(s.x1+=h*l.aspectRatio>p?h*l.aspectRatio:p,s.y2-=h*l.aspectRatio>p?h:p/l.aspectRatio);break;case"center":s.x2=s.x1+(s.y2-s.y1)*l.aspectRatio,s.y2=s.y1+(s.x2-s.x1)/l.aspectRatio;const S=Math.max(0-s.x1,0),R=Math.max(s.x2-_.width,0),I=Math.max(s.y2-_.height,0),k=Math.max(0-s.y1,0);(S>0||R>0||I>0||k>0)&&(s.x1+=I*l.aspectRatio>S?I*l.aspectRatio:S,s.x2-=k*l.aspectRatio>R?k*l.aspectRatio:R,s.y1+=k*l.aspectRatio>R?k:R/l.aspectRatio,s.y2-=I*l.aspectRatio>S?I:S/l.aspectRatio)}}getClientX(a){return a.touches?.[0].clientX||a.clientX||0}getClientY(a){return a.touches?.[0].clientY||a.clientY||0}}return O.\u0275fac=function(a){return new(a||O)},O.\u0275prov=c.jDH({token:O,factory:O.\u0275fac,providedIn:"root"}),O})();let Ce=(()=>{class O{constructor(){this.autoRotateSupported=function _e(){return new Promise(O=>{const m=new Image;m.onload=()=>{O(1===m.width&&2===m.height)},m.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(a,s){var _=this;return(0,H.A)(function*(){const l=yield a.arrayBuffer();return yield _.checkImageTypeAndLoadImageFromArrayBuffer(l,a.type,s)})()}checkImageTypeAndLoadImageFromArrayBuffer(a,s,_){return this.isValidImageType(s)?this.loadImageFromArrayBuffer(a,_,s):Promise.reject(new Error("Invalid image type"))}isValidImageType(a){return/image\/(png|jpg|jpeg|bmp|gif|tiff|svg|webp|x-icon|vnd.microsoft.icon)/.test(a)}loadImageFromURL(a,s){var _=this;return(0,H.A)(function*(){const p=yield(yield fetch(a)).blob(),h=yield p.arrayBuffer();return yield _.loadImageFromArrayBuffer(h,s,p.type)})()}loadBase64Image(a,s){const _=this.base64ToArrayBuffer(a);return this.loadImageFromArrayBuffer(_,s)}base64ToArrayBuffer(a){a=a.replace(/^data:([^;]+);base64,/gim,"");const s=atob(a),_=s.length,l=new Uint8Array(_);for(let p=0;p<_;p++)l[p]=s.charCodeAt(p);return l.buffer}loadImageFromArrayBuffer(a,s,_){var l=this;return(0,H.A)(function*(){const p=yield new Promise(function(){var h=(0,H.A)(function*(S,R){try{const I=new Blob([a],_?{type:_}:void 0),k=URL.createObjectURL(I),$=new Image,j="image/svg+xml"===_?yield l.getSvgImageSize(I):void 0;$.onload=()=>S({originalImage:$,originalImageSize:j,originalObjectUrl:k,originalArrayBuffer:a}),$.onerror=R,$.src=k}catch(I){R(I)}});return function(S,R){return h.apply(this,arguments)}}());return yield l.transformImageFromArrayBuffer(p,s,null!=p.originalImageSize)})()}getSvgImageSize(a){return(0,H.A)(function*(){const l=(new DOMParser).parseFromString(yield a.text(),"image/svg+xml").querySelector("svg");if(!l)throw Error("Failed to parse SVG image");const p=l.getAttribute("width"),h=l.getAttribute("height");if(p&&h)return null;const S=l.getAttribute("viewBox")||l.getAttribute("viewbox");if(S){const R=S.split(" ");return{width:+R[2],height:+R[3]}}throw Error("Failed to load SVG image. SVG must have width + height or viewBox definition.")})()}transformImageFromArrayBuffer(a,s,_=!1){var l=this;return(0,H.A)(function*(){const h=function oe(O){switch("object"==typeof O&&(O=function W(O){const m=new DataView(O);if(65496!==m.getUint16(0,!1))return-2;const a=m.byteLength;let s=2;for(;s<a;){if(m.getUint16(s+2,!1)<=8)return-1;const _=m.getUint16(s,!1);if(s+=2,65505==_){if(1165519206!==m.getUint32(s+=2,!1))return-1;const l=18761==m.getUint16(s+=6,!1);s+=m.getUint32(s+4,l);const p=m.getUint16(s,l);s+=2;for(let h=0;h<p;h++)if(274==m.getUint16(s+12*h,l))return m.getUint16(s+12*h+8,l)}else{if(65280&~_)break;s+=m.getUint16(s,!1)}}return-1}(O)),O){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}((yield l.autoRotateSupported)?-1:a.originalArrayBuffer);return a.originalImage&&a.originalImage.complete?l.transformLoadedImage({original:{objectUrl:a.originalObjectUrl,image:a.originalImage,size:a.originalImageSize??{width:a.originalImage.naturalWidth,height:a.originalImage.naturalHeight}},exifTransform:h},s,_):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(a,s,_=!1){var l=this;return(0,H.A)(function*(){const p=s.canvasRotation+a.exifTransform.rotate,h=a.original.size;if(!_&&0===p&&!a.exifTransform.flip&&!s.containWithinAspectRatio)return{original:{objectUrl:a.original.objectUrl,image:a.original.image,size:{...h}},transformed:{objectUrl:a.original.objectUrl,image:a.original.image,size:{...h}},exifTransform:a.exifTransform};const S=l.getTransformedSize(h,a.exifTransform,s),R=document.createElement("canvas");R.width=S.width,R.height=S.height;const I=R.getContext("2d");I?.setTransform(a.exifTransform.flip?-1:1,0,0,1,R.width/2,R.height/2),I?.rotate(Math.PI*(p/2)),I?.drawImage(a.original.image,-h.width/2,-h.height/2);const k=yield new Promise(j=>R.toBlob(j,s.format));if(!k)throw new Error("Failed to get Blob for transformed image.");const $=URL.createObjectURL(k),F=yield l.loadImageFromObjectUrl($);return{original:{objectUrl:a.original.objectUrl,image:a.original.image,size:{...h}},transformed:{objectUrl:$,image:F,size:{width:F.width,height:F.height}},exifTransform:a.exifTransform}})()}loadImageFromObjectUrl(a){return new Promise((s,_)=>{const l=new Image;l.onload=()=>s(l),l.onerror=_,l.src=a})}getTransformedSize(a,s,_){const l=_.canvasRotation+s.rotate;if(_.containWithinAspectRatio){if(l%2){const h=a.height/_.aspectRatio;return{width:Math.max(a.height,a.width*_.aspectRatio),height:Math.max(a.width,h)}}{const h=a.width/_.aspectRatio;return{width:Math.max(a.width,a.height*_.aspectRatio),height:Math.max(a.height,h)}}}return l%2?{height:a.width,width:a.height}:{width:a.width,height:a.height}}}return O.\u0275fac=function(a){return new(a||O)},O.\u0275prov=c.jDH({token:O,factory:O.\u0275fac,providedIn:"root"}),O})(),me=(()=>{class O{constructor(a,s,_,l,p,h,S){this.cropService=a,this.cropperPositionService=s,this.loadImageService=_,this.sanitizer=l,this.cd=p,this.zone=h,this.hammerLoader=S,this.settings=new G,this.setImageMaxSizeRetries=0,this.resizedWhileHidden=!1,this.marginLeft="0px",this.maxSize={width:0,height:0},this.moveTypes=J,this.imageVisible=!1,this.cropperFrameAriaLabel=this.settings.cropperFrameAriaLabel,this.output=this.settings.output,this.format=this.settings.format,this.transform={},this.maintainAspectRatio=this.settings.maintainAspectRatio,this.aspectRatio=this.settings.aspectRatio,this.resetCropOnAspectRatioChange=this.settings.resetCropOnAspectRatioChange,this.resizeToWidth=this.settings.resizeToWidth,this.resizeToHeight=this.settings.resizeToHeight,this.cropperMinWidth=this.settings.cropperMinWidth,this.cropperMinHeight=this.settings.cropperMinHeight,this.cropperMaxHeight=this.settings.cropperMaxHeight,this.cropperMaxWidth=this.settings.cropperMaxWidth,this.cropperStaticWidth=this.settings.cropperStaticWidth,this.cropperStaticHeight=this.settings.cropperStaticHeight,this.canvasRotation=this.settings.canvasRotation,this.initialStepSize=this.settings.initialStepSize,this.roundCropper=this.settings.roundCropper,this.onlyScaleDown=this.settings.onlyScaleDown,this.imageQuality=this.settings.imageQuality,this.autoCrop=this.settings.autoCrop,this.backgroundColor=this.settings.backgroundColor,this.containWithinAspectRatio=this.settings.containWithinAspectRatio,this.hideResizeSquares=this.settings.hideResizeSquares,this.allowMoveImage=!1,this.cropper={x1:-100,y1:-100,x2:1e4,y2:1e4},this.alignImage=this.settings.alignImage,this.disabled=!1,this.hidden=!1,this.imageCropped=new c.bkB,this.startCropImage=new c.bkB,this.imageLoaded=new c.bkB,this.cropperReady=new c.bkB,this.loadImageFailed=new c.bkB,this.transformChange=new c.bkB,this.reset()}ngOnChanges(a){this.onChangesUpdateSettings(a),this.onChangesInputImage(a),this.loadedImage?.original.image.complete&&(a.containWithinAspectRatio||a.canvasRotation)&&this.loadImageService.transformLoadedImage(this.loadedImage,this.settings).then(s=>this.setLoadedImage(s)).catch(s=>this.loadImageError(s)),(a.cropper||a.maintainAspectRatio||a.aspectRatio)&&(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),!this.maintainAspectRatio||!this.resetCropOnAspectRatioChange&&this.aspectRatioIsCorrect()||!a.maintainAspectRatio&&!a.aspectRatio?a.cropper&&(this.checkCropperPosition(!1),this.doAutoCrop()):this.resetCropperPosition()),a.transform&&(this.transform=this.transform||{},this.setCssTransform(),this.doAutoCrop()),a.hidden&&this.resizedWhileHidden&&!this.hidden&&setTimeout(()=>{this.onResize(),this.resizedWhileHidden=!1})}onChangesUpdateSettings(a){this.settings.setOptionsFromChanges(a),this.settings.cropperStaticHeight&&this.settings.cropperStaticWidth&&(this.hideResizeSquares=!0,this.settings.setOptions({hideResizeSquares:!0,cropperMinWidth:this.settings.cropperStaticWidth,cropperMinHeight:this.settings.cropperStaticHeight,cropperMaxHeight:this.settings.cropperStaticHeight,cropperMaxWidth:this.settings.cropperStaticWidth,maintainAspectRatio:!1}))}onChangesInputImage(a){(a.imageChangedEvent||a.imageURL||a.imageBase64||a.imageFile)&&this.reset(),a.imageChangedEvent&&this.isValidImageChangedEvent()&&this.loadImageFile(this.imageChangedEvent.target.files[0]),a.imageURL&&this.imageURL&&this.loadImageFromURL(this.imageURL),a.imageBase64&&this.imageBase64&&this.loadBase64Image(this.imageBase64),a.imageFile&&this.imageFile&&this.loadImageFile(this.imageFile)}isValidImageChangedEvent(){return this.imageChangedEvent?.target?.files?.length>0}setCssTransform(){const a=this.transform?.translateUnit||"%";this.safeTransformStyle=this.sanitizer.bypassSecurityTrustStyle(`translate(${this.transform.translateH||0}${a}, ${this.transform.translateV||0}${a}) scaleX(`+(this.transform.scale||1)*(this.transform.flipH?-1:1)+") scaleY("+(this.transform.scale||1)*(this.transform.flipV?-1:1)+") rotate("+(this.transform.rotate||0)+"deg)")}ngOnInit(){this.settings.stepSize=this.initialStepSize,this.activatePinchGesture()}reset(){this.imageVisible=!1,this.loadedImage=void 0,this.safeImgDataUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",this.moveStart={active:!1,type:null,position:null,x1:0,y1:0,x2:0,y2:0,clientX:0,clientY:0},this.maxSize={width:0,height:0},this.cropper.x1=-100,this.cropper.y1=-100,this.cropper.x2=1e4,this.cropper.y2=1e4}loadImageFile(a){this.loadImageService.loadImageFile(a,this.settings).then(s=>this.setLoadedImage(s)).catch(s=>this.loadImageError(s))}loadBase64Image(a){this.loadImageService.loadBase64Image(a,this.settings).then(s=>this.setLoadedImage(s)).catch(s=>this.loadImageError(s))}loadImageFromURL(a){this.loadImageService.loadImageFromURL(a,this.settings).then(s=>this.setLoadedImage(s)).catch(s=>this.loadImageError(s))}setLoadedImage(a){this.loadedImage=a,this.safeImgDataUrl=this.sanitizer.bypassSecurityTrustResourceUrl(a.transformed.objectUrl),this.cd.markForCheck()}loadImageError(a){console.error(a),this.loadImageFailed.emit()}imageLoadedInView(){null!=this.loadedImage&&(this.imageLoaded.emit(this.loadedImage),this.setImageMaxSizeRetries=0,setTimeout(()=>this.checkImageMaxSizeRecursively()))}checkImageMaxSizeRecursively(){this.setImageMaxSizeRetries>40?this.loadImageFailed.emit():this.sourceImageLoaded()?(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),this.resetCropperPosition(),this.cropperReady.emit({...this.maxSize}),this.cd.markForCheck()):(this.setImageMaxSizeRetries++,setTimeout(()=>this.checkImageMaxSizeRecursively(),50))}sourceImageLoaded(){return this.sourceImage?.nativeElement?.offsetWidth>0}onResize(){if(this.loadedImage)if(this.hidden)this.resizedWhileHidden=!0;else{const a={...this.maxSize};this.setMaxSize(),this.resizeCropperPosition(a),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize()}}activatePinchGesture(){var a=this;return(0,H.A)(function*(){yield a.hammerLoader?.();const s=window?.Hammer||null;if(s){const _=new s(a.wrapper.nativeElement);_.get("pinch").set({enable:!0}),_.on("pinchmove",a.onPinch.bind(a)),_.on("pinchend",a.pinchStop.bind(a)),_.on("pinchstart",a.startPinch.bind(a))}else(0,c.naY)()&&console.warn("[NgxImageCropper] Could not find HammerJS - Pinch Gesture won't work")})()}resizeCropperPosition(a){(a.width!==this.maxSize.width||a.height!==this.maxSize.height)&&(this.cropper.x1=this.cropper.x1*this.maxSize.width/a.width,this.cropper.x2=this.cropper.x2*this.maxSize.width/a.width,this.cropper.y1=this.cropper.y1*this.maxSize.height/a.height,this.cropper.y2=this.cropper.y2*this.maxSize.height/a.height)}resetCropperPosition(){this.cropperPositionService.resetCropperPosition(this.sourceImage,this.cropper,this.settings,this.maxSize),this.doAutoCrop(),this.imageVisible=!0}keyboardAccess(a){this.changeKeyboardStepSize(a),this.keyboardMoveCropper(a)}changeKeyboardStepSize(a){const s=+a.key;s>=1&&s<=9&&(this.settings.stepSize=s)}keyboardMoveCropper(a){if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(a.key))return;const _=a.shiftKey?J.Resize:J.Move,l=a.altKey?function M(O){switch(O){case"ArrowUp":return"bottom";case"ArrowRight":return"left";case"ArrowDown":return"top";default:return"right"}}(a.key):function f(O){switch(O){case"ArrowUp":return"top";case"ArrowRight":return"right";case"ArrowDown":return"bottom";default:return"left"}}(a.key),p=function N(O,m){switch(O){case"ArrowUp":return{clientX:0,clientY:-1*m};case"ArrowRight":return{clientX:m,clientY:0};case"ArrowDown":return{clientX:0,clientY:m};default:return{clientX:-1*m,clientY:0}}}(a.key,this.settings.stepSize);a.preventDefault(),a.stopPropagation(),this.startMove({clientX:0,clientY:0},_,l),this.handleMouseMove(p),this.handleMouseUp()}startMove(a,s,_=null){this.disabled||this.moveStart?.active&&this.moveStart?.type===J.Pinch||s===J.Drag&&!this.allowMoveImage||(a.preventDefault&&a.preventDefault(),this.moveStart={active:!0,type:s,position:_,transform:{...this.transform},clientX:this.cropperPositionService.getClientX(a),clientY:this.cropperPositionService.getClientY(a),...this.cropper},this.initMouseMove())}initMouseMove(){(0,te.h)((0,ce.R)(document,"mousemove"),(0,ce.R)(document,"touchmove")).pipe((0,ae.Q)((0,te.h)((0,ce.R)(document,"mouseup"),(0,ce.R)(document,"touchend")).pipe((0,fe.$)()))).subscribe({next:a=>this.zone.run(()=>{this.handleMouseMove(a),this.cd.markForCheck()}),complete:()=>this.zone.run(()=>{this.handleMouseUp(),this.cd.markForCheck()})})}startPinch(a){this.safeImgDataUrl&&(a.preventDefault&&a.preventDefault(),this.moveStart={active:!0,type:J.Pinch,position:"center",clientX:this.cropper.x1+(this.cropper.x2-this.cropper.x1)/2,clientY:this.cropper.y1+(this.cropper.y2-this.cropper.y1)/2,...this.cropper})}handleMouseMove(a){if(this.moveStart.active)if(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),this.moveStart.type===J.Move)this.cropperPositionService.move(a,this.moveStart,this.cropper),this.checkCropperPosition(!0);else if(this.moveStart.type===J.Resize)!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.cropperPositionService.resize(a,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1);else if(this.moveStart.type===J.Drag){const s=this.cropperPositionService.getClientX(a)-this.moveStart.clientX,_=this.cropperPositionService.getClientY(a)-this.moveStart.clientY;this.transform={...this.transform,translateH:(this.moveStart.transform?.translateH||0)+s,translateV:(this.moveStart.transform?.translateV||0)+_},this.setCssTransform()}}onPinch(a){this.moveStart.active&&(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),this.moveStart.type===J.Pinch&&(this.cropperPositionService.resize(a,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1)),this.cd.markForCheck())}setMaxSize(){if(this.sourceImage){const a=getComputedStyle(this.sourceImage.nativeElement);this.maxSize.width=parseFloat(a.width),this.maxSize.height=parseFloat(a.height),this.marginLeft=this.sanitizer.bypassSecurityTrustStyle("calc(50% - "+this.maxSize.width/2+"px)")}}setCropperScaledMinSize(){this.loadedImage?.transformed?.image?(this.setCropperScaledMinWidth(),this.setCropperScaledMinHeight()):(this.settings.cropperScaledMinWidth=20,this.settings.cropperScaledMinHeight=20)}setCropperScaledMinWidth(){this.settings.cropperScaledMinWidth=this.cropperMinWidth>0?Math.max(20,this.cropperMinWidth/this.loadedImage.transformed.image.width*this.maxSize.width):20}setCropperScaledMinHeight(){this.settings.cropperScaledMinHeight=this.maintainAspectRatio?Math.max(20,this.settings.cropperScaledMinWidth/this.aspectRatio):this.cropperMinHeight>0?Math.max(20,this.cropperMinHeight/this.loadedImage.transformed.image.height*this.maxSize.height):20}setCropperScaledMaxSize(){if(this.loadedImage?.transformed?.image){const a=this.loadedImage.transformed.size.width/this.maxSize.width;this.settings.cropperScaledMaxWidth=this.cropperMaxWidth>20?this.cropperMaxWidth/a:this.maxSize.width,this.settings.cropperScaledMaxHeight=this.cropperMaxHeight>20?this.cropperMaxHeight/a:this.maxSize.height,this.maintainAspectRatio&&(this.settings.cropperScaledMaxWidth>this.settings.cropperScaledMaxHeight*this.aspectRatio?this.settings.cropperScaledMaxWidth=this.settings.cropperScaledMaxHeight*this.aspectRatio:this.settings.cropperScaledMaxWidth<this.settings.cropperScaledMaxHeight*this.aspectRatio&&(this.settings.cropperScaledMaxHeight=this.settings.cropperScaledMaxWidth/this.aspectRatio))}else this.settings.cropperScaledMaxWidth=this.maxSize.width,this.settings.cropperScaledMaxHeight=this.maxSize.height}checkCropperPosition(a=!1){this.cropper.x1<0&&(this.cropper.x2-=a?this.cropper.x1:0,this.cropper.x1=0),this.cropper.y1<0&&(this.cropper.y2-=a?this.cropper.y1:0,this.cropper.y1=0),this.cropper.x2>this.maxSize.width&&(this.cropper.x1-=a?this.cropper.x2-this.maxSize.width:0,this.cropper.x2=this.maxSize.width),this.cropper.y2>this.maxSize.height&&(this.cropper.y1-=a?this.cropper.y2-this.maxSize.height:0,this.cropper.y2=this.maxSize.height)}handleMouseUp(){this.moveStart.active&&(this.moveStart.active=!1,this.moveStart?.type===J.Drag?this.transformChange.emit(this.transform):this.doAutoCrop())}pinchStop(){this.moveStart.active&&(this.moveStart.active=!1,this.doAutoCrop())}doAutoCrop(){this.autoCrop&&this.crop()}crop(a=this.settings.output){if(null!=this.loadedImage?.transformed?.image){if(this.startCropImage.emit(),"blob"===a)return this.cropToBlob();if("base64"===a)return this.cropToBase64()}return null}cropToBlob(){var a=this;return new Promise((s,_)=>this.zone.run((0,H.A)(function*(){const l=yield a.cropService.crop(a.loadedImage,a.cropper,a.settings,"blob",a.maxSize);l?(a.imageCropped.emit(l),s(l)):_("Crop image failed")})))}cropToBase64(){const a=this.cropService.crop(this.loadedImage,this.cropper,this.settings,"base64",this.maxSize);return a?(this.imageCropped.emit(a),a):null}aspectRatioIsCorrect(){return(this.cropper.x2-this.cropper.x1)/(this.cropper.y2-this.cropper.y1)===this.aspectRatio}}return O.\u0275fac=function(a){return new(a||O)(c.rXU(v),c.rXU(w),c.rXU(Ce),c.rXU(u.up),c.rXU(c.gRc),c.rXU(c.SKi),c.rXU(u.Bn,8))},O.\u0275cmp=c.VBU({type:O,selectors:[["image-cropper"]],viewQuery:function(a,s){if(1&a&&(c.GBs(e,7),c.GBs(Oe,5)),2&a){let _;c.mGM(_=c.lsd())&&(s.wrapper=_.first),c.mGM(_=c.lsd())&&(s.sourceImage=_.first)}},hostVars:6,hostBindings:function(a,s){1&a&&c.bIt("resize",function(){return s.onResize()},!1,c.tSv),2&a&&(c.xc7("text-align",s.alignImage),c.AVh("disabled",s.disabled)("ngx-ix-hidden",s.hidden))},inputs:{imageChangedEvent:"imageChangedEvent",imageURL:"imageURL",imageBase64:"imageBase64",imageFile:"imageFile",imageAltText:"imageAltText",cropperFrameAriaLabel:"cropperFrameAriaLabel",output:"output",format:"format",transform:"transform",maintainAspectRatio:"maintainAspectRatio",aspectRatio:"aspectRatio",resetCropOnAspectRatioChange:"resetCropOnAspectRatioChange",resizeToWidth:"resizeToWidth",resizeToHeight:"resizeToHeight",cropperMinWidth:"cropperMinWidth",cropperMinHeight:"cropperMinHeight",cropperMaxHeight:"cropperMaxHeight",cropperMaxWidth:"cropperMaxWidth",cropperStaticWidth:"cropperStaticWidth",cropperStaticHeight:"cropperStaticHeight",canvasRotation:"canvasRotation",initialStepSize:"initialStepSize",roundCropper:"roundCropper",onlyScaleDown:"onlyScaleDown",imageQuality:"imageQuality",autoCrop:"autoCrop",backgroundColor:"backgroundColor",containWithinAspectRatio:"containWithinAspectRatio",hideResizeSquares:"hideResizeSquares",allowMoveImage:"allowMoveImage",cropper:"cropper",alignImage:"alignImage",disabled:"disabled",hidden:"hidden"},outputs:{imageCropped:"imageCropped",startCropImage:"startCropImage",imageLoaded:"imageLoaded",cropperReady:"cropperReady",loadImageFailed:"loadImageFailed",transformChange:"transformChange"},features:[c.OA$],decls:5,vars:10,consts:[["wrapper",""],["sourceImage",""],["class","ngx-ic-source-image","role","presentation",3,"src","visibility","transform","ngx-ic-draggable","load","mousedown","touchstart","error",4,"ngIf"],[1,"ngx-ic-overlay"],["class","ngx-ic-cropper","tabindex","0",3,"ngx-ic-round","top","left","width","height","margin-left","visibility","keydown",4,"ngIf"],["role","presentation",1,"ngx-ic-source-image",3,"load","mousedown","touchstart","error","src"],["tabindex","0",1,"ngx-ic-cropper",3,"keydown"],["role","presentation",1,"ngx-ic-move",3,"mousedown","touchstart"],[4,"ngIf"],["role","presentation",1,"ngx-ic-resize","ngx-ic-topleft",3,"mousedown","touchstart"],[1,"ngx-ic-square"],[1,"ngx-ic-resize","ngx-ic-top"],["role","presentation",1,"ngx-ic-resize","ngx-ic-topright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-right"],["role","presentation",1,"ngx-ic-resize","ngx-ic-bottomright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-bottom"],["role","presentation",1,"ngx-ic-resize","ngx-ic-bottomleft",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-left"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-top",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-right",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-bottom",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-left",3,"mousedown","touchstart"]],template:function(a,s){1&a&&(c.j41(0,"div",null,0),c.DNE(2,L,2,8,"img",2),c.nrm(3,"div",3),c.DNE(4,q,3,16,"div",4),c.k0s()),2&a&&(c.xc7("background",s.imageVisible&&s.backgroundColor),c.R7$(2),c.Y8G("ngIf",s.safeImgDataUrl),c.R7$(),c.xc7("width",s.maxSize.width,"px")("height",s.maxSize.height,"px")("margin-left","center"===s.alignImage?s.marginLeft:null),c.R7$(),c.Y8G("ngIf",s.imageVisible))},dependencies:[de.bT],styles:['[_nghost-%COMP%]{display:flex;position:relative;width:100%;max-width:100%;max-height:100%;overflow:hidden;padding:5px;text-align:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{width:100%;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image[_ngcontent-%COMP%]{max-width:100%;max-height:100%;transform-origin:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image.ngx-ic-draggable[_ngcontent-%COMP%]{user-drag:none;-webkit-user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;cursor:grab}[_nghost-%COMP%]   .ngx-ic-overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;touch-action:none;outline:var(--cropper-overlay-color, white) solid 100vw;top:0;left:0}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{position:absolute;display:flex;color:#53535c;background:transparent;outline:rgba(255,255,255,.3) solid 100vw;outline:var(--cropper-outline-color, rgba(255, 255, 255, .3)) solid 100vw;touch-action:none}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{outline-width:100vh}}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:after{position:absolute;content:"";inset:0;pointer-events:none;border:dashed 1px;opacity:.75;color:inherit;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{width:100%;cursor:move;border:1px solid rgba(255,255,255,.5)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-move[_ngcontent-%COMP%]{border-color:#1e90ff;border-width:2px}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]{position:absolute;display:inline-block;line-height:6px;padding:8px;opacity:.85;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{display:inline-block;background:#53535C;width:6px;height:6px;border:1px solid rgba(255,255,255,.5);box-sizing:content-box}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topleft[_ngcontent-%COMP%]{top:-12px;left:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-top[_ngcontent-%COMP%]{top:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topright[_ngcontent-%COMP%]{top:-12px;right:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-right[_ngcontent-%COMP%]{top:calc(50% - 12px);right:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomright[_ngcontent-%COMP%]{bottom:-12px;right:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomleft[_ngcontent-%COMP%]{bottom:-12px;left:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-left[_ngcontent-%COMP%]{top:calc(50% - 12px);left:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%]{position:absolute;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-top[_ngcontent-%COMP%]{top:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-right[_ngcontent-%COMP%]{top:11px;right:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-left[_ngcontent-%COMP%]{top:11px;left:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]{outline-color:transparent}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{border-radius:100%;box-shadow:0 0 0 100vw #ffffff4d;box-shadow:0 0 0 100vw var(--cropper-outline-color, rgba(255, 255, 255, .3))}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{box-shadow:0 0 0 100vh #ffffff4d;box-shadow:0 0 0 100vh var(--cropper-outline-color, rgba(255, 255, 255, .3))}}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{border-radius:100%}.disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{display:none}.ngx-ix-hidden[_nghost-%COMP%]{display:none}'],changeDetection:0}),O})(),Ee=(()=>{class O{}return O.\u0275fac=function(a){return new(a||O)},O.\u0275mod=c.$C({type:O}),O.\u0275inj=c.G2t({imports:[[de.MD]]}),O})();function X(O){const m=O.split(","),a=m[0].replace("data:","").replace(";base64",""),s=atob(m[1]),_=new ArrayBuffer(s.length),l=new Uint8Array(_);for(let p=0;p<s.length;p+=1)l[p]=s.charCodeAt(p);return new Blob([_],{type:a})}}}]);