import{a as n}from"./chunk-TOONS3AW.js";import{b as D}from"./chunk-DJYMAW3B.js";import{a as L}from"./chunk-ITVL4IJL.js";import{G as _}from"./chunk-3LOKQP2Q.js";import{$b as T,Db as y,Eb as k,Jb as f,Kb as g,Lb as C,Mb as l,Pc as r,Qc as M,Wd as v,_a as p,a as c,b as d,e as o,fa as h,jc as q,kc as w,nb as m,ya as u}from"./chunk-XLNNDSL4.js";function P(i,R){i&1&&l(0,"app-loading")}var O=(()=>{class i{constructor(){this.listType=r(),this.query=r(),this.queryCmd=r(),this.loadMore=M.required(n),this.showRating=!1,this.showPlayCount=!1,this.showPlayDate=!1,this.jam=h(v),this.notify=h(_)}getTracks(s){let t=this.loadMore();t.loading.set(!0);let e=s().then(a=>{this.activeRequest===e&&(this.tracks=[...this.tracks??[],...a.items],t.hasMore.set((a.total??0)>this.tracks.length),t.total.set(a.total),t.loading.set(!1))}).catch(a=>{this.activeRequest===e&&this.loadMore().loading.set(!1),this.notify.error(a)});this.activeRequest=e}searchText(){this.getTracks(()=>o(this,null,function*(){return this.jam.track.search({query:this.query(),skip:this.loadMore().skip(),take:this.loadMore().take(),trackIncTag:!0,trackIncState:!0})}))}searchCmd(){this.getTracks(()=>o(this,null,function*(){return this.jam.track.search(d(c({},this.queryCmd()),{skip:this.loadMore().skip(),take:this.loadMore().take(),trackIncTag:!0,trackIncState:!0}))}))}list(){this.getTracks(()=>o(this,null,function*(){return this.jam.track.search({list:this.listType(),trackIncState:!0,trackIncTag:!0,skip:this.loadMore().skip(),take:this.loadMore().take()})}))}load(){this.query()?this.searchText():this.queryCmd()?this.searchCmd():this.listType()?this.list():this.tracks=[]}ngOnChanges(){let s=this.loadMore();s.skip.set(0),s.total.set(0),s.hasMore.set(!1),this.showRating=this.listType()==="highest",this.showPlayCount=this.listType()==="frequent",this.showPlayDate=this.listType()==="recent",this.tracks=void 0,this.load()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=m({type:i,selectors:[["app-tracks-loader"]],viewQuery:function(t,e){t&1&&q(e.loadMore,n,5),t&2&&w()},inputs:{listType:[1,"listType"],query:[1,"query"],queryCmd:[1,"queryCmd"]},features:[u],decls:3,vars:6,consts:[[3,"showArtist","showPlayCount","showPlayDate","showRating","tracks"],[3,"requestLoad"]],template:function(t,e){t&1&&(y(0,P,1,0,"app-loading"),l(1,"app-track-list",0),g(2,"app-load-more-button",1),T("requestLoad",function(){return e.load()}),C()),t&2&&(k(e.tracks?-1:0),p(),f("showArtist",!0)("showPlayCount",e.showPlayCount)("showPlayDate",e.showPlayDate)("showRating",e.showRating)("tracks",e.tracks))},dependencies:[D,n,L],encapsulation:2})}}return i})();export{O as a};
