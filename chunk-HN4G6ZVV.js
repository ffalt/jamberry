import{b as rt,d as lt,f as ct,g as pt,h as at,i as ut,j as ht}from"./chunk-5NZQP5GA.js";import{r as it,w as nt,x,z as st}from"./chunk-ZMFSGBQT.js";import{Aa as q,B as S,Bc as z,Cb as B,Db as F,E as c,I as T,Ib as H,Ic as G,Jb as $,K as N,Kb as Q,Pc as J,Qc as r,Rb as j,Rc as Z,T as I,Tc as tt,U as p,V as M,Za as K,_b as f,a as y,ac as A,bc as X,cc as Y,db as R,e as C,fa as a,hc as L,ib as V,ic as U,j as h,jc as w,mb as m,mc as W,nd as et,ob as d,rb as b,sd as ot,u as E,xa as P,y as k}from"./chunk-S3YUDFSI.js";var _=(()=>{class o{constructor(){this.tpl=a(R)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275dir=d({type:o,selectors:[["","appAutocompleteContent",""]]})}}return o})();var mt=["root"],dt=o=>({control:o});function ft(o,l){o&1&&j(0)}function gt(o,l){if(o&1&&($(0,"div",1),b(1,ft,1,0,"ng-container",2),Q()),o&2){let e=A().control,t=A();K(),H("ngTemplateOutlet",t.content().tpl)("ngTemplateOutletContext",z(2,dt,e))}}function vt(o,l){if(o&1&&B(0,gt,2,4,"div",1),o&2){let e=l.control;F(e!=null&&e.isVisible?0:-1)}}var St=(()=>{class o{constructor(){this.rootTemplate=Z.required("root"),this.content=tt.required(_)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=m({type:o,selectors:[["app-autocomplete"]],contentQueries:function(t,i,n){t&1&&L(n,i.content,_,5),t&2&&w()},viewQuery:function(t,i){t&1&&U(i.rootTemplate,mt,5),t&2&&w()},exportAs:["appAutocomplete"],decls:2,vars:0,consts:[["root",""],[1,"ac-content"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(t,i){t&1&&b(0,vt,1,1,"ng-template",null,0,G)},dependencies:[ot,et],styles:[".ac-content[_ngcontent-%COMP%]{width:100%;display:block;overflow-y:auto;background-color:var(--control);color:var(--on-control);box-shadow:var(--control-box-shadow);border-color:var(--control-box-border);border-width:1px;border-style:solid;border-radius:0;font-size:14px}"]})}}return o})();var yt=["*"],Pt=(()=>{class o{constructor(){this.option=r(),this.control=r()}get getActive(){let e=this.control();return e?e.options[e.activeIndex]===this.option():!1}mouseDownEvent(e){let t=this.control(),i=this.option();t&&i&&(t.selectOption(i),e.stopPropagation())}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=m({type:o,selectors:[["app-autocomplete-option"]],hostVars:2,hostBindings:function(t,i){t&1&&f("mousedown",function(s){return i.mouseDownEvent(s)}),t&2&&W("active",i.getActive)},inputs:{option:[1,"option"],control:[1,"control"]},ngContentSelectors:yt,decls:1,vars:0,template:function(t,i){t&1&&(X(),Y(0))},styles:["[_nghost-%COMP%]{display:block;padding:5px;cursor:pointer}[_nghost-%COMP%]:hover{background-color:var(--control-hover);color:var(--on-control-hover)}.active[_nghost-%COMP%]{background-color:var(--control-active);color:var(--on-control-active)}[_nghost-%COMP%]     b{color:var(--on-control-active)}"],changeDetection:0})}}return o})();function Ct(o){return o.target.value}var u=-1;function bt(o,l){return S(document,"click").pipe(c(e=>{let t=e.target,i=t!==l,n=!o.overlayElement.contains(t);return i&&n}),p(o.detachments()))}var $t=(()=>{class o{constructor(){this.appAutocomplete=r(),this.appAutocompleteControl=r(),this.appAutocompleteSettings=r(),this.appAutocompleteNavigKeyDown=J(),this.isVisible=!1,this.activeIndex=u,this.query="",this.options=[],this.unsubscribe=new h,this.host=a(q),this.vcr=a(V),this.overlay=a(st),this.keydown$=new h,this.keyup$=new h,this.settings={allowEmpty:!1,debounceTime:300},this.isCreated=!1}ngOnInit(){this.filterEnterEvent(this.keydown$),this.listenAndSuggest(this.keyup$),this.navigateSuggestionsWithArrows(this.keydown$)}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}ngOnChanges(e){e.appAutocompleteSettings&&(this.settings=y(y({},this.settings),this.appAutocompleteSettings()))}selectOption(e){this.hide();let t=this.appAutocompleteControl();t&&(this.query=t.autocompleteSelectResult(e))}handleEsc(e){ht(e)&&(this.hide(),e.preventDefault()),this.keydown$.next(e)}onkeyup(e){e.preventDefault(),e.stopPropagation(),this.keyup$.next(e)}run(){this.query.length!==0&&this.request(this.query).then(e=>{this.activeIndex=u,this.options=e,this.display()}).catch(e=>{console.error(e)})}static resolveNextIndex(e,t,i){let n=t?1:-1,s=i.length-1,O=u,g=e+n,v=g;return g===s+1&&(v=O),g===O-1&&(v=s),v}updateIndex(e){this.activeIndex=o.resolveNextIndex(this.activeIndex,at(e),this.options)}listenAndSuggest(e){e.pipe(c(t=>!rt(t)),E(Ct),T(this.settings.debounceTime),k,N(),M(t=>(this.query=t,t)),c(t=>this.settings.allowEmpty||t.length>0),I(t=>C(this,null,function*(){return this.request(t)})),p(this.unsubscribe)).subscribe(t=>{this.activeIndex=u,this.options=t,this.display()})}display(){if(this.options.length===0){this.isVisible=!1;return}this.isCreated||this.openDropdown(),this.isVisible=this.options.length>0}request(e){return C(this,null,function*(){let t=this.appAutocompleteControl();return t?t.autocompleteGetData(e):[]})}filterEnterEvent(e){e.pipe(c(ut),p(this.unsubscribe)).subscribe(()=>{if(!this.isVisible){this.query=this.host.nativeElement.value;let n=this.appAutocompleteControl();n&&n.autocompleteEnter(this.query);return}let t=this.options.at(this.activeIndex);this.hide();let i=this.appAutocompleteControl();t?this.selectOption(t):i&&i.autocompleteEnter(this.query)})}navigateSuggestionsWithArrows(e){e.pipe(c(lt),p(this.unsubscribe)).subscribe(t=>{ct(t)?(this.hide(),this.host.nativeElement.selectionStart===this.host.nativeElement.value.length&&this.appAutocompleteNavigKeyDown.emit(t)):pt(t)?(this.hide(),this.host.nativeElement.selectionEnd===0&&this.appAutocompleteNavigKeyDown.emit(t)):this.isVisible?(this.updateIndex(t),this.display()):this.appAutocompleteNavigKeyDown.emit(t)})}openDropdown(){let e=this.appAutocomplete()?.rootTemplate();if(!e)return;this.overlayRef=this.createOverlay();let t=new it(e,this.vcr,{control:this});this.overlayRef.attach(t),bt(this.overlayRef,this.host.nativeElement).pipe(p(this.unsubscribe)).subscribe(()=>{this.close()}),this.isCreated=!0,this.isVisible=!0}hide(){this.isVisible=!1,this.activeIndex=u}close(){this.overlayRef&&(this.overlayRef.detach(),this.overlayRef=void 0),this.isCreated=!1}createOverlay(){return this.overlay.create(this.getOverlayConfig())}getOverlayConfig(){return new nt({hasBackdrop:!1,backdropClass:"",panelClass:"ngx-autocomplete",scrollStrategy:this.overlay.scrollStrategies.block(),positionStrategy:this.getOverlayPosition()})}getOverlayPosition(){let e=[new x({originX:"start",originY:"bottom"},{overlayX:"start",overlayY:"top"}),new x({originX:"start",originY:"top"},{overlayX:"start",overlayY:"bottom"})];return this.overlay.position().flexibleConnectedTo(this.host).withFlexibleDimensions(!1).withPositions(e).withPush(!1)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275dir=d({type:o,selectors:[["","appAutocomplete",""]],hostBindings:function(t,i){t&1&&f("keydown",function(s){return i.handleEsc(s)})("keyup",function(s){return i.onkeyup(s)})},inputs:{appAutocomplete:[1,"appAutocomplete"],appAutocompleteControl:[1,"appAutocompleteControl"],appAutocompleteSettings:[1,"appAutocompleteSettings"]},outputs:{appAutocompleteNavigKeyDown:"appAutocompleteNavigKeyDown"},features:[P]})}}return o})();export{_ as a,St as b,Pt as c,$t as d};
