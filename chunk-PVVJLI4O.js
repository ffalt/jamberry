import{b}from"./chunk-JNPRJ3MQ.js";import{a as d}from"./chunk-24DMSAFT.js";import{a as p}from"./chunk-DYCPZPVS.js";import{G as l}from"./chunk-ZVKVGF76.js";import{$d as u,Y as r,da as f,e as a,ia as i,k as c,ub as m}from"./chunk-H2EXZDP6.js";var x=(()=>{let e=class e{constructor(){this.rootsChange=new m,this.rootChange=new p,this.unsubscribe=new c,this.jam=i(u),this.notify=i(l),this.folderService=i(b),this.rootPoll=new d((t,s)=>{this.jam.root.status({id:t.id}).then(o=>{if(!(this.rootsChange.observed||this.rootChange.observed(t.id))){s(!1);return}o.scanning?s(!0):(t.status=o,s(!1))}).catch(o=>{console.error("error while polling root scan status",o)})}),this.roots=[]}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}applyDialogRoot(t){return a(this,null,function*(){if(t.root){let s=t.root.id,o=yield this.jam.root.update({id:s,name:t.name,path:t.path,strategy:t.strategy});this.folderService.waitForQueueResult("Updating Root",o,[]).pipe(r(this.unsubscribe)).subscribe(()=>{this.notify.success("Root updated"),this.refreshRoot(s)})}else{let s=yield this.jam.root.create({name:t.name,path:t.path,strategy:t.strategy});this.folderService.waitForQueueResult("Creating Root",s,[]).pipe(r(this.unsubscribe)).subscribe(()=>{this.notify.success("Root created"),this.refreshRoots()})}})}rescanRoot(t){this.jam.root.refresh({id:t.id}).then(()=>{this.refreshRoot(t.id)}).catch(s=>{this.notify.error(s)})}refreshRootMeta(t){this.jam.root.refreshMeta({id:t.id}).then(()=>{this.refreshRoot(t.id)}).catch(s=>{this.notify.error(s)})}rescanRoots(){this.jam.root.refresh({}).then(()=>{this.refreshRoots()}).catch(t=>{this.notify.error(t)})}removeRoot(t){this.jam.root.remove({id:t.id}).then(s=>{this.folderService.waitForQueueResult("Removing Root",s,[]).pipe(r(this.unsubscribe)).subscribe(()=>{this.roots=this.roots.filter(o=>o.id!==t.id),this.rootChange.emit(t.id),this.notify.success("Root removed"),this.refreshRoots()})}).catch(s=>{this.notify.error(s)})}refreshRoot(t){this.jam.root.id({id:t}).then(s=>{let o=this.roots.findIndex(n=>n.id===t);o===-1?this.roots.push(s):this.roots[o]=s,this.rootChange.emit(t,s),this.rootsChange.emit(this.roots),s.status.scanning&&this.rootPoll.poll(s)}).catch(s=>{this.notify.error(s)})}refreshRoots(){this.jam.root.search({}).then(t=>{this.roots=t.items;for(let s of this.roots)s.status.scanning&&this.rootPoll.poll(s);this.rootsChange.emit(this.roots)}).catch(t=>{this.notify.error(t)})}};e.\u0275fac=function(s){return new(s||e)},e.\u0275prov=f({token:e,factory:e.\u0275fac,providedIn:"root"});let h=e;return h})();export{x as a};
