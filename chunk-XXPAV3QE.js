import{c as _e}from"./chunk-J6P7OT7K.js";import"./chunk-HMP63COV.js";import{a as de}from"./chunk-GVMVJAFS.js";import{b as D}from"./chunk-JNPRJ3MQ.js";import"./chunk-UKXRRTDE.js";import{a as se}from"./chunk-6WAGYCOA.js";import"./chunk-UPKF4LSO.js";import"./chunk-N2K5OS3Y.js";import"./chunk-24DMSAFT.js";import{d as q,g as K,k as Y,l as Z,m as ee,o as te}from"./chunk-Y5Z5ITNC.js";import"./chunk-BNP52TDG.js";import"./chunk-F6BYEP4R.js";import"./chunk-VP6KNDS4.js";import{k as ne}from"./chunk-AQDYGNZB.js";import"./chunk-FQC6PRY2.js";import{a as re}from"./chunk-PZTZCA44.js";import"./chunk-4HNSRH53.js";import{G as le}from"./chunk-ZVKVGF76.js";import{h as ie,i as oe,k as ae}from"./chunk-T6GM3CFW.js";import{$d as y,Aa as G,Ac as Q,Ba as B,Gc as W,Hb as p,Ib as f,Kb as v,Lb as u,Mb as M,Md as m,Nb as S,Ob as s,Pb as r,Qb as H,Rb as C,Sb as O,Tb as L,Vc as J,Y as N,_b as F,ab as l,ac as P,dc as R,e as b,ec as X,fc as c,ia as g,k,na as x,nb as I,oa as T,rb as z,tc as d,uc as _,vc as $,wd as U,yc as V,zc as j}from"./chunk-H2EXZDP6.js";var ge=(n,o)=>o.hint.id,he=(n,o)=>o.name;function Ce(n,o){if(n&1&&(C(0,"div",6),d(1),O()),n&2){let i=o.$implicit;l(),_(i)}}function pe(n,o){if(n&1&&(C(0,"div",2),L(1,"i",5),d(2),u(3,Ce,2,1,"div",6,v),O()),n&2){let i=o.$implicit;l(2),$(" ",i.hint.name," "),l(),M(i.details)}}function fe(n,o){n&1&&(C(0,"div",2),P(1,0),O())}function ue(n,o){n&1&&L(0,"i",8)}function Me(n,o){if(n&1&&d(0),n&2){let i=c().$implicit;$(" ",i.name," ")}}function Oe(n,o){if(n&1){let i=F();C(0,"button",7),X("click",function(){let t=x(i).$implicit;return T(t.click())}),p(1,ue,1,0,"i",8)(2,Me,1,1),O()}if(n&2){let i=o.$implicit;l(),f(i.running?1:2)}}function Pe(n,o){if(n&1&&(C(0,"div",1),u(1,pe,5,1,"div",2,ge,!1,fe,2,0,"div",2),C(4,"div",3),u(5,Oe,3,1,"button",4,he),O()()),n&2){let i=c();l(),M(i.hints),l(4),M(i.solutions)}}function Ee(n,o){n&1&&(C(0,"div",1)(1,"div",2),L(2,"i",8),O()())}var ce=(()=>{let o=class o{constructor(){this.folderHealth=J(),this.solutions=[],this.unsubscribe=new k,this.router=g(ie),this.jam=g(y),this.dialogOverlay=g(ne),this.folderService=g(D)}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}searchImages(e){this.dialogOverlay.open({childComponent:_e,title:"Search Artwork Images",data:{folder:e,artworks:[]},panelClass:"overlay-panel-large-buttons"})}ngOnChanges(){this.display(this.folderHealth())}static describeImageInvalidHint(e){if(!e.details||e.details.length===0)return[];let t=[e.details[0].reason];return e.details[0].expected&&t.push(`Expected: ${e.details[0].expected} Actual: ${e.details[0].actual}`),t}static describeAlbumTracksMissingHint(e){if(!e.details||e.details.length===0)return[];let t=[];return e.details[0].expected&&t.push(`Expected: ${e.details[0].expected} Actual: ${e.details[0].actual}`),t}describeImageQualityHint(e,t){if(this.addAlbumImageSearchSolution(t),!e.details||e.details.length===0)return[];let a=[e.details[0].reason];return a.push(`Expected: ${e.details[0].expected} Actual: ${e.details[0].actual}`),a}addArtistImageSearchSolution(e){if(e.tag?.mbArtistID){let t={name:"Search",click:()=>b(this,null,function*(){this.searchImages(e)})};this.solutions.push(t)}}addAlbumImageSearchSolution(e){if(e.tag&&(e.tag.mbReleaseID||e.tag.mbReleaseGroupID)){let t={name:"Search",click:()=>b(this,null,function*(){this.searchImages(e)})};this.solutions.push(t)}}addRenameSolution(e,t){if(!this.solutions.some(a=>a.name==="Rename")){let a={name:"Rename",click:()=>b(this,null,function*(){if(a.running)return;a.running=!0;let h=yield this.jam.folder.rename({id:e.id,name:t});this.folderService.waitForQueueResult("Renaming Folder",h,[e.id]).pipe(N(this.unsubscribe)).subscribe(()=>{a.running=!1})})};this.solutions.push(a)}}addEditTagSolution(e){if(!this.solutions.some(t=>t.name==="Edit Tags")){let t={name:"Edit Tags",click:()=>b(this,null,function*(){this.router.navigate([`/admin/folder/${e.id}/tags`]).catch(a=>{console.error(a)})})};this.solutions.push(t)}}describeMBIDMissingHint(e,t){return this.addEditTagSolution(t),[]}describeAlbumTagMissingHint(e,t){return this.addEditTagSolution(t),e.details?[`Expected: ${e.details.map(a=>a.expected).join(",")}`]:[]}describeNameNonConformHint(e,t){let a=e.details&&e.details.length>0?e.details[0].expected:"";return a?(this.addRenameSolution(t,a),[`Current: ${t.name}`,`Suggested Name: ${a}`]):[]}describeArtistImageMissingHint(e,t){return this.addArtistImageSearchSolution(t),[]}describeAlbumImageMissingHint(e,t){return this.addAlbumImageSearchSolution(t),[]}describeHint(e,t){switch(e.id){case m.albumMBIDExists:return this.describeMBIDMissingHint(e,t);case m.albumTagsExists:return this.describeAlbumTagMissingHint(e,t);case m.albumNameConform:case m.artistNameConform:return this.describeNameNonConformHint(e,t);case m.albumImageExists:return this.describeAlbumImageMissingHint(e,t);case m.albumTracksComplete:return o.describeAlbumTracksMissingHint(e);case m.artistImageExists:return this.describeArtistImageMissingHint(e,t);case m.artistImageValid:case m.albumImageValid:return o.describeImageInvalidHint(e);case m.albumImageQuality:return this.describeImageQualityHint(e,t);default:break}return[]}display(e){this.hints=[],this.solutions=[],e?.health&&(this.hints=e.health.map(t=>{let a=this.describeHint(t,e.folder);return{hint:t,details:a}}))}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=I({type:o,selectors:[["app-folder-health"]],inputs:{folderHealth:[1,"folderHealth"]},features:[G],decls:2,vars:1,consts:()=>{let e;return e=$localize`:␟baa5a59fd701bf37b30140cf2080f8987db6c2e9␟4786331182153457864:No Hints`,[e,[1,"hints"],[1,"hint"],[1,"solutions"],[1,"button-on-background"],[1,"icon-warning"],[1,"details"],[1,"button-on-background",3,"click"],[1,"icon-spin","icon-spinner"]]},template:function(t,a){t&1&&p(0,Pe,7,1,"div",1)(1,Ee,3,0,"div",1),t&2&&f(a.hints?0:1)},styles:["[_nghost-%COMP%]{height:100%;width:100%;overflow-y:auto;overflow-x:auto;display:block}[_nghost-%COMP%]   .icon-warning[_ngcontent-%COMP%]{color:var(--accent)}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]{padding-left:28px;font-size:.8em;text-transform:uppercase;min-width:30%;display:inline-block}[_nghost-%COMP%]   .hints[_ngcontent-%COMP%]{padding-top:10px}[_nghost-%COMP%]   .hint[_ngcontent-%COMP%]{padding-bottom:10px}"]});let n=o;return n})();var Ae=n=>["/admin/folder",n,"overview"],be=(n,o)=>o.folder.id;function xe(n,o){if(n&1&&(s(0,"option",13),d(1),r()),n&2){let i=o.$implicit;S("value",i),l(),_(i)}}function Te(n,o){if(n&1){let i=F();s(0,"select",12),Q("ngModelChange",function(t){x(i);let a=c();return j(a.filter,t)||(a.filter=t),T(t)}),R("ngModelChange",function(){x(i);let t=c();return T(t.onFilterChange())}),u(1,xe,2,2,"option",13,v),r()}if(n&2){let i=c();V("ngModel",i.filter),l(),M(i.modes)}}function Se(n,o){n&1&&H(0,"app-loading")}function He(n,o){if(n&1&&(s(0,"div",19),P(1,0),r(),s(2,"div",16),d(3),r(),s(4,"div",20),d(5),r(),s(6,"div",21),d(7),r()),n&2){let i=c().$implicit;l(3),_(i.folder.tag==null?null:i.folder.tag.album),l(2),_(i.folder.tag==null?null:i.folder.tag.artist),l(2),_(i.folder.tag==null?null:i.folder.tag.year)}}function Ne(n,o){if(n&1&&(s(0,"div",19),P(1,1),r(),s(2,"div",16),d(3),r(),s(4,"div",20),d(5),r(),s(6,"div",21),d(7),r()),n&2){let i=c().$implicit;l(3),_(i.folder.tag==null?null:i.folder.tag.album),l(2),_(i.folder.tag==null?null:i.folder.tag.artist),l(2),_(i.folder.tag==null?null:i.folder.tag.year)}}function Ie(n,o){if(n&1&&(s(0,"div",19),P(1,2),r(),s(2,"div",16),d(3),r()),n&2){let i=c().$implicit;l(3),_(i.folder.tag==null?null:i.folder.tag.artist)}}function ve(n,o){if(n&1&&(s(0,"div",19),P(1,3),r(),s(2,"div",16),d(3),r()),n&2){let i=c().$implicit;l(3),_(i.folder.name)}}function Le(n,o){if(n&1&&(s(0,"div",16),d(1),r()),n&2){let i=c().$implicit;l(),_(i.folder.name)}}function Fe(n,o){if(n&1&&(s(0,"div",11)(1,"div",14)(2,"a",15),p(3,He,8,3)(4,Ne,8,3)(5,Ie,4,1)(6,ve,4,1)(7,Le,2,1,"div",16),r()(),s(8,"div",17),H(9,"app-folder-health",18),r()()),n&2){let i,e=o.$implicit;l(2),S("routerLink",W(3,Ae,e.folder.id)),l(),f((i=e.folder.type)==="multialbum"?3:i==="album"?4:i==="artist"?5:i==="collection"?6:7),l(6),S("folderHealth",e)}}var at=(()=>{let o=class o extends de{constructor(){super(...arguments),this.modes=[],this.jam=g(y),this.notify=g(le),this.folderService=g(D)}onFilterChange(){this.reDisplay()}ngOnInit(){super.ngOnInit(),this.folderService.foldersChange.pipe(N(this.unsubscribe)).subscribe(e=>{if(e.id===this.id)this.refresh();else if(this.all){let t=this.all.find(a=>a.folder.id===e.id);t&&this.jam.folder.health({ids:[e.id],folderIncTag:!0}).then(a=>{if(this.all){let h=a.find(E=>E.folder.id===t.folder.id);h?this.all[this.all.indexOf(t)]=h:this.all=this.all.filter(E=>E.folder.id!==t.folder.id)}this.reDisplay()}).catch(a=>{this.notify.error(a)})}})}ngOnDestroy(){super.ngOnDestroy()}refresh(){this.hints=void 0,this.jam.folder.health({childOfID:this.id,folderIncTag:!0}).then(e=>{this.display(e)}).catch(e=>{this.notify.error(e)})}reDisplay(){this.hints=!this.filter||!this.all?this.all:this.all.filter(e=>e.health.find(t=>t.name===this.filter))}display(e){this.all=e,this.modes=[];for(let t of e)for(let a of t.health)this.modes.includes(a.name)||this.modes.push(a.name);this.reDisplay()}};o.\u0275fac=(()=>{let e;return function(a){return(e||(e=B(o)))(a||o)}})(),o.\u0275cmp=I({type:o,selectors:[["app-admin-folder-health"]],features:[z],decls:10,vars:3,consts:()=>{let e;e=$localize`:␟e9e69aab6530b06f07d62019e95496e5c974a35d␟4008496035123032607:Refresh List`;let t;t=$localize`:␟bb787b6c8e8a25e976f65cadc66c66c8a7d81a8a␟8891977878457079212:Type of Hints`;let a;a=$localize`:␟842a4fcf548e0c52ebab1cb5362f47ab2ca83e12␟1393837337557373364:Album`;let h;h=$localize`:␟842a4fcf548e0c52ebab1cb5362f47ab2ca83e12␟1393837337557373364:Album`;let E;E=$localize`:␟378660a509ecaa4d2dd3b4b0b8975760cfe3576d␟2492300395471245755:Artist`;let w;return w=$localize`:␟40cf215f61708390d3aba0212e49596e0d3d981c␟16823705783062999:Collection`,[a,h,E,w,[1,"health"],[1,"actions"],["title",e,1,"button-on-control",3,"click"],[1,"icon-reload"],["placeholder",t,3,"ngModel"],[1,"health-content"],["name","Folder Health Issues",3,"list"],[1,"folder"],["placeholder",t,3,"ngModelChange","ngModel"],[3,"value"],[1,"meta"],[3,"routerLink"],[1,"name"],[1,"folder-health"],[3,"folderHealth"],[1,"type"],[1,"artist"],[1,"year"]]},template:function(t,a){t&1&&(s(0,"div",4)(1,"div",5)(2,"button",6),R("click",function(){return a.refresh()}),H(3,"i",7),r(),p(4,Te,3,1,"select",8),r(),s(5,"div",9),p(6,Se,1,0,"app-loading"),H(7,"app-background-text-list",10),u(8,Fe,10,5,"div",11,be),r()()),t&2&&(l(4),f(a.modes.length>0?4:-1),l(2),f(a.hints?-1:6),l(),S("list",a.hints),l(),M(a.hints))},dependencies:[U,ae,oe,te,Z,ee,Y,q,K,ce,se,re],styles:["[_nghost-%COMP%]{height:100%;width:100%}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:10px 15px 0;border-bottom-color:var(--background-border);border-bottom-width:1px;border-bottom-style:solid}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:10px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:1px;font-size:11px;margin-left:5px;margin-right:5px}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .health-content[_ngcontent-%COMP%]{padding:15px;overflow-y:auto;overflow-x:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]{border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:var(--background-border);padding:15px;display:flex;flex-flow:row wrap;flex-flow:row nowrap}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{width:30%;padding-right:15px;margin-left:15px;display:flex;flex-flow:column wrap;position:relative}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;text-overflow:ellipsis;overflow:hidden}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%]{text-transform:uppercase}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .year[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .state[_ngcontent-%COMP%]{letter-spacing:1px;font-size:.8em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:24px;font-weight:100;color:var(--on-background-highlight)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--on-background-highlight)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--on-background)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:14px;line-height:1.2em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:auto}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-bottom:5px;margin-right:5px;height:27px;font-weight:500;padding:1px 15px 0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transform:scale(1.3);transform-origin:center}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;border:1px solid transparent;padding:4px 9px 7px;border-radius:50%;display:none;position:absolute;right:1px;bottom:0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:var(--control-hover);color:var(--on-background-hover)}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]:hover   .actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]:hover   app-fav-icon[_ngcontent-%COMP%]{display:inline}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .folder-health[_ngcontent-%COMP%]{display:flex;width:70%}@media (max-width: 400px){[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]{padding-left:0;padding-right:0}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-size:.8em}[_nghost-%COMP%]   .health[_ngcontent-%COMP%]   .folder[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:16px}}"]});let n=o;return n})();export{at as AdminFolderHealthComponent};
